!function(root,factory){if("object"==typeof exports&&"object"==typeof module)module.exports=factory();else if("function"==typeof define&&define.amd)define([],factory);else{var a=factory();for(var i in a)("object"==typeof exports?exports:root)[i]=a[i]}}(window,function(){return modules=[,function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var UrlSearchParams=__webpack_require__(131),QueryParams=function(){function QueryParams(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,QueryParams)}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(QueryParams,[{key:"urlParams",value:function(){return this._urlParams||(this._urlParams=new UrlSearchParams(window.location.search)),this._urlParams}},{key:"has",value:function(key){return this.urlParams().has(key)}},{key:"get",value:function(key){return this.urlParams().get(key)}},{key:"getUrl",value:function(uri){var url="";return this.has("base")&&(url=this.get("base")+"/"),url+uri}},{key:"getPath",value:function(key){return this.getUrl(this.get(key))}}]),QueryParams}();__webpack_exports__.a=new QueryParams},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;
/*!
 * jQuery JavaScript Library v3.3.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2018-01-20T17:24Z
 */
/*!
 * jQuery JavaScript Library v3.3.1
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2018-01-20T17:24Z
 */
!function(global,factory){"use strict";"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){"use strict";var arr=[],document=window.document,getProto=Object.getPrototypeOf,slice=arr.slice,concat=arr.concat,push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,fnToString=hasOwn.toString,ObjectFunctionString=fnToString.call(Object),support={},isFunction=function(obj){return"function"==typeof obj&&"number"!=typeof obj.nodeType},isWindow=function(obj){return null!=obj&&obj===obj.window},preservedScriptAttributes={type:!0,src:!0,noModule:!0};function DOMEval(code,doc,node){var i,script=(doc=doc||document).createElement("script");if(script.text=code,node)for(i in preservedScriptAttributes)node[i]&&(script[i]=node[i]);doc.head.appendChild(script).parentNode.removeChild(script)}function toType(obj){return null==obj?obj+"":"object"==typeof obj||"function"==typeof obj?class2type[toString.call(obj)]||"object":typeof obj}var jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=toType(obj);return!isFunction(obj)&&!isWindow(obj)&&("array"===type||0===length||"number"==typeof length&&0<length&&length-1 in obj)}jQuery.fn=jQuery.prototype={jquery:"3.3.1",constructor:jQuery,length:0,toArray:function(){return slice.call(this)},get:function(num){return null==num?slice.call(this):num<0?this[num+this.length]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(0<=j&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[i]||{},i++),"object"==typeof target||isFunction(target)||(target={}),i===length&&(target=this,i--);i<length;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],target!==(copy=options[name])&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))?(clone=copyIsArray?(copyIsArray=!1,src&&Array.isArray(src)?src:[]):src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+("3.3.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isPlainObject:function(obj){var proto,Ctor;return!(!obj||"[object Object]"!==toString.call(obj))&&(!(proto=getProto(obj))||"function"==typeof(Ctor=hasOwn.call(proto,"constructor")&&proto.constructor)&&fnToString.call(Ctor)===ObjectFunctionString)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},globalEval:function(code){DOMEval(code)},each:function(obj,callback){var length,i=0;if(isArrayLike(obj))for(length=obj.length;i<length&&!1!==callback.call(obj[i],i,obj[i]);i++);else for(i in obj)if(!1===callback.call(obj[i],i,obj[i]))break;return obj},trim:function(text){return null==text?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArrayLike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){return null==arr?-1:indexOf.call(arr,elem,i)},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;j<len;j++)first[i++]=second[j];return first.length=i,first},grep:function(elems,callback,invert){for(var matches=[],i=0,length=elems.length,callbackExpect=!invert;i<length;i++)!callback(elems[i],i)!=callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems))for(length=elems.length;i<length;i++)null!=(value=callback(elems[i],i,arg))&&ret.push(value);else for(i in elems)null!=(value=callback(elems[i],i,arg))&&ret.push(value);return concat.apply([],ret)},guid:1,support:support}),"function"==typeof Symbol&&(jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]),jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});var Sizzle=
/*!
 * Sizzle CSS Selector Engine v2.3.3
 * https://sizzlejs.com/
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2016-08-08
 */
function(window){function funescape(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!=high||escapedWhitespace?escaped:high<0?String.fromCharCode(65536+high):String.fromCharCode(high>>10|55296,1023&high|56320)}function unloadHandler(){setDocument()}var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;i<len;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),rcssescape=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,fcssescape=function(ch,asCodePoint){return asCodePoint?"\0"===ch?"ï¿½":ch.slice(0,-1)+"\\"+ch.charCodeAt(ch.length-1).toString(16)+" ":"\\"+ch},disabledAncestor=addCombinator(function(elem){return!0===elem.disabled&&("form"in elem||"label"in elem)},{dir:"parentNode",next:"legend"});try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}function Sizzle(selector,context,results,seed){var m,i,elem,nid,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;if(results=results||[],"string"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,documentIsHTML)){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m)))return results;if(elem.id===m)return results.push(elem),results}else if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&!compilerCache[selector+" "]&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(1!==nodeType)newContext=context,newSelector=selector;else if("object"!==context.nodeName.toLowerCase()){for((nid=context.getAttribute("id"))?nid=nid.replace(rcssescape,fcssescape):context.setAttribute("id",nid=expando),i=(groups=tokenize(selector)).length;i--;)groups[i]="#"+nid+" "+toSelector(groups[i]);newSelector=groups.join(","),newContext=rsibling.test(selector)&&testContext(context.parentNode)||context}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{nid===expando&&context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];return function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var el=document.createElement("fieldset");try{return!!fn(el)}catch(e){return!1}finally{el.parentNode&&el.parentNode.removeChild(el),el=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=arr.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&a.sourceIndex-b.sourceIndex;if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){return"input"===elem.nodeName.toLowerCase()&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createDisabledPseudo(disabled){return function(elem){return"form"in elem?elem.parentNode&&!1===elem.disabled?"label"in elem?"label"in elem.parentNode?elem.parentNode.disabled===disabled:elem.disabled===disabled:elem.isDisabled===disabled||elem.isDisabled!==!disabled&&disabledAncestor(elem)===disabled:elem.disabled===disabled:"label"in elem&&elem.disabled===disabled}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&void 0!==context.getElementsByTagName&&context}for(i in support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,subWindow,doc=node?node.ownerDocument||node:preferredDoc;return doc!==document&&9===doc.nodeType&&doc.documentElement&&(docElem=(document=doc).documentElement,documentIsHTML=!isXML(document),preferredDoc!==document&&(subWindow=document.defaultView)&&subWindow.top!==subWindow&&(subWindow.addEventListener?subWindow.addEventListener("unload",unloadHandler,!1):subWindow.attachEvent&&subWindow.attachEvent("onunload",unloadHandler)),support.attributes=assert(function(el){return el.className="i",!el.getAttribute("className")}),support.getElementsByTagName=assert(function(el){return el.appendChild(document.createComment("")),!el.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(document.getElementsByClassName),support.getById=assert(function(el){return docElem.appendChild(el).id=expando,!document.getElementsByName||!document.getElementsByName(expando).length}),support.getById?(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var elem=context.getElementById(id);return elem?[elem]:[]}}):(Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=void 0!==elem.getAttributeNode&&elem.getAttributeNode("id");return node&&node.value===attrId}},Expr.find.ID=function(id,context){if(void 0!==context.getElementById&&documentIsHTML){var node,i,elems,elem=context.getElementById(id);if(elem){if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem];for(elems=context.getElementsByName(id),i=0;elem=elems[i++];)if((node=elem.getAttributeNode("id"))&&node.value===id)return[elem]}return[]}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return void 0!==context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"!==tag)return results;for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(void 0!==context.getElementsByClassName&&documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(document.querySelectorAll))&&(assert(function(el){docElem.appendChild(el).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>",el.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),el.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),el.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),el.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),el.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]")}),assert(function(el){el.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var input=document.createElement("input");input.setAttribute("type","hidden"),el.appendChild(input).setAttribute("name","D"),el.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),2!==el.querySelectorAll(":enabled").length&&rbuggyQSA.push(":enabled",":disabled"),docElem.appendChild(el).disabled=!0,2!==el.querySelectorAll(":disabled").length&&rbuggyQSA.push(":enabled",":disabled"),el.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(el){support.disconnectedMatch=matches.call(el,"*"),matches.call(el,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare||(1&(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0}),document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&!compilerCache[expr+" "]&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return 0<Sizzle(expr,document,null,[elem]).length},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.escape=function(sel){return(sel+"").replace(rcssescape,fcssescape)},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},(Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||void 0!==elem.getAttribute&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&-1<result.indexOf(check):"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?-1<(" "+result.replace(rwhitespace," ")+" ").indexOf(check):"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!=forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=!1;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(diff=(nodeIndex=(cache=(uniqueCache=(outerCache=(node=parent)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1])&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(diff=nodeIndex=(cache=(uniqueCache=(outerCache=(node=elem)[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]||[])[0]===dirruns&&cache[1]),!1===diff)for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((uniqueCache=(outerCache=node[expando]||(node[expando]={}))[node.uniqueID]||(outerCache[node.uniqueID]={}))[type]=[dirruns,diff]),node!==elem)););return(diff-=last)===first||diff%first==0&&0<=diff/first}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):1<fn.length?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)seed[idx=indexOf(seed,matched[i])]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return 0<Sizzle(selector,elem).length}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return-1<(elem.textContent||elem.innerText||getText(elem)).indexOf(text)}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return(elemLang=elemLang.toLowerCase())===lang||0===elemLang.indexOf(lang+"-")}while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:createDisabledPseudo(!1),disabled:createDisabledPseudo(!0),checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,!0===elem.selected},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;0<=--i;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}}).pseudos.nth=Expr.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,skip=combinator.next,key=skip||dir,checkNonElements=base&&"parentNode"===key,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml);return!1}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)if(uniqueCache=(outerCache=elem[expando]||(elem[expando]={}))[elem.uniqueID]||(outerCache[elem.uniqueID]={}),skip&&skip===elem.nodeName.toLowerCase())elem=elem[dir]||elem;else{if((oldCache=uniqueCache[key])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if((uniqueCache[key]=newCache)[2]=matcher(elem,context,xml))return!0}return!1}}function elementMatcher(matchers){return 1<matchers.length?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||function(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&-1<(temp=postFinder?indexOf(seed,elem):preMap[i])&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return-1<indexOf(checkContext,elem)},implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if((matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches))[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(1<i&&elementMatcher(matchers),1<i&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){function superMatcher(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context===document||context||outermost);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0,context||elem.ownerDocument===document||(setDocument(elem),xml=!documentIsHTML);matcher=elementMatchers[j++];)if(matcher(elem,context||document,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(0<matchedCount)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&0<setMatched.length&&1<matchedCount+setMatchers.length&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched}var bySet=0<setMatchers.length,byElement=0<elementMatchers.length;return bySet?markFunction(superMatcher):superMatcher}return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){for(type in matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length)),Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(i=(match=match||tokenize(selector)).length;i--;)(cached=matcherFromTokens(match[i]))[expando]?setMatchers.push(cached):elementMatchers.push(cached);(cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))).selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(2<(tokens=match[0]=match[0].slice(0)).length&&"ID"===(token=tokens[0]).type&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(!(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0]))return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),!(selector=seed.length&&toSelector(tokens)))return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(el){return 1&el.compareDocumentPosition(document.createElement("fieldset"))}),assert(function(el){return el.innerHTML="<a href='#'></a>","#"===el.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(el){return el.innerHTML="<input/>",el.firstChild.setAttribute("value",""),""===el.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(el){return null==el.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return!0===elem[name]?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains,jQuery.escapeSelector=Sizzle.escape;function siblings(n,elem){for(var matched=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&matched.push(n);return matched}var dir=function(elem,dir,until){for(var matched=[],truncate=void 0!==until;(elem=elem[dir])&&9!==elem.nodeType;)if(1===elem.nodeType){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},rneedsContext=jQuery.expr.match.needsContext;function nodeName(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()}var rsingleTag=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function winnow(elements,qualifier,not){return isFunction(qualifier)?jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not}):qualifier.nodeType?jQuery.grep(elements,function(elem){return elem===qualifier!==not}):"string"!=typeof qualifier?jQuery.grep(elements,function(elem){return-1<indexOf.call(qualifier,elem)!==not}):jQuery.filter(qualifier,elements,not)}jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},jQuery.fn.extend({find:function(selector){var i,ret,len=this.length,self=this;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++)if(jQuery.contains(self[i],this))return!0}));for(ret=this.pushStack([]),i=0;i<len;i++)jQuery.find(selector,self[i],ret);return 1<len?jQuery.uniqueSort(ret):ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector)return this;if(root=root||rootjQuery,"string"!=typeof selector)return selector.nodeType?(this[0]=selector,this.length=1,this):isFunction(selector)?void 0!==root.ready?root.ready(selector):selector(jQuery):jQuery.makeArray(selector,this);if(!(match="<"===selector[0]&&">"===selector[selector.length-1]&&3<=selector.length?[null,selector,null]:rquickExpr.exec(selector))||!match[1]&&context)return!context||context.jquery?(context||root).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return(elem=document.getElementById(match[2]))&&(this[0]=elem,this.length=1),this}).prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};function sibling(cur,dir){for(;(cur=cur[dir])&&1!==cur.nodeType;);return cur}jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){for(var i=0;i<l;i++)if(jQuery.contains(this,targets[i]))return!0})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],targets="string"!=typeof selectors&&jQuery(selectors);if(!rneedsContext.test(selectors))for(;i<l;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(targets?-1<targets.index(cur):1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(1<matched.length?jQuery.uniqueSort(matched):matched)},index:function(elem){return elem?"string"==typeof elem?indexOf.call(jQuery(elem),this[0]):indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return siblings(elem.firstChild)},contents:function(elem){return nodeName(elem,"iframe")?elem.contentDocument:(nodeName(elem,"template")&&(elem=elem.content||elem),jQuery.merge([],elem.childNodes))}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(matched=jQuery.filter(selector,matched)),1<this.length&&(guaranteedUnique[name]||jQuery.uniqueSort(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}});var rnothtmlwhite=/[^\x20\t\r\n\f]+/g;function Identity(v){return v}function Thrower(ex){throw ex}function adoptValue(value,resolve,reject,noValue){var method;try{value&&isFunction(method=value.promise)?method.call(value).done(resolve).fail(reject):value&&isFunction(method=value.then)?method.call(value,resolve,reject):resolve.apply(void 0,[value].slice(noValue))}catch(value){reject.apply(void 0,[value])}}jQuery.Callbacks=function(options){options="string"==typeof options?function(options){var object={};return jQuery.each(options.match(rnothtmlwhite)||[],function(_,flag){object[flag]=!0}),object}(options):jQuery.extend({},options);function fire(){for(locked=locked||options.once,fired=firing=!0;queue.length;firingIndex=-1)for(memory=queue.shift();++firingIndex<list.length;)!1===list[firingIndex].apply(memory[0],memory[1])&&options.stopOnFalse&&(firingIndex=list.length,memory=!1);options.memory||(memory=!1),firing=!1,locked&&(list=memory?[]:"")}var firing,memory,fired,locked,list=[],queue=[],firingIndex=-1,self={add:function(){return list&&(memory&&!firing&&(firingIndex=list.length-1,queue.push(memory)),function add(args){jQuery.each(args,function(_,arg){isFunction(arg)?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==toType(arg)&&add(arg)})}(arguments),memory&&!firing&&fire()),this},remove:function(){return jQuery.each(arguments,function(_,arg){for(var index;-1<(index=jQuery.inArray(arg,list,index));)list.splice(index,1),index<=firingIndex&&firingIndex--}),this},has:function(fn){return fn?-1<jQuery.inArray(fn,list):0<list.length},empty:function(){return list=list&&[],this},disable:function(){return locked=queue=[],list=memory="",this},disabled:function(){return!list},lock:function(){return locked=queue=[],memory||firing||(list=memory=""),this},locked:function(){return!!locked},fireWith:function(context,args){return locked||(args=[context,(args=args||[]).slice?args.slice():args],queue.push(args),firing||fire()),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["notify","progress",jQuery.Callbacks("memory"),jQuery.Callbacks("memory"),2],["resolve","done",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),0,"resolved"],["reject","fail",jQuery.Callbacks("once memory"),jQuery.Callbacks("once memory"),1,"rejected"]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},catch:function(fn){return promise.then(null,fn)},pipe:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=isFunction(fns[tuple[4]])&&fns[tuple[4]];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&isFunction(returned.promise)?returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject):newDefer[tuple[0]+"With"](this,fn?[returned]:arguments)})}),fns=null}).promise()},then:function(onFulfilled,onRejected,onProgress){var maxDepth=0;function resolve(depth,deferred,handler,special){return function(){function mightThrow(){var returned,then;if(!(depth<maxDepth)){if((returned=handler.apply(that,args))===deferred.promise())throw new TypeError("Thenable self-resolution");then=returned&&("object"==typeof returned||"function"==typeof returned)&&returned.then,isFunction(then)?special?then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special)):(maxDepth++,then.call(returned,resolve(maxDepth,deferred,Identity,special),resolve(maxDepth,deferred,Thrower,special),resolve(maxDepth,deferred,Identity,deferred.notifyWith))):(handler!==Identity&&(that=void 0,args=[returned]),(special||deferred.resolveWith)(that,args))}}var that=this,args=arguments,process=special?mightThrow:function(){try{mightThrow()}catch(e){jQuery.Deferred.exceptionHook&&jQuery.Deferred.exceptionHook(e,process.stackTrace),maxDepth<=depth+1&&(handler!==Thrower&&(that=void 0,args=[e]),deferred.rejectWith(that,args))}};depth?process():(jQuery.Deferred.getStackHook&&(process.stackTrace=jQuery.Deferred.getStackHook()),window.setTimeout(process))}}return jQuery.Deferred(function(newDefer){tuples[0][3].add(resolve(0,newDefer,isFunction(onProgress)?onProgress:Identity,newDefer.notifyWith)),tuples[1][3].add(resolve(0,newDefer,isFunction(onFulfilled)?onFulfilled:Identity)),tuples[2][3].add(resolve(0,newDefer,isFunction(onRejected)?onRejected:Thrower))}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[5];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[3-i][2].disable,tuples[3-i][3].disable,tuples[0][2].lock,tuples[0][3].lock),list.add(tuple[3].fire),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?void 0:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(singleValue){function updateFunc(i){return function(value){resolveContexts[i]=this,resolveValues[i]=1<arguments.length?slice.call(arguments):value,--remaining||master.resolveWith(resolveContexts,resolveValues)}}var remaining=arguments.length,i=remaining,resolveContexts=Array(i),resolveValues=slice.call(arguments),master=jQuery.Deferred();if(remaining<=1&&(adoptValue(singleValue,master.done(updateFunc(i)).resolve,master.reject,!remaining),"pending"===master.state()||isFunction(resolveValues[i]&&resolveValues[i].then)))return master.then();for(;i--;)adoptValue(resolveValues[i],updateFunc(i),master.reject);return master.promise()}});var rerrorNames=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;jQuery.Deferred.exceptionHook=function(error,stack){window.console&&window.console.warn&&error&&rerrorNames.test(error.name)&&window.console.warn("jQuery.Deferred exception: "+error.message,error.stack,stack)},jQuery.readyException=function(error){window.setTimeout(function(){throw error})};var readyList=jQuery.Deferred();function completed(){document.removeEventListener("DOMContentLoaded",completed),window.removeEventListener("load",completed),jQuery.ready()}jQuery.fn.ready=function(fn){return readyList.then(fn).catch(function(error){jQuery.readyException(error)}),this},jQuery.extend({isReady:!1,readyWait:1,ready:function(wait){(!0===wait?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0)!==wait&&0<--jQuery.readyWait||readyList.resolveWith(document,[jQuery])}}),jQuery.ready.then=readyList.then,"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?window.setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed),window.addEventListener("load",completed));var access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=null==key;if("object"===toType(key))for(i in chainable=!0,key)access(elems,fn,i,key[i],!0,emptyGet,raw);else if(void 0!==value&&(chainable=!0,isFunction(value)||(raw=!0),bulk&&(fn=raw?(fn.call(elems,value),null):(bulk=fn,function(elem,key,value){return bulk.call(jQuery(elem),value)})),fn))for(;i<len;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet},rmsPrefix=/^-ms-/,rdashAlpha=/-([a-z])/g;function fcamelCase(all,letter){return letter.toUpperCase()}function camelCase(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)}function acceptData(owner){return 1===owner.nodeType||9===owner.nodeType||!+owner.nodeType}function Data(){this.expando=jQuery.expando+Data.uid++}Data.uid=1,Data.prototype={cache:function(owner){var value=owner[this.expando];return value||(value={},acceptData(owner)&&(owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,configurable:!0}))),value},set:function(owner,data,value){var prop,cache=this.cache(owner);if("string"==typeof data)cache[camelCase(data)]=value;else for(prop in data)cache[camelCase(prop)]=data[prop];return cache},get:function(owner,key){return void 0===key?this.cache(owner):owner[this.expando]&&owner[this.expando][camelCase(key)]},access:function(owner,key,value){return void 0===key||key&&"string"==typeof key&&void 0===value?this.get(owner,key):(this.set(owner,key,value),void 0!==value?value:key)},remove:function(owner,key){var i,cache=owner[this.expando];if(void 0!==cache){if(void 0!==key){i=(key=Array.isArray(key)?key.map(camelCase):(key=camelCase(key))in cache?[key]:key.match(rnothtmlwhite)||[]).length;for(;i--;)delete cache[key[i]]}void 0!==key&&!jQuery.isEmptyObject(cache)||(owner.nodeType?owner[this.expando]=void 0:delete owner[this.expando])}},hasData:function(owner){var cache=owner[this.expando];return void 0!==cache&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data,dataUser=new Data,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;function dataAttr(elem,key,data){var name;if(void 0===data&&1===elem.nodeType)if(name="data-"+key.replace(rmultiDash,"-$&").toLowerCase(),"string"==typeof(data=elem.getAttribute(name))){try{data=function(data){return"true"===data||"false"!==data&&("null"===data?null:data===+data+""?+data:rbrace.test(data)?JSON.parse(data):data)}(data)}catch(e){}dataUser.set(elem,key,data)}else data=void 0;return data}jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,data){return dataUser.access(elem,name,data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0!==key)return"object"==typeof key?this.each(function(){dataUser.set(this,key)}):access(this,function(value){var data;if(elem&&void 0===value)return void 0!==(data=dataUser.get(elem,key))?data:void 0!==(data=dataAttr(elem,key))?data:void 0;this.each(function(){dataUser.set(this,key,value)})},null,value,1<arguments.length,null,!0);if(this.length&&(data=dataUser.get(elem),1===elem.nodeType&&!dataPriv.get(elem,"hasDataAttrs"))){for(i=attrs.length;i--;)attrs[i]&&0===(name=attrs[i].name).indexOf("data-")&&(name=camelCase(name.slice(5)),dataAttr(elem,name,data[name]));dataPriv.set(elem,"hasDataAttrs",!0)}return data},removeData:function(key){return this.each(function(){dataUser.remove(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||"fx")+"queue",queue=dataPriv.get(elem,type),data&&(!queue||Array.isArray(data)?queue=dataPriv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type);"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,function(){jQuery.dequeue(elem,type)},hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){dataPriv.remove(elem,[type+"queue",key])})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){function resolve(){--count||defer.resolveWith(elements,[elements])}var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length;for("string"!=typeof type&&(obj=type,type=void 0),type=type||"fx";i--;)(tmp=dataPriv.get(elements[i],type+"queueHooks"))&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});function swap(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];for(name in ret=callback.apply(elem,args||[]),options)elem.style[name]=old[name];return ret}var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),cssExpand=["Top","Right","Bottom","Left"],isHiddenWithinTree=function(elem,el){return"none"===(elem=el||elem).style.display||""===elem.style.display&&jQuery.contains(elem.ownerDocument,elem)&&"none"===jQuery.css(elem,"display")};function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||"px"!==unit&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){for(initial/=2,unit=unit||initialInUnit[3],initialInUnit=+initial||1;maxIterations--;)jQuery.style(elem,prop,initialInUnit+unit),(1-scale)*(1-(scale=currentValue()/initial||.5))<=0&&(maxIterations=0),initialInUnit/=scale;initialInUnit*=2,jQuery.style(elem,prop,initialInUnit+unit),valueParts=valueParts||[]}return valueParts&&(initialInUnit=+initialInUnit||+initial||0,adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2],tween&&(tween.unit=unit,tween.start=initialInUnit,tween.end=adjusted)),adjusted}var defaultDisplayMap={};function getDefaultDisplay(elem){var temp,doc=elem.ownerDocument,nodeName=elem.nodeName,display=defaultDisplayMap[nodeName];return display||(temp=doc.body.appendChild(doc.createElement(nodeName)),display=jQuery.css(temp,"display"),temp.parentNode.removeChild(temp),"none"===display&&(display="block"),defaultDisplayMap[nodeName]=display)}function showHide(elements,show){for(var display,elem,values=[],index=0,length=elements.length;index<length;index++)(elem=elements[index]).style&&(display=elem.style.display,show?("none"===display&&(values[index]=dataPriv.get(elem,"display")||null,values[index]||(elem.style.display="")),""===elem.style.display&&isHiddenWithinTree(elem)&&(values[index]=getDefaultDisplay(elem))):"none"!==display&&(values[index]="none",dataPriv.set(elem,"display",display)));for(index=0;index<length;index++)null!=values[index]&&(elements[index].style.display=values[index]);return elements}jQuery.fn.extend({show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHiddenWithinTree(this)?jQuery(this).show():jQuery(this).hide()})}});var rcheckableType=/^(?:checkbox|radio)$/i,rtagName=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,rscriptType=/^$|^module$|\/(?:java|ecma)script/i,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function getAll(context,tag){var ret;return ret=void 0!==context.getElementsByTagName?context.getElementsByTagName(tag||"*"):void 0!==context.querySelectorAll?context.querySelectorAll(tag||"*"):[],void 0===tag||tag&&nodeName(context,tag)?jQuery.merge([context],ret):ret}function setGlobalEval(elems,refElements){for(var i=0,l=elems.length;i<l;i++)dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"))}wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td;var div,input,rhtml=/<|&#?\w+;/;function buildFragment(elems,context,scripts,selection,ignored){for(var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;i<l;i++)if((elem=elems[i])||0===elem)if("object"===toType(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),(tmp=fragment.firstChild).textContent=""}else nodes.push(context.createTextNode(elem));for(fragment.textContent="",i=0;elem=nodes[i++];)if(selection&&-1<jQuery.inArray(elem,selection))ignored&&ignored.push(elem);else if(contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(fragment.appendChild(elem),"script"),contains&&setGlobalEval(tmp),scripts)for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return fragment}div=document.createDocumentFragment().appendChild(document.createElement("div")),(input=document.createElement("input")).setAttribute("type","radio"),input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue;var documentElement=document.documentElement,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function on(elem,types,selector,data,fn,one){var origFn,type;if("object"==typeof types){for(type in"string"!=typeof selector&&(data=data||selector,selector=void 0),types)on(elem,type,selector,data,types[type],one);return elem}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&("string"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),!1===fn)fn=returnFalse;else if(!fn)return elem;return 1===one&&(origFn=fn,(fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)}).guid=origFn.guid||(origFn.guid=jQuery.guid++)),elem.each(function(){jQuery.event.add(this,types,fn,data,selector)})}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(elemData)for(handler.handler&&(handler=(handleObjIn=handler).handler,selector=handleObjIn.selector),selector&&jQuery.find.matchesSelector(documentElement,selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return void 0!==jQuery&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):void 0}),t=(types=(types||"").match(rnothtmlwhite)||[""]).length;t--;)type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||((handlers=events[type]=[]).delegateCount=0,special.setup&&!1!==special.setup.call(elem,data,namespaces,eventHandle)||elem.addEventListener&&elem.addEventListener(type,eventHandle)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0)},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(elemData&&(events=elemData.events)){for(t=(types=(types||"").match(rnothtmlwhite)||[""]).length;t--;)if(type=origType=(tmp=rtypenamespace.exec(types[t])||[])[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},handlers=events[type=(selector?special.delegateType:special.bindType)||type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&!1!==special.teardown.call(elem,namespaces,elemData.handle)||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&dataPriv.remove(elem,"handle events")}},dispatch:function(nativeEvent){var i,j,ret,matched,handleObj,handlerQueue,event=jQuery.event.fix(nativeEvent),args=new Array(arguments.length),handlers=(dataPriv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};for(args[0]=event,i=1;i<arguments.length;i++)args[i]=arguments[i];if(event.delegateTarget=this,!special.preDispatch||!1!==special.preDispatch.call(this,event)){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)event.rnamespace&&!event.rnamespace.test(handleObj.namespace)||(event.handleObj=handleObj,event.data=handleObj.data,void 0!==(ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args))&&!1===(event.result=ret)&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var i,handleObj,sel,matchedHandlers,matchedSelectors,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&!("click"===event.type&&1<=event.button))for(;cur!==this;cur=cur.parentNode||this)if(1===cur.nodeType&&("click"!==event.type||!0!==cur.disabled)){for(matchedHandlers=[],matchedSelectors={},i=0;i<delegateCount;i++)void 0===matchedSelectors[sel=(handleObj=handlers[i]).selector+" "]&&(matchedSelectors[sel]=handleObj.needsContext?-1<jQuery(sel,this).index(cur):jQuery.find(sel,this,null,[cur]).length),matchedSelectors[sel]&&matchedHandlers.push(handleObj);matchedHandlers.length&&handlerQueue.push({elem:cur,handlers:matchedHandlers})}return cur=this,delegateCount<handlers.length&&handlerQueue.push({elem:cur,handlers:handlers.slice(delegateCount)}),handlerQueue},addProp:function(name,hook){Object.defineProperty(jQuery.Event.prototype,name,{enumerable:!0,configurable:!0,get:isFunction(hook)?function(){if(this.originalEvent)return hook(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[name]},set:function(value){Object.defineProperty(this,name,{enumerable:!0,configurable:!0,writable:!0,value:value})}})},fix:function(originalEvent){return originalEvent[jQuery.expando]?originalEvent:new jQuery.Event(originalEvent)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&nodeName(this,"input"))return this.click(),!1},_default:function(event){return nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle)},jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event))return new jQuery.Event(src,props);src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&!1===src.returnValue?returnTrue:returnFalse,this.target=src.target&&3===src.target.nodeType?src.target.parentNode:src.target,this.currentTarget=src.currentTarget,this.relatedTarget=src.relatedTarget):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||Date.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(event){var button=event.button;return null==event.which&&rkeyEvent.test(event.type)?null!=event.charCode?event.charCode:event.keyCode:!event.which&&void 0!==button&&rmouseEvent.test(event.type)?1&button?1:2&button?3:4&button?2:0:event.which}},jQuery.event.addProp),jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,related=event.relatedTarget,handleObj=event.handleObj;return related&&(related===this||jQuery.contains(this,related))||(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),jQuery.fn.extend({on:function(types,selector,data,fn){return on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"!=typeof types)return!1!==selector&&"function"!=typeof selector||(fn=selector,selector=void 0),!1===fn&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)});for(type in types)this.off(type,selector,types[type]);return this}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function manipulationTarget(elem,content){return nodeName(elem,"table")&&nodeName(11!==content.nodeType?content:content.firstChild,"tr")&&jQuery(elem).children("tbody")[0]||elem}function disableScript(elem){return elem.type=(null!==elem.getAttribute("type"))+"/"+elem.type,elem}function restoreScript(elem){return"true/"===(elem.type||"").slice(0,5)?elem.type=elem.type.slice(5):elem.removeAttribute("type"),elem}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(1===dest.nodeType){if(dataPriv.hasData(src)&&(pdataOld=dataPriv.access(src),pdataCur=dataPriv.set(dest,pdataOld),events=pdataOld.events))for(type in delete pdataCur.handle,pdataCur.events={},events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i]);dataUser.hasData(src)&&(udataOld=dataUser.access(src),udataCur=jQuery.extend({},udataOld),dataUser.set(dest,udataCur))}}function domManip(collection,args,callback,ignored){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],valueIsFunction=isFunction(value);if(valueIsFunction||1<l&&"string"==typeof value&&!support.checkClone&&rchecked.test(value))return collection.each(function(index){var self=collection.eq(index);valueIsFunction&&(args[0]=value.call(this,index,self.html())),domManip(self,args,callback,ignored)});if(l&&(first=(fragment=buildFragment(args,collection[0].ownerDocument,!1,collection,ignored)).firstChild,1===fragment.childNodes.length&&(fragment=first),first||ignored)){for(hasScripts=(scripts=jQuery.map(getAll(fragment,"script"),disableScript)).length;i<l;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(collection[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;i<hasScripts;i++)node=scripts[i],rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src&&"module"!==(node.type||"").toLowerCase()?jQuery._evalUrl&&jQuery._evalUrl(node.src):DOMEval(node.textContent.replace(rcleanScript,""),doc,node))}return collection}function remove(elem,selector,keepData){for(var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;null!=(node=nodes[i]);i++)keepData||1!==node.nodeType||jQuery.cleanData(getAll(node)),node.parentNode&&(keepData&&jQuery.contains(node.ownerDocument,node)&&setGlobalEval(getAll(node,"script")),node.parentNode.removeChild(node));return elem}jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>")},clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,src,dest,nodeName,clone=elem.cloneNode(!0),inPage=jQuery.contains(elem.ownerDocument,elem);if(!(support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),i=0,l=(srcElements=getAll(elem)).length;i<l;i++)src=srcElements[i],dest=destElements[i],void 0,"input"===(nodeName=dest.nodeName.toLowerCase())&&rcheckableType.test(src.type)?dest.checked=src.checked:"input"!==nodeName&&"textarea"!==nodeName||(dest.defaultValue=src.defaultValue);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0,l=srcElements.length;i<l;i++)cloneCopyEvent(srcElements[i],destElements[i]);else cloneCopyEvent(elem,clone);return 0<(destElements=getAll(clone,"script")).length&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),clone},cleanData:function(elems){for(var data,elem,type,special=jQuery.event.special,i=0;void 0!==(elem=elems[i]);i++)if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);elem[dataPriv.expando]=void 0}elem[dataUser.expando]&&(elem[dataUser.expando]=void 0)}}}),jQuery.fn.extend({detach:function(selector){return remove(this,selector,!0)},remove:function(selector){return remove(this,selector)},text:function(value){return access(this,function(value){return void 0===value?jQuery.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=value)})},null,value,arguments.length)},append:function(){return domManip(this,arguments,function(elem){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||manipulationTarget(this,elem).appendChild(elem)})},prepend:function(){return domManip(this,arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent="");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null!=dataAndEvents&&dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value&&1===elem.nodeType)return elem.innerHTML;if("string"==typeof value&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;i<l;i++)1===(elem=this[i]||{}).nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;jQuery.inArray(this,ignored)<0&&(jQuery.cleanData(getAll(this)),parent&&parent.replaceChild(elem,this))},ignored)}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;i<=last;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}});var rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),getStyles=function(elem){var view=elem.ownerDocument.defaultView;return view&&view.opener||(view=window),view.getComputedStyle(elem)},rboxStyle=new RegExp(cssExpand.join("|"),"i");function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return(computed=computed||getStyles(elem))&&(""!==(ret=computed.getPropertyValue(name)||computed[name])||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name)),!support.pixelBoxStyles()&&rnumnonpx.test(ret)&&rboxStyle.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),void 0!==ret?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){if(!conditionFn())return(this.get=hookFn).apply(this,arguments);delete this.get}}}!function(){function computeStyleTests(){if(div){container.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",div.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",documentElement.appendChild(container).appendChild(div);var divStyle=window.getComputedStyle(div);pixelPositionVal="1%"!==divStyle.top,reliableMarginLeftVal=12===roundPixelMeasures(divStyle.marginLeft),div.style.right="60%",pixelBoxStylesVal=36===roundPixelMeasures(divStyle.right),boxSizingReliableVal=36===roundPixelMeasures(divStyle.width),div.style.position="absolute",scrollboxSizeVal=36===div.offsetWidth||"absolute",documentElement.removeChild(container),div=null}}function roundPixelMeasures(measure){return Math.round(parseFloat(measure))}var pixelPositionVal,boxSizingReliableVal,scrollboxSizeVal,pixelBoxStylesVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");div.style&&(div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,jQuery.extend(support,{boxSizingReliable:function(){return computeStyleTests(),boxSizingReliableVal},pixelBoxStyles:function(){return computeStyleTests(),pixelBoxStylesVal},pixelPosition:function(){return computeStyleTests(),pixelPositionVal},reliableMarginLeft:function(){return computeStyleTests(),reliableMarginLeftVal},scrollboxSize:function(){return computeStyleTests(),scrollboxSizeVal}}))}();var rdisplayswap=/^(none|table(?!-c[ea]).+)/,rcustomProp=/^--/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","Moz","ms"],emptyStyle=document.createElement("div").style;function finalPropName(name){var ret=jQuery.cssProps[name];return ret=ret||(jQuery.cssProps[name]=function(name){if(name in emptyStyle)return name;for(var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;i--;)if((name=cssPrefixes[i]+capName)in emptyStyle)return name}(name)||name)}function setPositiveNumber(elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value}function boxModelAdjustment(elem,dimension,box,isBorderBox,styles,computedVal){var i="width"===dimension?1:0,extra=0,delta=0;if(box===(isBorderBox?"border":"content"))return 0;for(;i<4;i+=2)"margin"===box&&(delta+=jQuery.css(elem,box+cssExpand[i],!0,styles)),isBorderBox?("content"===box&&(delta-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==box&&(delta-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(delta+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==box?delta+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles):extra+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles));return!isBorderBox&&0<=computedVal&&(delta+=Math.max(0,Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-computedVal-delta-extra-.5))),delta}function getWidthOrHeight(elem,dimension,extra){var styles=getStyles(elem),val=curCSS(elem,dimension,styles),isBorderBox="border-box"===jQuery.css(elem,"boxSizing",!1,styles),valueIsBorderBox=isBorderBox;if(rnumnonpx.test(val)){if(!extra)return val;val="auto"}return valueIsBorderBox=valueIsBorderBox&&(support.boxSizingReliable()||val===elem.style[dimension]),"auto"!==val&&(parseFloat(val)||"inline"!==jQuery.css(elem,"display",!1,styles))||(val=elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)],valueIsBorderBox=!0),(val=parseFloat(val)||0)+boxModelAdjustment(elem,dimension,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles,val)+"px"}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=camelCase(name),isCustomProp=rcustomProp.test(name),style=elem.style;if(isCustomProp||(name=finalPropName(origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value)return hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name];"string"===(type=typeof value)&&(ret=rcssNum.exec(value))&&ret[1]&&(value=adjustCSS(elem,name,ret),type="number"),null!=value&&value==value&&("number"===type&&(value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")),support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),hooks&&"set"in hooks&&void 0===(value=hooks.set(elem,value,extra))||(isCustomProp?style.setProperty(name,value):style[name]=value))}},css:function(elem,name,extra,styles){var val,num,hooks,origName=camelCase(name);return rcustomProp.test(name)||(name=finalPropName(origName)),(hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName])&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),!0===extra||isFinite(num)?num||0:val):val}}),jQuery.each(["height","width"],function(i,dimension){jQuery.cssHooks[dimension]={get:function(elem,computed,extra){if(computed)return!rdisplayswap.test(jQuery.css(elem,"display"))||elem.getClientRects().length&&elem.getBoundingClientRect().width?getWidthOrHeight(elem,dimension,extra):swap(elem,cssShow,function(){return getWidthOrHeight(elem,dimension,extra)})},set:function(elem,value,extra){var matches,styles=getStyles(elem),isBorderBox="border-box"===jQuery.css(elem,"boxSizing",!1,styles),subtract=extra&&boxModelAdjustment(elem,dimension,extra,isBorderBox,styles);return isBorderBox&&support.scrollboxSize()===styles.position&&(subtract-=Math.ceil(elem["offset"+dimension[0].toUpperCase()+dimension.slice(1)]-parseFloat(styles[dimension])-boxModelAdjustment(elem,dimension,"border",!1,styles)-.5)),subtract&&(matches=rcssNum.exec(value))&&"px"!==(matches[3]||"px")&&(elem.style[dimension]=value,value=jQuery.css(elem,dimension)),setPositiveNumber(0,value,subtract)}}}),jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){if(computed)return(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left}))+"px"}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},"margin"!==prefix&&(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)}),jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(Array.isArray(name)){for(styles=getStyles(elem),len=name.length;i<len;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,1<arguments.length)}}),((jQuery.Tween=Tween).prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||jQuery.easing._default,this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}}).init.prototype=Tween.prototype,(Tween.propHooks={_default:{get:function(tween){var result;return 1!==tween.elem.nodeType||null!=tween.elem[tween.prop]&&null==tween.elem.style[tween.prop]?tween.elem[tween.prop]:(result=jQuery.css(tween.elem,tween.prop,""))&&"auto"!==result?result:0},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):1!==tween.elem.nodeType||null==tween.elem.style[jQuery.cssProps[tween.prop]]&&!jQuery.cssHooks[tween.prop]?tween.elem[tween.prop]=tween.now:jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}}}).scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,inProgress,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;function schedule(){inProgress&&(!1===document.hidden&&window.requestAnimationFrame?window.requestAnimationFrame(schedule):window.setTimeout(schedule,jQuery.fx.interval),jQuery.fx.tick())}function createFxNow(){return window.setTimeout(function(){fxNow=void 0}),fxNow=Date.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};for(includeWidth=includeWidth?1:0;i<4;i+=2-includeWidth)attrs["margin"+(which=cssExpand[i])]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;index<length;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),percent=1-(remaining/animation.duration||0),index=0,length=animation.tweens.length;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(length||deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;index<length;index++)animation.tweens[index].run(1);return gotoEnd?(deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation,gotoEnd])):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(!function(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(easing=specialEasing[name=camelCase(index)],value=props[index],Array.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),(hooks=jQuery.cssHooks[name])&&"expand"in hooks)for(index in value=hooks.expand(value),delete props[name],value)index in props||(props[index]=value[index],specialEasing[index]=easing);else specialEasing[name]=easing}(props,animation.opts.specialEasing);index<length;index++)if(result=Animation.prefilters[index].call(animation,elem,props,animation.opts))return isFunction(result.stop)&&(jQuery._queueHooks(animation.elem,animation.opts.queue).stop=result.stop.bind(result)),result;return jQuery.map(props,createTween,animation),isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation}jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);return adjustCSS(tween.elem,prop,rcssNum.exec(value),tween),tween}]},tweener:function(props,callback){for(var prop,index=0,length=(props=isFunction(props)?(callback=props,["*"]):props.match(rnothtmlwhite)).length;index<length;index++)prop=props[index],Animation.tweeners[prop]=Animation.tweeners[prop]||[],Animation.tweeners[prop].unshift(callback)},prefilters:[function(elem,props,opts){var prop,value,toggle,hooks,oldfire,propTween,restoreDisplay,display,isBox="width"in props||"height"in props,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHiddenWithinTree(elem),dataShow=dataPriv.get(elem,"fxshow");for(prop in opts.queue||(null==(hooks=jQuery._queueHooks(elem,"fx")).unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),props)if(value=props[prop],rfxtypes.test(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}if((propTween=!jQuery.isEmptyObject(props))||!jQuery.isEmptyObject(orig))for(prop in isBox&&1===elem.nodeType&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],null==(restoreDisplay=dataShow&&dataShow.display)&&(restoreDisplay=dataPriv.get(elem,"display")),"none"===(display=jQuery.css(elem,"display"))&&(restoreDisplay?display=restoreDisplay:(showHide([elem],!0),restoreDisplay=elem.style.display||restoreDisplay,display=jQuery.css(elem,"display"),showHide([elem]))),("inline"===display||"inline-block"===display&&null!=restoreDisplay)&&"none"===jQuery.css(elem,"float")&&(propTween||(anim.done(function(){style.display=restoreDisplay}),null==restoreDisplay&&(display=style.display,restoreDisplay="none"===display?"":display)),style.display="inline-block")),opts.overflow&&(style.overflow="hidden",anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]})),propTween=!1,orig)propTween||(dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=dataPriv.access(elem,"fxshow",{display:restoreDisplay}),toggle&&(dataShow.hidden=!hidden),hidden&&showHide([elem],!0),anim.done(function(){for(prop in hidden||showHide([elem]),dataPriv.remove(elem,"fxshow"),orig)jQuery.style(elem,prop,orig[prop])})),propTween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=propTween.start,hidden&&(propTween.end=propTween.start,propTween.start=0))}],prefilter:function(callback,prepend){prepend?Animation.prefilters.unshift(callback):Animation.prefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!isFunction(easing)&&easing};return jQuery.fx.off?opt.duration=0:"number"!=typeof opt.duration&&(opt.duration in jQuery.fx.speeds?opt.duration=jQuery.fx.speeds[opt.duration]:opt.duration=jQuery.fx.speeds._default),null!=opt.queue&&!0!==opt.queue||(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHiddenWithinTree).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){function doAnimation(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||dataPriv.get(this,"finish"))&&anim.stop(!0)}var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback);return doAnimation.finish=doAnimation,empty||!1===optall.queue?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){function stopQueue(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)}return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&!1!==type&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));!dequeue&&gotoEnd||jQuery.dequeue(this,type)})},finish:function(type){return!1!==type&&(type=type||"fx"),this.each(function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;index<length;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.timers=[],jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;for(fxNow=Date.now();i<timers.length;i++)(timer=timers[i])()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){inProgress||(inProgress=!0,schedule())},jQuery.fx.stop=function(){inProgress=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx&&jQuery.fx.speeds[time]||time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}})},function(){var input=document.createElement("input"),opt=document.createElement("select").appendChild(document.createElement("option"));input.type="checkbox",support.checkOn=""!==input.value,support.optSelected=opt.selected,(input=document.createElement("input")).value="t",input.type="radio",support.radioValue="t"===input.value}();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,1<arguments.length)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}}),jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return void 0===elem.getAttribute?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(hooks=jQuery.attrHooks[name.toLowerCase()]||(jQuery.expr.match.bool.test(name)?boolHook:void 0)),void 0!==value?null===value?void jQuery.removeAttr(elem,name):hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+""),value):hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:null==(ret=jQuery.find.attr(elem,name))?void 0:ret)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&"radio"===value&&nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}},removeAttr:function(elem,value){var name,i=0,attrNames=value&&value.match(rnothtmlwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)elem.removeAttribute(name)}}),boolHook={set:function(elem,value,name){return!1===value?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle,lowercaseName=name.toLowerCase();return isXML||(handle=attrHandle[lowercaseName],attrHandle[lowercaseName]=ret,ret=null!=getter(elem,name,isXML)?lowercaseName:null,attrHandle[lowercaseName]=handle),ret}});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;function stripAndCollapse(value){return(value.match(rnothtmlwhite)||[]).join(" ")}function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||""}function classesToArray(value){return Array.isArray(value)?value:"string"==typeof value&&value.match(rnothtmlwhite)||[]}jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,1<arguments.length)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}}),jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return 1===nType&&jQuery.isXMLDoc(elem)||(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null},set:function(elem){var parent=elem.parentNode;parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex)}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))});if((classes=classesToArray(value)).length)for(;elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&" "+stripAndCollapse(curValue)+" "){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute("class",finalValue)}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))});if(!arguments.length)return this.attr("class","");if((classes=classesToArray(value)).length)for(;elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&" "+stripAndCollapse(curValue)+" "){for(j=0;clazz=classes[j++];)for(;-1<cur.indexOf(" "+clazz+" ");)cur=cur.replace(" "+clazz+" "," ");curValue!==(finalValue=stripAndCollapse(cur))&&elem.setAttribute("class",finalValue)}return this},toggleClass:function(value,stateVal){var type=typeof value,isValidValue="string"==type||Array.isArray(value);return"boolean"==typeof stateVal&&isValidValue?stateVal?this.addClass(value):this.removeClass(value):isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)}):this.each(function(){var className,i,self,classNames;if(isValidValue)for(i=0,self=jQuery(this),classNames=classesToArray(value);className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else void 0!==value&&"boolean"!=type||((className=getClass(this))&&dataPriv.set(this,"__className__",className),this.setAttribute&&this.setAttribute("class",className||!1===value?"":dataPriv.get(this,"__className__")||""))})},hasClass:function(selector){var className,elem,i=0;for(className=" "+selector+" ";elem=this[i++];)if(1===elem.nodeType&&-1<(" "+stripAndCollapse(getClass(elem))+" ").indexOf(className))return!0;return!1}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,valueIsFunction,elem=this[0];return arguments.length?(valueIsFunction=isFunction(value),this.each(function(i){var val;1===this.nodeType&&(null==(val=valueIsFunction?value.call(this,i,jQuery(this).val()):value)?val="":"number"==typeof val?val+="":Array.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),(hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()])&&"set"in hooks&&void 0!==hooks.set(this,val,"value")||(this.value=val))})):elem?(hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()])&&"get"in hooks&&void 0!==(ret=hooks.get(elem,"value"))?ret:"string"==typeof(ret=elem.value)?ret.replace(rreturn,""):null==ret?"":ret:void 0}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:stripAndCollapse(jQuery.text(elem))}},select:{get:function(elem){var value,option,i,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type,values=one?null:[],max=one?index+1:options.length;for(i=index<0?max:one?index:0;i<max;i++)if(((option=options[i]).selected||i===index)&&!option.disabled&&(!option.parentNode.disabled||!nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)((option=options[i]).selected=-1<jQuery.inArray(jQuery.valHooks.option.get(option),values))&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(Array.isArray(value))return elem.checked=-1<jQuery.inArray(jQuery(elem).val(),value)}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})}),support.focusin="onfocusin"in window;function stopPropagationCallback(e){e.stopPropagation()}var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/;jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,lastElement,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=lastElement=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(-1<type.indexOf(".")&&(type=(namespaces=type.split(".")).shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,(event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event)).isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||!1!==special.trigger.apply(elem,data))){if(!onlyHandlers&&!special.noBubble&&!isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)lastElement=cur,event.type=1<i?bubbleType:special.bindType||type,(handle=(dataPriv.get(cur,"events")||{})[event.type]&&dataPriv.get(cur,"handle"))&&handle.apply(cur,data),(handle=ontype&&cur[ontype])&&handle.apply&&acceptData(cur)&&(event.result=handle.apply(cur,data),!1===event.result&&event.preventDefault());return event.type=type,onlyHandlers||event.isDefaultPrevented()||special._default&&!1!==special._default.apply(eventPath.pop(),data)||!acceptData(elem)||ontype&&isFunction(elem[type])&&!isWindow(elem)&&((tmp=elem[ontype])&&(elem[ontype]=null),jQuery.event.triggered=type,event.isPropagationStopped()&&lastElement.addEventListener(type,stopPropagationCallback),elem[type](),event.isPropagationStopped()&&lastElement.removeEventListener(type,stopPropagationCallback),jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)),event.result}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0});jQuery.event.trigger(e,null,elem)}}),jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem)return jQuery.event.trigger(type,data,elem,!0)}}),support.focusin||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){function handler(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))}jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix);attaches||doc.addEventListener(orig,handler,!0),dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix)-1;attaches?dataPriv.access(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),dataPriv.remove(doc,fix))}}});var location=window.location,nonce=Date.now(),rquery=/\?/;jQuery.parseXML=function(data){var xml;if(!data||"string"!=typeof data)return null;try{xml=(new window.DOMParser).parseFromString(data,"text/xml")}catch(e){xml=void 0}return xml&&!xml.getElementsByTagName("parsererror").length||jQuery.error("Invalid XML: "+data),xml};var rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(Array.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v&&null!=v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==toType(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}jQuery.param=function(a,traditional){function add(key,valueOrFunction){var value=isFunction(valueOrFunction)?valueOrFunction():valueOrFunction;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(null==value?"":value)}var prefix,s=[];if(Array.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:Array.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});var r20=/%20/g,rhash=/#.*$/,rantiCache=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnothtmlwhite)||[];if(isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType[0]?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep=deep||{})[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}originAnchor.href=location.href,jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(location.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){"object"==typeof url&&(options=url,url=void 0),options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,completed,fireGlobals,i,uncached,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(completed){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return completed?responseHeadersString:null},setRequestHeader:function(name,value){return null==completed&&(name=requestHeadersNames[name.toLowerCase()]=requestHeadersNames[name.toLowerCase()]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return null==completed&&(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(completed)jqXHR.always(map[jqXHR.status]);else for(code in map)statusCode[code]=[statusCode[code],map[code]];return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR),s.url=((url||s.url||location.href)+"").replace(rprotocol,location.protocol+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=(s.dataType||"*").toLowerCase().match(rnothtmlwhite)||[""],null==s.crossDomain){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url,urlAnchor.href=urlAnchor.href,s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!=urlAnchor.protocol+"//"+urlAnchor.host}catch(e){s.crossDomain=!0}}if(s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),completed)return jqXHR;for(i in(fireGlobals=jQuery.event&&s.global)&&0==jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url.replace(rhash,""),s.hasContent?s.data&&s.processData&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&(s.data=s.data.replace(r20,"+")):(uncached=s.url.slice(cacheURL.length),s.data&&(s.processData||"string"==typeof s.data)&&(cacheURL+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),!1===s.cache&&(cacheURL=cacheURL.replace(rantiCache,"$1"),uncached=(rquery.test(cacheURL)?"&":"?")+"_="+nonce+++uncached),s.url=cacheURL+uncached),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&!1!==s.contentType||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]),s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(!1===s.beforeSend.call(callbackContext,jqXHR,s)||completed))return jqXHR.abort();if(strAbort="abort",completeDeferred.add(s.complete),jqXHR.done(s.success),jqXHR.fail(s.error),transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){if(jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),completed)return jqXHR;s.async&&0<s.timeout&&(timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{completed=!1,transport.send(requestHeaders,done)}catch(e){if(completed)throw e;done(-1,e)}}else done(-1,"No Transport");function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;completed||(completed=!0,timeoutTimer&&window.clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||"",jqXHR.readyState=0<status?4:0,isSuccess=200<=status&&status<300||304===status,responses&&(response=function(s,jqXHR,responses){for(var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType=firstDataType||type}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}(s,jqXHR,responses)),response=function(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(!(conv=converters[prev+" "+current]||converters["* "+current]))for(conv2 in converters)if((tmp=conv2.split(" "))[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){!0===conv?conv=converters[conv2]:!0!==converters[conv2]&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(!0!==conv)if(conv&&s.throws)response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&((modified=jqXHR.getResponseHeader("Last-Modified"))&&(jQuery.lastModified[cacheURL]=modified),(modified=jqXHR.getResponseHeader("etag"))&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,isSuccess=!(error=response.error))):(error=statusText,!status&&statusText||(statusText="error",status<0&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,"script")}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}}),jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},jQuery.fn.extend({wrapAll:function(html){var wrap;return this[0]&&(isFunction(html)&&(html=html.call(this[0])),wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstElementChild;)elem=elem.firstElementChild;return elem}).append(this)),this},wrapInner:function(html){return isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var htmlIsFunction=isFunction(html);return this.each(function(i){jQuery(this).wrapAll(htmlIsFunction?html.call(this,i):html)})},unwrap:function(selector){return this.parent(selector).not("body").each(function(){jQuery(this).replaceWith(this.childNodes)}),this}}),jQuery.expr.pseudos.hidden=function(elem){return!jQuery.expr.pseudos.visible(elem)},jQuery.expr.pseudos.visible=function(elem){return!!(elem.offsetWidth||elem.offsetHeight||elem.getClientRects().length)},jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(options){var callback,errorCallback;if(support.cors||xhrSupported&&!options.crossDomain)return{send:function(headers,complete){var i,xhr=options.xhr();if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];for(i in options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest"),headers)xhr.setRequestHeader(i,headers[i]);callback=function(type){return function(){callback&&(callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.ontimeout=xhr.onreadystatechange=null,"abort"===type?xhr.abort():"error"===type?"number"!=typeof xhr.status?complete(0,"error"):complete(xhr.status,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,"text"!==(xhr.responseType||"text")||"string"!=typeof xhr.responseText?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders()))}},xhr.onload=callback(),errorCallback=xhr.onerror=xhr.ontimeout=callback("error"),void 0!==xhr.onabort?xhr.onabort=errorCallback:xhr.onreadystatechange=function(){4===xhr.readyState&&window.setTimeout(function(){callback&&errorCallback()})},callback=callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(callback)throw e}},abort:function(){callback&&callback()}}}),jQuery.ajaxPrefilter(function(s){s.crossDomain&&(s.contents.script=!1)}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type="GET")}),jQuery.ajaxTransport("script",function(s){var script,callback;if(s.crossDomain)return{send:function(_,complete){script=jQuery("<script>").prop({charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove(),callback=null,evt&&complete("error"===evt.type?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){callback&&callback()}}});var body,oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=!1!==s.jsonp&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||"jsonp"===s.dataTypes[0])return callbackName=s.jsonpCallback=isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):!1!==s.jsonp&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){void 0===overwritten?jQuery(window).removeProp(callbackName):window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0}),"script"}),support.createHTMLDocument=((body=document.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===body.childNodes.length),jQuery.parseHTML=function(data,context,keepScripts){return"string"!=typeof data?[]:("boolean"==typeof context&&(keepScripts=context,context=!1),context||(support.createHTMLDocument?((base=(context=document.implementation.createHTMLDocument("")).createElement("base")).href=document.location.href,context.head.appendChild(base)):context=document),scripts=!keepScripts&&[],(parsed=rsingleTag.exec(data))?[context.createElement(parsed[1])]:(parsed=buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes)));var base,parsed,scripts},jQuery.fn.load=function(url,params,callback){var selector,type,response,self=this,off=url.indexOf(" ");return-1<off&&(selector=stripAndCollapse(url.slice(off)),url=url.slice(0,off)),isFunction(params)?(callback=params,params=void 0):params&&"object"==typeof params&&(type="POST"),0<self.length&&jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(this,response||[jqXHR.responseText,status,jqXHR])})}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.expr.pseudos.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length},jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),curLeft=("absolute"===position||"fixed"===position)&&-1<(curCSSTop+curCSSLeft).indexOf("auto")?(curTop=(curPosition=curElem.position()).top,curPosition.left):(curTop=parseFloat(curCSSTop)||0,parseFloat(curCSSLeft)||0),isFunction(options)&&(options=options.call(elem,i,jQuery.extend({},curOffset))),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var rect,win,elem=this[0];return elem?elem.getClientRects().length?(rect=elem.getBoundingClientRect(),win=elem.ownerDocument.defaultView,{top:rect.top+win.pageYOffset,left:rect.left+win.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var offsetParent,offset,doc,elem=this[0],parentOffset={top:0,left:0};if("fixed"===jQuery.css(elem,"position"))offset=elem.getBoundingClientRect();else{for(offset=this.offset(),doc=elem.ownerDocument,offsetParent=elem.offsetParent||doc.documentElement;offsetParent&&(offsetParent===doc.body||offsetParent===doc.documentElement)&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.parentNode;offsetParent&&offsetParent!==elem&&1===offsetParent.nodeType&&((parentOffset=jQuery(offsetParent).offset()).top+=jQuery.css(offsetParent,"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent,"borderLeftWidth",!0))}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent;offsetParent&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||documentElement})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win;if(isWindow(elem)?win=elem:9===elem.nodeType&&(win=elem.defaultView),void 0===val)return win?win[prop]:elem[method];win?win.scrollTo(top?win.pageXOffset:val,top?val:win.pageYOffset):elem[method]=val},method,val,arguments.length)}}),jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed)return computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed})}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(!0===margin||!0===value?"margin":"border");return access(this,function(elem,type,value){var doc;return isWindow(elem)?0===funcName.indexOf("outer")?elem["inner"+name]:elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:void 0,chainable)}})}),jQuery.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return 0<arguments.length?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)}}),jQuery.proxy=function(fn,context){var tmp,args,proxy;if("string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),isFunction(fn))return args=slice.call(arguments,2),(proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))}).guid=fn.guid=fn.guid||jQuery.guid++,proxy},jQuery.holdReady=function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},jQuery.isArray=Array.isArray,jQuery.parseJSON=JSON.parse,jQuery.nodeName=nodeName,jQuery.isFunction=isFunction,jQuery.isWindow=isWindow,jQuery.camelCase=camelCase,jQuery.type=toType,jQuery.now=Date.now,jQuery.isNumeric=function(obj){var type=jQuery.type(obj);return("number"===type||"string"===type)&&!isNaN(obj-parseFloat(obj))},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return jQuery}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__);var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},noGlobal||(window.jQuery=window.$=jQuery),jQuery})},,,,,,function(module,exports,__webpack_require__){"use strict";var bind=__webpack_require__(72),isBuffer=__webpack_require__(136),toString=Object.prototype.toString;function isArray(val){return"[object Array]"===toString.call(val)}function isObject(val){return null!==val&&"object"==typeof val}function isFunction(val){return"[object Function]"===toString.call(val)}function forEach(obj,fn){if(null!=obj)if("object"!=typeof obj&&(obj=[obj]),isArray(obj))for(var i=0,l=obj.length;i<l;i++)fn.call(null,obj[i],i,obj);else for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&fn.call(null,obj[key],key,obj)}module.exports={isArray:isArray,isArrayBuffer:function(val){return"[object ArrayBuffer]"===toString.call(val)},isBuffer:isBuffer,isFormData:function(val){return"undefined"!=typeof FormData&&val instanceof FormData},isArrayBufferView:function(val){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(val):val&&val.buffer&&val.buffer instanceof ArrayBuffer},isString:function(val){return"string"==typeof val},isNumber:function(val){return"number"==typeof val},isObject:isObject,isUndefined:function(val){return void 0===val},isDate:function(val){return"[object Date]"===toString.call(val)},isFile:function(val){return"[object File]"===toString.call(val)},isBlob:function(val){return"[object Blob]"===toString.call(val)},isFunction:isFunction,isStream:function(val){return isObject(val)&&isFunction(val.pipe)},isURLSearchParams:function(val){return"undefined"!=typeof URLSearchParams&&val instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:forEach,merge:function merge(){var result={};function assignValue(val,key){"object"==typeof result[key]&&"object"==typeof val?result[key]=merge(result[key],val):result[key]=val}for(var i=0,l=arguments.length;i<l;i++)forEach(arguments[i],assignValue);return result},extend:function(a,b,thisArg){return forEach(b,function(val,key){a[key]=thisArg&&"function"==typeof val?bind(val,thisArg):val}),a},trim:function(str){return str.replace(/^\s*/,"").replace(/\s*$/,"")}}},,,,,function(module,exports,__webpack_require__){"use strict";function Widget(element,options,event){this.element=element,this.options=options||{},this.namespace=this.namespace||"somewidget",this.event=event||null}var $=__webpack_require__(2);Widget.prototype={destroy:function(element){$(element).removeData(this.namespace).off("."+this.namespace).show().next(".widget").remove()},disable:function(element){$(element).next(".widget").addClass("readonly")},enable:function(element){element.readOnly||$(element).next(".widget").removeClass("readonly")},update:function(){}},module.exports=Widget},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var index_browser=__webpack_require__(60),index_browser_default=__webpack_require__.n(index_browser);window.PouchDB=index_browser_default.a;var instances={};function Storage(dbName){var driver=function(name){return new index_browser_default.a(name,{revs_limit:1,auto_compaction:!0})}(dbName);this.all=function(){return driver.allDocs({include_docs:!0}).then(function(result){return result.rows.map(function(row){return row.doc})})},this.create=function(doc){return driver.post(doc).then(function(result){return driver.get(result.id)})},this.update=function(doc){return driver.put(doc).then(function(result){return driver.get(result.id)})},this.get=function(id){return driver.get(id)},this.remove=function(doc){return driver.remove(doc)},this.attach=function(id,attachmentId,blob){return driver.putAttachment(id,attachmentId,blob)},this.getAttachment=function(id,filename){return driver.getAttachment(id,filename)}}var QueryParams=__webpack_require__(1),databaseName="sessions";QueryParams.a.has("db")&&(databaseName=QueryParams.a.get("db"));var name;__webpack_exports__.default=(name=databaseName,instances.hasOwnProperty(name)||(instances[name]=new Storage(name)),instances[name])},,function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Session});var _QueryParams__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(source,!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Session=function(){function Session(data){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Session),this.data=_objectSpread({xml:null,online:!1,draft:!0,payload:{},_attachments:{},submitted:!1,instance_id:null,deprecated_id:null,last_update:Date.now()},data),data.hasOwnProperty("payload")||this._setPayloadFromUrl()}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(Session,[{key:"setData",value:function(data){return this.data=_objectSpread({},this.data,{},data,{last_update:Date.now()}),this}},{key:"_setPayloadFromUrl",value:function(){try{var sessionExtra=_QueryParams__WEBPACK_IMPORTED_MODULE_0__.a.get("session_extra");this.setData({payload:JSON.parse(sessionExtra)})}catch(e){console.error(e)}}},{key:"putEnketoForm",value:function(form){this.setData({xml:form.xml,instance_id:form.instance_id,deprecated_id:form.deprecated_id,current_page:form.current_page,_attachments:this._getFiles(form.files)})}},{key:"toFormInstance",value:function(){return{instanceStr:this.data.xml,submitted:this.data.submitted}}},{key:"isOnline",value:function(){return this.data.online}},{key:"_getFiles",value:function(files){var _this=this;if(!files||"object"!==_typeof(files))return this.data._attachments;var attachments={};return files.forEach(function(file){_this._isFileStub(file)?_this._attachmentExists(file)&&(attachments[file]=_objectSpread({},_this.data._attachments[file],{stub:!0})):attachments[file.name]={data:file,content_type:file.type}}),attachments}},{key:"_isFileStub",value:function(file){return"string"==typeof file}},{key:"_attachmentExists",value:function(name){return this.data.hasOwnProperty("_attachments")&&this.data._attachments.hasOwnProperty(name)}}]),Session}()},,,,,,,,,,function(module,exports,__webpack_require__){"use strict";var os=__webpack_require__(439).os,inputTypes={},mobile=!1;["date","datetime","time","month"].forEach(function(inputType){var input=document.createElement("input");input.setAttribute("type",inputType),inputTypes[inputType]="text"!==input.type}),(os.ios||os.android)&&(mobile=!0,document.documentElement.classList.add("touch")),module.exports={get inputtypes(){return console.deprecate("support.inputtypes","support.inputTypes"),inputTypes},get inputTypes(){return inputTypes},get touch(){return mobile},set touch(val){mobile=val}}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__webpack_require__(129),__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function($){return toastId=0,toastType_error="error",toastType_info="info",toastType_success="success",toastType_warning="warning",toastr={clear:function($toastElement,clearOptions){var options=getOptions();$container||getContainer(options),clearToast($toastElement,options,clearOptions)||function(options){for(var toastsToClear=$container.children(),i=toastsToClear.length-1;0<=i;i--)clearToast($(toastsToClear[i]),options)}(options)},remove:function($toastElement){var options=getOptions();$container||getContainer(options),$toastElement&&0===$(":focus",$toastElement).length?removeToast($toastElement):$container.children().length&&$container.remove()},error:function(message,title,optionsOverride){return notify({type:toastType_error,iconClass:getOptions().iconClasses.error,message:message,optionsOverride:optionsOverride,title:title})},getContainer:getContainer,info:function(message,title,optionsOverride){return notify({type:toastType_info,iconClass:getOptions().iconClasses.info,message:message,optionsOverride:optionsOverride,title:title})},options:{},subscribe:function(callback){listener=callback},success:function(message,title,optionsOverride){return notify({type:toastType_success,iconClass:getOptions().iconClasses.success,message:message,optionsOverride:optionsOverride,title:title})},version:"2.1.4",warning:function(message,title,optionsOverride){return notify({type:toastType_warning,iconClass:getOptions().iconClasses.warning,message:message,optionsOverride:optionsOverride,title:title})}};function getContainer(options,create){return options=options||getOptions(),($container=$("#"+options.containerId)).length||create&&($container=function(options){return($container=$("<div/>").attr("id",options.containerId).addClass(options.positionClass)).appendTo($(options.target)),$container}(options)),$container}function clearToast($toastElement,options,clearOptions){var force=!(!clearOptions||!clearOptions.force)&&clearOptions.force;return!(!$toastElement||!force&&0!==$(":focus",$toastElement).length||($toastElement[options.hideMethod]({duration:options.hideDuration,easing:options.hideEasing,complete:function(){removeToast($toastElement)}}),0))}function publish(args){listener&&listener(args)}function notify(map){var options=getOptions(),iconClass=map.iconClass||options.iconClass;if(void 0!==map.optionsOverride&&(options=$.extend(options,map.optionsOverride),iconClass=map.optionsOverride.iconClass||iconClass),!function(options,map){if(options.preventDuplicates){if(map.message===previousToast)return!0;previousToast=map.message}return!1}(options,map)){toastId++,$container=getContainer(options,!0);var intervalId=null,$toastElement=$("<div/>"),$titleElement=$("<div/>"),$messageElement=$("<div/>"),$progressElement=$("<div/>"),$closeElement=$(options.closeHtml),progressBar={intervalId:null,hideEta:null,maxHideTime:null},response={toastId:toastId,state:"visible",startTime:new Date,options:options,map:map};return map.iconClass&&$toastElement.addClass(options.toastClass).addClass(iconClass),function(){if(map.title){var suffix=map.title;options.escapeHtml&&(suffix=escapeHtml(map.title)),$titleElement.append(suffix).addClass(options.titleClass),$toastElement.append($titleElement)}}(),function(){if(map.message){var suffix=map.message;options.escapeHtml&&(suffix=escapeHtml(map.message)),$messageElement.append(suffix).addClass(options.messageClass),$toastElement.append($messageElement)}}(),options.closeButton&&($closeElement.addClass(options.closeClass).attr("role","button"),$toastElement.prepend($closeElement)),options.progressBar&&($progressElement.addClass(options.progressClass),$toastElement.prepend($progressElement)),options.rtl&&$toastElement.addClass("rtl"),options.newestOnTop?$container.prepend($toastElement):$container.append($toastElement),function(){var ariaValue="";switch(map.iconClass){case"toast-success":case"toast-info":ariaValue="polite";break;default:ariaValue="assertive"}$toastElement.attr("aria-live",ariaValue)}(),$toastElement.hide(),$toastElement[options.showMethod]({duration:options.showDuration,easing:options.showEasing,complete:options.onShown}),0<options.timeOut&&(intervalId=setTimeout(hideToast,options.timeOut),progressBar.maxHideTime=parseFloat(options.timeOut),progressBar.hideEta=(new Date).getTime()+progressBar.maxHideTime,options.progressBar&&(progressBar.intervalId=setInterval(updateProgress,10))),options.closeOnHover&&$toastElement.hover(stickAround,delayedHideToast),!options.onclick&&options.tapToDismiss&&$toastElement.click(hideToast),options.closeButton&&$closeElement&&$closeElement.click(function(event){event.stopPropagation?event.stopPropagation():void 0!==event.cancelBubble&&!0!==event.cancelBubble&&(event.cancelBubble=!0),options.onCloseClick&&options.onCloseClick(event),hideToast(!0)}),options.onclick&&$toastElement.click(function(event){options.onclick(event),hideToast()}),publish(response),options.debug&&console&&console.log(response),$toastElement}function escapeHtml(source){return null==source&&(source=""),source.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function hideToast(override){var method=override&&!1!==options.closeMethod?options.closeMethod:options.hideMethod,duration=override&&!1!==options.closeDuration?options.closeDuration:options.hideDuration,easing=override&&!1!==options.closeEasing?options.closeEasing:options.hideEasing;if(!$(":focus",$toastElement).length||override)return clearTimeout(progressBar.intervalId),$toastElement[method]({duration:duration,easing:easing,complete:function(){removeToast($toastElement),clearTimeout(intervalId),options.onHidden&&"hidden"!==response.state&&options.onHidden(),response.state="hidden",response.endTime=new Date,publish(response)}})}function delayedHideToast(){(0<options.timeOut||0<options.extendedTimeOut)&&(intervalId=setTimeout(hideToast,options.extendedTimeOut),progressBar.maxHideTime=parseFloat(options.extendedTimeOut),progressBar.hideEta=(new Date).getTime()+progressBar.maxHideTime)}function stickAround(){clearTimeout(intervalId),progressBar.hideEta=0,$toastElement.stop(!0,!0)[options.showMethod]({duration:options.showDuration,easing:options.showEasing})}function updateProgress(){var percentage=(progressBar.hideEta-(new Date).getTime())/progressBar.maxHideTime*100;$progressElement.width(percentage+"%")}}function getOptions(){return $.extend({},{tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1e3,hideEasing:"swing",onHidden:void 0,closeMethod:!1,closeDuration:!1,closeEasing:!1,closeOnHover:!0,extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",escapeHtml:!1,target:"body",closeHtml:'<button type="button">&times;</button>',closeClass:"toast-close-button",newestOnTop:!0,preventDuplicates:!1,progressBar:!1,progressClass:"toast-progress",rtl:!1},toastr.options)}function removeToast($toastElement){$container=$container||getContainer(),$toastElement.is(":visible")||($toastElement.remove(),$toastElement=null,0===$container.children().length&&($container.remove(),previousToast=void 0))}var $container,listener,previousToast,toastId,toastType_error,toastType_info,toastType_success,toastType_warning,toastr}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},,,function(module,exports,__webpack_require__){"use strict";var cookies;module.exports={parseFunctionFromExpression:function(expr,func){var index,result,openBrackets,start,argStart,args,findFunc=new RegExp(func+"\\s*\\(","g"),results=[];if(!expr||!func)return results;for(;null!==(result=findFunc.exec(expr));){for(openBrackets=1,args=[],start=result.index,argStart=index=findFunc.lastIndex;0!==openBrackets;)"("===expr[++index]?openBrackets++:")"===expr[index]?openBrackets--:","===expr[index]&&1===openBrackets&&(args.push(expr.substring(argStart,index).trim()),argStart=index+1);args.push(expr.substring(argStart,index).trim()),results.push([expr.substring(start,index+1),args])}return results},stripQuotes:function(str){return/^".+"$/.test(str)||/^'.+'$/.test(str)?str.substring(1,str.length-1):str},getFilename:function(file,postfix){var filenameParts;return"object"==typeof file&&null!==file&&file.name?(postfix=postfix||"",1<(filenameParts=file.name.split(".")).length?filenameParts[filenameParts.length-2]+=postfix:1===filenameParts.length&&(filenameParts[0]+=postfix),filenameParts.join(".")):""},toArray:function(list){for(var array=[],i=list.length>>>0;i--;)array[i]=list[i];return array},isNumber:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},readCookie:function(name){var c,C,i;if(cookies)return cookies[name];for(c=document.cookie.split("; "),cookies={},i=c.length-1;0<=i;i--)(C=c[i].split("="))[1]=decodeURIComponent(C[1]),"s:"===C[1].substr(0,2)&&(C[1]=C[1].slice(2),C[1]=C[1].slice(0,C[1].lastIndexOf("."))),cookies[C[0]]=decodeURIComponent(C[1]);return cookies[name]},dataUriToBlobSync:function(dataURI){var byteString,mimeString,buffer,array;byteString=atob(dataURI.split(",")[1]),mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],buffer=new ArrayBuffer(byteString.length),array=new Uint8Array(buffer);for(var i=0;i<byteString.length;i++)array[i]=byteString.charCodeAt(i);return new Blob([array],{type:mimeString})},getPasteData:function(event){var clipboardData=event.originalEvent.clipboardData||window.clipboardData;return clipboardData?clipboardData.getData("text"):null}}},function(module,exports,__webpack_require__){__webpack_require__(130),module.exports=angular},function(module,__webpack_exports__,__webpack_require__){"use strict";var axios=__webpack_require__(41),axios_default=__webpack_require__.n(axios);function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var common_Cookies=new(function(){function Cookies(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Cookies)}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(Cookies,[{key:"get",value:function(cname){for(var name=cname+"=",ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}}]),Cookies}()),QueryParams=__webpack_require__(1),SessionRepository=__webpack_require__(14);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Server_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__webpack_require__.d(__webpack_exports__,"a",function(){return Server_Server});var serverInstance=null,Server_Server=function(){function Server(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Server),this._configureAxios()}var _postForm,_getFileBlob,_json;return function(Constructor,protoProps,staticProps){protoProps&&Server_defineProperties(Constructor.prototype,protoProps),staticProps&&Server_defineProperties(Constructor,staticProps)}(Server,[{key:"_configureAxios",value:function(){var token=this._detectAuthToken();null!==token&&(axios_default.a.defaults.headers.common.Authorization="Bearer "+token)}},{key:"_detectAuthToken",value:function(){return QueryParams.a.has("auth")?QueryParams.a.get("auth"):common_Cookies.get("enketo_token")?common_Cookies.get("enketo_token"):null}},{key:"json",value:(_json=_asyncToGenerator(regeneratorRuntime.mark(function _callee(url){var _ref,data;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,axios_default.a.get(url);case 2:return _ref=_context.sent,data=_ref.data,_context.abrupt("return",data);case 5:case"end":return _context.stop()}},_callee)})),function(_x){return _json.apply(this,arguments)})},{key:"getFileBlob",value:(_getFileBlob=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(sessionId,fileName,attachment){var blob;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(attachment.data&&!attachment.stub)return _context2.abrupt("return",{file:fileName,blob:attachment.data});_context2.next=2;break;case 2:return _context2.next=4,SessionRepository.default.getAttachment(sessionId,fileName);case 4:return blob=_context2.sent,_context2.abrupt("return",{file:fileName,blob:blob});case 6:case"end":return _context2.stop()}},_callee2)})),function(_x2,_x3,_x4){return _getFileBlob.apply(this,arguments)})},{key:"getFileBlobs",value:function(sessionId,attachments){var _this=this;return Object.keys(attachments).map(function(file){return _this.getFileBlob(sessionId,file,attachments[file])})}},{key:"postForm",value:(_postForm=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(session){var onProgress,form,submitUrl,config,_ref3,data,_args3=arguments;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(onProgress=1<_args3.length&&void 0!==_args3[1]?_args3[1]:null,(form=new FormData).append("Date",(new Date).toUTCString()),form.append("xml_submission_file",new Blob([session.data.xml])),"object"===_typeof(session.data.payload)&&form.append("Payload",JSON.stringify(session.data.payload)),"object"===_typeof(session.data._attachments))return _context3.next=8,Promise.all(this.getFileBlobs(session.data._id,session.data._attachments));_context3.next=10;break;case 8:_context3.sent.forEach(function(_ref2){var file=_ref2.file,blob=_ref2.blob;return form.append(file,blob,file)});case 10:return submitUrl=QueryParams.a.getPath("submit"),config={headers:this._headersForSession(session)},onProgress&&(config.onUploadProgress=function(progressEvent){return onProgress(0<progressEvent.total?progressEvent.loaded/progressEvent.total:0)}),_context3.next=15,axios_default.a.post(submitUrl,form,config);case 15:return _ref3=_context3.sent,data=_ref3.data,_context3.abrupt("return",data);case 18:case"end":return _context3.stop()}},_callee3,this)})),function(_x5){return _postForm.apply(this,arguments)})},{key:"_headersForSession",value:function(session){return{"Content-Type":"multipart/form-data","X-OpenRosa-Version":"1.0","X-OpenRosa-Instance-Id":session.data.instance_id,"X-OpenRosa-Deprecated-Id":session.data.deprecated_id}}}],[{key:"create",value:function(){return serverInstance=serverInstance||Server.newInstance()}},{key:"newInstance",value:function(){return new Server}}]),Server}()},function(module,exports,__webpack_require__){module.exports=__webpack_require__(135)},,,,function(module,exports,__webpack_require__){var E=__webpack_require__(414);module.exports=new E},function(module,exports,__webpack_require__){"use strict";var SOURCE_STRINGS={constraint:{invalid:"Value not allowed",required:"This field is required"},"esri-geopicker":{"coordinate-mgrs":"MGRS coordinate",decimal:"decimal",degrees:"degrees, minutes, seconds","latitude-degrees":"latitude (dÂ° mâ sâ N)","longitude-degrees":"longitude (dÂ° mâ sâ W)",mgrs:"MGRS",notavailable:"Not Available",utm:"UTM","utm-easting":"easting (m)","utm-hemisphere":"hemisphere","utm-north":"North","utm-northing":"northing (m)","utm-south":"South","utm-zone":"zone"},filepicker:{placeholder:"Click here to upload file. (< __maxSize__)",notFound:"File __existing__ could not be found (leave unchanged if already submitted and you want to preserve it).",waitingForPermissions:"Waiting for user permissions.",resetWarning:"This will remove the __item__. Are you sure you want to do this?",toolargeerror:"File too large (> __maxSize__)",file:"file"},drawwidget:{drawing:"drawing",signature:"signature",annotation:"file and drawing"},form:{required:"required"},geopicker:{accuracy:"accuracy (m)",altitude:"altitude (m)",closepolygon:"close polygon",kmlcoords:"KML coordinates",kmlpaste:"paste KML coordinates here",latitude:"latitude (x.y Â°)",longitude:"longitude (x.y Â°)",points:"points",searchPlaceholder:"search for place or address",removePoint:"This will completely remove the current geopoint from the list of geopoints and cannot be undone. Are you sure you want to do this?"},selectpicker:{noneselected:"none selected",numberselected:"__number__ selected"},imagemap:{svgNotFound:"SVG image could not be found"},widget:{comment:{update:"Update"}},alert:{gotonotfound:{msg:"Failed to find question '__path__' in form. Is it a valid path?"}}};module.exports={t:function(key,options){var str="",target=SOURCE_STRINGS;return key.split(".").forEach(function(part){target=target?target[part]:"",str=target}),options=options||{},str=str.replace(/__([^_]+)__/,function(match,p1){return options[p1]})}}},,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";var immediate=__webpack_require__(65);function INTERNAL(){}var handlers={},REJECTED=["REJECTED"],FULFILLED=["FULFILLED"],PENDING=["PENDING"];function Promise(resolver){if("function"!=typeof resolver)throw new TypeError("resolver must be a function");this.state=PENDING,this.queue=[],this.outcome=void 0,resolver!==INTERNAL&&safelyResolveThenable(this,resolver)}function QueueItem(promise,onFulfilled,onRejected){this.promise=promise,"function"==typeof onFulfilled&&(this.onFulfilled=onFulfilled,this.callFulfilled=this.otherCallFulfilled),"function"==typeof onRejected&&(this.onRejected=onRejected,this.callRejected=this.otherCallRejected)}function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}returnValue===promise?handlers.reject(promise,new TypeError("Cannot resolve promise with itself")):handlers.resolve(promise,returnValue)})}function getThen(obj){var then=obj&&obj.then;if(obj&&("object"==typeof obj||"function"==typeof obj)&&"function"==typeof then)return function(){then.apply(obj,arguments)}}function safelyResolveThenable(self,thenable){var called=!1;function onError(value){called||(called=!0,handlers.reject(self,value))}function onSuccess(value){called||(called=!0,handlers.resolve(self,value))}var result=tryCatch(function(){thenable(onSuccess,onError)});"error"===result.status&&onError(result.value)}function tryCatch(func,value){var out={};try{out.value=func(value),out.status="success"}catch(e){out.status="error",out.value=e}return out}(module.exports=Promise).prototype.finally=function(callback){if("function"!=typeof callback)return this;var p=this.constructor;return this.then(function(value){return p.resolve(callback()).then(function(){return value})},function(reason){return p.resolve(callback()).then(function(){throw reason})})},Promise.prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){if("function"!=typeof onFulfilled&&this.state===FULFILLED||"function"!=typeof onRejected&&this.state===REJECTED)return this;var promise=new this.constructor(INTERNAL);this.state!==PENDING?unwrap(promise,this.state===FULFILLED?onFulfilled:onRejected,this.outcome):this.queue.push(new QueueItem(promise,onFulfilled,onRejected));return promise},QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)},QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)},QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)},QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)},handlers.resolve=function(self,value){var result=tryCatch(getThen,value);if("error"===result.status)return handlers.reject(self,result.value);var thenable=result.value;if(thenable)safelyResolveThenable(self,thenable);else{self.state=FULFILLED,self.outcome=value;for(var i=-1,len=self.queue.length;++i<len;)self.queue[i].callFulfilled(value)}return self},handlers.reject=function(self,error){self.state=REJECTED,self.outcome=error;for(var i=-1,len=self.queue.length;++i<len;)self.queue[i].callRejected(error);return self},Promise.resolve=function(value){if(value instanceof this)return value;return handlers.resolve(new this(INTERNAL),value)},Promise.reject=function(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason)},Promise.all=function(iterable){var self=this;if("[object Array]"!==Object.prototype.toString.call(iterable))return this.reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return this.resolve([]);var values=new Array(len),resolved=0,i=-1,promise=new this(INTERNAL);for(;++i<len;)allResolver(iterable[i],i);return promise;function allResolver(value,i){self.resolve(value).then(function(outValue){values[i]=outValue,++resolved!==len||called||(called=!0,handlers.resolve(promise,values))},function(error){called||(called=!0,handlers.reject(promise,error))})}},Promise.race=function(iterable){var self=this;if("[object Array]"!==Object.prototype.toString.call(iterable))return this.reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return this.resolve([]);var i=-1,promise=new this(INTERNAL);for(;++i<len;)value=iterable[i],self.resolve(value).then(function(response){called||(called=!0,handlers.resolve(promise,response))},function(error){called||(called=!0,handlers.reject(promise,error))});var value;return promise}},function(module,exports,__webpack_require__){"use strict";(function(process){var utils=__webpack_require__(8),normalizeHeaderName=__webpack_require__(138),DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(headers,value){!utils.isUndefined(headers)&&utils.isUndefined(headers["Content-Type"])&&(headers["Content-Type"]=value)}var adapter,defaults={adapter:("undefined"!=typeof XMLHttpRequest?adapter=__webpack_require__(74):void 0!==process&&(adapter=__webpack_require__(74)),adapter),transformRequest:[function(data,headers){return normalizeHeaderName(headers,"Content-Type"),utils.isFormData(data)||utils.isArrayBuffer(data)||utils.isBuffer(data)||utils.isStream(data)||utils.isFile(data)||utils.isBlob(data)?data:utils.isArrayBufferView(data)?data.buffer:utils.isURLSearchParams(data)?(setContentTypeIfUnset(headers,"application/x-www-form-urlencoded;charset=utf-8"),data.toString()):utils.isObject(data)?(setContentTypeIfUnset(headers,"application/json;charset=utf-8"),JSON.stringify(data)):data}],transformResponse:[function(data){if("string"==typeof data)try{data=JSON.parse(data)}catch(e){}return data}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(status){return 200<=status&&status<300}};defaults.headers={common:{Accept:"application/json, text/plain, */*"}},utils.forEach(["delete","get","head"],function(method){defaults.headers[method]={}}),utils.forEach(["post","put","patch"],function(method){defaults.headers[method]=utils.merge(DEFAULT_CONTENT_TYPE)}),module.exports=defaults}).call(this,__webpack_require__(73))},function(module,exports,__webpack_require__){"use strict";(function(global){function _interopDefault(ex){return ex&&"object"==typeof ex&&"default"in ex?ex.default:ex}var lie=_interopDefault(__webpack_require__(152)),getArguments=_interopDefault(__webpack_require__(153)),nextTick=_interopDefault(__webpack_require__(65)),events=__webpack_require__(154),inherits=_interopDefault(__webpack_require__(155)),uuidV4=_interopDefault(__webpack_require__(156)),debug=_interopDefault(__webpack_require__(159)),Md5=_interopDefault(__webpack_require__(162)),vuvuzela=_interopDefault(__webpack_require__(163)),PouchPromise="function"==typeof Promise?Promise:lie;function cloneBinaryObject(object){if(object instanceof ArrayBuffer)return function(buff){if("function"==typeof buff.slice)return buff.slice(0);var target=new ArrayBuffer(buff.byteLength),targetArray=new Uint8Array(target),sourceArray=new Uint8Array(buff);return targetArray.set(sourceArray),target}(object);var size=object.size,type=object.type;return"function"==typeof object.slice?object.slice(0,size,type):object.webkitSlice(0,size,type)}var ExportedSet,ExportedMap,funcToString=Function.prototype.toString,objectCtorString=funcToString.call(Object);function clone(object){var newObject,i,len;if(!object||"object"!=typeof object)return object;if(Array.isArray(object)){for(newObject=[],i=0,len=object.length;i<len;i++)newObject[i]=clone(object[i]);return newObject}if(object instanceof Date)return object.toISOString();if(function(object){return"undefined"!=typeof ArrayBuffer&&object instanceof ArrayBuffer||"undefined"!=typeof Blob&&object instanceof Blob}(object))return cloneBinaryObject(object);if(!function(value){var proto=Object.getPrototypeOf(value);if(null===proto)return!0;var Ctor=proto.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}(object))return object;for(i in newObject={},object)if(Object.prototype.hasOwnProperty.call(object,i)){var value=clone(object[i]);void 0!==value&&(newObject[i]=value)}return newObject}function once(fun){var called=!1;return getArguments(function(args){if(called)throw new Error("once called more than once");called=!0,fun.apply(this,args)})}function toPromise(func){return getArguments(function(args){args=clone(args);var self=this,usedCB="function"==typeof args[args.length-1]&&args.pop(),promise=new PouchPromise(function(fulfill,reject){var resp;try{var callback=once(function(err,mesg){err?reject(err):fulfill(mesg)});args.push(callback),(resp=func.apply(self,args))&&"function"==typeof resp.then&&fulfill(resp)}catch(e){reject(e)}});return usedCB&&promise.then(function(result){usedCB(null,result)},usedCB),promise})}function adapterFun(name,callback){return toPromise(getArguments(function(args){if(this._closed)return PouchPromise.reject(new Error("database is closed"));if(this._destroyed)return PouchPromise.reject(new Error("database is destroyed"));var self=this;return function(self,name,args){if(self.constructor.listeners("debug").length){for(var logArgs=["api",self.name,name],i=0;i<args.length-1;i++)logArgs.push(args[i]);self.constructor.emit("debug",logArgs);var origCallback=args[args.length-1];args[args.length-1]=function(err,res){var responseArgs=["api",self.name,name];responseArgs=responseArgs.concat(err?["error",err]:["success",res]),self.constructor.emit("debug",responseArgs),origCallback(err,res)}}}(self,name,args),this.taskqueue.isReady?callback.apply(this,args):new PouchPromise(function(fulfill,reject){self.taskqueue.addTask(function(failed){failed?reject(failed):fulfill(self[name].apply(self,args))})})}))}function mangle(key){return"$"+key}function unmangle(key){return key.substring(1)}function Map$1(){this._store={}}function Set$1(array){if(this._store=new Map$1,array&&Array.isArray(array))for(var i=0,len=array.length;i<len;i++)this.add(array[i])}function pick(obj,arr){for(var res={},i=0,len=arr.length;i<len;i++){var prop=arr[i];prop in obj&&(res[prop]=obj[prop])}return res}Map$1.prototype.get=function(key){var mangled=mangle(key);return this._store[mangled]},Map$1.prototype.set=function(key,value){var mangled=mangle(key);return this._store[mangled]=value,!0},Map$1.prototype.has=function(key){return mangle(key)in this._store},Map$1.prototype.delete=function(key){var mangled=mangle(key),res=mangled in this._store;return delete this._store[mangled],res},Map$1.prototype.forEach=function(cb){for(var keys=Object.keys(this._store),i=0,len=keys.length;i<len;i++){var key=keys[i];cb(this._store[key],key=unmangle(key))}},Object.defineProperty(Map$1.prototype,"size",{get:function(){return Object.keys(this._store).length}}),Set$1.prototype.add=function(key){return this._store.set(key,!0)},Set$1.prototype.has=function(key){return this._store.has(key)},Set$1.prototype.forEach=function(cb){this._store.forEach(function(value,key){cb(key)})},Object.defineProperty(Set$1.prototype,"size",{get:function(){return this._store.size}}),ExportedMap=function(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var prop=Object.getOwnPropertyDescriptor(Map,Symbol.species);return prop&&"get"in prop&&Map[Symbol.species]===Map}()?(ExportedSet=Set,Map):(ExportedSet=Set$1,Map$1);var hasLocal,MAX_NUM_CONCURRENT_REQUESTS=6;function identityFunction(x){return x}function formatResultForOpenRevsGet(result){return[{ok:result}]}function bulkGet(db,opts,callback){var requests=opts.docs,requestsById=new ExportedMap;requests.forEach(function(request){requestsById.has(request.id)?requestsById.get(request.id).push(request):requestsById.set(request.id,[request])});var numDocs=requestsById.size,numDone=0,perDocResults=new Array(numDocs);function checkDone(){++numDone===numDocs&&function(){var results=[];perDocResults.forEach(function(res){res.docs.forEach(function(info){results.push({id:res.id,docs:[info]})})}),callback(null,{results:results})}()}var allRequests=[];requestsById.forEach(function(value,key){allRequests.push(key)});var i=0;function nextBatch(){if(!(i>=allRequests.length)){var upTo=Math.min(i+MAX_NUM_CONCURRENT_REQUESTS,allRequests.length),batch=allRequests.slice(i,upTo);!function(batch,offset){batch.forEach(function(docId,j){var docIdx=offset+j,docRequests=requestsById.get(docId),docOpts=pick(docRequests[0],["atts_since","attachments"]);docOpts.open_revs=docRequests.map(function(request){return request.rev}),docOpts.open_revs=docOpts.open_revs.filter(identityFunction);var formatResult=identityFunction;0===docOpts.open_revs.length&&(delete docOpts.open_revs,formatResult=formatResultForOpenRevsGet),["revs","attachments","binary","ajax","latest"].forEach(function(param){param in opts&&(docOpts[param]=opts[param])}),db.get(docId,docOpts,function(err,res){var result;result=err?[{error:err}]:formatResult(res),function(docIndex,id,docs){perDocResults[docIndex]={id:id,docs:docs},checkDone()}(docIdx,docId,result),nextBatch()})})}(batch,i),i+=batch.length}}nextBatch()}function isChromeApp(){return"undefined"!=typeof chrome&&void 0!==chrome.storage&&void 0!==chrome.storage.local}if(isChromeApp())hasLocal=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),hasLocal=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){hasLocal=!1}function hasLocalStorage(){return hasLocal}function Changes(){events.EventEmitter.call(this),this._listeners={},function(self){isChromeApp()?chrome.storage.onChanged.addListener(function(e){null!=e.db_name&&self.emit(e.dbName.newValue)}):hasLocalStorage()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(e){self.emit(e.key)}):window.attachEvent("storage",function(e){self.emit(e.key)}))}(this)}function guardedConsole(method){if("undefined"!=typeof console&&"function"==typeof console[method]){var args=Array.prototype.slice.call(arguments,1);console[method].apply(console,args)}}function defaultBackOff(min){var max=0;return min||(max=2e3),function(min,max){return min=parseInt(min,10)||0,(max=parseInt(max,10))!=max||max<=min?max=(min||1)<<1:max+=1,6e5<max&&(min=3e5,max=6e5),~~((max-min)*Math.random()+min)}(min,max)}function explainError(status,str){guardedConsole("info","The above "+status+" is totally normal. "+str)}inherits(Changes,events.EventEmitter),Changes.prototype.addListener=function(dbName,id,db,opts){if(!this._listeners[id]){var self=this,inprogress=!1;this._listeners[id]=eventFunction,this.on(dbName,eventFunction)}function eventFunction(){if(self._listeners[id])if(inprogress)inprogress="waiting";else{inprogress=!0;var changesOpts=pick(opts,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);db.changes(changesOpts).on("change",function(c){c.seq>opts.since&&!opts.cancelled&&(opts.since=c.seq,opts.onChange(c))}).on("complete",function(){"waiting"===inprogress&&nextTick(eventFunction),inprogress=!1}).on("error",function(){inprogress=!1})}}},Changes.prototype.removeListener=function(dbName,id){id in this._listeners&&(events.EventEmitter.prototype.removeListener.call(this,dbName,this._listeners[id]),delete this._listeners[id])},Changes.prototype.notifyLocalWindows=function(dbName){isChromeApp()?chrome.storage.local.set({dbName:dbName}):hasLocalStorage()&&(localStorage[dbName]="a"===localStorage[dbName]?"b":"a")},Changes.prototype.notify=function(dbName){this.emit(dbName),this.notifyLocalWindows(dbName)};var $inject_Object_assign="function"==typeof Object.assign?Object.assign:function(target){for(var to=Object(target),index=1;index<arguments.length;index++){var nextSource=arguments[index];if(null!=nextSource)for(var nextKey in nextSource)Object.prototype.hasOwnProperty.call(nextSource,nextKey)&&(to[nextKey]=nextSource[nextKey])}return to};function PouchError(status,error,reason){Error.call(this,reason),this.status=status,this.name=error,this.message=reason,this.error=!0}inherits(PouchError,Error),PouchError.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};new PouchError(401,"unauthorized","Name or password is incorrect.");var MISSING_BULK_DOCS=new PouchError(400,"bad_request","Missing JSON list of 'docs'"),MISSING_DOC=new PouchError(404,"not_found","missing"),REV_CONFLICT=new PouchError(409,"conflict","Document update conflict"),INVALID_ID=new PouchError(400,"bad_request","_id field must contain a string"),MISSING_ID=new PouchError(412,"missing_id","_id is required for puts"),RESERVED_ID=new PouchError(400,"bad_request","Only reserved document ids may start with underscore."),UNKNOWN_ERROR=(new PouchError(412,"precondition_failed","Database not open"),new PouchError(500,"unknown_error","Database encountered an unknown error")),BAD_ARG=new PouchError(500,"badarg","Some query argument is invalid"),QUERY_PARSE_ERROR=(new PouchError(400,"invalid_request","Request was invalid"),new PouchError(400,"query_parse_error","Some query parameter is invalid")),DOC_VALIDATION=new PouchError(500,"doc_validation","Bad special document member"),BAD_REQUEST=new PouchError(400,"bad_request","Something wrong with the request"),NOT_AN_OBJECT=new PouchError(400,"bad_request","Document must be a JSON object"),IDB_ERROR=(new PouchError(404,"not_found","Database not found"),new PouchError(500,"indexed_db_went_bad","unknown")),WSQ_ERROR=new PouchError(500,"web_sql_went_bad","unknown"),INVALID_REV=(new PouchError(500,"levelDB_went_went_bad","unknown"),new PouchError(403,"forbidden","Forbidden by design doc validate_doc_update function"),new PouchError(400,"bad_request","Invalid rev format")),MISSING_STUB=(new PouchError(412,"file_exists","The database could not be created, the file already exists."),new PouchError(412,"missing_stub","A pre-existing attachment stub wasn't found"));new PouchError(413,"invalid_url","Provided URL is invalid");function createError(error,reason){function CustomPouchError(reason){for(var p in error)"function"!=typeof error[p]&&(this[p]=error[p]);void 0!==reason&&(this.reason=reason)}return CustomPouchError.prototype=PouchError.prototype,new CustomPouchError(reason)}function generateErrorFromResponse(err){if("object"!=typeof err){var data=err;(err=UNKNOWN_ERROR).data=data}return"error"in err&&"conflict"===err.error&&(err.name="conflict",err.status=409),"name"in err||(err.name=err.error||"unknown"),"status"in err||(err.status=500),"message"in err||(err.message=err.message||err.reason),err}function filterChange(opts){var req={},hasFilter=opts.filter&&"function"==typeof opts.filter;return req.query=opts.query_params,function(change){change.doc||(change.doc={});var filterReturn=hasFilter&&function(filter,doc,req){try{return!filter(doc,req)}catch(err){var msg="Filter function threw: "+err.toString();return createError(BAD_REQUEST,msg)}}(opts.filter,change.doc,req);if("object"==typeof filterReturn)return filterReturn;if(filterReturn)return!1;if(opts.include_docs){if(!opts.attachments)for(var att in change.doc._attachments)change.doc._attachments.hasOwnProperty(att)&&(change.doc._attachments[att].stub=!0)}else delete change.doc;return!0}}function flatten(arrs){for(var res=[],i=0,len=arrs.length;i<len;i++)res=res.concat(arrs[i]);return res}function invalidIdError(id){var err;if(id?"string"!=typeof id?err=createError(INVALID_ID):/^_/.test(id)&&!/^_(design|local)/.test(id)&&(err=createError(RESERVED_ID)):err=createError(MISSING_ID),err)throw err}function isRemote(db){return"boolean"==typeof db._remote?db._remote:"function"==typeof db.type&&(guardedConsole("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===db.type())}function parseDesignDocFunctionName(s){if(!s)return null;var parts=s.split("/");return 2===parts.length?parts:1===parts.length?[s,s]:null}function normalizeDesignDocFunctionName(s){var normalized=parseDesignDocFunctionName(s);return normalized?normalized.join("/"):null}var keys=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],qName="queryKey",qParser=/(?:^|&)([^&=]*)=?([^&]*)/g,parser=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function parseUri(str){for(var m=parser.exec(str),uri={},i=14;i--;){var key=keys[i],value=m[i]||"",encoded=-1!==["user","password"].indexOf(key);uri[key]=encoded?decodeURIComponent(value):value}return uri[qName]={},uri[keys[12]].replace(qParser,function($0,$1,$2){$1&&(uri[qName][$1]=$2)}),uri}function scopeEval(source,scope){var keys=[],values=[];for(var key in scope)scope.hasOwnProperty(key)&&(keys.push(key),values.push(scope[key]));return keys.push(source),Function.apply(null,keys).apply(null,values)}function upsert(db,docId,diffFun){return new PouchPromise(function(fulfill,reject){db.get(docId,function(err,doc){if(err){if(404!==err.status)return reject(err);doc={}}var docRev=doc._rev,newDoc=diffFun(doc);if(!newDoc)return fulfill({updated:!1,rev:docRev});newDoc._id=docId,newDoc._rev=docRev,fulfill(function(db,doc,diffFun){return db.put(doc).then(function(res){return{updated:!0,rev:res.rev}},function(err){if(409!==err.status)throw err;return upsert(db,doc._id,diffFun)})}(db,newDoc,diffFun))})})}function rev(){return uuidV4.v4().replace(/-/g,"").toLowerCase()}var uuid=uuidV4.v4;function winningRev(metadata){for(var winningId,winningPos,winningDeleted,node,toVisit=metadata.rev_tree.slice();node=toVisit.pop();){var tree=node.ids,branches=tree[2],pos=node.pos;if(branches.length)for(var i=0,len=branches.length;i<len;i++)toVisit.push({pos:pos+1,ids:branches[i]});else{var deleted=!!tree[1].deleted,id=tree[0];winningId&&!(winningDeleted!==deleted?winningDeleted:winningPos!==pos?winningPos<pos:winningId<id)||(winningId=id,winningPos=pos,winningDeleted=deleted)}}return winningPos+"-"+winningId}function traverseRevTree(revs,callback){for(var node,toVisit=revs.slice();node=toVisit.pop();)for(var pos=node.pos,tree=node.ids,branches=tree[2],newCtx=callback(0===branches.length,pos,tree[0],node.ctx,tree[1]),i=0,len=branches.length;i<len;i++)toVisit.push({pos:pos+1,ids:branches[i],ctx:newCtx})}function sortByPos(a,b){return a.pos-b.pos}function collectLeaves(revs){var leaves=[];traverseRevTree(revs,function(isLeaf,pos,id,acc,opts){isLeaf&&leaves.push({rev:pos+"-"+id,pos:pos,opts:opts})}),leaves.sort(sortByPos).reverse();for(var i=0,len=leaves.length;i<len;i++)delete leaves[i].pos;return leaves}function collectConflicts(metadata){for(var win=winningRev(metadata),leaves=collectLeaves(metadata.rev_tree),conflicts=[],i=0,len=leaves.length;i<len;i++){var leaf=leaves[i];leaf.rev===win||leaf.opts.deleted||conflicts.push(leaf.rev)}return conflicts}function compactTree(metadata){var revs=[];return traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){"available"!==opts.status||isLeaf||(revs.push(pos+"-"+revHash),opts.status="missing")}),revs}function rootToLeaf(revs){for(var node,paths=[],toVisit=revs.slice();node=toVisit.pop();){var pos=node.pos,tree=node.ids,id=tree[0],opts=tree[1],branches=tree[2],isLeaf=0===branches.length,history=node.history?node.history.slice():[];history.push({id:id,opts:opts}),isLeaf&&paths.push({pos:pos+1-history.length,ids:history});for(var i=0,len=branches.length;i<len;i++)toVisit.push({pos:pos+1,ids:branches[i],history:history})}return paths.reverse()}function sortByPos$1(a,b){return a.pos-b.pos}function insertSorted(arr,item,comparator){var idx=function(arr,item,comparator){for(var mid,low=0,high=arr.length;low<high;)comparator(arr[mid=low+high>>>1],item)<0?low=1+mid:high=mid;return low}(arr,item,comparator);arr.splice(idx,0,item)}function pathToTree(path,numStemmed){for(var root,leaf,i=numStemmed,len=path.length;i<len;i++){var node=path[i],currentLeaf=[node.id,node.opts,[]];leaf?(leaf[2].push(currentLeaf),leaf=currentLeaf):root=leaf=currentLeaf}return root}function compareTree(a,b){return a[0]<b[0]?-1:1}function mergeTree(in_tree1,in_tree2){for(var queue=[{tree1:in_tree1,tree2:in_tree2}],conflicts=!1;0<queue.length;){var item=queue.pop(),tree1=item.tree1,tree2=item.tree2;(tree1[1].status||tree2[1].status)&&(tree1[1].status="available"===tree1[1].status||"available"===tree2[1].status?"available":"missing");for(var i=0;i<tree2[2].length;i++)if(tree1[2][0]){for(var merged=!1,j=0;j<tree1[2].length;j++)tree1[2][j][0]===tree2[2][i][0]&&(queue.push({tree1:tree1[2][j],tree2:tree2[2][i]}),merged=!0);merged||(conflicts="new_branch",insertSorted(tree1[2],tree2[2][i],compareTree))}else conflicts="new_leaf",tree1[2][0]=tree2[2][i]}return{conflicts:conflicts,tree:in_tree1}}function doMerge(tree,path,dontExpand){var res,restree=[],conflicts=!1,merged=!1;if(!tree.length)return{tree:[path],conflicts:"new_leaf"};for(var i=0,len=tree.length;i<len;i++){var branch=tree[i];if(branch.pos===path.pos&&branch.ids[0]===path.ids[0])res=mergeTree(branch.ids,path.ids),restree.push({pos:branch.pos,ids:res.tree}),conflicts=conflicts||res.conflicts,merged=!0;else if(!0!==dontExpand){var t1=branch.pos<path.pos?branch:path,t2=branch.pos<path.pos?path:branch,diff=t2.pos-t1.pos,candidateParents=[],trees=[];for(trees.push({ids:t1.ids,diff:diff,parent:null,parentIdx:null});0<trees.length;){var item=trees.pop();if(0!==item.diff)for(var elements=item.ids[2],j=0,elementsLen=elements.length;j<elementsLen;j++)trees.push({ids:elements[j],diff:item.diff-1,parent:item.ids,parentIdx:j});else item.ids[0]===t2.ids[0]&&candidateParents.push(item)}var el=candidateParents[0];el?(res=mergeTree(el.ids,t2.ids),el.parent[2][el.parentIdx]=res.tree,restree.push({pos:t1.pos,ids:t1.ids}),conflicts=conflicts||res.conflicts,merged=!0):restree.push(branch)}else restree.push(branch)}return merged||restree.push(path),restree.sort(sortByPos$1),{tree:restree,conflicts:conflicts||"internal_node"}}function merge(tree,path,depth){var newTree=doMerge(tree,path),stemmed=function(tree,depth){for(var stemmedRevs,result,paths=rootToLeaf(tree),i=0,len=paths.length;i<len;i++){var node,path=paths[i],stemmed=path.ids;if(stemmed.length>depth){stemmedRevs=stemmedRevs||{};var numStemmed=stemmed.length-depth;node={pos:path.pos+numStemmed,ids:pathToTree(stemmed,numStemmed)};for(var s=0;s<numStemmed;s++){var rev=path.pos+s+"-"+stemmed[s].id;stemmedRevs[rev]=!0}}else node={pos:path.pos,ids:pathToTree(stemmed,0)};result=result?doMerge(result,node,!0).tree:[node]}return stemmedRevs&&traverseRevTree(result,function(isLeaf,pos,revHash){delete stemmedRevs[pos+"-"+revHash]}),{tree:result,revs:stemmedRevs?Object.keys(stemmedRevs):[]}}(newTree.tree,depth);return{tree:stemmed.tree,stemmedRevs:stemmed.revs,conflicts:newTree.conflicts}}function getTrees(node){return node.ids}function isDeleted(metadata,rev){for(var tree,id=(rev=rev||winningRev(metadata)).substring(rev.indexOf("-")+1),toVisit=metadata.rev_tree.map(getTrees);tree=toVisit.pop();){if(tree[0]===id)return!!tree[1].deleted;toVisit=toVisit.concat(tree[2])}}function isLocalId(id){return/^_local/.test(id)}function latest(rev,metadata){for(var node,toVisit=metadata.rev_tree.slice();node=toVisit.pop();){var pos=node.pos,tree=node.ids,id=tree[0],opts=tree[1],branches=tree[2],isLeaf=0===branches.length,history=node.history?node.history.slice():[];if(history.push({id:id,pos:pos,opts:opts}),isLeaf)for(var i=0,len=history.length;i<len;i++){var historyNode=history[i];if(historyNode.pos+"-"+historyNode.id===rev)return pos+"-"+id}for(var j=0,l=branches.length;j<l;j++)toVisit.push({pos:pos+1,ids:branches[j],history:history})}throw new Error("Unable to resolve latest revision for id "+metadata.id+", rev "+rev)}function Changes$2(db,opts,callback){events.EventEmitter.call(this);var self=this;this.db=db;var complete=(opts=opts?clone(opts):{}).complete=once(function(err,resp){err?0<function(ee,type){return"listenerCount"in ee?ee.listenerCount(type):events.EventEmitter.listenerCount(ee,type)}(self,"error")&&self.emit("error",err):self.emit("complete",resp),self.removeAllListeners(),db.removeListener("destroyed",onDestroy)});function onDestroy(){self.cancel()}callback&&(self.on("complete",function(resp){callback(null,resp)}),self.on("error",callback)),db.once("destroyed",onDestroy),opts.onChange=function(change,pending,lastSeq){self.isCancelled||function(self,change,pending,lastSeq){try{self.emit("change",change,pending,lastSeq)}catch(e){guardedConsole("error",'Error in .on("change", function):',e)}}(self,change,pending,lastSeq)};var promise=new PouchPromise(function(fulfill,reject){opts.complete=function(err,res){err?reject(err):fulfill(res)}});self.once("cancel",function(){db.removeListener("destroyed",onDestroy),opts.complete(null,{status:"cancelled"})}),this.then=promise.then.bind(promise),this.catch=promise.catch.bind(promise),this.then(function(result){complete(null,result)},complete),db.taskqueue.isReady?self.validateChanges(opts):db.taskqueue.addTask(function(failed){failed?opts.complete(failed):self.isCancelled?self.emit("cancel"):self.validateChanges(opts)})}function processChange(doc,metadata,opts){var changeList=[{rev:doc._rev}];"all_docs"===opts.style&&(changeList=collectLeaves(metadata.rev_tree).map(function(x){return{rev:x.rev}}));var change={id:metadata.id,changes:changeList,doc:doc};return isDeleted(metadata,doc._rev)&&(change.deleted=!0),opts.conflicts&&(change.doc._conflicts=collectConflicts(metadata),change.doc._conflicts.length||delete change.doc._conflicts),change}function compare(left,right){return left<right?-1:right<left?1:0}function yankError(callback,docId){return function(err,results){err||results[0]&&results[0].error?((err=err||results[0]).docId=docId,callback(err)):callback(null,results.length?results[0]:results)}}function compareByIdThenRev(a,b){var idCompare=compare(a._id,b._id);return 0!==idCompare?idCompare:compare(a._revisions?a._revisions.start:0,b._revisions?b._revisions.start:0)}function AbstractPouchDB(){events.EventEmitter.call(this)}function TaskQueue$1(){this.isReady=!1,this.failed=!1,this.queue=[]}function PouchDB(name,opts){if(!(this instanceof PouchDB))return new PouchDB(name,opts);var self=this;if(opts=opts||{},name&&"object"==typeof name&&(name=(opts=name).name,delete opts.name),this.__opts=opts=clone(opts),self.auto_compaction=opts.auto_compaction,self.prefix=PouchDB.prefix,"string"!=typeof name)throw new Error("Missing/invalid DB name");var backend=function(name,opts){var match=name.match(/([a-z-]*):\/\/(.*)/);if(match)return{name:/https?/.test(match[1])?match[1]+"://"+match[2]:match[2],adapter:match[1]};var adapters=PouchDB.adapters,preferredAdapters=PouchDB.preferredAdapters,prefix=PouchDB.prefix,adapterName=opts.adapter;if(!adapterName)for(var i=0;i<preferredAdapters.length&&("idb"===(adapterName=preferredAdapters[i])&&"websql"in adapters&&hasLocalStorage()&&localStorage["_pouch__websqldb_"+prefix+name]);++i)guardedConsole("log",'PouchDB is downgrading "'+name+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');var adapter=adapters[adapterName];return{name:!(adapter&&"use_prefix"in adapter)||adapter.use_prefix?prefix+name:name,adapter:adapterName}}((opts.prefix||"")+name,opts);if(opts.name=backend.name,opts.adapter=opts.adapter||backend.adapter,self.name=name,self._adapter=opts.adapter,PouchDB.emit("debug",["adapter","Picked adapter: ",opts.adapter]),!PouchDB.adapters[opts.adapter]||!PouchDB.adapters[opts.adapter].valid())throw new Error("Invalid Adapter: "+opts.adapter);AbstractPouchDB.call(self),self.taskqueue=new TaskQueue$1,self.adapter=opts.adapter,PouchDB.adapters[opts.adapter].call(self,opts,function(err){if(err)return self.taskqueue.fail(err);!function(self){function onDestroyed(from_constructor){self.removeListener("closed",onClosed),from_constructor||self.constructor.emit("destroyed",self.name)}function onClosed(){self.removeListener("destroyed",onDestroyed),self.constructor.emit("unref",self)}self.once("destroyed",onDestroyed),self.once("closed",onClosed),self.constructor.emit("ref",self)}(self),self.emit("created",self),PouchDB.emit("created",self.name),self.taskqueue.ready(self)})}inherits(Changes$2,events.EventEmitter),Changes$2.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Changes$2.prototype.validateChanges=function(opts){var callback=opts.complete,self=this;PouchDB._changesFilterPlugin?PouchDB._changesFilterPlugin.validate(opts,function(err){if(err)return callback(err);self.doChanges(opts)}):self.doChanges(opts)},Changes$2.prototype.doChanges=function(opts){var self=this,callback=opts.complete;if("live"in(opts=clone(opts))&&!("continuous"in opts)&&(opts.continuous=opts.live),opts.processChange=processChange,"latest"===opts.since&&(opts.since="now"),opts.since||(opts.since=0),"now"!==opts.since){if(PouchDB._changesFilterPlugin){if(PouchDB._changesFilterPlugin.normalize(opts),PouchDB._changesFilterPlugin.shouldFilter(this,opts))return PouchDB._changesFilterPlugin.filter(this,opts)}else["doc_ids","filter","selector","view"].forEach(function(key){key in opts&&guardedConsole("warn",'The "'+key+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in opts||(opts.descending=!1),opts.limit=0===opts.limit?1:opts.limit,opts.complete=callback;var newPromise=this.db._changes(opts);if(newPromise&&"function"==typeof newPromise.cancel){var cancel=self.cancel;self.cancel=getArguments(function(args){newPromise.cancel(),cancel.apply(this,args)})}}else this.db.info().then(function(info){self.isCancelled?callback(null,{status:"cancelled"}):(opts.since=info.update_seq,self.doChanges(opts))},callback)},inherits(AbstractPouchDB,events.EventEmitter),AbstractPouchDB.prototype.post=adapterFun("post",function(doc,opts,callback){if("function"==typeof opts&&(callback=opts,opts={}),"object"!=typeof doc||Array.isArray(doc))return callback(createError(NOT_AN_OBJECT));this.bulkDocs({docs:[doc]},opts,yankError(callback,doc._id))}),AbstractPouchDB.prototype.put=adapterFun("put",function(doc,opts,cb){if("function"==typeof opts&&(cb=opts,opts={}),"object"!=typeof doc||Array.isArray(doc))return cb(createError(NOT_AN_OBJECT));if(invalidIdError(doc._id),isLocalId(doc._id)&&"function"==typeof this._putLocal)return doc._deleted?this._removeLocal(doc,cb):this._putLocal(doc,cb);var parts,oldRevId,newRevNum,newRevId,self=this;function putDoc(next){"function"==typeof self._put&&!1!==opts.new_edits?self._put(doc,opts,next):self.bulkDocs({docs:[doc]},opts,yankError(next,doc._id))}opts.force&&doc._rev?(parts=doc._rev.split("-"),oldRevId=parts[1],newRevNum=parseInt(parts[0],10)+1,newRevId=rev(),doc._revisions={start:newRevNum,ids:[newRevId,oldRevId]},doc._rev=newRevNum+"-"+newRevId,opts.new_edits=!1,putDoc(function(err){var result=err?null:{ok:!0,id:doc._id,rev:doc._rev};cb(err,result)})):putDoc(cb)}),AbstractPouchDB.prototype.putAttachment=adapterFun("putAttachment",function(docId,attachmentId,rev$$1,blob,type){var api=this;function createAttachment(doc){var prevrevpos="_rev"in doc?parseInt(doc._rev,10):0;return doc._attachments=doc._attachments||{},doc._attachments[attachmentId]={content_type:type,data:blob,revpos:++prevrevpos},api.put(doc)}return"function"==typeof type&&(type=blob,blob=rev$$1,rev$$1=null),void 0===type&&(type=blob,blob=rev$$1,rev$$1=null),type||guardedConsole("warn","Attachment",attachmentId,"on document",docId,"is missing content_type"),api.get(docId).then(function(doc){if(doc._rev!==rev$$1)throw createError(REV_CONFLICT);return createAttachment(doc)},function(err){if(err.reason===MISSING_DOC.message)return createAttachment({_id:docId});throw err})}),AbstractPouchDB.prototype.removeAttachment=adapterFun("removeAttachment",function(docId,attachmentId,rev$$1,callback){var self=this;self.get(docId,function(err,obj){if(err)callback(err);else if(obj._rev===rev$$1){if(!obj._attachments)return callback();delete obj._attachments[attachmentId],0===Object.keys(obj._attachments).length&&delete obj._attachments,self.put(obj,callback)}else callback(createError(REV_CONFLICT))})}),AbstractPouchDB.prototype.remove=adapterFun("remove",function(docOrId,optsOrRev,opts,callback){var doc;"string"==typeof optsOrRev?(doc={_id:docOrId,_rev:optsOrRev},"function"==typeof opts&&(callback=opts,opts={})):(doc=docOrId,opts="function"==typeof optsOrRev?(callback=optsOrRev,{}):(callback=opts,optsOrRev)),(opts=opts||{}).was_delete=!0;var newDoc={_id:doc._id,_rev:doc._rev||opts.rev,_deleted:!0};if(isLocalId(newDoc._id)&&"function"==typeof this._removeLocal)return this._removeLocal(doc,callback);this.bulkDocs({docs:[newDoc]},opts,yankError(callback,newDoc._id))}),AbstractPouchDB.prototype.revsDiff=adapterFun("revsDiff",function(req,opts,callback){"function"==typeof opts&&(callback=opts,opts={});var ids=Object.keys(req);if(!ids.length)return callback(null,{});var count=0,missing=new ExportedMap;function addToMissing(id,revId){missing.has(id)||missing.set(id,{missing:[]}),missing.get(id).missing.push(revId)}ids.map(function(id){this._getRevisionTree(id,function(err,rev_tree){if(err&&404===err.status&&"missing"===err.message)missing.set(id,{missing:req[id]});else{if(err)return callback(err);!function(id,rev_tree){var missingForId=req[id].slice(0);traverseRevTree(rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev$$1=pos+"-"+revHash,idx=missingForId.indexOf(rev$$1);-1!==idx&&(missingForId.splice(idx,1),"available"!==opts.status&&addToMissing(id,rev$$1))}),missingForId.forEach(function(rev$$1){addToMissing(id,rev$$1)})}(id,rev_tree)}if(++count===ids.length){var missingObj={};return missing.forEach(function(value,key){missingObj[key]=value}),callback(null,missingObj)}})},this)}),AbstractPouchDB.prototype.bulkGet=adapterFun("bulkGet",function(opts,callback){bulkGet(this,opts,callback)}),AbstractPouchDB.prototype.compactDocument=adapterFun("compactDocument",function(docId,maxHeight,callback){var self=this;this._getRevisionTree(docId,function(err,revTree){if(err)return callback(err);var height=function(revs){var height={},edges=[];return traverseRevTree(revs,function(isLeaf,pos,id,prnt){var rev$$1=pos+"-"+id;return isLeaf&&(height[rev$$1]=0),void 0!==prnt&&edges.push({from:prnt,to:rev$$1}),rev$$1}),edges.reverse(),edges.forEach(function(edge){void 0===height[edge.from]?height[edge.from]=1+height[edge.to]:height[edge.from]=Math.min(height[edge.from],1+height[edge.to])}),height}(revTree),candidates=[],revs=[];Object.keys(height).forEach(function(rev$$1){height[rev$$1]>maxHeight&&candidates.push(rev$$1)}),traverseRevTree(revTree,function(isLeaf,pos,revHash,ctx,opts){var rev$$1=pos+"-"+revHash;"available"===opts.status&&-1!==candidates.indexOf(rev$$1)&&revs.push(rev$$1)}),self._doCompaction(docId,revs,callback)})}),AbstractPouchDB.prototype.compact=adapterFun("compact",function(opts,callback){"function"==typeof opts&&(callback=opts,opts={});opts=opts||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:opts,callback:callback}),1===this._compactionQueue.length&&function doNextCompaction(self){var task=self._compactionQueue[0],opts=task.opts,callback=task.callback;self.get("_local/compaction").catch(function(){return!1}).then(function(doc){doc&&doc.last_seq&&(opts.last_seq=doc.last_seq),self._compact(opts,function(err,res){err?callback(err):callback(null,res),nextTick(function(){self._compactionQueue.shift(),self._compactionQueue.length&&doNextCompaction(self)})})})}(this)}),AbstractPouchDB.prototype._compact=function(opts,callback){var self=this,changesOpts={return_docs:!1,last_seq:opts.last_seq||0},promises=[];self.changes(changesOpts).on("change",function(row){promises.push(self.compactDocument(row.id,0))}).on("complete",function(resp){var lastSeq=resp.last_seq;PouchPromise.all(promises).then(function(){return upsert(self,"_local/compaction",function(doc){return(!doc.last_seq||doc.last_seq<lastSeq)&&(doc.last_seq=lastSeq,doc)})}).then(function(){callback(null,{ok:!0})}).catch(callback)}).on("error",callback)},AbstractPouchDB.prototype.get=adapterFun("get",function(id,opts,cb){if("function"==typeof opts&&(cb=opts,opts={}),"string"!=typeof id)return cb(createError(INVALID_ID));if(isLocalId(id)&&"function"==typeof this._getLocal)return this._getLocal(id,cb);var leaves=[],self=this;function finishOpenRevs(){var result=[],count=leaves.length;if(!count)return cb(null,result);leaves.forEach(function(leaf){self.get(id,{rev:leaf,revs:opts.revs,latest:opts.latest,attachments:opts.attachments,binary:opts.binary},function(err,doc){if(err)result.push({missing:leaf});else{for(var existing,i=0,l=result.length;i<l;i++)if(result[i].ok&&result[i].ok._rev===doc._rev){existing=!0;break}existing||result.push({ok:doc})}--count||cb(null,result)})})}if(!opts.open_revs)return this._get(id,opts,function(err,result){if(err)return err.docId=id,cb(err);var doc=result.doc,metadata=result.metadata,ctx=result.ctx;if(opts.conflicts){var conflicts=collectConflicts(metadata);conflicts.length&&(doc._conflicts=conflicts)}if(isDeleted(metadata,doc._rev)&&(doc._deleted=!0),opts.revs||opts.revs_info){for(var splittedRev=doc._rev.split("-"),revNo=parseInt(splittedRev[0],10),revHash=splittedRev[1],paths=rootToLeaf(metadata.rev_tree),path=null,i=0;i<paths.length;i++){var currentPath=paths[i],hashIndex=currentPath.ids.map(function(x){return x.id}).indexOf(revHash);(hashIndex===revNo-1||!path&&-1!==hashIndex)&&(path=currentPath)}var indexOfRev=path.ids.map(function(x){return x.id}).indexOf(doc._rev.split("-")[1])+1,howMany=path.ids.length-indexOfRev;if(path.ids.splice(indexOfRev,howMany),path.ids.reverse(),opts.revs&&(doc._revisions={start:path.pos+path.ids.length-1,ids:path.ids.map(function(rev$$1){return rev$$1.id})}),opts.revs_info){var pos=path.pos+path.ids.length;doc._revs_info=path.ids.map(function(rev$$1){return{rev:--pos+"-"+rev$$1.id,status:rev$$1.opts.status}})}}if(opts.attachments&&doc._attachments){var attachments=doc._attachments,count=Object.keys(attachments).length;if(0===count)return cb(null,doc);Object.keys(attachments).forEach(function(key){this._getAttachment(doc._id,key,attachments[key],{rev:doc._rev,binary:opts.binary,ctx:ctx},function(err,data){var att=doc._attachments[key];att.data=data,delete att.stub,delete att.length,--count||cb(null,doc)})},self)}else{if(doc._attachments)for(var key in doc._attachments)doc._attachments.hasOwnProperty(key)&&(doc._attachments[key].stub=!0);cb(null,doc)}});if("all"===opts.open_revs)this._getRevisionTree(id,function(err,rev_tree){if(err)return cb(err);leaves=collectLeaves(rev_tree).map(function(leaf){return leaf.rev}),finishOpenRevs()});else{if(!Array.isArray(opts.open_revs))return cb(createError(UNKNOWN_ERROR,"function_clause"));leaves=opts.open_revs;for(var i=0;i<leaves.length;i++){var l=leaves[i];if("string"!=typeof l||!/^\d+-/.test(l))return cb(createError(INVALID_REV))}finishOpenRevs()}}),AbstractPouchDB.prototype.getAttachment=adapterFun("getAttachment",function(docId,attachmentId,opts,callback){var self=this;opts instanceof Function&&(callback=opts,opts={}),this._get(docId,opts,function(err,res){return err?callback(err):res.doc._attachments&&res.doc._attachments[attachmentId]?(opts.ctx=res.ctx,opts.binary=!0,void self._getAttachment(docId,attachmentId,res.doc._attachments[attachmentId],opts,callback)):callback(createError(MISSING_DOC))})}),AbstractPouchDB.prototype.allDocs=adapterFun("allDocs",function(opts,callback){if("function"==typeof opts&&(callback=opts,opts={}),opts.skip=void 0!==opts.skip?opts.skip:0,opts.start_key&&(opts.startkey=opts.start_key),opts.end_key&&(opts.endkey=opts.end_key),"keys"in opts){if(!Array.isArray(opts.keys))return callback(new TypeError("options.keys must be an array"));var incompatibleOpt=["startkey","endkey","key"].filter(function(incompatibleOpt){return incompatibleOpt in opts})[0];if(incompatibleOpt)return void callback(createError(QUERY_PARSE_ERROR,"Query parameter `"+incompatibleOpt+"` is not compatible with multi-get"));if(!isRemote(this)&&(function(opts){var keys="limit"in opts?opts.keys.slice(opts.skip,opts.limit+opts.skip):0<opts.skip?opts.keys.slice(opts.skip):opts.keys;opts.keys=keys,opts.skip=0,delete opts.limit,opts.descending&&(keys.reverse(),opts.descending=!1)}(opts),0===opts.keys.length))return this._allDocs({limit:0},callback)}return this._allDocs(opts,callback)}),AbstractPouchDB.prototype.changes=function(opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),new Changes$2(this,opts,callback)},AbstractPouchDB.prototype.close=adapterFun("close",function(callback){return this._closed=!0,this.emit("closed"),this._close(callback)}),AbstractPouchDB.prototype.info=adapterFun("info",function(callback){var self=this;this._info(function(err,info){if(err)return callback(err);info.db_name=info.db_name||self.name,info.auto_compaction=!(!self.auto_compaction||isRemote(self)),info.adapter=self.adapter,callback(null,info)})}),AbstractPouchDB.prototype.id=adapterFun("id",function(callback){return this._id(callback)}),AbstractPouchDB.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},AbstractPouchDB.prototype.bulkDocs=adapterFun("bulkDocs",function(req,opts,callback){if("function"==typeof opts&&(callback=opts,opts={}),opts=opts||{},Array.isArray(req)&&(req={docs:req}),!req||!req.docs||!Array.isArray(req.docs))return callback(createError(MISSING_BULK_DOCS));for(var i=0;i<req.docs.length;++i)if("object"!=typeof req.docs[i]||Array.isArray(req.docs[i]))return callback(createError(NOT_AN_OBJECT));var attachmentError;if(req.docs.forEach(function(doc){doc._attachments&&Object.keys(doc._attachments).forEach(function(name){attachmentError=attachmentError||function(name){return"_"===name.charAt(0)&&name+" is not a valid attachment name, attachment names cannot start with '_'"}(name),doc._attachments[name].content_type||guardedConsole("warn","Attachment",name,"on document",doc._id,"is missing content_type")})}),attachmentError)return callback(createError(BAD_REQUEST,attachmentError));"new_edits"in opts||(opts.new_edits=!("new_edits"in req)||req.new_edits);var adapter=this;opts.new_edits||isRemote(adapter)||req.docs.sort(compareByIdThenRev),function(docs){for(var i=0;i<docs.length;i++){var doc=docs[i];if(doc._deleted)delete doc._attachments;else if(doc._attachments)for(var atts=Object.keys(doc._attachments),j=0;j<atts.length;j++){var att=atts[j];doc._attachments[att]=pick(doc._attachments[att],["data","digest","content_type","length","revpos","stub"])}}}(req.docs);var ids=req.docs.map(function(doc){return doc._id});return this._bulkDocs(req,opts,function(err,res){if(err)return callback(err);if(opts.new_edits||(res=res.filter(function(x){return x.error})),!isRemote(adapter))for(var i=0,l=res.length;i<l;i++)res[i].id=res[i].id||ids[i];callback(null,res)})}),AbstractPouchDB.prototype.registerDependentDatabase=adapterFun("registerDependentDatabase",function(dependentDb,callback){var depDB=new this.constructor(dependentDb,this.__opts);upsert(this,"_local/_pouch_dependentDbs",function(doc){return doc.dependentDbs=doc.dependentDbs||{},!doc.dependentDbs[dependentDb]&&(doc.dependentDbs[dependentDb]=!0,doc)}).then(function(){callback(null,{db:depDB})}).catch(callback)}),AbstractPouchDB.prototype.destroy=adapterFun("destroy",function(opts,callback){"function"==typeof opts&&(callback=opts,opts={});var self=this,usePrefix=!("use_prefix"in self)||self.use_prefix;function destroyDb(){self._destroy(opts,function(err,resp){if(err)return callback(err);self._destroyed=!0,self.emit("destroyed"),callback(null,resp||{ok:!0})})}if(isRemote(self))return destroyDb();self.get("_local/_pouch_dependentDbs",function(err,localDoc){if(err)return 404!==err.status?callback(err):destroyDb();var dependentDbs=localDoc.dependentDbs,PouchDB=self.constructor,deletedMap=Object.keys(dependentDbs).map(function(name){var trueName=usePrefix?name.replace(new RegExp("^"+PouchDB.prefix),""):name;return new PouchDB(trueName,self.__opts).destroy()});PouchPromise.all(deletedMap).then(destroyDb,callback)})}),TaskQueue$1.prototype.execute=function(){var fun;if(this.failed)for(;fun=this.queue.shift();)fun(this.failed);else for(;fun=this.queue.shift();)fun()},TaskQueue$1.prototype.fail=function(err){this.failed=err,this.execute()},TaskQueue$1.prototype.ready=function(db){this.isReady=!0,this.db=db,this.execute()},TaskQueue$1.prototype.addTask=function(fun){this.queue.push(fun),this.failed&&this.execute()},inherits(PouchDB,AbstractPouchDB),PouchDB.adapters={},PouchDB.preferredAdapters=[],PouchDB.prefix="_pouch_";var eventEmitter=new events.EventEmitter;!function(Pouch){Object.keys(events.EventEmitter.prototype).forEach(function(key){"function"==typeof events.EventEmitter.prototype[key]&&(Pouch[key]=eventEmitter[key].bind(eventEmitter))});var destructListeners=Pouch._destructionListeners=new ExportedMap;Pouch.on("ref",function(db){destructListeners.has(db.name)||destructListeners.set(db.name,[]),destructListeners.get(db.name).push(db)}),Pouch.on("unref",function(db){if(destructListeners.has(db.name)){var dbList=destructListeners.get(db.name),pos=dbList.indexOf(db);pos<0||(dbList.splice(pos,1),1<dbList.length?destructListeners.set(db.name,dbList):destructListeners.delete(db.name))}}),Pouch.on("destroyed",function(name){if(destructListeners.has(name)){var dbList=destructListeners.get(name);destructListeners.delete(name),dbList.forEach(function(db){db.emit("destroyed",!0)})}})}(PouchDB),PouchDB.adapter=function(id,obj,addToPreferredAdapters){obj.valid()&&(PouchDB.adapters[id]=obj,addToPreferredAdapters&&PouchDB.preferredAdapters.push(id))},PouchDB.plugin=function(obj){if("function"==typeof obj)obj(PouchDB);else{if("object"!=typeof obj||0===Object.keys(obj).length)throw new Error('Invalid plugin: got "'+obj+'", expected an object or a function');Object.keys(obj).forEach(function(id){PouchDB.prototype[id]=obj[id]})}return this.__defaults&&(PouchDB.__defaults=$inject_Object_assign({},this.__defaults)),PouchDB},PouchDB.defaults=function(defaultOpts){function PouchAlt(name,opts){if(!(this instanceof PouchAlt))return new PouchAlt(name,opts);opts=opts||{},name&&"object"==typeof name&&(name=(opts=name).name,delete opts.name),opts=$inject_Object_assign({},PouchAlt.__defaults,opts),PouchDB.call(this,name,opts)}return inherits(PouchAlt,PouchDB),PouchAlt.preferredAdapters=PouchDB.preferredAdapters.slice(),Object.keys(PouchDB).forEach(function(key){key in PouchAlt||(PouchAlt[key]=PouchDB[key])}),PouchAlt.__defaults=$inject_Object_assign({},this.__defaults,defaultOpts),PouchAlt};function getFieldFromDoc(doc,parsedField){for(var value=doc,i=0,len=parsedField.length;i<len;i++){if(!(value=value[parsedField[i]]))break}return value}function parseField(fieldName){for(var fields=[],current="",i=0,len=fieldName.length;i<len;i++){var ch=fieldName[i];"."===ch?current=0<i&&"\\"===fieldName[i-1]?current.substring(0,current.length-1)+".":(fields.push(current),""):current+=ch}return fields.push(current),fields}var combinationFields=["$or","$nor","$not"];function isCombinationalField(field){return-1<combinationFields.indexOf(field)}function getKey(obj){return Object.keys(obj)[0]}function mergeAndedSelectors(selectors){var res={};return selectors.forEach(function(selector){Object.keys(selector).forEach(function(field){var matcher=selector[field];if("object"!=typeof matcher&&(matcher={$eq:matcher}),isCombinationalField(field))matcher instanceof Array?res[field]=matcher.map(function(m){return mergeAndedSelectors([m])}):res[field]=mergeAndedSelectors([matcher]);else{var fieldMatchers=res[field]=res[field]||{};Object.keys(matcher).forEach(function(operator){var value=matcher[operator];return"$gt"===operator||"$gte"===operator?function(operator,value,fieldMatchers){if(void 0!==fieldMatchers.$eq)return;void 0!==fieldMatchers.$gte?"$gte"===operator?value>fieldMatchers.$gte&&(fieldMatchers.$gte=value):value>=fieldMatchers.$gte&&(delete fieldMatchers.$gte,fieldMatchers.$gt=value):void 0!==fieldMatchers.$gt?"$gte"===operator?value>fieldMatchers.$gt&&(delete fieldMatchers.$gt,fieldMatchers.$gte=value):value>fieldMatchers.$gt&&(fieldMatchers.$gt=value):fieldMatchers[operator]=value}(operator,value,fieldMatchers):"$lt"===operator||"$lte"===operator?function(operator,value,fieldMatchers){if(void 0!==fieldMatchers.$eq)return;void 0!==fieldMatchers.$lte?"$lte"===operator?value<fieldMatchers.$lte&&(fieldMatchers.$lte=value):value<=fieldMatchers.$lte&&(delete fieldMatchers.$lte,fieldMatchers.$lt=value):void 0!==fieldMatchers.$lt?"$lte"===operator?value<fieldMatchers.$lt&&(delete fieldMatchers.$lt,fieldMatchers.$lte=value):value<fieldMatchers.$lt&&(fieldMatchers.$lt=value):fieldMatchers[operator]=value}(operator,value,fieldMatchers):"$ne"===operator?function(value,fieldMatchers){"$ne"in fieldMatchers?fieldMatchers.$ne.push(value):fieldMatchers.$ne=[value]}(value,fieldMatchers):"$eq"===operator?function(value,fieldMatchers){delete fieldMatchers.$gt,delete fieldMatchers.$gte,delete fieldMatchers.$lt,delete fieldMatchers.$lte,delete fieldMatchers.$ne,fieldMatchers.$eq=value}(value,fieldMatchers):void(fieldMatchers[operator]=value)})}})}),res}function padLeft(str,padWith,upToLength){return function(str,padWith,upToLength){for(var padding="",targetLength=upToLength-str.length;padding.length<targetLength;)padding+=padWith;return padding}(str,padWith,upToLength)+str}var MIN_MAGNITUDE=-324,MAGNITUDE_DIGITS=3,SEP="";function collate(a,b){if(a===b)return 0;a=normalizeKey(a),b=normalizeKey(b);var ai=collationIndex(a),bi=collationIndex(b);if(ai-bi!=0)return ai-bi;switch(typeof a){case"number":return a-b;case"boolean":return a<b?-1:1;case"string":return function(a,b){return a===b?0:b<a?1:-1}(a,b)}return Array.isArray(a)?function(a,b){for(var len=Math.min(a.length,b.length),i=0;i<len;i++){var sort=collate(a[i],b[i]);if(0!==sort)return sort}return a.length===b.length?0:a.length>b.length?1:-1}(a,b):function(a,b){for(var ak=Object.keys(a),bk=Object.keys(b),len=Math.min(ak.length,bk.length),i=0;i<len;i++){var sort=collate(ak[i],bk[i]);if(0!==sort)return sort;if(0!==(sort=collate(a[ak[i]],b[bk[i]])))return sort}return ak.length===bk.length?0:ak.length>bk.length?1:-1}(a,b)}function normalizeKey(key){switch(typeof key){case"undefined":return null;case"number":return key===1/0||key===-1/0||isNaN(key)?null:key;case"object":var origKey=key;if(Array.isArray(key)){var len=key.length;key=new Array(len);for(var i=0;i<len;i++)key[i]=normalizeKey(origKey[i])}else{if(key instanceof Date)return key.toJSON();if(null!==key)for(var k in key={},origKey)if(origKey.hasOwnProperty(k)){var val=origKey[k];void 0!==val&&(key[k]=normalizeKey(val))}}}return key}function indexify(key){if(null!==key)switch(typeof key){case"boolean":return key?1:0;case"number":return function(num){if(0===num)return"1";var expFormat=num.toExponential().split(/e\+?/),magnitude=parseInt(expFormat[1],10),neg=num<0,result=neg?"0":"2",magString=padLeft(((neg?-magnitude:magnitude)-MIN_MAGNITUDE).toString(),"0",MAGNITUDE_DIGITS);result+=SEP+magString;var factor=Math.abs(parseFloat(expFormat[0]));neg&&(factor=10-factor);var factorStr=factor.toFixed(20);return factorStr=factorStr.replace(/\.?0+$/,""),result+=SEP+factorStr}(key);case"string":return key.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var isArray=Array.isArray(key),arr=isArray?key:Object.keys(key),i=-1,len=arr.length,result="";if(isArray)for(;++i<len;)result+=toIndexableString(arr[i]);else for(;++i<len;){var objKey=arr[i];result+=toIndexableString(objKey)+toIndexableString(key[objKey])}return result}return""}function toIndexableString(key){return collationIndex(key=normalizeKey(key))+SEP+indexify(key)+"\0"}function parseNumber(str,i){var num,originalIdx=i;if("1"===str[i])num=0,i++;else{var neg="0"===str[i];i++;var numAsString="",magAsString=str.substring(i,i+MAGNITUDE_DIGITS),magnitude=parseInt(magAsString,10)+MIN_MAGNITUDE;for(neg&&(magnitude=-magnitude),i+=MAGNITUDE_DIGITS;;){var ch=str[i];if("\0"===ch)break;numAsString+=ch,i++}num=1===(numAsString=numAsString.split(".")).length?parseInt(numAsString,10):parseFloat(numAsString[0]+"."+numAsString[1]),neg&&(num-=10),0!==magnitude&&(num=parseFloat(num+"e"+magnitude))}return{num:num,length:i-originalIdx}}function pop(stack,metaStack){var obj=stack.pop();if(metaStack.length){var lastMetaElement=metaStack[metaStack.length-1];obj===lastMetaElement.element&&(metaStack.pop(),lastMetaElement=metaStack[metaStack.length-1]);var element=lastMetaElement.element,lastElementIndex=lastMetaElement.index;if(Array.isArray(element))element.push(obj);else if(lastElementIndex===stack.length-2){element[stack.pop()]=obj}else stack.push(obj)}}function collationIndex(x){var idx=["boolean","number","string","object"].indexOf(typeof x);return~idx?null===x?1:Array.isArray(x)?5:idx<3?idx+2:idx+3:Array.isArray(x)?5:void 0}function createFieldSorter(sort){function getFieldValuesAsArray(doc){return sort.map(function(sorting){var parsedField=parseField(getKey(sorting));return getFieldFromDoc(doc,parsedField)})}return function(aRow,bRow){var collation=collate(getFieldValuesAsArray(aRow.doc),getFieldValuesAsArray(bRow.doc));return 0!==collation?collation:function(left,right){return left<right?-1:right<left?1:0}(aRow.doc._id,bRow.doc._id)}}function filterInMemoryFields(rows,requestDef,inMemoryFields){if(rows=rows.filter(function(row){return rowFilter(row.doc,requestDef.selector,inMemoryFields)}),requestDef.sort){var fieldSorter=createFieldSorter(requestDef.sort);rows=rows.sort(fieldSorter),"string"!=typeof requestDef.sort[0]&&"desc"===function(obj){return obj[getKey(obj)]}(requestDef.sort[0])&&(rows=rows.reverse())}if("limit"in requestDef||"skip"in requestDef){var skip=requestDef.skip||0,limit=("limit"in requestDef?requestDef.limit:rows.length)+skip;rows=rows.slice(skip,limit)}return rows}function rowFilter(doc,selector,inMemoryFields){return inMemoryFields.every(function(field){var matcher=selector[field],parsedField=parseField(field),docFieldValue=getFieldFromDoc(doc,parsedField);return isCombinationalField(field)?function(field,matcher,doc){return"$or"!==field?"$not"!==field?!matcher.find(function(orMatchers){return rowFilter(doc,orMatchers,Object.keys(orMatchers))}):!rowFilter(doc,matcher,Object.keys(matcher)):matcher.some(function(orMatchers){return rowFilter(doc,orMatchers,Object.keys(orMatchers))})}(field,matcher,doc):matchSelector(matcher,doc,parsedField,docFieldValue)})}function matchSelector(matcher,doc,parsedField,docFieldValue){return!matcher||Object.keys(matcher).every(function(userOperator){var userValue=matcher[userOperator];return function(userOperator,doc,userValue,parsedField,docFieldValue){if(matchers[userOperator])return matchers[userOperator](doc,userValue,parsedField,docFieldValue);throw new Error('unknown operator "'+userOperator+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all')}(userOperator,doc,userValue,parsedField,docFieldValue)})}function fieldExists(docFieldValue){return null!=docFieldValue}function fieldIsNotUndefined(docFieldValue){return void 0!==docFieldValue}function arrayContainsValue(docFieldValue,userValue){return userValue.some(function(val){return docFieldValue instanceof Array?-1<docFieldValue.indexOf(val):docFieldValue===val})}var matchers={$elemMatch:function(doc,userValue,parsedField,docFieldValue){return!!Array.isArray(docFieldValue)&&(0!==docFieldValue.length&&("object"==typeof docFieldValue[0]?docFieldValue.some(function(val){return rowFilter(val,userValue,Object.keys(userValue))}):docFieldValue.some(function(val){return matchSelector(userValue,doc,parsedField,val)})))},$allMatch:function(doc,userValue,parsedField,docFieldValue){return!!Array.isArray(docFieldValue)&&(0!==docFieldValue.length&&("object"==typeof docFieldValue[0]?docFieldValue.every(function(val){return rowFilter(val,userValue,Object.keys(userValue))}):docFieldValue.every(function(val){return matchSelector(userValue,doc,parsedField,val)})))},$eq:function(doc,userValue,parsedField,docFieldValue){return fieldIsNotUndefined(docFieldValue)&&0===collate(docFieldValue,userValue)},$gte:function(doc,userValue,parsedField,docFieldValue){return fieldIsNotUndefined(docFieldValue)&&0<=collate(docFieldValue,userValue)},$gt:function(doc,userValue,parsedField,docFieldValue){return fieldIsNotUndefined(docFieldValue)&&0<collate(docFieldValue,userValue)},$lte:function(doc,userValue,parsedField,docFieldValue){return fieldIsNotUndefined(docFieldValue)&&collate(docFieldValue,userValue)<=0},$lt:function(doc,userValue,parsedField,docFieldValue){return fieldIsNotUndefined(docFieldValue)&&collate(docFieldValue,userValue)<0},$exists:function(doc,userValue,parsedField,docFieldValue){return userValue?fieldIsNotUndefined(docFieldValue):!fieldIsNotUndefined(docFieldValue)},$mod:function(doc,userValue,parsedField,docFieldValue){return fieldExists(docFieldValue)&&function(docFieldValue,userValue){var divisor=userValue[0],mod=userValue[1];if(0===divisor)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(divisor,10)!==divisor)throw new Error("Divisor is not an integer");if(parseInt(mod,10)!==mod)throw new Error("Modulus is not an integer");return parseInt(docFieldValue,10)===docFieldValue&&docFieldValue%divisor===mod}(docFieldValue,userValue)},$ne:function(doc,userValue,parsedField,docFieldValue){return userValue.every(function(neValue){return 0!==collate(docFieldValue,neValue)})},$in:function(doc,userValue,parsedField,docFieldValue){return fieldExists(docFieldValue)&&arrayContainsValue(docFieldValue,userValue)},$nin:function(doc,userValue,parsedField,docFieldValue){return fieldExists(docFieldValue)&&!arrayContainsValue(docFieldValue,userValue)},$size:function(doc,userValue,parsedField,docFieldValue){return fieldExists(docFieldValue)&&function(docFieldValue,userValue){return docFieldValue.length===userValue}(docFieldValue,userValue)},$all:function(doc,userValue,parsedField,docFieldValue){return Array.isArray(docFieldValue)&&function(docFieldValue,userValue){return userValue.every(function(val){return-1<docFieldValue.indexOf(val)})}(docFieldValue,userValue)},$regex:function(doc,userValue,parsedField,docFieldValue){return fieldExists(docFieldValue)&&function(docFieldValue,userValue){return new RegExp(userValue).test(docFieldValue)}(docFieldValue,userValue)},$type:function(doc,userValue,parsedField,docFieldValue){return function(docFieldValue,userValue){switch(userValue){case"null":return null===docFieldValue;case"boolean":return"boolean"==typeof docFieldValue;case"number":return"number"==typeof docFieldValue;case"string":return"string"==typeof docFieldValue;case"array":return docFieldValue instanceof Array;case"object":return"[object Object]"==={}.toString.call(docFieldValue)}throw new Error(userValue+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(docFieldValue,userValue)}};function matchesSelector(doc,selector){if("object"!=typeof selector)throw new Error("Selector error: expected a JSON object");var rowsMatched=filterInMemoryFields([{doc:doc}],{selector:selector=function(input){var result=clone(input),wasAnded=!1;"$and"in result&&(result=mergeAndedSelectors(result.$and),wasAnded=!0),["$or","$nor"].forEach(function(orOrNor){orOrNor in result&&result[orOrNor].forEach(function(subSelector){for(var fields=Object.keys(subSelector),i=0;i<fields.length;i++){var field=fields[i],matcher=subSelector[field];"object"==typeof matcher&&null!==matcher||(subSelector[field]={$eq:matcher})}})}),"$not"in result&&(result.$not=mergeAndedSelectors([result.$not]));for(var fields=Object.keys(result),i=0;i<fields.length;i++){var field=fields[i],matcher=result[field];"object"!=typeof matcher||null===matcher?matcher={$eq:matcher}:"$ne"in matcher&&!wasAnded&&(matcher.$ne=[matcher.$ne]),result[field]=matcher}return result}(selector)},Object.keys(selector));return rowsMatched&&1===rowsMatched.length}function validate(opts,callback){if(opts.selector&&opts.filter&&"_selector"!==opts.filter){var filterName="string"==typeof opts.filter?opts.filter:"function";return callback(new Error('selector invalid for filter "'+filterName+'"'))}callback()}function normalize(opts){opts.view&&!opts.filter&&(opts.filter="_view"),opts.selector&&!opts.filter&&(opts.filter="_selector"),opts.filter&&"string"==typeof opts.filter&&("_view"===opts.filter?opts.view=normalizeDesignDocFunctionName(opts.view):opts.filter=normalizeDesignDocFunctionName(opts.filter))}function shouldFilter(changesHandler,opts){return opts.filter&&"string"==typeof opts.filter&&!opts.doc_ids&&!isRemote(changesHandler.db)}function filter(changesHandler,opts){var callback=opts.complete;if("_view"===opts.filter){if(!opts.view||"string"!=typeof opts.view){var err=createError(BAD_REQUEST,"`view` filter parameter not found or invalid.");return callback(err)}var viewName=parseDesignDocFunctionName(opts.view);changesHandler.db.get("_design/"+viewName[0],function(err,ddoc){if(changesHandler.isCancelled)return callback(null,{status:"cancelled"});if(err)return callback(generateErrorFromResponse(err));var mapFun=ddoc&&ddoc.views&&ddoc.views[viewName[1]]&&ddoc.views[viewName[1]].map;if(!mapFun)return callback(createError(MISSING_DOC,ddoc.views?"missing json key: "+viewName[1]:"missing json key: views"));opts.filter=function(input){return scopeEval(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+input+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{})}(mapFun),changesHandler.doChanges(opts)})}else if(opts.selector)opts.filter=function(doc){return matchesSelector(doc,opts.selector)},changesHandler.doChanges(opts);else{var filterName=parseDesignDocFunctionName(opts.filter);changesHandler.db.get("_design/"+filterName[0],function(err,ddoc){if(changesHandler.isCancelled)return callback(null,{status:"cancelled"});if(err)return callback(generateErrorFromResponse(err));var filterFun=ddoc&&ddoc.filters&&ddoc.filters[filterName[1]];if(!filterFun)return callback(createError(MISSING_DOC,ddoc&&ddoc.filters?"missing json key: "+filterName[1]:"missing json key: filters"));opts.filter=function(input){return scopeEval('"use strict";\nreturn '+input+";",{})}(filterFun),changesHandler.doChanges(opts)})}}function toObject(array){return array.reduce(function(obj,item){return obj[item]=!0,obj},{})}PouchDB.plugin(function(PouchDB){PouchDB.debug=debug;var logs={};PouchDB.on("debug",function(args){var logId=args[0],logArgs=args.slice(1);logs[logId]||(logs[logId]=debug("pouchdb:"+logId)),logs[logId].apply(null,logArgs)})}),PouchDB.plugin(function(PouchDB){PouchDB._changesFilterPlugin={validate:validate,normalize:normalize,shouldFilter:shouldFilter,filter:filter}}),PouchDB.version="6.4.3";var reservedWords=toObject(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),dataWords=toObject(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function parseRevisionInfo(rev$$1){if(!/^\d+-./.test(rev$$1))return createError(INVALID_REV);var idx=rev$$1.indexOf("-"),left=rev$$1.substring(0,idx),right=rev$$1.substring(idx+1);return{prefix:parseInt(left,10),id:right}}function parseDoc(doc,newEdits){var nRevNum,newRevId,revInfo,opts={status:"available"};if(doc._deleted&&(opts.deleted=!0),newEdits)if(doc._id||(doc._id=uuid()),newRevId=rev(),doc._rev){if((revInfo=parseRevisionInfo(doc._rev)).error)return revInfo;doc._rev_tree=[{pos:revInfo.prefix,ids:[revInfo.id,{status:"missing"},[[newRevId,opts,[]]]]}],nRevNum=revInfo.prefix+1}else doc._rev_tree=[{pos:1,ids:[newRevId,opts,[]]}],nRevNum=1;else if(doc._revisions&&(doc._rev_tree=function(revisions,opts){for(var pos=revisions.start-revisions.ids.length+1,revisionIds=revisions.ids,ids=[revisionIds[0],opts,[]],i=1,len=revisionIds.length;i<len;i++)ids=[revisionIds[i],{status:"missing"},[ids]];return[{pos:pos,ids:ids}]}(doc._revisions,opts),nRevNum=doc._revisions.start,newRevId=doc._revisions.ids[0]),!doc._rev_tree){if((revInfo=parseRevisionInfo(doc._rev)).error)return revInfo;nRevNum=revInfo.prefix,newRevId=revInfo.id,doc._rev_tree=[{pos:nRevNum,ids:[newRevId,opts,[]]}]}invalidIdError(doc._id),doc._rev=nRevNum+"-"+newRevId;var result={metadata:{},data:{}};for(var key in doc)if(Object.prototype.hasOwnProperty.call(doc,key)){var specialKey="_"===key[0];if(specialKey&&!reservedWords[key]){var error=createError(DOC_VALIDATION,key);throw error.message=DOC_VALIDATION.message+": "+key,error}specialKey&&!dataWords[key]?result.metadata[key.slice(1)]=doc[key]:result.data[key]=doc[key]}return result}var thisAtob=function(str){return atob(str)},thisBtoa=function(str){return btoa(str)};function createBlob(parts,properties){parts=parts||[],properties=properties||{};try{return new Blob(parts,properties)}catch(e){if("TypeError"!==e.name)throw e;for(var builder=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<parts.length;i+=1)builder.append(parts[i]);return builder.getBlob(properties.type)}}function binStringToBluffer(binString,type){return createBlob([function(bin){for(var length=bin.length,buf=new ArrayBuffer(length),arr=new Uint8Array(buf),i=0;i<length;i++)arr[i]=bin.charCodeAt(i);return buf}(binString)],{type:type})}function b64ToBluffer(b64,type){return binStringToBluffer(thisAtob(b64),type)}function arrayBufferToBinaryString(buffer){for(var binary="",bytes=new Uint8Array(buffer),length=bytes.byteLength,i=0;i<length;i++)binary+=String.fromCharCode(bytes[i]);return binary}function readAsBinaryString(blob,callback){if("undefined"==typeof FileReader)return callback(arrayBufferToBinaryString((new FileReaderSync).readAsArrayBuffer(blob)));var reader=new FileReader,hasBinaryString="function"==typeof reader.readAsBinaryString;reader.onloadend=function(e){var result=e.target.result||"";if(hasBinaryString)return callback(result);callback(arrayBufferToBinaryString(result))},hasBinaryString?reader.readAsBinaryString(blob):reader.readAsArrayBuffer(blob)}function blobToBinaryString(blobOrBuffer,callback){readAsBinaryString(blobOrBuffer,function(bin){callback(bin)})}function blobToBase64(blobOrBuffer,callback){blobToBinaryString(blobOrBuffer,function(base64){callback(thisBtoa(base64))})}function readAsArrayBuffer(blob,callback){if("undefined"==typeof FileReader)return callback((new FileReaderSync).readAsArrayBuffer(blob));var reader=new FileReader;reader.onloadend=function(e){var result=e.target.result||new ArrayBuffer(0);callback(result)},reader.readAsArrayBuffer(blob)}var setImmediateShim=global.setImmediate||global.setTimeout,MD5_CHUNK_SIZE=32768;function appendBlob(buffer,blob,start,end,callback){(0<start||end<blob.size)&&(blob=function(blob,start,end){return blob.webkitSlice?blob.webkitSlice(start,end):blob.slice(start,end)}(blob,start,end)),readAsArrayBuffer(blob,function(arrayBuffer){buffer.append(arrayBuffer),callback()})}function appendString(buffer,string,start,end,callback){(0<start||end<string.length)&&(string=string.substring(start,end)),buffer.appendBinary(string),callback()}function binaryMd5(data,callback){var inputIsString="string"==typeof data,len=inputIsString?data.length:data.size,chunkSize=Math.min(MD5_CHUNK_SIZE,len),chunks=Math.ceil(len/chunkSize),currentChunk=0,buffer=inputIsString?new Md5:new Md5.ArrayBuffer,append=inputIsString?appendString:appendBlob;function next(){setImmediateShim(loadNextChunk)}function done(){var base64=function(raw){return thisBtoa(raw)}(buffer.end(!0));callback(base64),buffer.destroy()}function loadNextChunk(){var start=currentChunk*chunkSize,end=start+chunkSize;append(buffer,data,start,end,++currentChunk<chunks?next:done)}loadNextChunk()}function preprocessString(att,blobType,callback){var asBinary=function(data){try{return thisAtob(data)}catch(e){return{error:createError(BAD_ARG,"Attachment is not a valid base64 string")}}}(att.data);if(asBinary.error)return callback(asBinary.error);att.length=asBinary.length,att.data="blob"===blobType?binStringToBluffer(asBinary,att.content_type):"base64"===blobType?thisBtoa(asBinary):asBinary,binaryMd5(asBinary,function(result){att.digest="md5-"+result,callback()})}function preprocessAttachment(att,blobType,callback){if(att.stub)return callback();"string"==typeof att.data?preprocessString(att,blobType,callback):function(att,blobType,callback){binaryMd5(att.data,function(md5){att.digest="md5-"+md5,att.length=att.data.size||att.data.length||0,"binary"===blobType?blobToBinaryString(att.data,function(binString){att.data=binString,callback()}):"base64"===blobType?blobToBase64(att.data,function(b64){att.data=b64,callback()}):callback()})}(att,blobType,callback)}function preprocessAttachments(docInfos,blobType,callback){if(!docInfos.length)return callback();var overallErr,docv=0;function done(){docv++,docInfos.length===docv&&(overallErr?callback(overallErr):callback())}docInfos.forEach(function(docInfo){var attachments=docInfo.data&&docInfo.data._attachments?Object.keys(docInfo.data._attachments):[],recv=0;if(!attachments.length)return done();function processedAttachment(err){overallErr=err,++recv===attachments.length&&done()}for(var key in docInfo.data._attachments)docInfo.data._attachments.hasOwnProperty(key)&&preprocessAttachment(docInfo.data._attachments[key],blobType,processedAttachment)})}function updateDoc(revLimit,prev,docInfo,results,i,cb,writeDoc,newEdits){if(function(revs,rev){for(var node,toVisit=revs.slice(),splitRev=rev.split("-"),targetPos=parseInt(splitRev[0],10),targetId=splitRev[1];node=toVisit.pop();){if(node.pos===targetPos&&node.ids[0]===targetId)return!0;for(var branches=node.ids[2],i=0,len=branches.length;i<len;i++)toVisit.push({pos:node.pos+1,ids:branches[i]})}return!1}(prev.rev_tree,docInfo.metadata.rev))return results[i]=docInfo,cb();var previousWinningRev=prev.winningRev||winningRev(prev),previouslyDeleted="deleted"in prev?prev.deleted:isDeleted(prev,previousWinningRev),deleted="deleted"in docInfo.metadata?docInfo.metadata.deleted:isDeleted(docInfo.metadata),isRoot=/^1-/.test(docInfo.metadata.rev);if(previouslyDeleted&&!deleted&&newEdits&&isRoot){var newDoc=docInfo.data;newDoc._rev=previousWinningRev,newDoc._id=docInfo.metadata.id,docInfo=parseDoc(newDoc,newEdits)}var merged=merge(prev.rev_tree,docInfo.metadata.rev_tree[0],revLimit);if(newEdits&&(previouslyDeleted&&deleted&&"new_leaf"!==merged.conflicts||!previouslyDeleted&&"new_leaf"!==merged.conflicts||previouslyDeleted&&!deleted&&"new_branch"===merged.conflicts)){var err=createError(REV_CONFLICT);return results[i]=err,cb()}var newRev=docInfo.metadata.rev;docInfo.metadata.rev_tree=merged.tree,docInfo.stemmedRevs=merged.stemmedRevs||[],prev.rev_map&&(docInfo.metadata.rev_map=prev.rev_map);var winningRev$$1=winningRev(docInfo.metadata),winningRevIsDeleted=isDeleted(docInfo.metadata,winningRev$$1),delta=previouslyDeleted===winningRevIsDeleted?0:previouslyDeleted<winningRevIsDeleted?-1:1;writeDoc(docInfo,winningRev$$1,winningRevIsDeleted,newRev===winningRev$$1?winningRevIsDeleted:isDeleted(docInfo.metadata,newRev),!0,delta,i,cb)}function processDocs(revLimit,docInfos,api,fetchedDocs,tx,results,writeDoc,opts,overallCallback){revLimit=revLimit||1e3;var newEdits=opts.new_edits,idsToDocs=new ExportedMap,docsDone=0,docsToDo=docInfos.length;function checkAllDocsDone(){++docsDone===docsToDo&&overallCallback&&overallCallback()}docInfos.forEach(function(currentDoc,resultsIdx){if(currentDoc._id&&isLocalId(currentDoc._id)){var fun=currentDoc._deleted?"_removeLocal":"_putLocal";api[fun](currentDoc,{ctx:tx},function(err,res){results[resultsIdx]=err||res,checkAllDocsDone()})}else{var id=currentDoc.metadata.id;idsToDocs.has(id)?(docsToDo--,idsToDocs.get(id).push([currentDoc,resultsIdx])):idsToDocs.set(id,[[currentDoc,resultsIdx]])}}),idsToDocs.forEach(function(docs,id){var numDone=0;function docWritten(){++numDone<docs.length?nextDoc():checkAllDocsDone()}function nextDoc(){var value=docs[numDone],currentDoc=value[0],resultsIdx=value[1];if(fetchedDocs.has(id))updateDoc(revLimit,fetchedDocs.get(id),currentDoc,results,resultsIdx,docWritten,writeDoc,newEdits);else{var merged=merge([],currentDoc.metadata.rev_tree[0],revLimit);currentDoc.metadata.rev_tree=merged.tree,currentDoc.stemmedRevs=merged.stemmedRevs||[],function(docInfo,resultsIdx,callback){var winningRev$$1=winningRev(docInfo.metadata),deleted=isDeleted(docInfo.metadata,winningRev$$1);if("was_delete"in opts&&deleted)return results[resultsIdx]=createError(MISSING_DOC,"deleted"),callback();if(newEdits&&function(docInfo){return"missing"===docInfo.metadata.rev_tree[0].ids[1].status}(docInfo)){var err=createError(REV_CONFLICT);return results[resultsIdx]=err,callback()}writeDoc(docInfo,winningRev$$1,deleted,deleted,!1,deleted?0:1,resultsIdx,callback)}(currentDoc,resultsIdx,docWritten)}}nextDoc()})}var ADAPTER_VERSION=5,DOC_STORE="document-store",BY_SEQ_STORE="by-sequence",ATTACH_STORE="attach-store",ATTACH_AND_SEQ_STORE="attach-seq-store",META_STORE="meta-store",LOCAL_STORE="local-store",DETECT_BLOB_SUPPORT_STORE="detect-blob-support";function safeJsonParse(str){try{return JSON.parse(str)}catch(e){return vuvuzela.parse(str)}}function safeJsonStringify(json){try{return JSON.stringify(json)}catch(e){return vuvuzela.stringify(json)}}function idbError(callback){return function(evt){var message="unknown_error";evt.target&&evt.target.error&&(message=evt.target.error.name||evt.target.error.message),callback(createError(IDB_ERROR,message,evt.type))}}function encodeMetadata(metadata,winningRev,deleted){return{data:safeJsonStringify(metadata),winningRev:winningRev,deletedOrLocal:deleted?"1":"0",seq:metadata.seq,id:metadata.id}}function decodeMetadata(storedObject){if(!storedObject)return null;var metadata=safeJsonParse(storedObject.data);return metadata.winningRev=storedObject.winningRev,metadata.deleted="1"===storedObject.deletedOrLocal,metadata.seq=storedObject.seq,metadata}function decodeDoc(doc){if(!doc)return doc;var idx=doc._doc_id_rev.lastIndexOf(":");return doc._id=doc._doc_id_rev.substring(0,idx-1),doc._rev=doc._doc_id_rev.substring(idx+1),delete doc._doc_id_rev,doc}function readBlobData(body,type,asBlob,callback){asBlob?callback(body?"string"!=typeof body?body:b64ToBluffer(body,type):createBlob([""],{type:type})):body?"string"!=typeof body?readAsBinaryString(body,function(binary){callback(thisBtoa(binary))}):callback(body):callback("")}function fetchAttachmentsIfNecessary(doc,opts,txn,cb){var attachments=Object.keys(doc._attachments||{});if(!attachments.length)return cb&&cb();var numDone=0;function checkDone(){++numDone===attachments.length&&cb&&cb()}attachments.forEach(function(att){opts.attachments&&opts.include_docs?function(doc,att){var attObj=doc._attachments[att],digest=attObj.digest;txn.objectStore(ATTACH_STORE).get(digest).onsuccess=function(e){attObj.body=e.target.result.body,checkDone()}}(doc,att):(doc._attachments[att].stub=!0,checkDone())})}function postProcessAttachments(results,asBlob){return PouchPromise.all(results.map(function(row){if(row.doc&&row.doc._attachments){var attNames=Object.keys(row.doc._attachments);return PouchPromise.all(attNames.map(function(att){var attObj=row.doc._attachments[att];if("body"in attObj){var body=attObj.body,type=attObj.content_type;return new PouchPromise(function(resolve){readBlobData(body,type,asBlob,function(data){row.doc._attachments[att]=$inject_Object_assign(pick(attObj,["digest","content_type"]),{data:data}),resolve()})})}}))}}))}function compactRevs(revs,docId,txn){var possiblyOrphanedDigests=[],seqStore=txn.objectStore(BY_SEQ_STORE),attStore=txn.objectStore(ATTACH_STORE),attAndSeqStore=txn.objectStore(ATTACH_AND_SEQ_STORE),count=revs.length;function checkDone(){--count||function(){if(!possiblyOrphanedDigests.length)return;possiblyOrphanedDigests.forEach(function(digest){attAndSeqStore.index("digestSeq").count(IDBKeyRange.bound(digest+"::",digest+"::ï¿¿",!1,!1)).onsuccess=function(e){e.target.result||attStore.delete(digest)}})}()}revs.forEach(function(rev$$1){var index=seqStore.index("_doc_id_rev"),key=docId+"::"+rev$$1;index.getKey(key).onsuccess=function(e){var seq=e.target.result;if("number"!=typeof seq)return checkDone();seqStore.delete(seq),attAndSeqStore.index("seq").openCursor(IDBKeyRange.only(seq)).onsuccess=function(event){var cursor=event.target.result;if(cursor){var digest=cursor.value.digestSeq.split("::")[0];possiblyOrphanedDigests.push(digest),attAndSeqStore.delete(cursor.primaryKey),cursor.continue()}else checkDone()}}})}function openTransactionSafely(idb,stores,mode){try{return{txn:idb.transaction(stores,mode)}}catch(err){return{error:err}}}var changesHandler$$1=new Changes;function idbBulkDocs(dbOpts,req,opts,api,idb,callback){for(var txn,docStore,bySeqStore,attachStore,attachAndSeqStore,metaStore,docInfoError,metaDoc,docInfos=req.docs,i=0,len=docInfos.length;i<len;i++){var doc=docInfos[i];doc._id&&isLocalId(doc._id)||(doc=docInfos[i]=parseDoc(doc,opts.new_edits)).error&&!docInfoError&&(docInfoError=doc)}if(docInfoError)return callback(docInfoError);var allDocsProcessed=!1,docCountDelta=0,results=new Array(docInfos.length),fetchedDocs=new ExportedMap,preconditionErrored=!1,blobType=api._meta.blobSupport?"blob":"base64";function onAllDocsProcessed(){allDocsProcessed=!0,updateDocCountIfReady()}function updateDocCountIfReady(){metaDoc&&allDocsProcessed&&(metaDoc.docCount+=docCountDelta,metaStore.put(metaDoc))}function complete(){preconditionErrored||(changesHandler$$1.notify(api._meta.name),callback(null,results))}function writeDoc(docInfo,winningRev$$1,winningRevIsDeleted,newRevIsDeleted,isUpdate,delta,resultsIdx,callback){docInfo.metadata.winningRev=winningRev$$1,docInfo.metadata.deleted=winningRevIsDeleted;var doc=docInfo.data;if(doc._id=docInfo.metadata.id,doc._rev=docInfo.metadata.rev,newRevIsDeleted&&(doc._deleted=!0),doc._attachments&&Object.keys(doc._attachments).length)return function(docInfo,winningRev$$1,winningRevIsDeleted,isUpdate,resultsIdx,callback){var doc=docInfo.data,numDone=0,attachments=Object.keys(doc._attachments);function collectResults(){numDone===attachments.length&&finishDoc(docInfo,winningRev$$1,winningRevIsDeleted,isUpdate,resultsIdx,callback)}function attachmentSaved(){numDone++,collectResults()}attachments.forEach(function(key){var att=docInfo.data._attachments[key];if(att.stub)numDone++,collectResults();else{var data=att.data;delete att.data,att.revpos=parseInt(winningRev$$1,10),function(digest,data,callback){attachStore.count(digest).onsuccess=function(e){if(e.target.result)return callback();var newAtt={digest:digest,body:data};attachStore.put(newAtt).onsuccess=callback}}(att.digest,data,attachmentSaved)}})}(docInfo,winningRev$$1,winningRevIsDeleted,isUpdate,resultsIdx,callback);docCountDelta+=delta,updateDocCountIfReady(),finishDoc(docInfo,winningRev$$1,winningRevIsDeleted,isUpdate,resultsIdx,callback)}function finishDoc(docInfo,winningRev$$1,winningRevIsDeleted,isUpdate,resultsIdx,callback){var doc=docInfo.data,metadata=docInfo.metadata;function afterPutDoc(e){var revsToDelete=docInfo.stemmedRevs||[];isUpdate&&api.auto_compaction&&(revsToDelete=revsToDelete.concat(compactTree(docInfo.metadata))),revsToDelete&&revsToDelete.length&&compactRevs(revsToDelete,docInfo.metadata.id,txn),metadata.seq=e.target.result;var metadataToStore=encodeMetadata(metadata,winningRev$$1,winningRevIsDeleted);docStore.put(metadataToStore).onsuccess=afterPutMetadata}function afterPutMetadata(){results[resultsIdx]={ok:!0,id:metadata.id,rev:metadata.rev},fetchedDocs.set(docInfo.metadata.id,docInfo.metadata),function(docInfo,seq,callback){var attsAdded=0,attsToAdd=Object.keys(docInfo.data._attachments||{});if(!attsToAdd.length)return callback();function checkDone(){++attsAdded===attsToAdd.length&&callback()}for(var i=0;i<attsToAdd.length;i++)att=attsToAdd[i],req=void 0,digest=docInfo.data._attachments[att].digest,(req=attachAndSeqStore.put({seq:seq,digestSeq:digest+"::"+seq})).onsuccess=checkDone,req.onerror=function(e){e.preventDefault(),e.stopPropagation(),checkDone()};var att,digest,req}(docInfo,metadata.seq,callback)}doc._doc_id_rev=metadata.id+"::"+metadata.rev,delete doc._id,delete doc._rev;var putReq=bySeqStore.put(doc);putReq.onsuccess=afterPutDoc,putReq.onerror=function(e){e.preventDefault(),e.stopPropagation(),bySeqStore.index("_doc_id_rev").getKey(doc._doc_id_rev).onsuccess=function(e){bySeqStore.put(doc,e.target.result).onsuccess=afterPutDoc}}}preprocessAttachments(docInfos,blobType,function(err){if(err)return callback(err);!function(){var txnResult=openTransactionSafely(idb,[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,LOCAL_STORE,ATTACH_AND_SEQ_STORE,META_STORE],"readwrite");if(txnResult.error)return callback(txnResult.error);(txn=txnResult.txn).onabort=idbError(callback),txn.ontimeout=idbError(callback),txn.oncomplete=complete,docStore=txn.objectStore(DOC_STORE),bySeqStore=txn.objectStore(BY_SEQ_STORE),attachStore=txn.objectStore(ATTACH_STORE),attachAndSeqStore=txn.objectStore(ATTACH_AND_SEQ_STORE),(metaStore=txn.objectStore(META_STORE)).get(META_STORE).onsuccess=function(e){metaDoc=e.target.result,updateDocCountIfReady()},function(finish){var digests=[];if(docInfos.forEach(function(docInfo){docInfo.data&&docInfo.data._attachments&&Object.keys(docInfo.data._attachments).forEach(function(filename){var att=docInfo.data._attachments[filename];att.stub&&digests.push(att.digest)})}),!digests.length)return finish();var err,numDone=0;digests.forEach(function(digest){!function(digest,callback){attachStore.get(digest).onsuccess=function(e){if(e.target.result)callback();else{var err=createError(MISSING_STUB,"unknown stub attachment with digest "+digest);err.status=412,callback(err)}}}(digest,function(attErr){attErr&&!err&&(err=attErr),++numDone===digests.length&&finish(err)})})}(function(err){if(err)return preconditionErrored=!0,callback(err);!function(){if(!docInfos.length)return;var numFetched=0;function checkDone(){++numFetched===docInfos.length&&processDocs(dbOpts.revs_limit,docInfos,api,fetchedDocs,txn,results,writeDoc,opts,onAllDocsProcessed)}function readMetadata(event){var metadata=decodeMetadata(event.target.result);metadata&&fetchedDocs.set(metadata.id,metadata),checkDone()}for(var i=0,len=docInfos.length;i<len;i++){var docInfo=docInfos[i];if(docInfo._id&&isLocalId(docInfo._id))checkDone();else docStore.get(docInfo.metadata.id).onsuccess=readMetadata}}()})}()})}function runBatchedCursor(objectStore,keyRange,descending,batchSize,onBatch){var keysBatch,valuesBatch,pseudoCursor;function onGetAll(e){valuesBatch=e.target.result,keysBatch&&onBatch(keysBatch,valuesBatch,pseudoCursor)}function onGetAllKeys(e){keysBatch=e.target.result,valuesBatch&&onBatch(keysBatch,valuesBatch,pseudoCursor)}function onCursor(e){var cursor=e.target.result;if(!cursor)return onBatch();onBatch([cursor.key],[cursor.value],cursor)}"function"==typeof objectStore.getAll&&"function"==typeof objectStore.getAllKeys&&1<batchSize&&!descending?(pseudoCursor={continue:function(){if(!keysBatch.length)return onBatch();var newKeyRange,lastKey=keysBatch[keysBatch.length-1];if(keyRange&&keyRange.upper)try{newKeyRange=IDBKeyRange.bound(lastKey,keyRange.upper,!0,keyRange.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return onBatch()}else newKeyRange=IDBKeyRange.lowerBound(lastKey,!0);keyRange=newKeyRange,valuesBatch=keysBatch=null,objectStore.getAll(keyRange,batchSize).onsuccess=onGetAll,objectStore.getAllKeys(keyRange,batchSize).onsuccess=onGetAllKeys}},objectStore.getAll(keyRange,batchSize).onsuccess=onGetAll,objectStore.getAllKeys(keyRange,batchSize).onsuccess=onGetAllKeys):descending?objectStore.openCursor(keyRange,"prev").onsuccess=onCursor:objectStore.openCursor(keyRange).onsuccess=onCursor}function getAll(objectStore,keyRange,onSuccess){if("function"!=typeof objectStore.getAll){var values=[];objectStore.openCursor(keyRange).onsuccess=function(e){var cursor=e.target.result;cursor?(values.push(cursor.value),cursor.continue()):onSuccess({target:{result:values}})}}else objectStore.getAll(keyRange).onsuccess=onSuccess}function idbAllDocs(opts,idb,callback){var keyRange,keyRangeError,start="startkey"in opts&&opts.startkey,end="endkey"in opts&&opts.endkey,key="key"in opts&&opts.key,keys="keys"in opts&&opts.keys,skip=opts.skip||0,limit="number"==typeof opts.limit?opts.limit:-1,inclusiveEnd=!1!==opts.inclusive_end;if(!keys&&(keyRangeError=(keyRange=function(start,end,inclusiveEnd,key,descending){try{if(start&&end)return descending?IDBKeyRange.bound(end,start,!inclusiveEnd,!1):IDBKeyRange.bound(start,end,!1,!inclusiveEnd);if(start)return descending?IDBKeyRange.upperBound(start):IDBKeyRange.lowerBound(start);if(end)return descending?IDBKeyRange.lowerBound(end,!inclusiveEnd):IDBKeyRange.upperBound(end,!inclusiveEnd);if(key)return IDBKeyRange.only(key)}catch(e){return{error:e}}return null}(start,end,inclusiveEnd,key,opts.descending))&&keyRange.error)&&("DataError"!==keyRangeError.name||0!==keyRangeError.code))return callback(createError(IDB_ERROR,keyRangeError.name,keyRangeError.message));var stores=[DOC_STORE,BY_SEQ_STORE,META_STORE];opts.attachments&&stores.push(ATTACH_STORE);var txnResult=openTransactionSafely(idb,stores,"readonly");if(txnResult.error)return callback(txnResult.error);var txn=txnResult.txn;txn.oncomplete=function(){opts.attachments?postProcessAttachments(results,opts.binary).then(onResultsReady):onResultsReady()},txn.onabort=idbError(callback);var docCount,updateSeq,onSuccess,docStore=txn.objectStore(DOC_STORE),seqStore=txn.objectStore(BY_SEQ_STORE),metaStore=txn.objectStore(META_STORE),docIdRevIndex=seqStore.index("_doc_id_rev"),results=[];function allDocsInner(winningRev$$1,metadata){var row={id:metadata.id,key:metadata.id,value:{rev:winningRev$$1}};metadata.deleted?keys&&(results.push(row),row.value.deleted=!0,row.doc=null):skip--<=0&&(results.push(row),opts.include_docs&&function(metadata,row,winningRev$$1){var key=metadata.id+"::"+winningRev$$1;docIdRevIndex.get(key).onsuccess=function(e){if(row.doc=decodeDoc(e.target.result),opts.conflicts){var conflicts=collectConflicts(metadata);conflicts.length&&(row.doc._conflicts=conflicts)}fetchAttachmentsIfNecessary(row.doc,opts,txn)}}(metadata,row,winningRev$$1))}function processBatch(batchValues){for(var i=0,len=batchValues.length;i<len&&results.length!==limit;i++){var batchValue=batchValues[i];if(batchValue.error&&keys)results.push(batchValue);else{var metadata=decodeMetadata(batchValue);allDocsInner(metadata.winningRev,metadata)}}}function onBatch(batchKeys,batchValues,cursor){cursor&&(processBatch(batchValues),results.length<limit&&cursor.continue())}function onResultsReady(){var returnVal={total_rows:docCount,offset:opts.skip,rows:results};opts.update_seq&&void 0!==updateSeq&&(returnVal.update_seq=updateSeq),callback(null,returnVal)}return metaStore.get(META_STORE).onsuccess=function(e){docCount=e.target.result.docCount},opts.update_seq&&(onSuccess=function(e){e.target.result&&0<e.target.result.length&&(updateSeq=e.target.result[0])},seqStore.openCursor(null,"prev").onsuccess=function(e){var cursor=e.target.result,maxKey=void 0;return cursor&&cursor.key&&(maxKey=cursor.key),onSuccess({target:{result:[maxKey]}})}),keyRangeError||0===limit?void 0:keys?function(keys,docStore,onBatch){var valuesBatch=[],count=0;keys.forEach(function(key,index){docStore.get(key).onsuccess=function(event){event.target.result?valuesBatch[index]=event.target.result:valuesBatch[index]={key:key,error:"not_found"},++count===keys.length&&onBatch(keys,valuesBatch,{})}})}(opts.keys,docStore,onBatch):-1===limit?getAll(docStore,keyRange,function(e){var values=e.target.result;opts.descending&&(values=values.reverse()),processBatch(values)}):void runBatchedCursor(docStore,keyRange,opts.descending,limit+skip,onBatch)}var running=!1,queue=[];function applyNext(){!running&&queue.length&&(running=!0,queue.shift()())}function enqueueTask(action,callback,PouchDB){queue.push(function(){action(function(err,res){!function(fun,err,res,PouchDB){try{fun(err,res)}catch(err){PouchDB.emit("error",err)}}(callback,err,res,PouchDB),running=!1,nextTick(function(){applyNext()})})}),applyNext()}function changes(opts,api,dbName,idb){if((opts=clone(opts)).continuous){var id=dbName+":"+uuid();return changesHandler$$1.addListener(dbName,id,api,opts),changesHandler$$1.notify(dbName),{cancel:function(){changesHandler$$1.removeListener(dbName,id)}}}var docIds=opts.doc_ids&&new ExportedSet(opts.doc_ids);opts.since=opts.since||0;var returnDocs,lastSeq=opts.since,limit="limit"in opts?opts.limit:-1;0===limit&&(limit=1),returnDocs="return_docs"in opts?opts.return_docs:!("returnDocs"in opts)||opts.returnDocs;var txn,bySeqStore,docStore,docIdRevIndex,results=[],numResults=0,filter=filterChange(opts),docIdsToMetadata=new ExportedMap;function onGetMetadata(doc,seq,metadata,cb){if(metadata.seq!==seq)return cb();if(metadata.winningRev===doc._rev)return cb(metadata,doc);var docIdRev=doc._id+"::"+metadata.winningRev;docIdRevIndex.get(docIdRev).onsuccess=function(e){cb(metadata,decodeDoc(e.target.result))}}function finish(){opts.complete(null,{results:results,last_seq:lastSeq})}var objectStores=[DOC_STORE,BY_SEQ_STORE];opts.attachments&&objectStores.push(ATTACH_STORE);var txnResult=openTransactionSafely(idb,objectStores,"readonly");if(txnResult.error)return opts.complete(txnResult.error);(txn=txnResult.txn).onabort=idbError(opts.complete),txn.oncomplete=function(){!opts.continuous&&opts.attachments?postProcessAttachments(results).then(finish):finish()},bySeqStore=txn.objectStore(BY_SEQ_STORE),docStore=txn.objectStore(DOC_STORE),docIdRevIndex=bySeqStore.index("_doc_id_rev"),runBatchedCursor(bySeqStore,opts.since&&!opts.descending?IDBKeyRange.lowerBound(opts.since,!0):null,opts.descending,limit,function(batchKeys,batchValues,cursor){if(cursor&&batchKeys.length){var winningDocs=new Array(batchKeys.length),metadatas=new Array(batchKeys.length),numDone=0;batchValues.forEach(function(value,i){!function(doc,seq,cb){if(docIds&&!docIds.has(doc._id))return cb();var metadata=docIdsToMetadata.get(doc._id);if(metadata)return onGetMetadata(doc,seq,metadata,cb);docStore.get(doc._id).onsuccess=function(e){metadata=decodeMetadata(e.target.result),docIdsToMetadata.set(doc._id,metadata),onGetMetadata(doc,seq,metadata,cb)}}(decodeDoc(value),batchKeys[i],function(metadata,winningDoc){metadatas[i]=metadata,winningDocs[i]=winningDoc,++numDone===batchKeys.length&&function(){for(var i=0,len=winningDocs.length;i<len&&numResults!==limit;i++){var winningDoc=winningDocs[i];winningDoc&&processMetadataAndWinningDoc(metadatas[i],winningDoc)}numResults!==limit&&cursor.continue()}()})})}function processMetadataAndWinningDoc(metadata,winningDoc){var change=opts.processChange(winningDoc,metadata,opts);lastSeq=change.seq=metadata.seq;var filtered=filter(change);if("object"==typeof filtered)return opts.complete(filtered);filtered&&(numResults++,returnDocs&&results.push(change),opts.attachments&&opts.include_docs?fetchAttachmentsIfNecessary(winningDoc,opts,txn,function(){postProcessAttachments([change],opts.binary).then(function(){opts.onChange(change)})}):opts.onChange(change))}})}var blobSupportPromise,cachedDBs=new ExportedMap,openReqList=new ExportedMap;function IdbPouch(opts,callback){var api=this;enqueueTask(function(thisCallback){!function(api,opts,callback){var dbName=opts.name,idb=null;function addDeletedOrLocalIndex(txn,callback){var docStore=txn.objectStore(DOC_STORE);docStore.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),docStore.openCursor().onsuccess=function(event){var cursor=event.target.result;if(cursor){var metadata=cursor.value,deleted=isDeleted(metadata);metadata.deletedOrLocal=deleted?"1":"0",docStore.put(metadata),cursor.continue()}else callback()}}function migrateLocalStore(txn,cb){var localStore=txn.objectStore(LOCAL_STORE),docStore=txn.objectStore(DOC_STORE),seqStore=txn.objectStore(BY_SEQ_STORE);docStore.openCursor().onsuccess=function(event){var cursor=event.target.result;if(cursor){var metadata=cursor.value,docId=metadata.id,local=isLocalId(docId),rev$$1=winningRev(metadata);if(local){var docIdRev=docId+"::"+rev$$1,start=docId+"::",end=docId+"::~",index=seqStore.index("_doc_id_rev"),range=IDBKeyRange.bound(start,end,!1,!1),seqCursor=index.openCursor(range);seqCursor.onsuccess=function(e){if(seqCursor=e.target.result){var data=seqCursor.value;data._doc_id_rev===docIdRev&&localStore.put(data),seqStore.delete(seqCursor.primaryKey),seqCursor.continue()}else docStore.delete(cursor.primaryKey),cursor.continue()}}else cursor.continue()}else cb&&cb()}}function migrateAttsAndSeqs(txn,callback){var seqStore=txn.objectStore(BY_SEQ_STORE),attStore=txn.objectStore(ATTACH_STORE),attAndSeqStore=txn.objectStore(ATTACH_AND_SEQ_STORE);attStore.count().onsuccess=function(e){if(!e.target.result)return callback();seqStore.openCursor().onsuccess=function(e){var cursor=e.target.result;if(!cursor)return callback();for(var doc=cursor.value,seq=cursor.primaryKey,atts=Object.keys(doc._attachments||{}),digestMap={},j=0;j<atts.length;j++){digestMap[doc._attachments[atts[j]].digest]=!0}var digests=Object.keys(digestMap);for(j=0;j<digests.length;j++){var digest=digests[j];attAndSeqStore.put({seq:seq,digestSeq:digest+"::"+seq})}cursor.continue()}}}function migrateMetadata(txn){var bySeqStore=txn.objectStore(BY_SEQ_STORE),docStore=txn.objectStore(DOC_STORE);docStore.openCursor().onsuccess=function(e){var cursor=e.target.result;if(cursor){var start,end,req,metadataSeq,metadata=function(storedObject){return storedObject.data?decodeMetadata(storedObject):(storedObject.deleted="1"===storedObject.deletedOrLocal,storedObject)}(cursor.value);if(metadata.winningRev=metadata.winningRev||winningRev(metadata),metadata.seq)return onGetMetadataSeq();start=metadata.id+"::",end=metadata.id+"::ï¿¿",req=bySeqStore.index("_doc_id_rev").openCursor(IDBKeyRange.bound(start,end)),metadataSeq=0,req.onsuccess=function(e){var cursor=e.target.result;if(!cursor)return metadata.seq=metadataSeq,onGetMetadataSeq();var seq=cursor.primaryKey;metadataSeq<seq&&(metadataSeq=seq),cursor.continue()}}function onGetMetadataSeq(){var metadataToStore=encodeMetadata(metadata,metadata.winningRev,metadata.deleted);docStore.put(metadataToStore).onsuccess=function(){cursor.continue()}}}}api._meta=null,api._remote=!1,api.type=function(){return"idb"},api._id=toPromise(function(callback){callback(null,api._meta.instanceId)}),api._bulkDocs=function(req,reqOpts,callback){idbBulkDocs(opts,req,reqOpts,api,idb,callback)},api._get=function(id,opts,callback){var doc,metadata,err,txn=opts.ctx;if(!txn){var txnResult=openTransactionSafely(idb,[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);txn=txnResult.txn}function finish(){callback(err,{doc:doc,metadata:metadata,ctx:txn})}txn.objectStore(DOC_STORE).get(id).onsuccess=function(e){if(!(metadata=decodeMetadata(e.target.result)))return err=createError(MISSING_DOC,"missing"),finish();var rev$$1;if(opts.rev)rev$$1=opts.latest?latest(opts.rev,metadata):opts.rev;else if(rev$$1=metadata.winningRev,isDeleted(metadata))return err=createError(MISSING_DOC,"deleted"),finish();var objectStore=txn.objectStore(BY_SEQ_STORE),key=metadata.id+"::"+rev$$1;objectStore.index("_doc_id_rev").get(key).onsuccess=function(e){if(!(doc=(doc=e.target.result)&&decodeDoc(doc)))return err=createError(MISSING_DOC,"missing"),finish();finish()}}},api._getAttachment=function(docId,attachId,attachment,opts,callback){var txn;if(opts.ctx)txn=opts.ctx;else{var txnResult=openTransactionSafely(idb,[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);txn=txnResult.txn}var digest=attachment.digest,type=attachment.content_type;txn.objectStore(ATTACH_STORE).get(digest).onsuccess=function(e){readBlobData(e.target.result.body,type,opts.binary,function(blobData){callback(null,blobData)})}},api._info=function(callback){var updateSeq,docCount,txnResult=openTransactionSafely(idb,[META_STORE,BY_SEQ_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);var txn=txnResult.txn;txn.objectStore(META_STORE).get(META_STORE).onsuccess=function(e){docCount=e.target.result.docCount},txn.objectStore(BY_SEQ_STORE).openCursor(null,"prev").onsuccess=function(e){var cursor=e.target.result;updateSeq=cursor?cursor.key:0},txn.oncomplete=function(){callback(null,{doc_count:docCount,update_seq:updateSeq,idb_attachment_format:api._meta.blobSupport?"binary":"base64"})}},api._allDocs=function(opts,callback){idbAllDocs(opts,idb,callback)},api._changes=function(opts){return changes(opts,api,dbName,idb)},api._close=function(callback){idb.close(),cachedDBs.delete(dbName),callback()},api._getRevisionTree=function(docId,callback){var txnResult=openTransactionSafely(idb,[DOC_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);txnResult.txn.objectStore(DOC_STORE).get(docId).onsuccess=function(event){var doc=decodeMetadata(event.target.result);doc?callback(null,doc.rev_tree):callback(createError(MISSING_DOC))}},api._doCompaction=function(docId,revs,callback){var txnResult=openTransactionSafely(idb,[DOC_STORE,BY_SEQ_STORE,ATTACH_STORE,ATTACH_AND_SEQ_STORE],"readwrite");if(txnResult.error)return callback(txnResult.error);var txn=txnResult.txn;txn.objectStore(DOC_STORE).get(docId).onsuccess=function(event){var metadata=decodeMetadata(event.target.result);traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev$$1=pos+"-"+revHash;-1!==revs.indexOf(rev$$1)&&(opts.status="missing")}),compactRevs(revs,docId,txn);var winningRev$$1=metadata.winningRev,deleted=metadata.deleted;txn.objectStore(DOC_STORE).put(encodeMetadata(metadata,winningRev$$1,deleted))},txn.onabort=idbError(callback),txn.oncomplete=function(){callback()}},api._getLocal=function(id,callback){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readonly");if(txnResult.error)return callback(txnResult.error);var req=txnResult.txn.objectStore(LOCAL_STORE).get(id);req.onerror=idbError(callback),req.onsuccess=function(e){var doc=e.target.result;doc?(delete doc._doc_id_rev,callback(null,doc)):callback(createError(MISSING_DOC))}},api._putLocal=function(doc,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),delete doc._revisions;var oldRev=doc._rev,id=doc._id;doc._rev=oldRev?"0-"+(parseInt(oldRev.split("-")[1],10)+1):"0-1";var ret,tx=opts.ctx;if(!tx){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readwrite");if(txnResult.error)return callback(txnResult.error);(tx=txnResult.txn).onerror=idbError(callback),tx.oncomplete=function(){ret&&callback(null,ret)}}var req,oStore=tx.objectStore(LOCAL_STORE);oldRev?(req=oStore.get(id)).onsuccess=function(e){var oldDoc=e.target.result;oldDoc&&oldDoc._rev===oldRev?oStore.put(doc).onsuccess=function(){ret={ok:!0,id:doc._id,rev:doc._rev},opts.ctx&&callback(null,ret)}:callback(createError(REV_CONFLICT))}:((req=oStore.add(doc)).onerror=function(e){callback(createError(REV_CONFLICT)),e.preventDefault(),e.stopPropagation()},req.onsuccess=function(){ret={ok:!0,id:doc._id,rev:doc._rev},opts.ctx&&callback(null,ret)})},api._removeLocal=function(doc,opts,callback){"function"==typeof opts&&(callback=opts,opts={});var ret,tx=opts.ctx;if(!tx){var txnResult=openTransactionSafely(idb,[LOCAL_STORE],"readwrite");if(txnResult.error)return callback(txnResult.error);(tx=txnResult.txn).oncomplete=function(){ret&&callback(null,ret)}}var id=doc._id,oStore=tx.objectStore(LOCAL_STORE),req=oStore.get(id);req.onerror=idbError(callback),req.onsuccess=function(e){var oldDoc=e.target.result;oldDoc&&oldDoc._rev===doc._rev?(oStore.delete(id),ret={ok:!0,id:id,rev:"0-0"},opts.ctx&&callback(null,ret)):callback(createError(MISSING_DOC))}},api._destroy=function(opts,callback){changesHandler$$1.removeAllListeners(dbName);var openReq=openReqList.get(dbName);openReq&&openReq.result&&(openReq.result.close(),cachedDBs.delete(dbName));var req=indexedDB.deleteDatabase(dbName);req.onsuccess=function(){openReqList.delete(dbName),hasLocalStorage()&&dbName in localStorage&&delete localStorage[dbName],callback(null,{ok:!0})},req.onerror=idbError(callback)};var req,cached=cachedDBs.get(dbName);if(cached)return idb=cached.idb,api._meta=cached.global,nextTick(function(){callback(null,api)});req=opts.storage?function(dbName,storage){try{return indexedDB.open(dbName,{version:ADAPTER_VERSION,storage:storage})}catch(err){return indexedDB.open(dbName,ADAPTER_VERSION)}}(dbName,opts.storage):indexedDB.open(dbName,ADAPTER_VERSION);openReqList.set(dbName,req),req.onupgradeneeded=function(e){var db=e.target.result;if(e.oldVersion<1)return function(db){var docStore=db.createObjectStore(DOC_STORE,{keyPath:"id"});db.createObjectStore(BY_SEQ_STORE,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),db.createObjectStore(ATTACH_STORE,{keyPath:"digest"}),db.createObjectStore(META_STORE,{keyPath:"id",autoIncrement:!1}),db.createObjectStore(DETECT_BLOB_SUPPORT_STORE),docStore.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),db.createObjectStore(LOCAL_STORE,{keyPath:"_id"});var attAndSeqStore=db.createObjectStore(ATTACH_AND_SEQ_STORE,{autoIncrement:!0});attAndSeqStore.createIndex("seq","seq"),attAndSeqStore.createIndex("digestSeq","digestSeq",{unique:!0})}(db);var txn=e.currentTarget.transaction;e.oldVersion<3&&function(db){db.createObjectStore(LOCAL_STORE,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}(db),e.oldVersion<4&&function(db){var attAndSeqStore=db.createObjectStore(ATTACH_AND_SEQ_STORE,{autoIncrement:!0});attAndSeqStore.createIndex("seq","seq"),attAndSeqStore.createIndex("digestSeq","digestSeq",{unique:!0})}(db);var migrations=[addDeletedOrLocalIndex,migrateLocalStore,migrateAttsAndSeqs,migrateMetadata],i=e.oldVersion;!function next(){var migration=migrations[i-1];i++,migration&&migration(txn,next)}()},req.onsuccess=function(e){(idb=e.target.result).onversionchange=function(){idb.close(),cachedDBs.delete(dbName)},idb.onabort=function(e){guardedConsole("error","Database has a global failure",e.target.error),idb.close(),cachedDBs.delete(dbName)};var metaDoc,docCount,blobSupport,instanceId,txn=idb.transaction([META_STORE,DETECT_BLOB_SUPPORT_STORE,DOC_STORE],"readwrite"),storedMetaDoc=!1;function completeSetup(){void 0!==blobSupport&&storedMetaDoc&&(api._meta={name:dbName,instanceId:instanceId,blobSupport:blobSupport},cachedDBs.set(dbName,{idb:idb,global:api._meta}),callback(null,api))}function storeMetaDocIfReady(){if(void 0!==docCount&&void 0!==metaDoc){var instanceKey=dbName+"_id";instanceKey in metaDoc?instanceId=metaDoc[instanceKey]:metaDoc[instanceKey]=instanceId=uuid(),metaDoc.docCount=docCount,txn.objectStore(META_STORE).put(metaDoc)}}txn.objectStore(META_STORE).get(META_STORE).onsuccess=function(e){metaDoc=e.target.result||{id:META_STORE},storeMetaDocIfReady()},function(txn,cb){txn.objectStore(DOC_STORE).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){cb(e.target.result)}}(txn,function(count){docCount=count,storeMetaDocIfReady()}),(blobSupportPromise=blobSupportPromise||function(txn){return new PouchPromise(function(resolve){var blob$$1=createBlob([""]);txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob$$1,"key").onsuccess=function(){var matchedChrome=navigator.userAgent.match(/Chrome\/(\d+)/),matchedEdge=navigator.userAgent.match(/Edge\//);resolve(matchedEdge||!matchedChrome||43<=parseInt(matchedChrome[1],10))},txn.onabort=function(e){e.preventDefault(),e.stopPropagation(),resolve(!1)}}).catch(function(){return!1})}(txn)).then(function(val){blobSupport=val,completeSetup()}),txn.oncomplete=function(){storedMetaDoc=!0,completeSetup()},txn.onabort=idbError(callback)},req.onerror=function(){var msg="Failed to open indexedDB, are you in private browsing mode?";guardedConsole("error",msg),callback(createError(IDB_ERROR,msg))}}(api,opts,thisCallback)},callback,api.constructor)}function hexToInt(charCode){return charCode<65?charCode-48:charCode-55}function parseHexString(str,encoding){return"UTF-8"===encoding?function(str){return decodeURIComponent(escape(str))}(function(str,start,end){for(var result="";start<end;)result+=String.fromCharCode(hexToInt(str.charCodeAt(start++))<<4|hexToInt(str.charCodeAt(start++)));return result}(str,0,str.length)):function(str,start,end){for(var result="";start<end;)result+=String.fromCharCode(hexToInt(str.charCodeAt(start+2))<<12|hexToInt(str.charCodeAt(start+3))<<8|hexToInt(str.charCodeAt(start))<<4|hexToInt(str.charCodeAt(start+1))),start+=4;return result}(str,0,str.length)}function quote(str){return"'"+str+"'"}IdbPouch.valid=function(){var isSafari="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),hasFetch="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");try{return(!isSafari||hasFetch)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};var ADAPTER_VERSION$1=7,DOC_STORE$1=quote("document-store"),BY_SEQ_STORE$1=quote("by-sequence"),ATTACH_STORE$1=quote("attach-store"),LOCAL_STORE$1=quote("local-store"),META_STORE$1=quote("metadata-store"),ATTACH_AND_SEQ_STORE$1=quote("attach-seq-store");function stringifyDoc(doc){return delete doc._id,delete doc._rev,JSON.stringify(doc)}function unstringifyDoc(doc,id,rev$$1){return(doc=JSON.parse(doc))._id=id,doc._rev=rev$$1,doc}function qMarks(num){for(var s="(";num--;)s+="?",num&&(s+=",");return s+")"}function select(selector,table,joiner,where,orderBy){return"SELECT "+selector+" FROM "+("string"==typeof table?table:table.join(" JOIN "))+(joiner?" ON "+joiner:"")+(where?" WHERE "+("string"==typeof where?where:where.join(" AND ")):"")+(orderBy?" ORDER BY "+orderBy:"")}function compactRevs$1(revs,docId,tx){if(revs.length){var numDone=0,seqs=[];revs.forEach(function(rev$$1){var sql="SELECT seq FROM "+BY_SEQ_STORE$1+" WHERE doc_id=? AND rev=?";tx.executeSql(sql,[docId,rev$$1],function(tx,res){if(!res.rows.length)return checkDone();var seq=res.rows.item(0).seq;seqs.push(seq),tx.executeSql("DELETE FROM "+BY_SEQ_STORE$1+" WHERE seq=?",[seq],checkDone)})})}function checkDone(){++numDone===revs.length&&function(){if(!seqs.length)return;var sql="SELECT DISTINCT digest AS digest FROM "+ATTACH_AND_SEQ_STORE$1+" WHERE seq IN "+qMarks(seqs.length);tx.executeSql(sql,seqs,function(tx,res){for(var digestsToCheck=[],i=0;i<res.rows.length;i++)digestsToCheck.push(res.rows.item(i).digest);if(digestsToCheck.length){var sql="DELETE FROM "+ATTACH_AND_SEQ_STORE$1+" WHERE seq IN ("+seqs.map(function(){return"?"}).join(",")+")";tx.executeSql(sql,seqs,function(tx){var sql="SELECT digest FROM "+ATTACH_AND_SEQ_STORE$1+" WHERE digest IN ("+digestsToCheck.map(function(){return"?"}).join(",")+")";tx.executeSql(sql,digestsToCheck,function(tx,res){for(var nonOrphanedDigests=new ExportedSet,i=0;i<res.rows.length;i++)nonOrphanedDigests.add(res.rows.item(i).digest);digestsToCheck.forEach(function(digest){nonOrphanedDigests.has(digest)||(tx.executeSql("DELETE FROM "+ATTACH_AND_SEQ_STORE$1+" WHERE digest=?",[digest]),tx.executeSql("DELETE FROM "+ATTACH_STORE$1+" WHERE digest=?",[digest]))})})})}})}()}}function websqlError(callback){return function(event){guardedConsole("error","WebSQL threw an error",event);var errorNameMatch=event&&event.constructor.toString().match(/function ([^(]+)/),errorReason=(errorNameMatch&&errorNameMatch[1]||event.type,event.target||event.message);callback(createError(WSQ_ERROR,errorReason))}}function websqlBulkDocs(dbOpts,req,opts,api,db,websqlChanges,callback){var tx,newEdits=opts.new_edits,docInfos=req.docs.map(function(doc){return doc._id&&isLocalId(doc._id)?doc:parseDoc(doc,newEdits)}),docInfoErrors=docInfos.filter(function(docInfo){return docInfo.error});if(docInfoErrors.length)return callback(docInfoErrors[0]);var preconditionErrored,results=new Array(docInfos.length),fetchedDocs=new ExportedMap;function complete(){if(preconditionErrored)return callback(preconditionErrored);websqlChanges.notify(api._name),callback(null,results)}function verifyAttachments(finish){var digests=[];if(docInfos.forEach(function(docInfo){docInfo.data&&docInfo.data._attachments&&Object.keys(docInfo.data._attachments).forEach(function(filename){var att=docInfo.data._attachments[filename];att.stub&&digests.push(att.digest)})}),!digests.length)return finish();var err,numDone=0;digests.forEach(function(digest){!function(digest,callback){var sql="SELECT count(*) as cnt FROM "+ATTACH_STORE$1+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){if(0===result.rows.item(0).cnt){var err=createError(MISSING_STUB,"unknown stub attachment with digest "+digest);callback(err)}else callback()})}(digest,function(attErr){attErr&&!err&&(err=attErr),++numDone===digests.length&&finish(err)})})}function writeDoc(docInfo,winningRev$$1,winningRevIsDeleted,newRevIsDeleted,isUpdate,delta,resultsIdx,callback){function finish(){var data=docInfo.data,deletedInt=newRevIsDeleted?1:0,id=data._id,rev=data._rev,json=stringifyDoc(data),sql="INSERT INTO "+BY_SEQ_STORE$1+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",sqlArgs=[id,rev,json,deletedInt];function insertAttachmentMappings(seq,callback){var att,sql,sqlArgs,attsAdded=0,attsToAdd=Object.keys(data._attachments||{});if(!attsToAdd.length)return callback();function checkDone(){return++attsAdded===attsToAdd.length&&callback(),!1}for(var i=0;i<attsToAdd.length;i++)att=attsToAdd[i],void 0,sql="INSERT INTO "+ATTACH_AND_SEQ_STORE$1+" (digest, seq) VALUES (?,?)",sqlArgs=[data._attachments[att].digest,seq],tx.executeSql(sql,sqlArgs,checkDone,checkDone)}tx.executeSql(sql,sqlArgs,function(tx,result){var seq=result.insertId;insertAttachmentMappings(seq,function(){dataWritten(tx,seq)})},function(){var fetchSql=select("seq",BY_SEQ_STORE$1,null,"doc_id=? AND rev=?");return tx.executeSql(fetchSql,[id,rev],function(tx,res){var seq=res.rows.item(0).seq,sql="UPDATE "+BY_SEQ_STORE$1+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",sqlArgs=[json,deletedInt,id,rev];tx.executeSql(sql,sqlArgs,function(tx){insertAttachmentMappings(seq,function(){dataWritten(tx,seq)})})}),!1})}function collectResults(attachmentErr){err||(attachmentErr?callback(err=attachmentErr):recv===attachments.length&&finish())}var err=null,recv=0;docInfo.data._id=docInfo.metadata.id,docInfo.data._rev=docInfo.metadata.rev;var attachments=Object.keys(docInfo.data._attachments||{});function attachmentSaved(err){recv++,collectResults(err)}function dataWritten(tx,seq){var id=docInfo.metadata.id,revsToCompact=docInfo.stemmedRevs||[];isUpdate&&api.auto_compaction&&(revsToCompact=compactTree(docInfo.metadata).concat(revsToCompact)),revsToCompact.length&&compactRevs$1(revsToCompact,id,tx),docInfo.metadata.seq=seq;var rev=docInfo.metadata.rev;delete docInfo.metadata.rev;var sql=isUpdate?"UPDATE "+DOC_STORE$1+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+BY_SEQ_STORE$1+" WHERE doc_id="+DOC_STORE$1+".id AND rev=?) WHERE id=?":"INSERT INTO "+DOC_STORE$1+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",metadataStr=safeJsonStringify(docInfo.metadata),params=isUpdate?[metadataStr,seq,winningRev$$1,id]:[id,seq,seq,metadataStr];tx.executeSql(sql,params,function(){results[resultsIdx]={ok:!0,id:docInfo.metadata.id,rev:rev},fetchedDocs.set(id,docInfo.metadata),callback()})}newRevIsDeleted&&(docInfo.data._deleted=!0),attachments.forEach(function(key){var att=docInfo.data._attachments[key];if(att.stub)recv++,collectResults();else{var data=att.data;delete att.data,att.revpos=parseInt(winningRev$$1,10),function(digest,data,callback){var sql="SELECT digest FROM "+ATTACH_STORE$1+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){if(result.rows.length)return callback();sql="INSERT INTO "+ATTACH_STORE$1+" (digest, body, escaped) VALUES (?,?,1)",tx.executeSql(sql,[digest,function(str){return str.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}(data)],function(){callback()},function(){return callback(),!1})})}(att.digest,data,attachmentSaved)}}),attachments.length||finish()}function websqlProcessDocs(){processDocs(dbOpts.revs_limit,docInfos,api,fetchedDocs,tx,results,writeDoc,opts)}preprocessAttachments(docInfos,"binary",function(err){if(err)return callback(err);db.transaction(function(txn){tx=txn,verifyAttachments(function(err){err?preconditionErrored=err:function(callback){if(!docInfos.length)return callback();var numFetched=0;function checkDone(){++numFetched===docInfos.length&&callback()}docInfos.forEach(function(docInfo){if(docInfo._id&&isLocalId(docInfo._id))return checkDone();var id=docInfo.metadata.id;tx.executeSql("SELECT json FROM "+DOC_STORE$1+" WHERE id = ?",[id],function(tx,result){if(result.rows.length){var metadata=safeJsonParse(result.rows.item(0).json);fetchedDocs.set(id,metadata)}checkDone()})})}(websqlProcessDocs)})},websqlError(callback),complete)})}var cachedDatabases=new ExportedMap;var websqlChanges=new Changes;function fetchAttachmentsIfNecessary$1(doc,opts,api,txn,cb){var attachments=Object.keys(doc._attachments||{});if(!attachments.length)return cb&&cb();var numDone=0;function checkDone(){++numDone===attachments.length&&cb&&cb()}attachments.forEach(function(att){opts.attachments&&opts.include_docs?function(doc,att){var attObj=doc._attachments[att],attOpts={binary:opts.binary,ctx:txn};api._getAttachment(doc._id,att,attObj,attOpts,function(_,data){doc._attachments[att]=$inject_Object_assign(pick(attObj,["digest","content_type"]),{data:data}),checkDone()})}(doc,att):(doc._attachments[att].stub=!0,checkDone())})}var POUCH_VERSION=1,BY_SEQ_STORE_DELETED_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+BY_SEQ_STORE$1+" (seq, deleted)",BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+BY_SEQ_STORE$1+" (doc_id, rev)",DOC_STORE_WINNINGSEQ_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+DOC_STORE$1+" (winningseq)",ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+ATTACH_AND_SEQ_STORE$1+" (seq)",ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+ATTACH_AND_SEQ_STORE$1+" (digest, seq)",DOC_STORE_AND_BY_SEQ_JOINER=BY_SEQ_STORE$1+".seq = "+DOC_STORE$1+".winningseq",SELECT_DOCS=BY_SEQ_STORE$1+".seq AS seq, "+BY_SEQ_STORE$1+".deleted AS deleted, "+BY_SEQ_STORE$1+".json AS data, "+BY_SEQ_STORE$1+".rev AS rev, "+DOC_STORE$1+".json AS metadata";function WebSqlPouch(opts,callback){var encoding,api=this,instanceId=null,size=function(opts){return"size"in opts?1e6*opts.size:"undefined"!=typeof navigator&&/Android/.test(navigator.userAgent)?5e6:1}(opts),idRequests=[];api._name=opts.name;var openDBResult=function(opts){var cachedResult=cachedDatabases.get(opts.name);return cachedResult||(cachedResult=function(opts){try{return{db:function(opts){return opts.websql(opts.name,opts.version,opts.description,opts.size)}(opts)}}catch(err){return{error:err}}}(opts),cachedDatabases.set(opts.name,cachedResult)),cachedResult}($inject_Object_assign({},opts,{version:POUCH_VERSION,description:opts.name,size:size}));if(openDBResult.error)return websqlError(callback)(openDBResult.error);var db=openDBResult.db;function dbCreated(){hasLocalStorage()&&(window.localStorage["_pouch__websqldb_"+api._name]=!0),callback(null,api)}function runMigration2(tx,callback){tx.executeSql(DOC_STORE_WINNINGSEQ_INDEX_SQL),tx.executeSql("ALTER TABLE "+BY_SEQ_STORE$1+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){tx.executeSql(BY_SEQ_STORE_DELETED_INDEX_SQL),tx.executeSql("ALTER TABLE "+DOC_STORE$1+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){tx.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+DOC_STORE$1+" (local, id)");var sql="SELECT "+DOC_STORE$1+".winningseq AS seq, "+DOC_STORE$1+".json AS metadata FROM "+BY_SEQ_STORE$1+" JOIN "+DOC_STORE$1+" ON "+BY_SEQ_STORE$1+".seq = "+DOC_STORE$1+".winningseq";tx.executeSql(sql,[],function(tx,result){for(var deleted=[],local=[],i=0;i<result.rows.length;i++){var item=result.rows.item(i),seq=item.seq,metadata=JSON.parse(item.metadata);isDeleted(metadata)&&deleted.push(seq),isLocalId(metadata.id)&&local.push(metadata.id)}tx.executeSql("UPDATE "+DOC_STORE$1+"SET local = 1 WHERE id IN "+qMarks(local.length),local,function(){tx.executeSql("UPDATE "+BY_SEQ_STORE$1+" SET deleted = 1 WHERE seq IN "+qMarks(deleted.length),deleted,callback)})})})})}function runMigration3(tx,callback){var local="CREATE TABLE IF NOT EXISTS "+LOCAL_STORE$1+" (id UNIQUE, rev, json)";tx.executeSql(local,[],function(){var sql="SELECT "+DOC_STORE$1+".id AS id, "+BY_SEQ_STORE$1+".json AS data FROM "+BY_SEQ_STORE$1+" JOIN "+DOC_STORE$1+" ON "+BY_SEQ_STORE$1+".seq = "+DOC_STORE$1+".winningseq WHERE local = 1";tx.executeSql(sql,[],function(tx,res){for(var rows=[],i=0;i<res.rows.length;i++)rows.push(res.rows.item(i));!function doNext(){if(!rows.length)return callback(tx);var row=rows.shift(),rev$$1=JSON.parse(row.data)._rev;tx.executeSql("INSERT INTO "+LOCAL_STORE$1+" (id, rev, json) VALUES (?,?,?)",[row.id,rev$$1,row.data],function(tx){tx.executeSql("DELETE FROM "+DOC_STORE$1+" WHERE id=?",[row.id],function(tx){tx.executeSql("DELETE FROM "+BY_SEQ_STORE$1+" WHERE seq=?",[row.seq],function(){doNext()})})})}()})})}function runMigration4(tx,callback){function updateRows(rows){!function doNext(){if(!rows.length)return callback(tx);var doc_id_rev=parseHexString(rows.shift().hex,encoding),idx=doc_id_rev.lastIndexOf("::"),doc_id=doc_id_rev.substring(0,idx),rev$$1=doc_id_rev.substring(idx+2),sql="UPDATE "+BY_SEQ_STORE$1+" SET doc_id=?, rev=? WHERE doc_id_rev=?";tx.executeSql(sql,[doc_id,rev$$1,doc_id_rev],function(){doNext()})}()}var sql="ALTER TABLE "+BY_SEQ_STORE$1+" ADD COLUMN doc_id";tx.executeSql(sql,[],function(tx){var sql="ALTER TABLE "+BY_SEQ_STORE$1+" ADD COLUMN rev";tx.executeSql(sql,[],function(tx){tx.executeSql(BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL,[],function(tx){var sql="SELECT hex(doc_id_rev) as hex FROM "+BY_SEQ_STORE$1;tx.executeSql(sql,[],function(tx,res){for(var rows=[],i=0;i<res.rows.length;i++)rows.push(res.rows.item(i));updateRows(rows)})})})})}function runMigration5(tx,callback){function migrateAttsAndSeqs(tx){var sql="SELECT COUNT(*) AS cnt FROM "+ATTACH_STORE$1;tx.executeSql(sql,[],function(tx,res){if(!res.rows.item(0).cnt)return callback(tx);var offset=0,pageSize=10;!function nextPage(){var sql=select(SELECT_DOCS+", "+DOC_STORE$1+".id AS id",[DOC_STORE$1,BY_SEQ_STORE$1],DOC_STORE_AND_BY_SEQ_JOINER,null,DOC_STORE$1+".id ");sql+=" LIMIT "+pageSize+" OFFSET "+offset,offset+=pageSize,tx.executeSql(sql,[],function(tx,res){if(!res.rows.length)return callback(tx);for(var digest,seq,seqs,digestSeqs={},i=0;i<res.rows.length;i++)for(var row=res.rows.item(i),doc=unstringifyDoc(row.data,row.id,row.rev),atts=Object.keys(doc._attachments||{}),j=0;j<atts.length;j++){var att=doc._attachments[atts[j]];digest=att.digest,seq=row.seq,seqs=void 0,-1===(seqs=digestSeqs[digest]=digestSeqs[digest]||[]).indexOf(seq)&&seqs.push(seq)}var digestSeqPairs=[];if(Object.keys(digestSeqs).forEach(function(digest){digestSeqs[digest].forEach(function(seq){digestSeqPairs.push([digest,seq])})}),!digestSeqPairs.length)return nextPage();var numDone=0;digestSeqPairs.forEach(function(pair){var sql="INSERT INTO "+ATTACH_AND_SEQ_STORE$1+" (digest, seq) VALUES (?,?)";tx.executeSql(sql,pair,function(){++numDone===digestSeqPairs.length&&nextPage()})})})}()})}var attachAndRev="CREATE TABLE IF NOT EXISTS "+ATTACH_AND_SEQ_STORE$1+" (digest, seq INTEGER)";tx.executeSql(attachAndRev,[],function(tx){tx.executeSql(ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL,[],function(tx){tx.executeSql(ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL,[],migrateAttsAndSeqs)})})}function runMigration6(tx,callback){var sql="ALTER TABLE "+ATTACH_STORE$1+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";tx.executeSql(sql,[],callback)}function runMigration7(tx,callback){var sql="ALTER TABLE "+DOC_STORE$1+" ADD COLUMN max_seq INTEGER";tx.executeSql(sql,[],function(tx){var sql="UPDATE "+DOC_STORE$1+" SET max_seq=(SELECT MAX(seq) FROM "+BY_SEQ_STORE$1+" WHERE doc_id=id)";tx.executeSql(sql,[],function(tx){var sql="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+DOC_STORE$1+" (max_seq)";tx.executeSql(sql,[],callback)})})}function onGetInstanceId(){for(;0<idRequests.length;){idRequests.pop()(null,instanceId)}}function onGetVersion(tx,dbVersion){if(0===dbVersion){var meta="CREATE TABLE IF NOT EXISTS "+META_STORE$1+" (dbid, db_version INTEGER)",attach="CREATE TABLE IF NOT EXISTS "+ATTACH_STORE$1+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",attachAndRev="CREATE TABLE IF NOT EXISTS "+ATTACH_AND_SEQ_STORE$1+" (digest, seq INTEGER)",doc="CREATE TABLE IF NOT EXISTS "+DOC_STORE$1+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",seq="CREATE TABLE IF NOT EXISTS "+BY_SEQ_STORE$1+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",local="CREATE TABLE IF NOT EXISTS "+LOCAL_STORE$1+" (id UNIQUE, rev, json)";tx.executeSql(attach),tx.executeSql(local),tx.executeSql(attachAndRev,[],function(){tx.executeSql(ATTACH_AND_SEQ_STORE_SEQ_INDEX_SQL),tx.executeSql(ATTACH_AND_SEQ_STORE_ATTACH_INDEX_SQL)}),tx.executeSql(doc,[],function(){tx.executeSql(DOC_STORE_WINNINGSEQ_INDEX_SQL),tx.executeSql(seq,[],function(){tx.executeSql(BY_SEQ_STORE_DELETED_INDEX_SQL),tx.executeSql(BY_SEQ_STORE_DOC_ID_REV_INDEX_SQL),tx.executeSql(meta,[],function(){var initSeq="INSERT INTO "+META_STORE$1+" (db_version, dbid) VALUES (?,?)";instanceId=uuid();var initSeqArgs=[ADAPTER_VERSION$1,instanceId];tx.executeSql(initSeq,initSeqArgs,function(){onGetInstanceId()})})})})}else{var tasks=[runMigration2,runMigration3,runMigration4,runMigration5,runMigration6,runMigration7,function(){dbVersion<ADAPTER_VERSION$1&&tx.executeSql("UPDATE "+META_STORE$1+" SET db_version = "+ADAPTER_VERSION$1);var sql="SELECT dbid FROM "+META_STORE$1;tx.executeSql(sql,[],function(tx,result){instanceId=result.rows.item(0).dbid,onGetInstanceId()})}],i=dbVersion,nextMigration=function(tx){tasks[i-1](tx,nextMigration),i++};nextMigration(tx)}}function getMaxSeq(tx,callback){var sql="SELECT MAX(seq) AS seq FROM "+BY_SEQ_STORE$1;tx.executeSql(sql,[],function(tx,res){var updateSeq=res.rows.item(0).seq||0;callback(updateSeq)})}function countDocs(tx,callback){var sql=select("COUNT("+DOC_STORE$1+".id) AS 'num'",[DOC_STORE$1,BY_SEQ_STORE$1],DOC_STORE_AND_BY_SEQ_JOINER,BY_SEQ_STORE$1+".deleted=0");tx.executeSql(sql,[],function(tx,result){callback(result.rows.item(0).num)})}"function"!=typeof db.readTransaction&&(db.readTransaction=db.transaction),db.transaction(function(tx){!function(tx,cb){tx.executeSql('SELECT HEX("a") AS hex',[],function(tx,res){var hex=res.rows.item(0).hex;encoding=2===hex.length?"UTF-8":"UTF-16",cb()})}(tx,function(){!function(tx){var sql="SELECT sql FROM sqlite_master WHERE tbl_name = "+META_STORE$1;tx.executeSql(sql,[],function(tx,result){result.rows.length?/db_version/.test(result.rows.item(0).sql)?tx.executeSql("SELECT db_version FROM "+META_STORE$1,[],function(tx,result){onGetVersion(tx,result.rows.item(0).db_version)}):tx.executeSql("ALTER TABLE "+META_STORE$1+" ADD COLUMN db_version INTEGER",[],function(){onGetVersion(tx,1)}):onGetVersion(tx,0)})}(tx)})},websqlError(callback),dbCreated),api._remote=!1,api.type=function(){return"websql"},api._id=toPromise(function(callback){callback(null,instanceId)}),api._info=function(callback){var seq,docCount;db.readTransaction(function(tx){getMaxSeq(tx,function(theSeq){seq=theSeq}),countDocs(tx,function(theDocCount){docCount=theDocCount})},websqlError(callback),function(){callback(null,{doc_count:docCount,update_seq:seq,websql_encoding:encoding})})},api._bulkDocs=function(req,reqOpts,callback){websqlBulkDocs(opts,req,reqOpts,api,db,websqlChanges,callback)},api._get=function(id,opts,callback){var doc,metadata,sql,sqlArgs,tx=opts.ctx;if(!tx)return db.readTransaction(function(txn){api._get(id,$inject_Object_assign({ctx:txn},opts),callback)});function finish(err){callback(err,{doc:doc,metadata:metadata,ctx:tx})}if(opts.rev){if(opts.latest)return void function(tx,id,rev$$1,callback,finish){var sql=select(SELECT_DOCS,[DOC_STORE$1,BY_SEQ_STORE$1],DOC_STORE_AND_BY_SEQ_JOINER,DOC_STORE$1+".id=?"),sqlArgs=[id];tx.executeSql(sql,sqlArgs,function(a,results){if(!results.rows.length){var err=createError(MISSING_DOC,"missing");return finish(err)}var metadata=safeJsonParse(results.rows.item(0).metadata);callback(latest(rev$$1,metadata))})}(tx,id,opts.rev,function(latestRev){opts.latest=!1,opts.rev=latestRev,api._get(id,opts,callback)},finish);sql=select(SELECT_DOCS,[DOC_STORE$1,BY_SEQ_STORE$1],DOC_STORE$1+".id="+BY_SEQ_STORE$1+".doc_id",[BY_SEQ_STORE$1+".doc_id=?",BY_SEQ_STORE$1+".rev=?"]),sqlArgs=[id,opts.rev]}else sql=select(SELECT_DOCS,[DOC_STORE$1,BY_SEQ_STORE$1],DOC_STORE_AND_BY_SEQ_JOINER,DOC_STORE$1+".id=?"),sqlArgs=[id];tx.executeSql(sql,sqlArgs,function(a,results){if(!results.rows.length)return finish(createError(MISSING_DOC,"missing"));var item=results.rows.item(0);if(metadata=safeJsonParse(item.metadata),item.deleted&&!opts.rev)return finish(createError(MISSING_DOC,"deleted"));doc=unstringifyDoc(item.data,metadata.id,item.rev),finish()})},api._allDocs=function(opts,callback){var totalRows,updateSeq,results=[],start="startkey"in opts&&opts.startkey,end="endkey"in opts&&opts.endkey,key="key"in opts&&opts.key,keys="keys"in opts&&opts.keys,descending="descending"in opts&&opts.descending,limit="limit"in opts?opts.limit:-1,offset="skip"in opts?opts.skip:0,inclusiveEnd=!1!==opts.inclusive_end,sqlArgs=[],criteria=[];if(keys){var destinctKeys=[],bindingStr="";keys.forEach(function(key){-1===destinctKeys.indexOf(key)&&(destinctKeys.push(key),bindingStr+="?,")}),bindingStr=bindingStr.substring(0,bindingStr.length-1),criteria.push(DOC_STORE$1+".id IN ("+bindingStr+")"),sqlArgs=sqlArgs.concat(destinctKeys)}else if(!1!==key)criteria.push(DOC_STORE$1+".id = ?"),sqlArgs.push(key);else if(!1!==start||!1!==end){if(!1!==start&&(criteria.push(DOC_STORE$1+".id "+(descending?"<=":">=")+" ?"),sqlArgs.push(start)),!1!==end){var comparator=descending?">":"<";inclusiveEnd&&(comparator+="="),criteria.push(DOC_STORE$1+".id "+comparator+" ?"),sqlArgs.push(end)}!1!==key&&(criteria.push(DOC_STORE$1+".id = ?"),sqlArgs.push(key))}keys||criteria.push(BY_SEQ_STORE$1+".deleted = 0"),db.readTransaction(function(tx){if(countDocs(tx,function(docCount){totalRows=docCount}),opts.update_seq&&getMaxSeq(tx,function(theSeq){updateSeq=theSeq}),0!==limit){var sql=select(SELECT_DOCS,[DOC_STORE$1,BY_SEQ_STORE$1],DOC_STORE_AND_BY_SEQ_JOINER,criteria,DOC_STORE$1+".id "+(descending?"DESC":"ASC"));sql+=" LIMIT "+limit+" OFFSET "+offset,tx.executeSql(sql,sqlArgs,function(tx,result){for(var i=0,l=result.rows.length;i<l;i++){var item=result.rows.item(i),metadata=safeJsonParse(item.metadata),id=metadata.id,data=unstringifyDoc(item.data,id,item.rev),winningRev$$1=data._rev,doc={id:id,key:id,value:{rev:winningRev$$1}};if(opts.include_docs){if(doc.doc=data,doc.doc._rev=winningRev$$1,opts.conflicts){var conflicts=collectConflicts(metadata);conflicts.length&&(doc.doc._conflicts=conflicts)}fetchAttachmentsIfNecessary$1(doc.doc,opts,api,tx)}if(item.deleted){if(!keys)continue;doc.value.deleted=!0,doc.doc=null}if(keys)for(var index=keys.indexOf(id,index);results[index]=doc,-1<(index=keys.indexOf(id,index+1))&&index<keys.length;);else results.push(doc)}keys&&keys.forEach(function(key,index){results[index]||(results[index]={key:key,error:"not_found"})})})}},websqlError(callback),function(){var returnVal={total_rows:totalRows,offset:opts.skip,rows:results};opts.update_seq&&(returnVal.update_seq=updateSeq),callback(null,returnVal)})},api._changes=function(opts){if((opts=clone(opts)).continuous){var id=api._name+":"+uuid();return websqlChanges.addListener(api._name,id,api,opts),websqlChanges.notify(api._name),{cancel:function(){websqlChanges.removeListener(api._name,id)}}}var descending=opts.descending;opts.since=opts.since&&!descending?opts.since:0;var returnDocs,limit="limit"in opts?opts.limit:-1;0===limit&&(limit=1),returnDocs="return_docs"in opts?opts.return_docs:!("returnDocs"in opts)||opts.returnDocs;var results=[],numResults=0;!function(){var selectStmt=DOC_STORE$1+".json AS metadata, "+DOC_STORE$1+".max_seq AS maxSeq, "+BY_SEQ_STORE$1+".json AS winningDoc, "+BY_SEQ_STORE$1+".rev AS winningRev ",from=DOC_STORE$1+" JOIN "+BY_SEQ_STORE$1,joiner=DOC_STORE$1+".id="+BY_SEQ_STORE$1+".doc_id AND "+DOC_STORE$1+".winningseq="+BY_SEQ_STORE$1+".seq",criteria=["maxSeq > ?"],sqlArgs=[opts.since];opts.doc_ids&&(criteria.push(DOC_STORE$1+".id IN "+qMarks(opts.doc_ids.length)),sqlArgs=sqlArgs.concat(opts.doc_ids));var sql=select(selectStmt,from,joiner,criteria,"maxSeq "+(descending?"DESC":"ASC")),filter=filterChange(opts);opts.view||opts.filter||(sql+=" LIMIT "+limit);var lastSeq=opts.since||0;db.readTransaction(function(tx){tx.executeSql(sql,sqlArgs,function(tx,result){function reportChange(change){return function(){opts.onChange(change)}}for(var i=0,l=result.rows.length;i<l;i++){var item=result.rows.item(i),metadata=safeJsonParse(item.metadata);lastSeq=item.maxSeq;var doc=unstringifyDoc(item.winningDoc,metadata.id,item.winningRev),change=opts.processChange(doc,metadata,opts);change.seq=item.maxSeq;var filtered=filter(change);if("object"==typeof filtered)return opts.complete(filtered);if(filtered&&(numResults++,returnDocs&&results.push(change),opts.attachments&&opts.include_docs?fetchAttachmentsIfNecessary$1(doc,opts,api,tx,reportChange(change)):reportChange(change)()),numResults===limit)break}})},websqlError(opts.complete),function(){opts.continuous||opts.complete(null,{results:results,last_seq:lastSeq})})}()},api._close=function(callback){callback()},api._getAttachment=function(docId,attachId,attachment,opts,callback){var res,tx=opts.ctx,digest=attachment.digest,type=attachment.content_type,sql="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+ATTACH_STORE$1+" WHERE digest=?";tx.executeSql(sql,[digest],function(tx,result){var item=result.rows.item(0),data=item.escaped?function(str){return str.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}(item.body):parseHexString(item.body,encoding);res=opts.binary?binStringToBluffer(data,type):thisBtoa(data),callback(null,res)})},api._getRevisionTree=function(docId,callback){db.readTransaction(function(tx){var sql="SELECT json AS metadata FROM "+DOC_STORE$1+" WHERE id = ?";tx.executeSql(sql,[docId],function(tx,result){if(result.rows.length){var data=safeJsonParse(result.rows.item(0).metadata);callback(null,data.rev_tree)}else callback(createError(MISSING_DOC))})})},api._doCompaction=function(docId,revs,callback){if(!revs.length)return callback();db.transaction(function(tx){var sql="SELECT json AS metadata FROM "+DOC_STORE$1+" WHERE id = ?";tx.executeSql(sql,[docId],function(tx,result){var metadata=safeJsonParse(result.rows.item(0).metadata);traverseRevTree(metadata.rev_tree,function(isLeaf,pos,revHash,ctx,opts){var rev$$1=pos+"-"+revHash;-1!==revs.indexOf(rev$$1)&&(opts.status="missing")});var sql="UPDATE "+DOC_STORE$1+" SET json = ? WHERE id = ?";tx.executeSql(sql,[safeJsonStringify(metadata),docId])}),compactRevs$1(revs,docId,tx)},websqlError(callback),function(){callback()})},api._getLocal=function(id,callback){db.readTransaction(function(tx){var sql="SELECT json, rev FROM "+LOCAL_STORE$1+" WHERE id=?";tx.executeSql(sql,[id],function(tx,res){if(res.rows.length){var item=res.rows.item(0),doc=unstringifyDoc(item.json,id,item.rev);callback(null,doc)}else callback(createError(MISSING_DOC))})})},api._putLocal=function(doc,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),delete doc._revisions;var newRev,oldRev=doc._rev,id=doc._id;newRev=doc._rev=oldRev?"0-"+(parseInt(oldRev.split("-")[1],10)+1):"0-1";var ret,json=stringifyDoc(doc);function putLocal(tx){var sql,values;values=oldRev?(sql="UPDATE "+LOCAL_STORE$1+" SET rev=?, json=? WHERE id=? AND rev=?",[newRev,json,id,oldRev]):(sql="INSERT INTO "+LOCAL_STORE$1+" (id, rev, json) VALUES (?,?,?)",[id,newRev,json]),tx.executeSql(sql,values,function(tx,res){res.rowsAffected?(ret={ok:!0,id:id,rev:newRev},opts.ctx&&callback(null,ret)):callback(createError(REV_CONFLICT))},function(){return callback(createError(REV_CONFLICT)),!1})}opts.ctx?putLocal(opts.ctx):db.transaction(putLocal,websqlError(callback),function(){ret&&callback(null,ret)})},api._removeLocal=function(doc,opts,callback){var ret;function removeLocal(tx){var sql="DELETE FROM "+LOCAL_STORE$1+" WHERE id=? AND rev=?",params=[doc._id,doc._rev];tx.executeSql(sql,params,function(tx,res){if(!res.rowsAffected)return callback(createError(MISSING_DOC));ret={ok:!0,id:doc._id,rev:"0-0"},opts.ctx&&callback(null,ret)})}"function"==typeof opts&&(callback=opts,opts={}),opts.ctx?removeLocal(opts.ctx):db.transaction(removeLocal,websqlError(callback),function(){ret&&callback(null,ret)})},api._destroy=function(opts,callback){websqlChanges.removeAllListeners(api._name),db.transaction(function(tx){[DOC_STORE$1,BY_SEQ_STORE$1,ATTACH_STORE$1,META_STORE$1,LOCAL_STORE$1,ATTACH_AND_SEQ_STORE$1].forEach(function(store){tx.executeSql("DROP TABLE IF EXISTS "+store,[])})},websqlError(callback),function(){hasLocalStorage()&&(delete window.localStorage["_pouch__websqldb_"+api._name],delete window.localStorage[api._name]),callback(null,{ok:!0})})}}function isValidWebSQL(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var hasLS=hasLocalStorage(),localStorageKey="_pouch__websqldb_valid_"+navigator.userAgent;if(hasLS&&localStorage[localStorageKey])return"1"===localStorage[localStorageKey];var openedTestDB=function(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(err){return!1}}();return hasLS&&(localStorage[localStorageKey]=openedTestDB?"1":"0"),openedTestDB}function openDB$2(name,version,description,size){return openDatabase(name,version,description,size)}function WebSQLPouch(opts,callback){guardedConsole("warn","WebSQL is deprecated and will be removed in future releases of PouchDB. Please migrate to IndexedDB: https://pouchdb.com/2018/01/23/pouchdb-6.4.2.html");var _opts=$inject_Object_assign({websql:openDB$2},opts);WebSqlPouch.call(this,_opts,callback)}function fetchRequest(options,callback){var wrappedPromise,timer,response,headers=new Headers,fetchOptions={method:options.method,credentials:"include",headers:headers};return options.json&&(headers.set("Accept","application/json"),headers.set("Content-Type",options.headers["Content-Type"]||"application/json")),options.body&&options.processData&&"string"!=typeof options.body?fetchOptions.body=JSON.stringify(options.body):fetchOptions.body="body"in options?options.body:null,Object.keys(options.headers).forEach(function(key){options.headers.hasOwnProperty(key)&&headers.set(key,options.headers[key])}),wrappedPromise=function(){for(var wrappedPromise={},promise=new PouchPromise(function(resolve,reject){wrappedPromise.resolve=resolve,wrappedPromise.reject=reject}),args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];return wrappedPromise.promise=promise,PouchPromise.resolve().then(function(){return fetch.apply(null,args)}).then(function(response){wrappedPromise.resolve(response)}).catch(function(error){wrappedPromise.reject(error)}),wrappedPromise}(options.url,fetchOptions),0<options.timeout&&(timer=setTimeout(function(){wrappedPromise.reject(new Error("Load timeout for resource: "+options.url))},options.timeout)),wrappedPromise.promise.then(function(fetchResponse){return response={statusCode:fetchResponse.status},0<options.timeout&&clearTimeout(timer),200<=response.statusCode&&response.statusCode<300?options.binary?fetchResponse.blob():fetchResponse.text():fetchResponse.json()}).then(function(result){200<=response.statusCode&&response.statusCode<300?callback(null,response,result):(result.status=response.statusCode,callback(result))}).catch(function(error){error=error||new Error("canceled"),callback(error)}),{abort:wrappedPromise.reject}}WebSQLPouch.valid=function(){return"function"==typeof openDatabase&&isValidWebSQL()},WebSQLPouch.use_prefix=!0;var hasXhr=function(){try{return new XMLHttpRequest,!0}catch(err){return!1}}();function ajax(options,callback){return hasXhr||options.xhr?function(options,callback){function timeoutReq(){timedout=!0,xhr.abort(),cleanUp()}var xhr,timer,timedout=!1,ret={abort:function(){xhr.abort(),cleanUp()}},cleanUp=function(){clearTimeout(timer),ret.abort=function(){},xhr&&(xhr.onprogress=void 0,xhr.upload&&(xhr.upload.onprogress=void 0),xhr.onreadystatechange=void 0,xhr=void 0)};xhr=options.xhr?new options.xhr:new XMLHttpRequest;try{xhr.open(options.method,options.url)}catch(exception){return callback(new Error(exception.name||"Url is invalid"))}for(var key in xhr.withCredentials=!("withCredentials"in options)||options.withCredentials,"GET"===options.method?delete options.headers["Content-Type"]:options.json&&(options.headers.Accept="application/json",options.headers["Content-Type"]=options.headers["Content-Type"]||"application/json",options.body&&options.processData&&"string"!=typeof options.body&&(options.body=JSON.stringify(options.body))),options.binary&&(xhr.responseType="arraybuffer"),"body"in options||(options.body=null),options.headers)options.headers.hasOwnProperty(key)&&xhr.setRequestHeader(key,options.headers[key]);return 0<options.timeout&&(timer=setTimeout(timeoutReq,options.timeout),xhr.onprogress=function(){clearTimeout(timer),4!==xhr.readyState&&(timer=setTimeout(timeoutReq,options.timeout))},void 0!==xhr.upload&&(xhr.upload.onprogress=xhr.onprogress)),xhr.onreadystatechange=function(){if(4===xhr.readyState){var response={statusCode:xhr.status};if(200<=xhr.status&&xhr.status<300){var data;data=options.binary?createBlob([xhr.response||""],{type:xhr.getResponseHeader("Content-Type")}):xhr.responseText,callback(null,response,data)}else{var err={};if(timedout)(err=new Error("ETIMEDOUT")).code="ETIMEDOUT";else if("string"==typeof xhr.response&&""!==xhr.response)try{err=JSON.parse(xhr.response)}catch(e){}err.status=xhr.status,callback(err)}cleanUp()}},options.body&&options.body instanceof Blob?readAsArrayBuffer(options.body,function(arrayBuffer){xhr.send(arrayBuffer)}):xhr.send(options.body),ret}(options,callback):fetchRequest(options,callback)}function ajaxCore(options,callback){options=clone(options);return(options=$inject_Object_assign({method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},options)).json&&(options.binary||(options.headers.Accept="application/json"),options.headers["Content-Type"]=options.headers["Content-Type"]||"application/json"),options.binary&&(options.encoding=null,options.json=!1),options.processData||(options.json=!1),ajax(options,function(err,response,body){if(err)return callback(generateErrorFromResponse(err));var error,content_type=response.headers&&response.headers["content-type"],data=body||"";if(!options.binary&&(options.json||!options.processData)&&"object"!=typeof data&&(/json/.test(content_type)||/^[\s]*\{/.test(data)&&/\}[\s]*$/.test(data)))try{data=JSON.parse(data.toString())}catch(e){}200<=response.statusCode&&response.statusCode<300?function(obj,resp,cb){if(!options.binary&&options.json&&"string"==typeof obj)try{obj=JSON.parse(obj)}catch(e){return cb(e)}Array.isArray(obj)&&(obj=obj.map(function(v){return v.error||v.missing?generateErrorFromResponse(v):v})),options.binary,cb(null,obj,resp)}(data,response,callback):((error=generateErrorFromResponse(data)).status=response.statusCode,callback(error))})}function ajax$1(opts,callback){var ua=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",isSafari=-1!==ua.indexOf("safari")&&-1===ua.indexOf("chrome"),isIE=-1!==ua.indexOf("msie"),isTrident=-1!==ua.indexOf("trident"),isEdge=-1!==ua.indexOf("edge"),shouldCacheBust=isSafari||(isIE||isTrident||isEdge)&&"GET"===opts.method,cache=!("cache"in opts)||opts.cache;if(!/^blob:/.test(opts.url)&&(shouldCacheBust||!cache)){var hasArgs=-1!==opts.url.indexOf("?");opts.url+=(hasArgs?"&":"?")+"_nonce="+Date.now()}return ajaxCore(opts,callback)}var CHANGES_BATCH_SIZE=25,MAX_SIMULTANEOUS_REVS=50,CHANGES_TIMEOUT_BUFFER=5e3,DEFAULT_HEARTBEAT=1e4,supportsBulkGetMap={};function readAttachmentsAsBlobOrBuffer(row){var atts=(row.doc||row.ok)._attachments;atts&&Object.keys(atts).forEach(function(filename){var att=atts[filename];att.data=b64ToBluffer(att.data,att.content_type)})}function encodeDocId(id){return/^_design/.test(id)?"_design/"+encodeURIComponent(id.slice(8)):/^_local/.test(id)?"_local/"+encodeURIComponent(id.slice(7)):encodeURIComponent(id)}function preprocessAttachments$2(doc){return doc._attachments&&Object.keys(doc._attachments)?PouchPromise.all(Object.keys(doc._attachments).map(function(key){var attachment=doc._attachments[key];if(attachment.data&&"string"!=typeof attachment.data)return new PouchPromise(function(resolve){blobToBase64(attachment.data,resolve)}).then(function(b64){attachment.data=b64})})):PouchPromise.resolve()}function getHost(name,opts){if(function(opts){if(!opts.prefix)return!1;var protocol=parseUri(opts.prefix).protocol;return"http"===protocol||"https"===protocol}(opts)){var dbName=opts.name.substr(opts.prefix.length);name=opts.prefix+encodeURIComponent(dbName)}var uri=parseUri(name);(uri.user||uri.password)&&(uri.auth={username:uri.user,password:uri.password});var parts=uri.path.replace(/(^\/|\/$)/g,"").split("/");return uri.db=parts.pop(),-1===uri.db.indexOf("%")&&(uri.db=encodeURIComponent(uri.db)),uri.path=parts.join("/"),uri}function genDBUrl(opts,path){return genUrl(opts,opts.db+"/"+path)}function genUrl(opts,path){var pathDel=opts.path?"/":"";return opts.protocol+"://"+opts.host+(opts.port?":"+opts.port:"")+"/"+opts.path+pathDel+path}function paramsToStr(params){return"?"+Object.keys(params).map(function(k){return k+"="+encodeURIComponent(params[k])}).join("&")}function HttpPouch(opts,callback){var setupPromise,api=this,host=getHost(opts.name,opts),dbUrl=genDBUrl(host,""),ajaxOpts=(opts=clone(opts)).ajax||{};if(opts.auth||host.auth){var nAuth=opts.auth||host.auth,str=nAuth.username+":"+nAuth.password,token=thisBtoa(unescape(encodeURIComponent(str)));ajaxOpts.headers=ajaxOpts.headers||{},ajaxOpts.headers.Authorization="Basic "+token}function ajax(userOpts,options,callback){var reqAjax=(userOpts||{}).ajax||{},reqOpts=$inject_Object_assign(clone(ajaxOpts),reqAjax,options),defaultHeaders=clone(ajaxOpts.headers||{});return reqOpts.headers=$inject_Object_assign(defaultHeaders,reqAjax.headers,options.headers||{}),api.constructor.listeners("debug").length&&api.constructor.emit("debug",["http",reqOpts.method,reqOpts.url]),api._ajax(reqOpts,callback)}function ajaxPromise(userOpts,opts){return new PouchPromise(function(resolve,reject){ajax(userOpts,opts,function(err,res){if(err)return reject(err);resolve(res)})})}function adapterFun$$1(name,fun){return adapterFun(name,getArguments(function(args){setup().then(function(){return fun.apply(this,args)}).catch(function(e){args.pop()(e)})}))}function setup(){return opts.skipSetup||opts.skip_setup?PouchPromise.resolve():setupPromise||((setupPromise=ajaxPromise({},{method:"GET",url:dbUrl}).catch(function(err){return err&&err.status&&404===err.status?(explainError(404,"PouchDB is just detecting if the remote exists."),ajaxPromise({},{method:"PUT",url:dbUrl})):PouchPromise.reject(err)}).catch(function(err){return!(!err||!err.status||412!==err.status)||PouchPromise.reject(err)})).catch(function(){setupPromise=null}),setupPromise)}function encodeAttachmentId(attachmentId){return attachmentId.split("/").map(encodeURIComponent).join("/")}api._ajax=ajax$1,nextTick(function(){callback(null,api)}),api._remote=!0,api.type=function(){return"http"},api.id=adapterFun$$1("id",function(callback){ajax({},{method:"GET",url:genUrl(host,"")},function(err,result){var uuid$$1=result&&result.uuid?result.uuid+host.db:genDBUrl(host,"");callback(null,uuid$$1)})}),api.request=adapterFun$$1("request",function(options,callback){options.url=genDBUrl(host,options.url),ajax({},options,callback)}),api.compact=adapterFun$$1("compact",function(opts,callback){"function"==typeof opts&&(callback=opts,opts={}),ajax(opts=clone(opts),{url:genDBUrl(host,"_compact"),method:"POST"},function(){!function ping(){api.info(function(err,res){res&&!res.compact_running?callback(null,{ok:!0}):setTimeout(ping,opts.interval||200)})}()})}),api.bulkGet=adapterFun("bulkGet",function(opts,callback){var self=this;function doBulkGet(cb){var params={};opts.revs&&(params.revs=!0),opts.attachments&&(params.attachments=!0),opts.latest&&(params.latest=!0),ajax(opts,{url:genDBUrl(host,"_bulk_get"+paramsToStr(params)),method:"POST",body:{docs:opts.docs}},function(err,result){!err&&opts.attachments&&opts.binary&&result.results.forEach(function(res){res.docs.forEach(readAttachmentsAsBlobOrBuffer)}),cb(err,result)})}function doBulkGetShim(){var batchSize=MAX_SIMULTANEOUS_REVS,numBatches=Math.ceil(opts.docs.length/batchSize),numDone=0,results=new Array(numBatches);function onResult(batchNum){return function(err,res){results[batchNum]=res.results,++numDone===numBatches&&callback(null,{results:flatten(results)})}}for(var i=0;i<numBatches;i++){var subOpts=pick(opts,["revs","attachments","binary","latest"]);subOpts.ajax=ajaxOpts,subOpts.docs=opts.docs.slice(i*batchSize,Math.min(opts.docs.length,(i+1)*batchSize)),bulkGet(self,subOpts,onResult(i))}}var dbUrl=genUrl(host,""),supportsBulkGet=supportsBulkGetMap[dbUrl];"boolean"!=typeof supportsBulkGet?doBulkGet(function(err,res){err?(supportsBulkGetMap[dbUrl]=!1,explainError(err.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),doBulkGetShim()):(supportsBulkGetMap[dbUrl]=!0,callback(null,res))}):supportsBulkGet?doBulkGet(callback):doBulkGetShim()}),api._info=function(callback){setup().then(function(){ajax({},{method:"GET",url:genDBUrl(host,"")},function(err,res){if(err)return callback(err);res.host=genDBUrl(host,""),callback(null,res)})}).catch(callback)},api.get=adapterFun$$1("get",function(id,opts,callback){"function"==typeof opts&&(callback=opts,opts={});var params={};(opts=clone(opts)).revs&&(params.revs=!0),opts.revs_info&&(params.revs_info=!0),opts.latest&&(params.latest=!0),opts.open_revs&&("all"!==opts.open_revs&&(opts.open_revs=JSON.stringify(opts.open_revs)),params.open_revs=opts.open_revs),opts.rev&&(params.rev=opts.rev),opts.conflicts&&(params.conflicts=opts.conflicts),opts.update_seq&&(params.update_seq=opts.update_seq),id=encodeDocId(id);var options={method:"GET",url:genDBUrl(host,id+paramsToStr(params))};function fetchAttachments(doc){var atts=doc._attachments,filenames=atts&&Object.keys(atts);if(atts&&filenames.length)return function(promiseFactories,limit){return new PouchPromise(function(resolve,reject){var err,running=0,current=0,done=0,len=promiseFactories.length;function doNext(){++done===len?err?reject(err):resolve():runNextBatch()}function onSuccess(){running--,doNext()}function onError(thisErr){running--,err=err||thisErr,doNext()}function runNextBatch(){for(;running<limit&&current<len;)running++,promiseFactories[current++]().then(onSuccess,onError)}runNextBatch()})}(filenames.map(function(filename){return function(){return function(filename){var att=atts[filename],path=encodeDocId(doc._id)+"/"+encodeAttachmentId(filename)+"?rev="+doc._rev;return ajaxPromise(opts,{method:"GET",url:genDBUrl(host,path),binary:!0}).then(function(blob){return opts.binary?blob:new PouchPromise(function(resolve){blobToBase64(blob,resolve)})}).then(function(data){delete att.stub,delete att.length,att.data=data})}(filename)}}),5)}ajaxPromise(opts,options).then(function(res){return PouchPromise.resolve().then(function(){if(opts.attachments)return function(docOrDocs){return Array.isArray(docOrDocs)?PouchPromise.all(docOrDocs.map(function(doc){if(doc.ok)return fetchAttachments(doc.ok)})):fetchAttachments(docOrDocs)}(res)}).then(function(){callback(null,res)})}).catch(function(e){e.docId=id,callback(e)})}),api.remove=adapterFun$$1("remove",function(docOrId,optsOrRev,opts,callback){var doc;"string"==typeof optsOrRev?(doc={_id:docOrId,_rev:optsOrRev},"function"==typeof opts&&(callback=opts,opts={})):(doc=docOrId,opts="function"==typeof optsOrRev?(callback=optsOrRev,{}):(callback=opts,optsOrRev));var rev$$1=doc._rev||opts.rev;ajax(opts,{method:"DELETE",url:genDBUrl(host,encodeDocId(doc._id))+"?rev="+rev$$1},callback)}),api.getAttachment=adapterFun$$1("getAttachment",function(docId,attachmentId,opts,callback){"function"==typeof opts&&(callback=opts,opts={});var params=opts.rev?"?rev="+opts.rev:"";ajax(opts,{method:"GET",url:genDBUrl(host,encodeDocId(docId))+"/"+encodeAttachmentId(attachmentId)+params,binary:!0},callback)}),api.removeAttachment=adapterFun$$1("removeAttachment",function(docId,attachmentId,rev$$1,callback){ajax({},{method:"DELETE",url:genDBUrl(host,encodeDocId(docId)+"/"+encodeAttachmentId(attachmentId))+"?rev="+rev$$1},callback)}),api.putAttachment=adapterFun$$1("putAttachment",function(docId,attachmentId,rev$$1,blob,type,callback){"function"==typeof type&&(callback=type,type=blob,blob=rev$$1,rev$$1=null);var id=encodeDocId(docId)+"/"+encodeAttachmentId(attachmentId),url=genDBUrl(host,id);if(rev$$1&&(url+="?rev="+rev$$1),"string"==typeof blob){var binary;try{binary=thisAtob(blob)}catch(err){return callback(createError(BAD_ARG,"Attachment is not a valid base64 string"))}blob=binary?binStringToBluffer(binary,type):""}ajax({},{headers:{"Content-Type":type},method:"PUT",url:url,processData:!1,body:blob,timeout:ajaxOpts.timeout||6e4},callback)}),api._bulkDocs=function(req,opts,callback){req.new_edits=opts.new_edits,setup().then(function(){return PouchPromise.all(req.docs.map(preprocessAttachments$2))}).then(function(){ajax(opts,{method:"POST",url:genDBUrl(host,"_bulk_docs"),timeout:opts.timeout,body:req},function(err,results){if(err)return callback(err);results.forEach(function(result){result.ok=!0}),callback(null,results)})}).catch(callback)},api._put=function(doc,opts,callback){setup().then(function(){return preprocessAttachments$2(doc)}).then(function(){ajax(opts,{method:"PUT",url:genDBUrl(host,encodeDocId(doc._id)),body:doc},function(err,result){if(err)return err.docId=doc&&doc._id,callback(err);callback(null,result)})}).catch(callback)},api.allDocs=adapterFun$$1("allDocs",function(opts,callback){"function"==typeof opts&&(callback=opts,opts={});var body,params={},method="GET";(opts=clone(opts)).conflicts&&(params.conflicts=!0),opts.update_seq&&(params.update_seq=!0),opts.descending&&(params.descending=!0),opts.include_docs&&(params.include_docs=!0),opts.attachments&&(params.attachments=!0),opts.key&&(params.key=JSON.stringify(opts.key)),opts.start_key&&(opts.startkey=opts.start_key),opts.startkey&&(params.startkey=JSON.stringify(opts.startkey)),opts.end_key&&(opts.endkey=opts.end_key),opts.endkey&&(params.endkey=JSON.stringify(opts.endkey)),void 0!==opts.inclusive_end&&(params.inclusive_end=!!opts.inclusive_end),void 0!==opts.limit&&(params.limit=opts.limit),void 0!==opts.skip&&(params.skip=opts.skip);var paramStr=paramsToStr(params);void 0!==opts.keys&&(method="POST",body={keys:opts.keys}),ajaxPromise(opts,{method:method,url:genDBUrl(host,"_all_docs"+paramStr),body:body}).then(function(res){opts.include_docs&&opts.attachments&&opts.binary&&res.rows.forEach(readAttachmentsAsBlobOrBuffer),callback(null,res)}).catch(callback)}),api._changes=function(opts){var batchSize="batch_size"in opts?opts.batch_size:CHANGES_BATCH_SIZE;!(opts=clone(opts)).continuous||"heartbeat"in opts||(opts.heartbeat=DEFAULT_HEARTBEAT);var requestTimeout="timeout"in opts?opts.timeout:"timeout"in ajaxOpts?ajaxOpts.timeout:3e4;"timeout"in opts&&opts.timeout&&requestTimeout-opts.timeout<CHANGES_TIMEOUT_BUFFER&&(requestTimeout=opts.timeout+CHANGES_TIMEOUT_BUFFER),"heartbeat"in opts&&opts.heartbeat&&requestTimeout-opts.heartbeat<CHANGES_TIMEOUT_BUFFER&&(requestTimeout=opts.heartbeat+CHANGES_TIMEOUT_BUFFER);var params={};"timeout"in opts&&opts.timeout&&(params.timeout=opts.timeout);var returnDocs,limit=void 0!==opts.limit&&opts.limit;returnDocs="return_docs"in opts?opts.return_docs:!("returnDocs"in opts)||opts.returnDocs;var leftToFetch=limit;if(opts.style&&(params.style=opts.style),(opts.include_docs||opts.filter&&"function"==typeof opts.filter)&&(params.include_docs=!0),opts.attachments&&(params.attachments=!0),opts.continuous&&(params.feed="longpoll"),opts.seq_interval&&(params.seq_interval=opts.seq_interval),opts.conflicts&&(params.conflicts=!0),opts.descending&&(params.descending=!0),opts.update_seq&&(params.update_seq=!0),"heartbeat"in opts&&opts.heartbeat&&(params.heartbeat=opts.heartbeat),opts.filter&&"string"==typeof opts.filter&&(params.filter=opts.filter),opts.view&&"string"==typeof opts.view&&(params.filter="_view",params.view=opts.view),opts.query_params&&"object"==typeof opts.query_params)for(var param_name in opts.query_params)opts.query_params.hasOwnProperty(param_name)&&(params[param_name]=opts.query_params[param_name]);var body,xhr,lastFetchedSeq,method="GET";opts.doc_ids?(params.filter="_doc_ids",method="POST",body={doc_ids:opts.doc_ids}):opts.selector&&(params.filter="_selector",method="POST",body={selector:opts.selector});function fetch(since,callback){if(!opts.aborted){params.since=since,"object"==typeof params.since&&(params.since=JSON.stringify(params.since)),opts.descending?limit&&(params.limit=leftToFetch):params.limit=!limit||batchSize<leftToFetch?batchSize:leftToFetch;var xhrOpts={method:method,url:genDBUrl(host,"_changes"+paramsToStr(params)),timeout:requestTimeout,body:body};lastFetchedSeq=since,opts.aborted||setup().then(function(){xhr=ajax(opts,xhrOpts,callback)}).catch(callback)}}var results={results:[]},fetched=function(err,res){if(!opts.aborted){var raw_results_length=0;if(res&&res.results){raw_results_length=res.results.length,results.last_seq=res.last_seq;var pending=null,lastSeq=null;"number"==typeof res.pending&&(pending=res.pending),"string"!=typeof results.last_seq&&"number"!=typeof results.last_seq||(lastSeq=results.last_seq);opts.query_params,res.results=res.results.filter(function(c){leftToFetch--;var ret=filterChange(opts)(c);return ret&&(opts.include_docs&&opts.attachments&&opts.binary&&readAttachmentsAsBlobOrBuffer(c),returnDocs&&results.results.push(c),opts.onChange(c,pending,lastSeq)),ret})}else if(err)return opts.aborted=!0,void opts.complete(err);res&&res.last_seq&&(lastFetchedSeq=res.last_seq);var finished=limit&&leftToFetch<=0||res&&raw_results_length<batchSize||opts.descending;(!opts.continuous||limit&&leftToFetch<=0)&&finished?opts.complete(null,results):nextTick(function(){fetch(lastFetchedSeq,fetched)})}};return fetch(opts.since||0,fetched),{cancel:function(){opts.aborted=!0,xhr&&xhr.abort()}}},api.revsDiff=adapterFun$$1("revsDiff",function(req,opts,callback){"function"==typeof opts&&(callback=opts,opts={}),ajax(opts,{method:"POST",url:genDBUrl(host,"_revs_diff"),body:req},callback)}),api._close=function(callback){callback()},api._destroy=function(options,callback){ajax(options,{url:genDBUrl(host,""),method:"DELETE"},function(err,resp){if(err&&err.status&&404!==err.status)return callback(err);callback(null,resp)})}}function QueryParseError(message){this.status=400,this.name="query_parse_error",this.message=message,this.error=!0;try{Error.captureStackTrace(this,QueryParseError)}catch(e){}}function NotFoundError(message){this.status=404,this.name="not_found",this.message=message,this.error=!0;try{Error.captureStackTrace(this,NotFoundError)}catch(e){}}function BuiltInError(message){this.status=500,this.name="invalid_value",this.message=message,this.error=!0;try{Error.captureStackTrace(this,BuiltInError)}catch(e){}}function promisedCallback(promise,callback){return callback&&promise.then(function(res){nextTick(function(){callback(null,res)})},function(reason){nextTick(function(){callback(reason)})}),promise}function sequentialize(queue,promiseFactory){return function(){var args=arguments,that=this;return queue.add(function(){return promiseFactory.apply(that,args)})}}function uniq(arr){var theSet=new ExportedSet(arr),result=new Array(theSet.size),index=-1;return theSet.forEach(function(value){result[++index]=value}),result}function mapToKeysArray(map){var result=new Array(map.size),index=-1;return map.forEach(function(value,key){result[++index]=key}),result}function createBuiltInError(name){return new BuiltInError("builtin "+name+" function requires map values to be numbers or number arrays")}function sum(values){for(var result=0,i=0,len=values.length;i<len;i++){var num=values[i];if("number"!=typeof num){if(!Array.isArray(num))throw createBuiltInError("_sum");result="number"==typeof result?[result]:result;for(var j=0,jLen=num.length;j<jLen;j++){var jNum=num[j];if("number"!=typeof jNum)throw createBuiltInError("_sum");void 0===result[j]?result.push(jNum):result[j]+=jNum}}else"number"==typeof result?result+=num:result[0]+=num}return result}HttpPouch.valid=function(){return!0},inherits(QueryParseError,Error),inherits(NotFoundError,Error),inherits(BuiltInError,Error);var log=guardedConsole.bind(null,"log"),isArray=Array.isArray,toJSON=JSON.parse;function evalFunctionWithEval(func,emit){return scopeEval("return ("+func.replace(/;\s*$/,"")+");",{emit:emit,sum:sum,log:log,isArray:isArray,toJSON:toJSON})}function TaskQueue$2(){this.promise=new PouchPromise(function(fulfill){fulfill()})}function stringify(input){if(!input)return"undefined";switch(typeof input){case"function":case"string":return input.toString();default:return JSON.stringify(input)}}function createView(sourceDB,viewName,mapFun,reduceFun,temporary,localDocName){var cachedViews,viewSignature=function(mapFun,reduceFun){return stringify(mapFun)+stringify(reduceFun)+"undefined"}(mapFun,reduceFun);if(!temporary&&(cachedViews=sourceDB._cachedViews=sourceDB._cachedViews||{})[viewSignature])return cachedViews[viewSignature];var promiseForView=sourceDB.info().then(function(info){var depDbName=info.db_name+"-mrview-"+(temporary?"temp":function(string){return Md5.hash(string)}(viewSignature));return upsert(sourceDB,"_local/"+localDocName,function(doc){doc.views=doc.views||{};var fullViewName=viewName;-1===fullViewName.indexOf("/")&&(fullViewName=viewName+"/"+viewName);var depDbs=doc.views[fullViewName]=doc.views[fullViewName]||{};if(!depDbs[depDbName])return depDbs[depDbName]=!0,doc}).then(function(){return sourceDB.registerDependentDatabase(depDbName).then(function(res){var db=res.db;db.auto_compaction=!0;var view={name:depDbName,db:db,sourceDB:sourceDB,adapter:sourceDB.adapter,mapFun:mapFun,reduceFun:reduceFun};return view.db.get("_local/lastSeq").catch(function(err){if(404!==err.status)throw err}).then(function(lastSeqDoc){return view.seq=lastSeqDoc?lastSeqDoc.seq:0,cachedViews&&view.db.once("destroyed",function(){delete cachedViews[viewSignature]}),view})})})});return cachedViews&&(cachedViews[viewSignature]=promiseForView),promiseForView}TaskQueue$2.prototype.add=function(promiseFactory){return this.promise=this.promise.catch(function(){}).then(function(){return promiseFactory()}),this.promise},TaskQueue$2.prototype.finish=function(){return this.promise};var persistentQueues={},tempViewQueue=new TaskQueue$2;function parseViewName(name){return-1===name.indexOf("/")?[name,name]:name.split("/")}function emitError(db,e){try{db.emit("error",e)}catch(err){guardedConsole("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),guardedConsole("error",e)}}var builtInReduce={_sum:function(keys,values){return sum(values)},_count:function(keys,values){return values.length},_stats:function(keys,values){return{sum:sum(values),min:Math.min.apply(null,values),max:Math.max.apply(null,values),count:values.length,sumsqr:function(values){for(var _sumsqr=0,i=0,len=values.length;i<len;i++){var num=values[i];_sumsqr+=num*num}return _sumsqr}(values)}}};var abstract=function(localDocName,mapper,reducer,ddocValidator){function tryMap(db,fun,doc){try{fun(doc)}catch(e){emitError(db,e)}}function tryReduce(db,fun,keys,values,rereduce){try{return{output:fun(keys,values,rereduce)}}catch(e){return emitError(db,e),{error:e}}}function sortByKeyThenValue(x,y){var keyCompare=collate(x.key,y.key);return 0!==keyCompare?keyCompare:collate(x.value,y.value)}function rowToDocId(row){var val=row.value;return val&&"object"==typeof val&&val._id||row.id}function postprocessAttachments(opts){return function(res){return opts.include_docs&&opts.attachments&&opts.binary&&function(res){res.rows.forEach(function(row){var atts=row.doc&&row.doc._attachments;atts&&Object.keys(atts).forEach(function(filename){var att=atts[filename];atts[filename].data=b64ToBluffer(att.data,att.content_type)})})}(res),res}}function addHttpParam(paramName,opts,params,asJson){var val=opts[paramName];void 0!==val&&(asJson&&(val=encodeURIComponent(JSON.stringify(val))),params.push(paramName+"="+val))}function coerceInteger(integerCandidate){if(void 0!==integerCandidate){var asNumber=Number(integerCandidate);return isNaN(asNumber)||asNumber!==parseInt(integerCandidate,10)?integerCandidate:asNumber}}function checkQueryParseError(options,fun){var startkeyName=options.descending?"endkey":"startkey",endkeyName=options.descending?"startkey":"endkey";if(void 0!==options[startkeyName]&&void 0!==options[endkeyName]&&0<collate(options[startkeyName],options[endkeyName]))throw new QueryParseError("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(fun.reduce&&!1!==options.reduce){if(options.include_docs)throw new QueryParseError("{include_docs:true} is invalid for reduce");if(options.keys&&1<options.keys.length&&!options.group&&!options.group_level)throw new QueryParseError("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(optionName){var error=function(number){if(number){if("number"!=typeof number)return new QueryParseError('Invalid value for integer: "'+number+'"');if(number<0)return new QueryParseError('Invalid value for positive integer: "'+number+'"')}}(options[optionName]);if(error)throw error})}function defaultsTo(value){return function(reason){if(404===reason.status)return value;throw reason}}function getDocsToPersist(docId,view,docIdsToChangesAndEmits){var metaDocId="_local/doc_"+docId,defaultMetaDoc={_id:metaDocId,keys:[]},docData=docIdsToChangesAndEmits.get(docId),indexableKeysToKeyValues=docData[0];return(function(changes){return 1===changes.length&&/^1-/.test(changes[0].rev)}(docData[1])?PouchPromise.resolve(defaultMetaDoc):view.db.get(metaDocId).catch(defaultsTo(defaultMetaDoc))).then(function(metaDoc){return function(metaDoc){return metaDoc.keys.length?view.db.allDocs({keys:metaDoc.keys,include_docs:!0}):PouchPromise.resolve({rows:[]})}(metaDoc).then(function(kvDocsRes){return function(metaDoc,kvDocsRes){for(var kvDocs=[],oldKeys=new ExportedSet,i=0,len=kvDocsRes.rows.length;i<len;i++){var doc=kvDocsRes.rows[i].doc;if(doc&&(kvDocs.push(doc),oldKeys.add(doc._id),doc._deleted=!indexableKeysToKeyValues.has(doc._id),!doc._deleted)){var keyValue=indexableKeysToKeyValues.get(doc._id);"value"in keyValue&&(doc.value=keyValue.value)}}var newKeys=mapToKeysArray(indexableKeysToKeyValues);return newKeys.forEach(function(key){if(!oldKeys.has(key)){var kvDoc={_id:key},keyValue=indexableKeysToKeyValues.get(key);"value"in keyValue&&(kvDoc.value=keyValue.value),kvDocs.push(kvDoc)}}),metaDoc.keys=uniq(newKeys.concat(metaDoc.keys)),kvDocs.push(metaDoc),kvDocs}(metaDoc,kvDocsRes)})})}function getQueue(view){var viewName="string"==typeof view?view:view.name,queue=persistentQueues[viewName];return queue=queue||(persistentQueues[viewName]=new TaskQueue$2)}function updateView(view){return sequentialize(getQueue(view),function(){return function(view){var mapResults,doc;var mapFun=mapper(view.mapFun,function(key,value){var output={id:doc._id,key:normalizeKey(key)};null!=value&&(output.value=normalizeKey(value)),mapResults.push(output)}),currentSeq=view.seq||0;function processChange(docIdsToChangesAndEmits,seq){return function(){return function(view,docIdsToChangesAndEmits,seq){return view.db.get("_local/lastSeq").catch(defaultsTo({_id:"_local/lastSeq",seq:0})).then(function(lastSeqDoc){var docIds=mapToKeysArray(docIdsToChangesAndEmits);return PouchPromise.all(docIds.map(function(docId){return getDocsToPersist(docId,view,docIdsToChangesAndEmits)})).then(function(listOfDocsToPersist){var docsToPersist=flatten(listOfDocsToPersist);return lastSeqDoc.seq=seq,docsToPersist.push(lastSeqDoc),view.db.bulkDocs({docs:docsToPersist})})})}(view,docIdsToChangesAndEmits,seq)}}var queue=new TaskQueue$2;function processNextBatch(){return view.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:currentSeq,limit:50}).then(processBatch)}function processBatch(response){var results=response.results;if(results.length){var docIdsToChangesAndEmits=function(results){for(var docIdsToChangesAndEmits=new ExportedMap,i=0,len=results.length;i<len;i++){var change=results[i];if("_"!==change.doc._id[0]){mapResults=[],(doc=change.doc)._deleted||tryMap(view.sourceDB,mapFun,doc),mapResults.sort(sortByKeyThenValue);var indexableKeysToKeyValues=createIndexableKeysToKeyValues(mapResults);docIdsToChangesAndEmits.set(change.doc._id,[indexableKeysToKeyValues,change.changes])}currentSeq=change.seq}return docIdsToChangesAndEmits}(results);if(queue.add(processChange(docIdsToChangesAndEmits,currentSeq)),!(results.length<50))return processNextBatch()}}function createIndexableKeysToKeyValues(mapResults){for(var lastKey,indexableKeysToKeyValues=new ExportedMap,i=0,len=mapResults.length;i<len;i++){var emittedKeyValue=mapResults[i],complexKey=[emittedKeyValue.key,emittedKeyValue.id];0<i&&0===collate(emittedKeyValue.key,lastKey)&&complexKey.push(i),indexableKeysToKeyValues.set(toIndexableString(complexKey),emittedKeyValue),lastKey=emittedKeyValue.key}return indexableKeysToKeyValues}return processNextBatch().then(function(){return queue.finish()}).then(function(){view.seq=currentSeq})}(view)})()}function reduceView(view,results,options){0===options.group_level&&delete options.group_level;var shouldGroup=options.group||options.group_level,reduceFun=reducer(view.reduceFun),groups=[],lvl=isNaN(options.group_level)?Number.POSITIVE_INFINITY:options.group_level;results.forEach(function(e){var last=groups[groups.length-1],groupKey=shouldGroup?e.key:null;if(shouldGroup&&Array.isArray(groupKey)&&(groupKey=groupKey.slice(0,lvl)),last&&0===collate(last.groupKey,groupKey))return last.keys.push([e.key,e.id]),void last.values.push(e.value);groups.push({keys:[[e.key,e.id]],values:[e.value],groupKey:groupKey})}),results=[];for(var i=0,len=groups.length;i<len;i++){var e=groups[i],reduceTry=tryReduce(view.sourceDB,reduceFun,e.keys,e.values,!1);if(reduceTry.error&&reduceTry.error instanceof BuiltInError)throw reduceTry.error;results.push({value:reduceTry.error?null:reduceTry.output,key:e.groupKey})}return{rows:function(results,limit,skip){return skip=skip||0,"number"==typeof limit?results.slice(skip,limit+skip):0<skip?results.slice(skip):results}(results,options.limit,options.skip)}}function queryView(view,opts){return sequentialize(getQueue(view),function(){return function(view,opts){var totalRows,shouldReduce=view.reduceFun&&!1!==opts.reduce,skip=opts.skip||0;void 0===opts.keys||opts.keys.length||(opts.limit=0,delete opts.keys);function fetchFromView(viewOpts){return viewOpts.include_docs=!0,view.db.allDocs(viewOpts).then(function(res){return totalRows=res.total_rows,res.rows.map(function(result){if("value"in result.doc&&"object"==typeof result.doc.value&&null!==result.doc.value){var keys=Object.keys(result.doc.value).sort(),expectedKeys=["id","key","value"];if(!(keys<expectedKeys||expectedKeys<keys))return result.doc.value}var parsedKeyAndDocId=function(str){for(var stack=[],metaStack=[],i=0;;){var collationIndex=str[i++];if("\0"!==collationIndex)switch(collationIndex){case"1":stack.push(null);break;case"2":stack.push("1"===str[i]),i++;break;case"3":var parsedNum=parseNumber(str,i);stack.push(parsedNum.num),i+=parsedNum.length;break;case"4":for(var parsedStr="";;){var ch=str[i];if("\0"===ch)break;parsedStr+=ch,i++}parsedStr=parsedStr.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),stack.push(parsedStr);break;case"5":var arrayElement={element:[],index:stack.length};stack.push(arrayElement.element),metaStack.push(arrayElement);break;case"6":var objElement={element:{},index:stack.length};stack.push(objElement.element),metaStack.push(objElement);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+collationIndex)}else{if(1===stack.length)return stack.pop();pop(stack,metaStack)}}}(result.doc._id);return{key:parsedKeyAndDocId[0],id:parsedKeyAndDocId[1],value:"value"in result.doc?result.doc.value:null}})})}function onMapResultsReady(rows){var finalResults;if(finalResults=shouldReduce?reduceView(view,rows,opts):{total_rows:totalRows,offset:skip,rows:rows},opts.update_seq&&(finalResults.update_seq=view.seq),opts.include_docs){var docIds=uniq(rows.map(rowToDocId));return view.sourceDB.allDocs({keys:docIds,include_docs:!0,conflicts:opts.conflicts,attachments:opts.attachments,binary:opts.binary}).then(function(allDocsRes){var docIdsToDocs=new ExportedMap;return allDocsRes.rows.forEach(function(row){docIdsToDocs.set(row.id,row.doc)}),rows.forEach(function(row){var docId=rowToDocId(row),doc=docIdsToDocs.get(docId);doc&&(row.doc=doc)}),finalResults})}return finalResults}{if(void 0!==opts.keys){var fetchPromises=opts.keys.map(function(key){var viewOpts={startkey:toIndexableString([key]),endkey:toIndexableString([key,{}])};return opts.update_seq&&(viewOpts.update_seq=!0),fetchFromView(viewOpts)});return PouchPromise.all(fetchPromises).then(flatten).then(onMapResultsReady)}var startkey,endkey,viewOpts={descending:opts.descending};if(opts.update_seq&&(viewOpts.update_seq=!0),"start_key"in opts&&(startkey=opts.start_key),"startkey"in opts&&(startkey=opts.startkey),"end_key"in opts&&(endkey=opts.end_key),"endkey"in opts&&(endkey=opts.endkey),void 0!==startkey&&(viewOpts.startkey=opts.descending?toIndexableString([startkey,{}]):toIndexableString([startkey])),void 0!==endkey){var inclusiveEnd=!1!==opts.inclusive_end;opts.descending&&(inclusiveEnd=!inclusiveEnd),viewOpts.endkey=toIndexableString(inclusiveEnd?[endkey,{}]:[endkey])}if(void 0!==opts.key){var keyStart=toIndexableString([opts.key]),keyEnd=toIndexableString([opts.key,{}]);viewOpts.descending?(viewOpts.endkey=keyStart,viewOpts.startkey=keyEnd):(viewOpts.startkey=keyStart,viewOpts.endkey=keyEnd)}return shouldReduce||("number"==typeof opts.limit&&(viewOpts.limit=opts.limit),viewOpts.skip=skip),fetchFromView(viewOpts).then(onMapResultsReady)}}(view,opts)})()}function queryPromised(db,fun,opts){if("function"==typeof db._query)return function(db,fun,opts){return new PouchPromise(function(resolve,reject){db._query(fun,opts,function(err,res){if(err)return reject(err);resolve(res)})})}(db,fun,opts);if(isRemote(db))return function(db,fun,opts){var body,params=[],method="GET";if(addHttpParam("reduce",opts,params),addHttpParam("include_docs",opts,params),addHttpParam("attachments",opts,params),addHttpParam("limit",opts,params),addHttpParam("descending",opts,params),addHttpParam("group",opts,params),addHttpParam("group_level",opts,params),addHttpParam("skip",opts,params),addHttpParam("stale",opts,params),addHttpParam("conflicts",opts,params),addHttpParam("startkey",opts,params,!0),addHttpParam("start_key",opts,params,!0),addHttpParam("endkey",opts,params,!0),addHttpParam("end_key",opts,params,!0),addHttpParam("inclusive_end",opts,params),addHttpParam("key",opts,params,!0),addHttpParam("update_seq",opts,params),params=""===(params=params.join("&"))?"":"?"+params,void 0!==opts.keys){var keysAsString="keys="+encodeURIComponent(JSON.stringify(opts.keys));keysAsString.length+params.length+1<=2e3?params+=("?"===params[0]?"&":"?")+keysAsString:(method="POST","string"==typeof fun?body={keys:opts.keys}:fun.keys=opts.keys)}if("string"!=typeof fun)return body=body||{},Object.keys(fun).forEach(function(key){Array.isArray(fun[key])?body[key]=fun[key]:body[key]=fun[key].toString()}),db.request({method:"POST",url:"_temp_view"+params,body:body}).then(postprocessAttachments(opts));var parts=parseViewName(fun);return db.request({method:method,url:"_design/"+parts[0]+"/_view/"+parts[1]+params,body:body}).then(function(result){return result.rows.forEach(function(row){if(row.value&&row.value.error&&"builtin_reduce_error"===row.value.error)throw new Error(row.reason)}),result}).then(postprocessAttachments(opts))}(db,fun,opts);if("string"!=typeof fun)return checkQueryParseError(opts,fun),tempViewQueue.add(function(){return createView(db,"temp_view/temp_view",fun.map,fun.reduce,!0,localDocName).then(function(view){return function(promise,finalPromiseFactory){return promise.then(function(res){return finalPromiseFactory().then(function(){return res})},function(reason){return finalPromiseFactory().then(function(){throw reason})})}(updateView(view).then(function(){return queryView(view,opts)}),function(){return view.db.destroy()})})}),tempViewQueue.finish();var fullViewName=fun,parts=parseViewName(fullViewName),designDocName=parts[0],viewName=parts[1];return db.get("_design/"+designDocName).then(function(doc){var fun=doc.views&&doc.views[viewName];if(!fun)throw new NotFoundError("ddoc "+doc._id+" has no view named "+viewName);return ddocValidator(doc,viewName),checkQueryParseError(opts,fun),createView(db,fullViewName,fun.map,fun.reduce,!1,localDocName).then(function(view){return"ok"===opts.stale||"update_after"===opts.stale?("update_after"===opts.stale&&nextTick(function(){updateView(view)}),queryView(view,opts)):updateView(view).then(function(){return queryView(view,opts)})})})}return{query:function(fun,opts,callback){var db=this;"function"==typeof opts&&(callback=opts,opts={}),opts=opts?function(opts){return opts.group_level=coerceInteger(opts.group_level),opts.limit=coerceInteger(opts.limit),opts.skip=coerceInteger(opts.skip),opts}(opts):{},"function"==typeof fun&&(fun={map:fun});var promise=PouchPromise.resolve().then(function(){return queryPromised(db,fun,opts)});return promisedCallback(promise,callback),promise},viewCleanup:function(fun){return getArguments(function(args){var cb=args.pop(),promise=fun.apply(this,args);return"function"==typeof cb&&promisedCallback(promise,cb),promise})}(function(){var db=this;return"function"==typeof db._viewCleanup?function(db){return new PouchPromise(function(resolve,reject){db._viewCleanup(function(err,res){if(err)return reject(err);resolve(res)})})}(db):isRemote(db)?function(db){return db.request({method:"POST",url:"_view_cleanup"})}(db):function(db){return db.get("_local/"+localDocName).then(function(metaDoc){var docsToViews=new ExportedMap;Object.keys(metaDoc.views).forEach(function(fullViewName){var parts=parseViewName(fullViewName),designDocName="_design/"+parts[0],viewName=parts[1],views=docsToViews.get(designDocName);views||(views=new ExportedSet,docsToViews.set(designDocName,views)),views.add(viewName)});var opts={keys:mapToKeysArray(docsToViews),include_docs:!0};return db.allDocs(opts).then(function(res){var viewsToStatus={};res.rows.forEach(function(row){var ddocName=row.key.substring(8);docsToViews.get(row.key).forEach(function(viewName){var fullViewName=ddocName+"/"+viewName;metaDoc.views[fullViewName]||(fullViewName=viewName);var viewDBNames=Object.keys(metaDoc.views[fullViewName]),statusIsGood=row.doc&&row.doc.views&&row.doc.views[viewName];viewDBNames.forEach(function(viewDBName){viewsToStatus[viewDBName]=viewsToStatus[viewDBName]||statusIsGood})})});var destroyPromises=Object.keys(viewsToStatus).filter(function(viewDBName){return!viewsToStatus[viewDBName]}).map(function(viewDBName){return sequentialize(getQueue(viewDBName),function(){return new db.constructor(viewDBName,db.__opts).destroy()})()});return PouchPromise.all(destroyPromises).then(function(){return{ok:!0}})})},defaultsTo({ok:!0}))}(db)})}}("mrviews",function(mapFun,emit){if("function"!=typeof mapFun||2!==mapFun.length)return evalFunctionWithEval(mapFun.toString(),emit);var origMap=mapFun;return function(doc){return origMap(doc,emit)}},function(reduceFun){var reduceFunString=reduceFun.toString(),builtIn=function(reduceFunString){if(/^_sum/.test(reduceFunString))return builtInReduce._sum;if(/^_count/.test(reduceFunString))return builtInReduce._count;if(/^_stats/.test(reduceFunString))return builtInReduce._stats;if(/^_/.test(reduceFunString))throw new Error(reduceFunString+" is not a supported reduce function.")}(reduceFunString);return builtIn||evalFunctionWithEval(reduceFunString)},function(ddoc,viewName){var fun=ddoc.views&&ddoc.views[viewName];if("string"!=typeof fun.map)throw new NotFoundError("ddoc "+ddoc._id+" has no string view named "+viewName+", instead found object of type: "+typeof fun.map)});var mapreduce={query:function(fun,opts,callback){return abstract.query.call(this,fun,opts,callback)},viewCleanup:function(callback){return abstract.viewCleanup.call(this,callback)}};function isGenOne$1(rev$$1){return/^1-/.test(rev$$1)}function getDocAttachments(db,doc){var filenames=Object.keys(doc._attachments);return PouchPromise.all(filenames.map(function(filename){return db.getAttachment(doc._id,filename,{rev:doc._rev})}))}function getDocAttachmentsFromTargetOrSource(target,src,doc){var doCheckForLocalAttachments=isRemote(src)&&!isRemote(target),filenames=Object.keys(doc._attachments);return doCheckForLocalAttachments?target.get(doc._id).then(function(localDoc){return PouchPromise.all(filenames.map(function(filename){return function(localDoc,remoteDoc,filename){return!localDoc._attachments||!localDoc._attachments[filename]||localDoc._attachments[filename].digest!==remoteDoc._attachments[filename].digest}(localDoc,doc,filename)?src.getAttachment(doc._id,filename):target.getAttachment(localDoc._id,filename)}))}).catch(function(error){if(404!==error.status)throw error;return getDocAttachments(src,doc)}):getDocAttachments(src,doc)}function getDocs(src,target,diffs,state){diffs=clone(diffs);var resultDocs=[],ok=!0;function fetchRevisionOneDocs(ids){return src.allDocs({keys:ids,include_docs:!0,conflicts:!0}).then(function(res){if(state.cancelled)throw new Error("cancelled");res.rows.forEach(function(row){row.deleted||!row.doc||!isGenOne$1(row.value.rev)||function(doc){return doc._attachments&&0<Object.keys(doc._attachments).length}(row.doc)||function(doc){return doc._conflicts&&0<doc._conflicts.length}(row.doc)||(row.doc._conflicts&&delete row.doc._conflicts,resultDocs.push(row.doc),delete diffs[row.id])})})}return PouchPromise.resolve().then(function(){var ids=Object.keys(diffs).filter(function(id){var missing=diffs[id].missing;return 1===missing.length&&isGenOne$1(missing[0])});if(0<ids.length)return fetchRevisionOneDocs(ids)}).then(function(){var bulkGetOpts=function(diffs){var requests=[];return Object.keys(diffs).forEach(function(id){diffs[id].missing.forEach(function(missingRev){requests.push({id:id,rev:missingRev})})}),{docs:requests,revs:!0,latest:!0}}(diffs);if(bulkGetOpts.docs.length)return src.bulkGet(bulkGetOpts).then(function(bulkGetResponse){if(state.cancelled)throw new Error("cancelled");return PouchPromise.all(bulkGetResponse.results.map(function(bulkGetInfo){return PouchPromise.all(bulkGetInfo.docs.map(function(doc){var remoteDoc=doc.ok;return doc.error&&(ok=!1),remoteDoc&&remoteDoc._attachments?getDocAttachmentsFromTargetOrSource(target,src,remoteDoc).then(function(attachments){var filenames=Object.keys(remoteDoc._attachments);return attachments.forEach(function(attachment,i){var att=remoteDoc._attachments[filenames[i]];delete att.stub,delete att.length,att.data=attachment}),remoteDoc}):remoteDoc}))})).then(function(results){resultDocs=resultDocs.concat(flatten(results).filter(Boolean))})})}).then(function(){return{ok:ok,docs:resultDocs}})}var CHECKPOINT_VERSION=1,REPLICATOR="pouchdb",CHECKPOINT_HISTORY_SIZE=5,LOWEST_SEQ=0;function updateCheckpoint(db,id,checkpoint,session,returnValue){return db.get(id).catch(function(err){if(404===err.status)return"http"!==db.adapter&&"https"!==db.adapter||explainError(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:session,_id:id,history:[],replicator:REPLICATOR,version:CHECKPOINT_VERSION};throw err}).then(function(doc){if(!returnValue.cancelled&&doc.last_seq!==checkpoint)return doc.history=(doc.history||[]).filter(function(item){return item.session_id!==session}),doc.history.unshift({last_seq:checkpoint,session_id:session}),doc.history=doc.history.slice(0,CHECKPOINT_HISTORY_SIZE),doc.version=CHECKPOINT_VERSION,doc.replicator=REPLICATOR,doc.session_id=session,doc.last_seq=checkpoint,db.put(doc).catch(function(err){if(409===err.status)return updateCheckpoint(db,id,checkpoint,session,returnValue);throw err})})}function Checkpointer(src,target,id,returnValue,opts){this.src=src,this.target=target,this.id=id,this.returnValue=returnValue,this.opts=opts||{}}Checkpointer.prototype.writeCheckpoint=function(checkpoint,session){var self=this;return this.updateTarget(checkpoint,session).then(function(){return self.updateSource(checkpoint,session)})},Checkpointer.prototype.updateTarget=function(checkpoint,session){return this.opts.writeTargetCheckpoint?updateCheckpoint(this.target,this.id,checkpoint,session,this.returnValue):PouchPromise.resolve(!0)},Checkpointer.prototype.updateSource=function(checkpoint,session){if(this.opts.writeSourceCheckpoint){var self=this;return updateCheckpoint(this.src,this.id,checkpoint,session,this.returnValue).catch(function(err){if(isForbiddenError(err))return!(self.opts.writeSourceCheckpoint=!1);throw err})}return PouchPromise.resolve(!0)};var comparisons={undefined:function(targetDoc,sourceDoc){return 0===collate(targetDoc.last_seq,sourceDoc.last_seq)?sourceDoc.last_seq:0},1:function(targetDoc,sourceDoc){return function(srcDoc,tgtDoc){return srcDoc.session_id!==tgtDoc.session_id?function compareReplicationHistory(sourceHistory,targetHistory){var S=sourceHistory[0];var sourceRest=sourceHistory.slice(1);var T=targetHistory[0];var targetRest=targetHistory.slice(1);if(!S||0===targetHistory.length)return{last_seq:LOWEST_SEQ,history:[]};var sourceId=S.session_id;if(hasSessionId(sourceId,targetHistory))return{last_seq:S.last_seq,history:sourceHistory};var targetId=T.session_id;if(hasSessionId(targetId,sourceRest))return{last_seq:T.last_seq,history:targetRest};return compareReplicationHistory(sourceRest,targetRest)}(srcDoc.history,tgtDoc.history):{last_seq:srcDoc.last_seq,history:srcDoc.history}}(sourceDoc,targetDoc).last_seq}};function hasSessionId(sessionId,history){var props=history[0],rest=history.slice(1);return!(!sessionId||0===history.length)&&(sessionId===props.session_id||hasSessionId(sessionId,rest))}function isForbiddenError(err){return"number"==typeof err.status&&4===Math.floor(err.status/100)}Checkpointer.prototype.getCheckpoint=function(){var self=this;return self.opts&&self.opts.writeSourceCheckpoint&&!self.opts.writeTargetCheckpoint?self.src.get(self.id).then(function(sourceDoc){return sourceDoc.last_seq||LOWEST_SEQ}).catch(function(err){if(404!==err.status)throw err;return LOWEST_SEQ}):self.target.get(self.id).then(function(targetDoc){return self.opts&&self.opts.writeTargetCheckpoint&&!self.opts.writeSourceCheckpoint?targetDoc.last_seq||LOWEST_SEQ:self.src.get(self.id).then(function(sourceDoc){return targetDoc.version!==sourceDoc.version?LOWEST_SEQ:(version=targetDoc.version?targetDoc.version.toString():"undefined")in comparisons?comparisons[version](targetDoc,sourceDoc):LOWEST_SEQ;var version},function(err){if(404===err.status&&targetDoc.last_seq)return self.src.put({_id:self.id,last_seq:LOWEST_SEQ}).then(function(){return LOWEST_SEQ},function(err){return isForbiddenError(err)?(self.opts.writeSourceCheckpoint=!1,targetDoc.last_seq):LOWEST_SEQ});throw err})}).catch(function(err){if(404!==err.status)throw err;return LOWEST_SEQ})};var STARTING_BACK_OFF=0;function generateReplicationId(src,target,opts){var docIds=opts.doc_ids?opts.doc_ids.sort(collate):"",filterFun=opts.filter?opts.filter.toString():"",queryParams="",filterViewName="",selector="";return opts.selector&&(selector=JSON.stringify(opts.selector)),opts.filter&&opts.query_params&&(queryParams=JSON.stringify(function(queryParams){return Object.keys(queryParams).sort(collate).reduce(function(result,key){return result[key]=queryParams[key],result},{})}(opts.query_params))),opts.filter&&"_view"===opts.filter&&(filterViewName=opts.view.toString()),PouchPromise.all([src.id(),target.id()]).then(function(res){var queryData=res[0]+res[1]+filterFun+filterViewName+queryParams+docIds+selector;return new PouchPromise(function(resolve){binaryMd5(queryData,resolve)})}).then(function(md5sum){return"_local/"+(md5sum=md5sum.replace(/\//g,".").replace(/\+/g,"_"))})}function replicate(src,target,opts,returnValue,result){var currentBatch,repId,checkpointer,batches=[],pendingBatch={seq:0,changes:[],docs:[]},writingCheckpoint=!1,changesCompleted=!1,replicationCompleted=!1,last_seq=0,continuous=opts.continuous||opts.live||!1,batch_size=opts.batch_size||100,batches_limit=opts.batches_limit||10,changesPending=!1,doc_ids=opts.doc_ids,selector=opts.selector,changedDocs=[],session=uuid(),seq_interval=opts.seq_interval;result=result||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var changesOpts={};function initCheckpointer(){return checkpointer?PouchPromise.resolve():generateReplicationId(src,target,opts).then(function(res){repId=res;var checkpointOpts={};checkpointOpts=!1===opts.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===opts.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===opts.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},checkpointer=new Checkpointer(src,target,repId,returnValue,checkpointOpts)})}function writeDocs(){if(changedDocs=[],0!==currentBatch.docs.length){var docs=currentBatch.docs,bulkOpts={timeout:opts.timeout};return target.bulkDocs({docs:docs,new_edits:!1},bulkOpts).then(function(res){if(returnValue.cancelled)throw completeReplication(),new Error("cancelled");var errorsById=Object.create(null);res.forEach(function(res){res.error&&(errorsById[res.id]=res)});var errorsNo=Object.keys(errorsById).length;result.doc_write_failures+=errorsNo,result.docs_written+=docs.length-errorsNo,docs.forEach(function(doc){var error=errorsById[doc._id];if(error){result.errors.push(error);var errorName=(error.name||"").toLowerCase();if("unauthorized"!==errorName&&"forbidden"!==errorName)throw error;returnValue.emit("denied",clone(error))}else changedDocs.push(doc)})},function(err){throw result.doc_write_failures+=docs.length,err})}}function finishBatch(){if(currentBatch.error)throw new Error("There was a problem getting docs.");result.last_seq=last_seq=currentBatch.seq;var outResult=clone(result);return changedDocs.length&&(outResult.docs=changedDocs,"number"==typeof currentBatch.pending&&(outResult.pending=currentBatch.pending,delete currentBatch.pending),returnValue.emit("change",outResult)),writingCheckpoint=!0,checkpointer.writeCheckpoint(currentBatch.seq,session).then(function(){if(writingCheckpoint=!1,returnValue.cancelled)throw completeReplication(),new Error("cancelled");currentBatch=void 0,getChanges()}).catch(function(err){throw onCheckpointError(err),err})}function getBatchDocs(){return getDocs(src,target,currentBatch.diffs,returnValue).then(function(got){currentBatch.error=!got.ok,got.docs.forEach(function(doc){delete currentBatch.diffs[doc._id],result.docs_read++,currentBatch.docs.push(doc)})})}function startNextBatch(){returnValue.cancelled||currentBatch||(0!==batches.length?(currentBatch=batches.shift(),function(){var diff={};return currentBatch.changes.forEach(function(change){"_user/"!==change.id&&(diff[change.id]=change.changes.map(function(x){return x.rev}))}),target.revsDiff(diff).then(function(diffs){if(returnValue.cancelled)throw completeReplication(),new Error("cancelled");currentBatch.diffs=diffs})}().then(getBatchDocs).then(writeDocs).then(finishBatch).then(startNextBatch).catch(function(err){abortReplication("batch processing terminated with error",err)})):processPendingBatch(!0))}function processPendingBatch(immediate){0!==pendingBatch.changes.length?(immediate||changesCompleted||pendingBatch.changes.length>=batch_size)&&(batches.push(pendingBatch),pendingBatch={seq:0,changes:[],docs:[]},"pending"!==returnValue.state&&"stopped"!==returnValue.state||(returnValue.state="active",returnValue.emit("active")),startNextBatch()):0!==batches.length||currentBatch||((continuous&&changesOpts.live||changesCompleted)&&(returnValue.state="pending",returnValue.emit("paused")),changesCompleted&&completeReplication())}function abortReplication(reason,err){replicationCompleted||(err.message||(err.message=reason),result.ok=!1,result.status="aborting",batches=[],pendingBatch={seq:0,changes:[],docs:[]},completeReplication(err))}function completeReplication(fatalError){if(!(replicationCompleted||returnValue.cancelled&&(result.status="cancelled",writingCheckpoint)))if(result.status=result.status||"complete",result.end_time=new Date,result.last_seq=last_seq,replicationCompleted=!0,fatalError){(fatalError=createError(fatalError)).result=result;var errorName=(fatalError.name||"").toLowerCase();"unauthorized"===errorName||"forbidden"===errorName?(returnValue.emit("error",fatalError),returnValue.removeAllListeners()):function(opts,returnValue,error,callback){if(!1===opts.retry)return returnValue.emit("error",error),returnValue.removeAllListeners();if("function"!=typeof opts.back_off_function&&(opts.back_off_function=defaultBackOff),returnValue.emit("requestError",error),"active"===returnValue.state||"pending"===returnValue.state){returnValue.emit("paused",error),returnValue.state="stopped";var backOffSet=function(){opts.current_back_off=STARTING_BACK_OFF};returnValue.once("paused",function(){returnValue.removeListener("active",backOffSet)}),returnValue.once("active",backOffSet)}opts.current_back_off=opts.current_back_off||STARTING_BACK_OFF,opts.current_back_off=opts.back_off_function(opts.current_back_off),setTimeout(callback,opts.current_back_off)}(opts,returnValue,fatalError,function(){replicate(src,target,opts,returnValue)})}else returnValue.emit("complete",result),returnValue.removeAllListeners()}function onChange(change,pending,lastSeq){if(returnValue.cancelled)return completeReplication();"number"==typeof pending&&(pendingBatch.pending=pending),filterChange(opts)(change)&&(pendingBatch.seq=change.seq||lastSeq,pendingBatch.changes.push(change),processPendingBatch(0===batches.length&&changesOpts.live))}function onChangesComplete(changes){if(changesPending=!1,returnValue.cancelled)return completeReplication();if(0<changes.results.length)changesOpts.since=changes.last_seq,getChanges(),processPendingBatch(!0);else{var complete=function(){continuous?(changesOpts.live=!0,getChanges()):changesCompleted=!0,processPendingBatch(!0)};currentBatch||0!==changes.results.length?complete():(writingCheckpoint=!0,checkpointer.writeCheckpoint(changes.last_seq,session).then(function(){writingCheckpoint=!1,result.last_seq=last_seq=changes.last_seq,complete()}).catch(onCheckpointError))}}function onChangesError(err){if(changesPending=!1,returnValue.cancelled)return completeReplication();abortReplication("changes rejected",err)}function getChanges(){if(!changesPending&&!changesCompleted&&batches.length<batches_limit){changesPending=!0,returnValue._changes&&(returnValue.removeListener("cancel",returnValue._abortChanges),returnValue._changes.cancel()),returnValue.once("cancel",abortChanges);var changes=src.changes(changesOpts).on("change",onChange);changes.then(removeListener,removeListener),changes.then(onChangesComplete).catch(onChangesError),opts.retry&&(returnValue._changes=changes,returnValue._abortChanges=abortChanges)}function abortChanges(){changes.cancel()}function removeListener(){returnValue.removeListener("cancel",abortChanges)}}function startChanges(){initCheckpointer().then(function(){if(!returnValue.cancelled)return checkpointer.getCheckpoint().then(function(checkpoint){!(changesOpts={since:last_seq=checkpoint,limit:batch_size,batch_size:batch_size,style:"all_docs",doc_ids:doc_ids,selector:selector,return_docs:!0})!==seq_interval&&(changesOpts.seq_interval=seq_interval||batch_size),opts.filter&&("string"!=typeof opts.filter?changesOpts.include_docs=!0:changesOpts.filter=opts.filter),"heartbeat"in opts&&(changesOpts.heartbeat=opts.heartbeat),"timeout"in opts&&(changesOpts.timeout=opts.timeout),opts.query_params&&(changesOpts.query_params=opts.query_params),opts.view&&(changesOpts.view=opts.view),getChanges()});completeReplication()}).catch(function(err){abortReplication("getCheckpoint rejected with ",err)})}function onCheckpointError(err){writingCheckpoint=!1,abortReplication("writeCheckpoint completed with error",err)}returnValue.ready(src,target),returnValue.cancelled?completeReplication():(returnValue._addedListeners||(returnValue.once("cancel",completeReplication),"function"==typeof opts.complete&&(returnValue.once("error",opts.complete),returnValue.once("complete",function(result){opts.complete(null,result)})),returnValue._addedListeners=!0),void 0===opts.since?startChanges():initCheckpointer().then(function(){return writingCheckpoint=!0,checkpointer.writeCheckpoint(opts.since,session)}).then(function(){writingCheckpoint=!1,returnValue.cancelled?completeReplication():(last_seq=opts.since,startChanges())}).catch(onCheckpointError))}function Replication(){events.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var self=this,promise=new PouchPromise(function(fulfill,reject){self.once("complete",fulfill),self.once("error",reject)});self.then=function(resolve,reject){return promise.then(resolve,reject)},self.catch=function(reject){return promise.catch(reject)},self.catch(function(){})}function toPouch(db,opts){var PouchConstructor=opts.PouchConstructor;return"string"==typeof db?new PouchConstructor(db,opts):db}function replicateWrapper(src,target,opts,callback){if("function"==typeof opts&&(callback=opts,opts={}),void 0===opts&&(opts={}),opts.doc_ids&&!Array.isArray(opts.doc_ids))throw createError(BAD_REQUEST,"`doc_ids` filter parameter is not a list.");opts.complete=callback,(opts=clone(opts)).continuous=opts.continuous||opts.live,opts.retry="retry"in opts&&opts.retry,opts.PouchConstructor=opts.PouchConstructor||this;var replicateRet=new Replication(opts);return replicate(toPouch(src,opts),toPouch(target,opts),opts,replicateRet),replicateRet}function sync$1(src,target,opts,callback){return"function"==typeof opts&&(callback=opts,opts={}),void 0===opts&&(opts={}),(opts=clone(opts)).PouchConstructor=opts.PouchConstructor||this,new Sync(src=toPouch(src,opts),target=toPouch(target,opts),opts,callback)}function Sync(src,target,opts,callback){var self=this;this.canceled=!1;var optsPush=opts.push?$inject_Object_assign({},opts,opts.push):opts,optsPull=opts.pull?$inject_Object_assign({},opts,opts.pull):opts;function pullChange(change){self.emit("change",{direction:"pull",change:change})}function pushChange(change){self.emit("change",{direction:"push",change:change})}function pushDenied(doc){self.emit("denied",{direction:"push",doc:doc})}function pullDenied(doc){self.emit("denied",{direction:"pull",doc:doc})}function pushPaused(){self.pushPaused=!0,self.pullPaused&&self.emit("paused")}function pullPaused(){self.pullPaused=!0,self.pushPaused&&self.emit("paused")}function pushActive(){self.pushPaused=!1,self.pullPaused&&self.emit("active",{direction:"push"})}function pullActive(){self.pullPaused=!1,self.pushPaused&&self.emit("active",{direction:"pull"})}this.push=replicateWrapper(src,target,optsPush),this.pull=replicateWrapper(target,src,optsPull),this.pushPaused=!0,this.pullPaused=!0;var removed={};function removeAll(type){return function(event,func){("change"!==event||func!==pullChange&&func!==pushChange)&&("denied"!==event||func!==pullDenied&&func!==pushDenied)&&("paused"!==event||func!==pullPaused&&func!==pushPaused)&&("active"!==event||func!==pullActive&&func!==pushActive)||(event in removed||(removed[event]={}),removed[event][type]=!0,2===Object.keys(removed[event]).length&&self.removeAllListeners(event))}}function addOneListener(ee,event,listener){-1==ee.listeners(event).indexOf(listener)&&ee.on(event,listener)}opts.live&&(this.push.on("complete",self.pull.cancel.bind(self.pull)),this.pull.on("complete",self.push.cancel.bind(self.push))),this.on("newListener",function(event){"change"===event?(addOneListener(self.pull,"change",pullChange),addOneListener(self.push,"change",pushChange)):"denied"===event?(addOneListener(self.pull,"denied",pullDenied),addOneListener(self.push,"denied",pushDenied)):"active"===event?(addOneListener(self.pull,"active",pullActive),addOneListener(self.push,"active",pushActive)):"paused"===event&&(addOneListener(self.pull,"paused",pullPaused),addOneListener(self.push,"paused",pushPaused))}),this.on("removeListener",function(event){"change"===event?(self.pull.removeListener("change",pullChange),self.push.removeListener("change",pushChange)):"denied"===event?(self.pull.removeListener("denied",pullDenied),self.push.removeListener("denied",pushDenied)):"active"===event?(self.pull.removeListener("active",pullActive),self.push.removeListener("active",pushActive)):"paused"===event&&(self.pull.removeListener("paused",pullPaused),self.push.removeListener("paused",pushPaused))}),this.pull.on("removeListener",removeAll("pull")),this.push.on("removeListener",removeAll("push"));var promise=PouchPromise.all([this.push,this.pull]).then(function(resp){var out={push:resp[0],pull:resp[1]};return self.emit("complete",out),callback&&callback(null,out),self.removeAllListeners(),out},function(err){if(self.cancel(),callback?callback(err):self.emit("error",err),self.removeAllListeners(),callback)throw err});this.then=function(success,err){return promise.then(success,err)},this.catch=function(err){return promise.catch(err)}}inherits(Replication,events.EventEmitter),Replication.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},Replication.prototype.ready=function(src,target){var self=this;function onDestroy(){self.cancel()}self._readyCalled||(self._readyCalled=!0,src.once("destroyed",onDestroy),target.once("destroyed",onDestroy),self.once("complete",function(){src.removeListener("destroyed",onDestroy),target.removeListener("destroyed",onDestroy)}))},inherits(Sync,events.EventEmitter),Sync.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},PouchDB.plugin(function(PouchDB){PouchDB.adapter("idb",IdbPouch,!0)}).plugin(function(PouchDB){PouchDB.adapter("websql",WebSQLPouch,!0)}).plugin(function(PouchDB){PouchDB.adapter("http",HttpPouch,!1),PouchDB.adapter("https",HttpPouch,!1)}).plugin(mapreduce).plugin(function(PouchDB){PouchDB.replicate=replicateWrapper,PouchDB.sync=sync$1,Object.defineProperty(PouchDB.prototype,"replicate",{get:function(){var self=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(other,opts,callback){return self.constructor.replicate(other,self,opts,callback)},to:function(other,opts,callback){return self.constructor.replicate(self,other,opts,callback)}}),this.replicateMethods}}),PouchDB.prototype.sync=function(dbName,opts,callback){return this.constructor.sync(this,dbName,opts,callback)}}),module.exports=PouchDB}).call(this,__webpack_require__(16))},,,,,function(module,exports,__webpack_require__){"use strict";(function(global){var scheduleDrain,draining,Mutation=global.MutationObserver||global.WebKitMutationObserver;if(Mutation){var called=0,observer=new Mutation(nextTick),element=global.document.createTextNode("");observer.observe(element,{characterData:!0}),scheduleDrain=function(){element.data=called=++called%2}}else if(global.setImmediate||void 0===global.MessageChannel)scheduleDrain="document"in global&&"onreadystatechange"in global.document.createElement("script")?function(){var scriptEl=global.document.createElement("script");scriptEl.onreadystatechange=function(){nextTick(),scriptEl.onreadystatechange=null,scriptEl.parentNode.removeChild(scriptEl),scriptEl=null},global.document.documentElement.appendChild(scriptEl)}:function(){setTimeout(nextTick,0)};else{var channel=new global.MessageChannel;channel.port1.onmessage=nextTick,scheduleDrain=function(){channel.port2.postMessage(0)}}var queue=[];function nextTick(){var i,oldQueue;draining=!0;for(var len=queue.length;len;){for(oldQueue=queue,queue=[],i=-1;++i<len;)oldQueue[i]();len=queue.length}draining=!1}module.exports=function(task){1!==queue.push(task)||draining||scheduleDrain()}}).call(this,__webpack_require__(16))},,,,,,function(module){module.exports=JSON.parse('{"maps":[{"tiles":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"],"name":"streets","attribution":"Â© <a href=\\"http://openstreetmap.org\\">OpenStreetMap</a> | <a href=\\"www.openstreetmap.org/copyright\\">Terms</a>"},{"tiles":"GOOGLE_SATELLITE","name":"satellite"}],"googleApiKey":"","repeatOrdinals":false,"validateContinuously":false,"validatePage":false,"swipePage":true,"arcGis":{"jsUrl":"","cssUrl":"","webMapId":"","hasZ":true,"basemaps":["streets"]}}')},function(module,exports,__webpack_require__){"use strict";module.exports=function(fn,thisArg){return function(){for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];return fn.apply(thisArg,args)}}},function(module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8),settle=__webpack_require__(139),buildURL=__webpack_require__(141),parseHeaders=__webpack_require__(142),isURLSameOrigin=__webpack_require__(143),createError=__webpack_require__(75);module.exports=function(config){return new Promise(function(resolve,reject){var requestData=config.data,requestHeaders=config.headers;utils.isFormData(requestData)&&delete requestHeaders["Content-Type"];var request=new XMLHttpRequest;if(config.auth){var username=config.auth.username||"",password=config.auth.password||"";requestHeaders.Authorization="Basic "+btoa(username+":"+password)}if(request.open(config.method.toUpperCase(),buildURL(config.url,config.params,config.paramsSerializer),!0),request.timeout=config.timeout,request.onreadystatechange=function(){if(request&&4===request.readyState&&(0!==request.status||request.responseURL&&0===request.responseURL.indexOf("file:"))){var responseHeaders="getAllResponseHeaders"in request?parseHeaders(request.getAllResponseHeaders()):null,response={data:config.responseType&&"text"!==config.responseType?request.response:request.responseText,status:request.status,statusText:request.statusText,headers:responseHeaders,config:config,request:request};settle(resolve,reject,response),request=null}},request.onerror=function(){reject(createError("Network Error",config,null,request)),request=null},request.ontimeout=function(){reject(createError("timeout of "+config.timeout+"ms exceeded",config,"ECONNABORTED",request)),request=null},utils.isStandardBrowserEnv()){var cookies=__webpack_require__(144),xsrfValue=(config.withCredentials||isURLSameOrigin(config.url))&&config.xsrfCookieName?cookies.read(config.xsrfCookieName):void 0;xsrfValue&&(requestHeaders[config.xsrfHeaderName]=xsrfValue)}if("setRequestHeader"in request&&utils.forEach(requestHeaders,function(val,key){void 0===requestData&&"content-type"===key.toLowerCase()?delete requestHeaders[key]:request.setRequestHeader(key,val)}),config.withCredentials&&(request.withCredentials=!0),config.responseType)try{request.responseType=config.responseType}catch(e){if("json"!==config.responseType)throw e}"function"==typeof config.onDownloadProgress&&request.addEventListener("progress",config.onDownloadProgress),"function"==typeof config.onUploadProgress&&request.upload&&request.upload.addEventListener("progress",config.onUploadProgress),config.cancelToken&&config.cancelToken.promise.then(function(cancel){request&&(request.abort(),reject(cancel),request=null)}),void 0===requestData&&(requestData=null),request.send(requestData)})}},function(module,exports,__webpack_require__){"use strict";var enhanceError=__webpack_require__(140);module.exports=function(message,config,code,request,response){var error=new Error(message);return enhanceError(error,config,code,request,response)}},function(module,exports,__webpack_require__){"use strict";module.exports=function(value){return!(!value||!value.__CANCEL__)}},function(module,exports,__webpack_require__){"use strict";function Cancel(message){this.message=message}Cancel.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},Cancel.prototype.__CANCEL__=!0,module.exports=Cancel},function(module,exports){var getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);module.exports=function(){return getRandomValues(rnds8),rnds8}}else{var rnds=new Array(16);module.exports=function(){for(var r,i=0;i<16;i++)0==(3&i)&&(r=4294967296*Math.random()),rnds[i]=r>>>((3&i)<<3)&255;return rnds}}},function(module,exports){for(var byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);module.exports=function(buf,offset){var i=offset||0,bth=byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}},,,,,,,,,,,,,,,function(module,exports,__webpack_require__){var lodashSet=__webpack_require__(128);module.exports={get:function(obj,path,def){return path.replace(/\[/g,".").replace(/]/g,"").split(".").filter(Boolean).every(function(step){return!(step&&void 0===(obj=obj[step]))})?obj:def},set:lodashSet}},function(module,exports,__webpack_require__){function Dropdown(element){$(element).on("click.bs.dropdown",this.toggle)}var $=__webpack_require__(2),toggle="[data-toggle=dropdown]";function clearMenus(e){$(".dropdown-backdrop").remove(),$(toggle).each(function(){var $parent=getParent($(this)),relatedTarget={relatedTarget:this};$parent.hasClass("open")&&($parent.trigger(e=$.Event("hide.bs.dropdown",relatedTarget)),e.isDefaultPrevented()||$parent.removeClass("open").trigger("hidden.bs.dropdown",relatedTarget))})}function getParent($this){var selector=$this.attr("data-target"),$parent=(selector=selector||(selector=$this.attr("href"))&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,""))&&$(selector);return $parent&&$parent.length?$parent:$this.parent()}Dropdown.prototype.toggle=function(e){var $this=$(this);if(!$this.is(".disabled, :disabled")){var $parent=getParent($this),isActive=$parent.hasClass("open");if(clearMenus(),!isActive){"ontouchstart"in document.documentElement&&!$parent.closest(".navbar-nav").length&&$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on("click",clearMenus);var relatedTarget={relatedTarget:this};if($parent.trigger(e=$.Event("show.bs.dropdown",relatedTarget)),e.isDefaultPrevented())return;$parent.toggleClass("open").trigger("shown.bs.dropdown",relatedTarget),$this.focus()}return!1}},Dropdown.prototype.keydown=function(e){if(/^(38|40|27)$/.test(e.keyCode)){var $this=$(this);if(e.preventDefault(),e.stopPropagation(),!$this.is(".disabled, :disabled")){var $parent=getParent($this),isActive=$parent.hasClass("open");if(!isActive||isActive&&27===e.keyCode)return 27===e.which&&$parent.find(toggle).focus(),$this.click();var desc=" li:not(.divider):visible a",$items=$parent.find("[role=menu]"+desc+", [role=listbox]"+desc);if($items.length){var index=$items.index($items.filter(":focus"));38===e.keyCode&&0<index&&index--,40===e.keyCode&&index<$items.length-1&&index++,~index||(index=0),$items.eq(index).focus()}}}};var old=$.fn.dropdown;$.fn.dropdown=function(option){return this.each(function(){var $this=$(this),data=$this.data("bs.dropdown");data||$this.data("bs.dropdown",new Dropdown(this)),"string"==typeof option&&data[option].call($this)})},$.fn.dropdown.Constructor=Dropdown,$.fn.dropdown.noConflict=function(){return $.fn.dropdown=old,this},$(document).on("click.bs.dropdown.data-api",clearMenus).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.bs.dropdown.data-api",toggle+", [role=menu], [role=listbox]",Dropdown.prototype.keydown)},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){window.$=window.jQuery=__webpack_require__(2)},function(module,exports,__webpack_require__){var en=__webpack_require__(125),lo=__webpack_require__(126),zh=__webpack_require__(127),_=__webpack_require__(94),Cookies_set=function(key,value){window.localStorage.setItem(key,value)},Cookies_get=function(key){return window.localStorage.getItem(key)},i18n={},languages={en:en,lo:lo,zh:zh},fallback=en;i18n.set=function(language){languages.hasOwnProperty(language)?(this.language=language,this.translations=languages[language],this.translateDocument(),Cookies_set("language",this.language)):console.error("Language not found: "+language)},i18n.get=function(){return this.language},i18n._=function(key,bindings){null==bindings&&(bindings={});var t=_.get(this.translations,key,_.get(fallback,key,""));for(var key in bindings)t=t.replace(new RegExp(":"+key,"g"),bindings[key]);return t},i18n.translateDocument=function(){for(var matches=document.querySelectorAll("[data-i18n]"),i=0;i<matches.length;i++){var el=matches[i],key=el.getAttribute("data-i18n"),translation=this._(key);el.innerHTML=translation}},document.onreadystatechange=function(){var language=Cookies_get("language");null==language&&(language="en"),i18n.set(language)},window.i18n=i18n,module.exports=i18n},function(module,exports){module.exports={index:{upload:"Upload"},survey:{loading:"Loading Survey!",wait:"This will take a few moments...",errors:"Form contains errors, please fix all errors before submitting.",saved:"Active session has been saved",camera:"Camera",save:"Save",validate:"Validate",first:"First",last:"Last",jump_to:"Jump To",submit:"Validate &amp; Submit",back:"Back",next:"Next"},session:{title:"Survey Session",description:"Start a New Session",name:"Name this Session",start:"Start"},constraint:{required:"This field is required.",invalid:"Value not allowed"},submissions:{back:"Back",upload_all:"Upload All",upload_single:"Upload This",title:"Upload Surveys",uploaded:"Uploaded!",name:"Name",hint:"Hint",size:"Size",created_at:"Created At",error:"An error occured while trying to submit packet named :packet",success:"Packet named :packet has been submitted!"}}},function(module,exports){module.exports={index:{upload:"àº­àº±àºà»àº«àº¥àº"},survey:{loading:"àºà»àº²àº¥àº±àºà»àº«àº¥àº",wait:"àº¥à»àºà»àº²",errors:"àºàº´àºàºàº²àº",saved:"àºàº±àºàºàº¶àºà»àº§à»à»àº¥à»àº§",camera:"àºà»àº­àºàºà»àº²àºàº®àº¹àº",save:"àºàº±àºàºàº¶àº",validate:"àºàº§àºàºªàº­àº",first:"àº«àºà»àº²àºà»àº²àº­àº´àº",last:"à»à»àº²àºªàº¸àºàºà»àº²àº",jump_to:"àºàº»à»àºàº«àº²",submit:"àºªàº»à»àºàºà»à»àº¡àº¹àº",back:"àºàº±àºàºàº·àºà»àºàºà»àº­àºà»àºàº»à»àº²",next:"àºà»à»à»àº"},session:{title:"àº«àº»àº§àºà»à»",description:"àº¥àº²àºàº¥àº°àº­àº½àº",name:"àºàº·à»",start:"à»àº¥àºµà»àº¡àºàº»à»àº"},constraint:{required:"àºà»àº­àºàºàº²àº",invalid:"àºà»à»àºàº·àºàºà»àº­àº"},submissions:{back:"Back",upload_all:"àº­àº±àºà»àº«àº¥àºàºàº±àºàº«àº¡àº»àº",upload_single:"àº­àº±àºà»àº«àº¥àº",title:"àº¢àº¹à»àº¥àº°àº«àº§à»àº²àºàºàº²àºàºªàº»à»àºàºà»à»àº¡àº¹àº",uploaded:"àº­àº±àº!",name:"àºàº·à»",hint:"Hint",size:"àºàº°àº«àºàº²àº",created_at:"àºàº°àºàº´àºàºªà»àº²àºàºàº·à»àºà»àº",error:"àºàº´àºàºàº²àº :packet",success:"àºªà»àº²à»àº¥àº±àº :packet àºàº¸àº"}}},function(module,exports){module.exports={index:{upload:"ä¸ä¼ "},survey:{loading:"å è½½é®å·ï¼",wait:"éè¦ä¸äºæ¶é´...",errors:"è¡¨ååå«éè¯¯ï¼è¯·å¨æäº¤ä¹åä¿®å¤ææéè¯¯ã",saved:"å·²ä¿å­æä½",camera:"ç¸æº",save:"ä¿å­",validate:"ç¡®è®¤",first:"é¦é¡µ",last:"æ«é¡µ",search:"æç´¢",submit:"ç¡®è®¤å¹¶æäº¤",back:"è¿å",next:"ä¸ä¸é¡µ"},session:{title:"é®å·è°æ¥ä¼è¯",description:"å¼å§ä¸ä¸ªæ°çä¼è¯",name:"ä¼è¯å½å",start:"å¼å§"},constraint:{required:"æ­¤å­æ®µå¿å¡«.",invalid:"å¼ä¸å¯ç¨"},submissions:{upload_all:"ä¸ä¼ ææ",upload_single:"ä¸ä¼ æ­¤æ¬¡æ°æ®",title:"ç³è¯·æ°æ®æäº¤",uploaded:"ä¸ä¼ å®æï¼",name:"åç§°",hint:"æç¤º",size:"å¤§å°",created_at:"åå»ºäº",error:"è¯å¾æäº¤åä¸º:packetçæ°æ®åæ¶åºéã",success:"åå:packetå·²æäº¤ï¼"}}},function(module,exports,__webpack_require__){(function(global){var FUNC_ERROR_TEXT="Expected a function",INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]",reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,reLeadingDot=/^\./,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^(?:0|[1-9]\d*)$/,freeGlobal="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")();var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Symbol=root.Symbol,splice=arrayProto.splice,Map=getNative(root,"Map"),nativeCreate=getNative(Object,"create"),symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function Hash(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||(object[key]=value)}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseIsNative(value){return!(!isObject(value)||function(func){return!!maskSrcKey&&maskSrcKey in func}(value))&&(function(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}(value)||function(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}(value)?reIsNative:reIsHostCtor).test(function(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}(value))}function baseSet(object,path,value,customizer){if(!isObject(object))return object;for(var index=-1,length=(path=function(value,object){if(isArray(value))return!1;var type=typeof value;if("number"==type||"symbol"==type||"boolean"==type||null==value||isSymbol(value))return!0;return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object)}(path,object)?[path]:function(value){return isArray(value)?value:stringToPath(value)}(path)).length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];void 0===(newValue=customizer?customizer(objValue,key,nested):void 0)&&(newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object}function getMapData(map,key){var data=map.__data__;return function(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}(key)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=function(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}function isIndex(value,length){return!!(length=null==length?MAX_SAFE_INTEGER:length)&&("number"==typeof value||reIsUint.test(value))&&-1<value&&value%1==0&&value<length}Hash.prototype.clear=function(){this.__data__=nativeCreate?nativeCreate(null):{}},Hash.prototype.delete=function(key){return this.has(key)&&delete this.__data__[key]},Hash.prototype.get=function(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function(key,value){return this.__data__[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function(){this.__data__=[]},ListCache.prototype.delete=function(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),!0)},ListCache.prototype.get=function(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function(key){return-1<assocIndexOf(this.__data__,key)},ListCache.prototype.set=function(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?data.push([key,value]):data[index][1]=value,this},MapCache.prototype.clear=function(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function(key){return getMapData(this,key).delete(key)},MapCache.prototype.get=function(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function(key,value){return getMapData(this,key).set(key,value),this};var stringToPath=memoize(function(string){string=function(value){return null==value?"":function(value){if("string"==typeof value)return value;if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}(value)}(string);var result=[];return reLeadingDot.test(string)&&result.push(""),string.replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)}),result});function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}function memoize(func,resolver){if("function"!=typeof func||resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result),result};return memoized.cache=new(memoize.Cache||MapCache),memoized}function eq(value,other){return value===other||value!=value&&other!=other}memoize.Cache=MapCache;var isArray=Array.isArray;function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function isSymbol(value){return"symbol"==typeof value||function(value){return!!value&&"object"==typeof value}(value)&&objectToString.call(value)==symbolTag}module.exports=function(object,path,value){return null==object?object:baseSet(object,path,value)}}).call(this,__webpack_require__(16))},function(module,exports){module.exports=function(){throw new Error("define cannot be used indirect")}},function(module,exports){
/**
 * @license AngularJS v1.7.4
 * (c) 2010-2018 Google, Inc. http://angularjs.org
 * License: MIT
 */
!function(window){"use strict";var minErrConfig={objectMaxDepth:5,urlErrorParamsEnabled:!0};function errorHandlingConfig(config){if(!isObject(config))return minErrConfig;isDefined(config.objectMaxDepth)&&(minErrConfig.objectMaxDepth=isValidObjectMaxDepth(config.objectMaxDepth)?config.objectMaxDepth:NaN),isDefined(config.urlErrorParamsEnabled)&&isBoolean(config.urlErrorParamsEnabled)&&(minErrConfig.urlErrorParamsEnabled=config.urlErrorParamsEnabled)}function isValidObjectMaxDepth(maxDepth){return isNumber(maxDepth)&&0<maxDepth}function minErr(module,ErrorConstructor){ErrorConstructor=ErrorConstructor||Error;var url="https://errors.angularjs.org/1.7.4/",regex=url.replace(".","\\.")+"[\\s\\S]*",errRegExp=new RegExp(regex,"g");return function(){var paramPrefix,i,code=arguments[0],template=arguments[1],message="["+(module?module+":":"")+code+"] ",templateArgs=sliceArgs(arguments,2).map(function(arg){return toDebugString(arg,minErrConfig.objectMaxDepth)});if(message+=template.replace(/\{\d+\}/g,function(match){var index=+match.slice(1,-1);return index<templateArgs.length?templateArgs[index].replace(errRegExp,""):match}),message+="\n"+url+(module?module+"/":"")+code,minErrConfig.urlErrorParamsEnabled)for(i=0,paramPrefix="?";i<templateArgs.length;i++,paramPrefix="&")message+=paramPrefix+"p"+i+"="+encodeURIComponent(templateArgs[i]);return new ErrorConstructor(message)}}var msie,jqLite,jQuery,angularModule,REGEX_STRING_REGEXP=/^\/(.+)\/([a-z]*)$/,VALIDITY_STATE_PROPERTY="validity",hasOwnProperty=Object.prototype.hasOwnProperty,lowercase=function(string){return isString(string)?string.toLowerCase():string},uppercase=function(string){return isString(string)?string.toUpperCase():string},slice=[].slice,splice=[].splice,push=[].push,toString=Object.prototype.toString,getPrototypeOf=Object.getPrototypeOf,ngMinErr=minErr("ng"),angular=window.angular||(window.angular={}),uid=0;function isArrayLike(obj){if(null==obj||isWindow(obj))return!1;if(isArray(obj)||isString(obj)||jqLite&&obj instanceof jqLite)return!0;var length="length"in Object(obj)&&obj.length;return isNumber(length)&&(0<=length&&length-1 in obj||"function"==typeof obj.item)}function forEach(obj,iterator,context){var key,length;if(obj)if(isFunction(obj))for(key in obj)"prototype"!==key&&"length"!==key&&"name"!==key&&obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj);else if(isArray(obj)||isArrayLike(obj)){var isPrimitive="object"!=typeof obj;for(key=0,length=obj.length;key<length;key++)(isPrimitive||key in obj)&&iterator.call(context,obj[key],key,obj)}else if(obj.forEach&&obj.forEach!==forEach)obj.forEach(iterator,context,obj);else if(isBlankObject(obj))for(key in obj)iterator.call(context,obj[key],key,obj);else if("function"==typeof obj.hasOwnProperty)for(key in obj)obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj);else for(key in obj)hasOwnProperty.call(obj,key)&&iterator.call(context,obj[key],key,obj);return obj}function forEachSorted(obj,iterator,context){for(var keys=Object.keys(obj).sort(),i=0;i<keys.length;i++)iterator.call(context,obj[keys[i]],keys[i]);return keys}function reverseParams(iteratorFn){return function(value,key){iteratorFn(key,value)}}function nextUid(){return++uid}function setHashKey(obj,h){h?obj.$$hashKey=h:delete obj.$$hashKey}function baseExtend(dst,objs,deep){for(var h=dst.$$hashKey,i=0,ii=objs.length;i<ii;++i){var obj=objs[i];if(isObject(obj)||isFunction(obj))for(var keys=Object.keys(obj),j=0,jj=keys.length;j<jj;j++){var key=keys[j],src=obj[key];deep&&isObject(src)?isDate(src)?dst[key]=new Date(src.valueOf()):isRegExp(src)?dst[key]=new RegExp(src):src.nodeName?dst[key]=src.cloneNode(!0):isElement(src)?dst[key]=src.clone():(isObject(dst[key])||(dst[key]=isArray(src)?[]:{}),baseExtend(dst[key],[src],!0)):dst[key]=src}}return setHashKey(dst,h),dst}function extend(dst){return baseExtend(dst,slice.call(arguments,1),!1)}function merge(dst){return baseExtend(dst,slice.call(arguments,1),!0)}function toInt(str){return parseInt(str,10)}msie=window.document.documentMode;var isNumberNaN=Number.isNaN||function(num){return num!=num};function inherit(parent,extra){return extend(Object.create(parent),extra)}function noop(){}function identity($){return $}function valueFn(value){return function(){return value}}function hasCustomToString(obj){return isFunction(obj.toString)&&obj.toString!==toString}function isUndefined(value){return void 0===value}function isDefined(value){return void 0!==value}function isObject(value){return null!==value&&"object"==typeof value}function isBlankObject(value){return null!==value&&"object"==typeof value&&!getPrototypeOf(value)}function isString(value){return"string"==typeof value}function isNumber(value){return"number"==typeof value}function isDate(value){return"[object Date]"===toString.call(value)}function isArray(arr){return Array.isArray(arr)||arr instanceof Array}function isError(value){switch(toString.call(value)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return value instanceof Error}}function isFunction(value){return"function"==typeof value}function isRegExp(value){return"[object RegExp]"===toString.call(value)}function isWindow(obj){return obj&&obj.window===obj}function isScope(obj){return obj&&obj.$evalAsync&&obj.$watch}function isBoolean(value){return"boolean"==typeof value}function isPromiseLike(obj){return obj&&isFunction(obj.then)}noop.$inject=[],identity.$inject=[];var TYPED_ARRAY_REGEXP=/^\[object (?:Uint8|Uint8Clamped|Uint16|Uint32|Int8|Int16|Int32|Float32|Float64)Array]$/;var trim=function(value){return isString(value)?value.trim():value},escapeForRegexp=function(s){return s.replace(/([-()[\]{}+?*.$^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};function isElement(node){return!(!node||!(node.nodeName||node.prop&&node.attr&&node.find))}function nodeName_(element){return lowercase(element.nodeName||element[0]&&element[0].nodeName)}function includes(array,obj){return-1!==Array.prototype.indexOf.call(array,obj)}function arrayRemove(array,value){var index=array.indexOf(value);return 0<=index&&array.splice(index,1),index}function copy(source,destination,maxDepth){var stackSource=[],stackDest=[];if(maxDepth=isValidObjectMaxDepth(maxDepth)?maxDepth:NaN,destination){if(function(value){return value&&isNumber(value.length)&&TYPED_ARRAY_REGEXP.test(toString.call(value))}(destination)||function(obj){return"[object ArrayBuffer]"===toString.call(obj)}(destination))throw ngMinErr("cpta","Can't copy! TypedArray destination cannot be mutated.");if(source===destination)throw ngMinErr("cpi","Can't copy! Source and destination are identical.");return isArray(destination)?destination.length=0:forEach(destination,function(value,key){"$$hashKey"!==key&&delete destination[key]}),stackSource.push(source),stackDest.push(destination),copyRecurse(source,destination,maxDepth)}return copyElement(source,maxDepth);function copyRecurse(source,destination,maxDepth){if(--maxDepth<0)return"...";var key,h=destination.$$hashKey;if(isArray(source))for(var i=0,ii=source.length;i<ii;i++)destination.push(copyElement(source[i],maxDepth));else if(isBlankObject(source))for(key in source)destination[key]=copyElement(source[key],maxDepth);else if(source&&"function"==typeof source.hasOwnProperty)for(key in source)source.hasOwnProperty(key)&&(destination[key]=copyElement(source[key],maxDepth));else for(key in source)hasOwnProperty.call(source,key)&&(destination[key]=copyElement(source[key],maxDepth));return setHashKey(destination,h),destination}function copyElement(source,maxDepth){if(!isObject(source))return source;var index=stackSource.indexOf(source);if(-1!==index)return stackDest[index];if(isWindow(source)||isScope(source))throw ngMinErr("cpws","Can't copy! Making copies of Window or Scope instances is not supported.");var needsRecurse=!1,destination=function(source){switch(toString.call(source)){case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Float32Array]":case"[object Float64Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return new source.constructor(copyElement(source.buffer),source.byteOffset,source.length);case"[object ArrayBuffer]":if(source.slice)return source.slice(0);var copied=new ArrayBuffer(source.byteLength);return new Uint8Array(copied).set(new Uint8Array(source)),copied;case"[object Boolean]":case"[object Number]":case"[object String]":case"[object Date]":return new source.constructor(source.valueOf());case"[object RegExp]":var re=new RegExp(source.source,source.toString().match(/[^/]*$/)[0]);return re.lastIndex=source.lastIndex,re;case"[object Blob]":return new source.constructor([source],{type:source.type})}if(isFunction(source.cloneNode))return source.cloneNode(!0)}(source);return void 0===destination&&(destination=isArray(source)?[]:Object.create(getPrototypeOf(source)),needsRecurse=!0),stackSource.push(source),stackDest.push(destination),needsRecurse?copyRecurse(source,destination,maxDepth):destination}}function simpleCompare(a,b){return a===b||a!=a&&b!=b}function equals(o1,o2){if(o1===o2)return!0;if(null===o1||null===o2)return!1;if(o1!=o1&&o2!=o2)return!0;var length,key,keySet,t1=typeof o1;if(t1==typeof o2&&"object"==t1){if(!isArray(o1)){if(isDate(o1))return!!isDate(o2)&&simpleCompare(o1.getTime(),o2.getTime());if(isRegExp(o1))return!!isRegExp(o2)&&o1.toString()===o2.toString();if(isScope(o1)||isScope(o2)||isWindow(o1)||isWindow(o2)||isArray(o2)||isDate(o2)||isRegExp(o2))return!1;for(key in keySet=createMap(),o1)if("$"!==key.charAt(0)&&!isFunction(o1[key])){if(!equals(o1[key],o2[key]))return!1;keySet[key]=!0}for(key in o2)if(!(key in keySet)&&"$"!==key.charAt(0)&&isDefined(o2[key])&&!isFunction(o2[key]))return!1;return!0}if(!isArray(o2))return!1;if((length=o1.length)===o2.length){for(key=0;key<length;key++)if(!equals(o1[key],o2[key]))return!1;return!0}}return!1}var csp=function(){if(!isDefined(csp.rules)){var ngCspElement=window.document.querySelector("[ng-csp]")||window.document.querySelector("[data-ng-csp]");if(ngCspElement){var ngCspAttribute=ngCspElement.getAttribute("ng-csp")||ngCspElement.getAttribute("data-ng-csp");csp.rules={noUnsafeEval:!ngCspAttribute||-1!==ngCspAttribute.indexOf("no-unsafe-eval"),noInlineStyle:!ngCspAttribute||-1!==ngCspAttribute.indexOf("no-inline-style")}}else csp.rules={noUnsafeEval:function(){try{return new Function(""),!1}catch(e){return!0}}(),noInlineStyle:!1}}return csp.rules},jq=function(){if(isDefined(jq.name_))return jq.name_;var el,i,prefix,name,ii=ngAttrPrefixes.length;for(i=0;i<ii;++i)if(prefix=ngAttrPrefixes[i],el=window.document.querySelector("["+prefix.replace(":","\\:")+"jq]")){name=el.getAttribute(prefix+"jq");break}return jq.name_=name};function concat(array1,array2,index){return array1.concat(slice.call(array2,index))}function sliceArgs(args,startIndex){return slice.call(args,startIndex||0)}function bind(self,fn){var curryArgs=2<arguments.length?sliceArgs(arguments,2):[];return!isFunction(fn)||fn instanceof RegExp?fn:curryArgs.length?function(){return arguments.length?fn.apply(self,concat(curryArgs,arguments,0)):fn.apply(self,curryArgs)}:function(){return arguments.length?fn.apply(self,arguments):fn.call(self)}}function toJsonReplacer(key,value){var val=value;return"string"==typeof key&&"$"===key.charAt(0)&&"$"===key.charAt(1)?val=void 0:isWindow(value)?val="$WINDOW":value&&window.document===value?val="$DOCUMENT":isScope(value)&&(val="$SCOPE"),val}function toJson(obj,pretty){if(!isUndefined(obj))return isNumber(pretty)||(pretty=pretty?2:null),JSON.stringify(obj,toJsonReplacer,pretty)}function fromJson(json){return isString(json)?JSON.parse(json):json}var ALL_COLONS=/:/g;function timezoneToOffset(timezone,fallback){timezone=timezone.replace(ALL_COLONS,"");var requestedTimezoneOffset=Date.parse("Jan 01, 1970 00:00:00 "+timezone)/6e4;return isNumberNaN(requestedTimezoneOffset)?fallback:requestedTimezoneOffset}function addDateMinutes(date,minutes){return(date=new Date(date.getTime())).setMinutes(date.getMinutes()+minutes),date}function convertTimezoneToLocal(date,timezone,reverse){reverse=reverse?-1:1;var dateTimezoneOffset=date.getTimezoneOffset();return addDateMinutes(date,reverse*(timezoneToOffset(timezone,dateTimezoneOffset)-dateTimezoneOffset))}function startingTag(element){element=jqLite(element).clone().empty();var elemHtml=jqLite("<div></div>").append(element).html();try{return element[0].nodeType===NODE_TYPE_TEXT?lowercase(elemHtml):elemHtml.match(/^(<[^>]+>)/)[1].replace(/^<([\w-]+)/,function(match,nodeName){return"<"+lowercase(nodeName)})}catch(e){return lowercase(elemHtml)}}function tryDecodeURIComponent(value){try{return decodeURIComponent(value)}catch(e){}}function parseKeyValue(keyValue){var obj={};return forEach((keyValue||"").split("&"),function(keyValue){var splitPoint,key,val;keyValue&&(key=keyValue=keyValue.replace(/\+/g,"%20"),-1!==(splitPoint=keyValue.indexOf("="))&&(key=keyValue.substring(0,splitPoint),val=keyValue.substring(splitPoint+1)),isDefined(key=tryDecodeURIComponent(key))&&(val=!isDefined(val)||tryDecodeURIComponent(val),hasOwnProperty.call(obj,key)?isArray(obj[key])?obj[key].push(val):obj[key]=[obj[key],val]:obj[key]=val))}),obj}function encodeUriSegment(val){return encodeUriQuery(val,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function encodeUriQuery(val,pctEncodeSpaces){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,pctEncodeSpaces?"%20":"+")}var ngAttrPrefixes=["ng-","data-ng-","ng:","x-ng-"];var isAutoBootstrapAllowed=function(document){var script=document.currentScript;if(!script)return!0;if(!(script instanceof window.HTMLScriptElement||script instanceof window.SVGScriptElement))return!1;var attributes=script.attributes;return[attributes.getNamedItem("src"),attributes.getNamedItem("href"),attributes.getNamedItem("xlink:href")].every(function(src){if(!src)return!0;if(!src.value)return!1;var link=document.createElement("a");if(link.href=src.value,document.location.origin===link.origin)return!0;switch(link.protocol){case"http:":case"https:":case"ftp:":case"blob:":case"file:":case"data:":return!0;default:return!1}})}(window.document);function angularInit(element,bootstrap){var appElement,module,config={};if(forEach(ngAttrPrefixes,function(prefix){var name=prefix+"app";!appElement&&element.hasAttribute&&element.hasAttribute(name)&&(module=(appElement=element).getAttribute(name))}),forEach(ngAttrPrefixes,function(prefix){var candidate,name=prefix+"app";!appElement&&(candidate=element.querySelector("["+name.replace(":","\\:")+"]"))&&(module=(appElement=candidate).getAttribute(name))}),appElement){if(!isAutoBootstrapAllowed){try{window.console.error("AngularJS: disabling automatic bootstrap. <script> protocol indicates an extension, document.location.href does not match.")}catch(e){}return}config.strictDi=null!==function(element,ngAttr){var attr,i,ii=ngAttrPrefixes.length;for(i=0;i<ii;++i)if(attr=ngAttrPrefixes[i]+ngAttr,isString(attr=element.getAttribute(attr)))return attr;return null}(appElement,"strict-di"),bootstrap(appElement,module?[module]:[],config)}}function bootstrap(element,modules,config){isObject(config)||(config={});config=extend({strictDi:!1},config);function doBootstrap(){if((element=jqLite(element)).injector()){var tag=element[0]===window.document?"document":startingTag(element);throw ngMinErr("btstrpd","App already bootstrapped with this element '{0}'",tag.replace(/</,"&lt;").replace(/>/,"&gt;"))}(modules=modules||[]).unshift(["$provide",function($provide){$provide.value("$rootElement",element)}]),config.debugInfoEnabled&&modules.push(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!0)}]),modules.unshift("ng");var injector=createInjector(modules,config.strictDi);return injector.invoke(["$rootScope","$rootElement","$compile","$injector",function(scope,element,compile,injector){scope.$apply(function(){element.data("$injector",injector),compile(element)(scope)})}]),injector}var NG_ENABLE_DEBUG_INFO=/^NG_ENABLE_DEBUG_INFO!/,NG_DEFER_BOOTSTRAP=/^NG_DEFER_BOOTSTRAP!/;if(window&&NG_ENABLE_DEBUG_INFO.test(window.name)&&(config.debugInfoEnabled=!0,window.name=window.name.replace(NG_ENABLE_DEBUG_INFO,"")),window&&!NG_DEFER_BOOTSTRAP.test(window.name))return doBootstrap();window.name=window.name.replace(NG_DEFER_BOOTSTRAP,""),angular.resumeBootstrap=function(extraModules){return forEach(extraModules,function(module){modules.push(module)}),doBootstrap()},isFunction(angular.resumeDeferredBootstrap)&&angular.resumeDeferredBootstrap()}function reloadWithDebugInfo(){window.name="NG_ENABLE_DEBUG_INFO!"+window.name,window.location.reload()}function getTestability(rootElement){var injector=angular.element(rootElement).injector();if(!injector)throw ngMinErr("test","no injector found for element argument to getTestability");return injector.get("$$testability")}var SNAKE_CASE_REGEXP=/[A-Z]/g;function snake_case(name,separator){return separator=separator||"_",name.replace(SNAKE_CASE_REGEXP,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}var bindJQueryFired=!1;function assertArg(arg,name,reason){if(!arg)throw ngMinErr("areq","Argument '{0}' is {1}",name||"?",reason||"required");return arg}function assertArgFn(arg,name,acceptArrayAnnotation){return acceptArrayAnnotation&&isArray(arg)&&(arg=arg[arg.length-1]),assertArg(isFunction(arg),name,"not a function, got "+(arg&&"object"==typeof arg?arg.constructor.name||"Object":typeof arg)),arg}function assertNotHasOwnProperty(name,context){if("hasOwnProperty"===name)throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}function getBlockNodes(nodes){for(var blockNodes,node=nodes[0],endNode=nodes[nodes.length-1],i=1;node!==endNode&&(node=node.nextSibling);i++)!blockNodes&&nodes[i]===node||(blockNodes=blockNodes||jqLite(slice.call(nodes,0,i))).push(node);return blockNodes||nodes}function createMap(){return Object.create(null)}function stringify(value){if(null==value)return"";switch(typeof value){case"string":break;case"number":value=""+value;break;default:value=!hasCustomToString(value)||isArray(value)||isDate(value)?toJson(value):value.toString()}return value}var NODE_TYPE_ELEMENT=1,NODE_TYPE_TEXT=3,NODE_TYPE_COMMENT=8,NODE_TYPE_DOCUMENT=9,NODE_TYPE_DOCUMENT_FRAGMENT=11;function shallowCopy(src,dst){if(isArray(src)){dst=dst||[];for(var i=0,ii=src.length;i<ii;i++)dst[i]=src[i]}else if(isObject(src))for(var key in dst=dst||{},src)"$"===key.charAt(0)&&"$"===key.charAt(1)||(dst[key]=src[key]);return dst||src}function toDebugString(obj,maxDepth){return"function"==typeof obj?obj.toString().replace(/ \{[\s\S]*$/,""):isUndefined(obj)?"undefined":"string"!=typeof obj?function(obj,maxDepth){var seen=[];return isValidObjectMaxDepth(maxDepth)&&(obj=angular.copy(obj,null,maxDepth)),JSON.stringify(obj,function(key,val){if(isObject(val=toJsonReplacer(key,val))){if(0<=seen.indexOf(val))return"...";seen.push(val)}return val})}(obj,maxDepth):obj}var version={full:"1.7.4",major:1,minor:7,dot:4,codeName:"interstellar-exploration"};JQLite.expando="ng339";var jqCache=JQLite.cache={},jqId=1;JQLite._data=function(node){return this.cache[node[this.expando]]||{}};var DASH_LOWERCASE_REGEXP=/-([a-z])/g,MS_HACK_REGEXP=/^-ms-/,MOUSE_EVENT_MAP={mouseleave:"mouseout",mouseenter:"mouseover"},jqLiteMinErr=minErr("jqLite");function fnCamelCaseReplace(all,letter){return letter.toUpperCase()}function kebabToCamel(name){return name.replace(DASH_LOWERCASE_REGEXP,fnCamelCaseReplace)}var SINGLE_TAG_REGEXP=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,HTML_REGEXP=/<|&#?\w+;/,TAG_NAME_REGEXP=/<([\w:-]+)/,XHTML_TAG_REGEXP=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wrapMap={option:[1,'<select multiple="multiple">',"</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function jqLiteIsTextNode(html){return!HTML_REGEXP.test(html)}function jqLiteAcceptsData(node){var nodeType=node.nodeType;return nodeType===NODE_TYPE_ELEMENT||!nodeType||nodeType===NODE_TYPE_DOCUMENT}function jqLiteBuildFragment(html,context){var tmp,tag,wrap,i,fragment=context.createDocumentFragment(),nodes=[];if(jqLiteIsTextNode(html))nodes.push(context.createTextNode(html));else{for(tmp=fragment.appendChild(context.createElement("div")),tag=(TAG_NAME_REGEXP.exec(html)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+html.replace(XHTML_TAG_REGEXP,"<$1></$2>")+wrap[2],i=wrap[0];i--;)tmp=tmp.lastChild;nodes=concat(nodes,tmp.childNodes),(tmp=fragment.firstChild).textContent=""}return fragment.textContent="",fragment.innerHTML="",forEach(nodes,function(node){fragment.appendChild(node)}),fragment}wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td;var jqLiteContains=window.Node.prototype.contains||function(arg){return!!(16&this.compareDocumentPosition(arg))};function JQLite(element){if(element instanceof JQLite)return element;var argIsString;if(isString(element)&&(element=trim(element),argIsString=!0),!(this instanceof JQLite)){if(argIsString&&"<"!==element.charAt(0))throw jqLiteMinErr("nosel","Looking up elements via selectors is not supported by jqLite! See: http://docs.angularjs.org/api/angular.element");return new JQLite(element)}argIsString?jqLiteAddNodes(this,function(html,context){var parsed;return context=context||window.document,(parsed=SINGLE_TAG_REGEXP.exec(html))?[context.createElement(parsed[1])]:(parsed=jqLiteBuildFragment(html,context))?parsed.childNodes:[]}(element)):isFunction(element)?jqLiteReady(element):jqLiteAddNodes(this,element)}function jqLiteClone(element){return element.cloneNode(!0)}function jqLiteDealoc(element,onlyDescendants){!onlyDescendants&&jqLiteAcceptsData(element)&&jqLite.cleanData([element]),element.querySelectorAll&&jqLite.cleanData(element.querySelectorAll("*"))}function isEmptyObject(obj){var name;for(name in obj)return!1;return!0}function removeIfEmptyData(element){var expandoId=element.ng339,expandoStore=expandoId&&jqCache[expandoId],events=expandoStore&&expandoStore.events,data=expandoStore&&expandoStore.data;data&&!isEmptyObject(data)||events&&!isEmptyObject(events)||(delete jqCache[expandoId],element.ng339=void 0)}function jqLiteOff(element,type,fn,unsupported){if(isDefined(unsupported))throw jqLiteMinErr("offargs","jqLite#off() does not support the `selector` argument");var expandoStore=jqLiteExpandoStore(element),events=expandoStore&&expandoStore.events,handle=expandoStore&&expandoStore.handle;if(handle){if(type){var removeHandler=function(type){var listenerFns=events[type];isDefined(fn)&&arrayRemove(listenerFns||[],fn),isDefined(fn)&&listenerFns&&0<listenerFns.length||(element.removeEventListener(type,handle),delete events[type])};forEach(type.split(" "),function(type){removeHandler(type),MOUSE_EVENT_MAP[type]&&removeHandler(MOUSE_EVENT_MAP[type])})}else for(type in events)"$destroy"!==type&&element.removeEventListener(type,handle),delete events[type];removeIfEmptyData(element)}}function jqLiteRemoveData(element,name){var expandoId=element.ng339,expandoStore=expandoId&&jqCache[expandoId];expandoStore&&(name?delete expandoStore.data[name]:expandoStore.data={},removeIfEmptyData(element))}function jqLiteExpandoStore(element,createIfNecessary){var expandoId=element.ng339,expandoStore=expandoId&&jqCache[expandoId];return createIfNecessary&&!expandoStore&&(element.ng339=expandoId=++jqId,expandoStore=jqCache[expandoId]={events:{},data:{},handle:void 0}),expandoStore}function jqLiteData(element,key,value){if(jqLiteAcceptsData(element)){var prop,isSimpleSetter=isDefined(value),isSimpleGetter=!isSimpleSetter&&key&&!isObject(key),massGetter=!key,expandoStore=jqLiteExpandoStore(element,!isSimpleGetter),data=expandoStore&&expandoStore.data;if(isSimpleSetter)data[kebabToCamel(key)]=value;else{if(massGetter)return data;if(isSimpleGetter)return data&&data[kebabToCamel(key)];for(prop in key)data[kebabToCamel(prop)]=key[prop]}}}function jqLiteHasClass(element,selector){return!!element.getAttribute&&-1<(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," ").indexOf(" "+selector+" ")}function jqLiteRemoveClass(element,cssClasses){if(cssClasses&&element.setAttribute){var existingClasses=(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," "),newClasses=existingClasses;forEach(cssClasses.split(" "),function(cssClass){cssClass=trim(cssClass),newClasses=newClasses.replace(" "+cssClass+" "," ")}),newClasses!==existingClasses&&element.setAttribute("class",trim(newClasses))}}function jqLiteAddClass(element,cssClasses){if(cssClasses&&element.setAttribute){var existingClasses=(" "+(element.getAttribute("class")||"")+" ").replace(/[\n\t]/g," "),newClasses=existingClasses;forEach(cssClasses.split(" "),function(cssClass){cssClass=trim(cssClass),-1===newClasses.indexOf(" "+cssClass+" ")&&(newClasses+=cssClass+" ")}),newClasses!==existingClasses&&element.setAttribute("class",trim(newClasses))}}function jqLiteAddNodes(root,elements){if(elements)if(elements.nodeType)root[root.length++]=elements;else{var length=elements.length;if("number"==typeof length&&elements.window!==elements){if(length)for(var i=0;i<length;i++)root[root.length++]=elements[i]}else root[root.length++]=elements}}function jqLiteController(element,name){return jqLiteInheritedData(element,"$"+(name||"ngController")+"Controller")}function jqLiteInheritedData(element,name,value){element.nodeType===NODE_TYPE_DOCUMENT&&(element=element.documentElement);for(var names=isArray(name)?name:[name];element;){for(var i=0,ii=names.length;i<ii;i++)if(isDefined(value=jqLite.data(element,names[i])))return value;element=element.parentNode||element.nodeType===NODE_TYPE_DOCUMENT_FRAGMENT&&element.host}}function jqLiteEmpty(element){for(jqLiteDealoc(element,!0);element.firstChild;)element.removeChild(element.firstChild)}function jqLiteRemove(element,keepData){keepData||jqLiteDealoc(element);var parent=element.parentNode;parent&&parent.removeChild(element)}function jqLiteReady(fn){function trigger(){window.document.removeEventListener("DOMContentLoaded",trigger),window.removeEventListener("load",trigger),fn()}"complete"===window.document.readyState?window.setTimeout(fn):(window.document.addEventListener("DOMContentLoaded",trigger),window.addEventListener("load",trigger))}var JQLitePrototype=JQLite.prototype={ready:jqLiteReady,toString:function(){var value=[];return forEach(this,function(e){value.push(""+e)}),"["+value.join(", ")+"]"},eq:function(index){return jqLite(0<=index?this[index]:this[this.length+index])},length:0,push:push,sort:[].sort,splice:[].splice},BOOLEAN_ATTR={};forEach("multiple,selected,checked,disabled,readOnly,required,open".split(","),function(value){BOOLEAN_ATTR[lowercase(value)]=value});var BOOLEAN_ELEMENTS={};forEach("input,select,option,textarea,button,form,details".split(","),function(value){BOOLEAN_ELEMENTS[value]=!0});var ALIASED_ATTR={ngMinlength:"minlength",ngMaxlength:"maxlength",ngMin:"min",ngMax:"max",ngPattern:"pattern",ngStep:"step"};function getBooleanAttrName(element,name){var booleanAttr=BOOLEAN_ATTR[name.toLowerCase()];return booleanAttr&&BOOLEAN_ELEMENTS[nodeName_(element)]&&booleanAttr}function getText(element,value){if(isUndefined(value)){var nodeType=element.nodeType;return nodeType===NODE_TYPE_ELEMENT||nodeType===NODE_TYPE_TEXT?element.textContent:""}element.textContent=value}function createEventHandler(element,events){function eventHandler(event,type){event.isDefaultPrevented=function(){return event.defaultPrevented};var eventFns=events[type||event.type],eventFnsLength=eventFns?eventFns.length:0;if(eventFnsLength){if(isUndefined(event.immediatePropagationStopped)){var originalStopImmediatePropagation=event.stopImmediatePropagation;event.stopImmediatePropagation=function(){event.immediatePropagationStopped=!0,event.stopPropagation&&event.stopPropagation(),originalStopImmediatePropagation&&originalStopImmediatePropagation.call(event)}}event.isImmediatePropagationStopped=function(){return!0===event.immediatePropagationStopped};var handlerWrapper=eventFns.specialHandlerWrapper||defaultHandlerWrapper;1<eventFnsLength&&(eventFns=shallowCopy(eventFns));for(var i=0;i<eventFnsLength;i++)event.isImmediatePropagationStopped()||handlerWrapper(element,event,eventFns[i])}}return eventHandler.elem=element,eventHandler}function defaultHandlerWrapper(element,event,handler){handler.call(element,event)}function specialMouseHandlerWrapper(target,event,handler){var related=event.relatedTarget;related&&(related===target||jqLiteContains.call(target,related))||handler.call(target,event)}function $$jqLiteProvider(){this.$get=function(){return extend(JQLite,{hasClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteHasClass(node,classes)},addClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteAddClass(node,classes)},removeClass:function(node,classes){return node.attr&&(node=node[0]),jqLiteRemoveClass(node,classes)}})}}function hashKey(obj,nextUidFn){var key=obj&&obj.$$hashKey;if(key)return"function"==typeof key&&(key=obj.$$hashKey()),key;var objType=typeof obj;return key="function"==objType||"object"==objType&&null!==obj?obj.$$hashKey=objType+":"+(nextUidFn||nextUid)():objType+":"+obj}forEach({data:jqLiteData,removeData:jqLiteRemoveData,hasData:function(node){for(var key in jqCache[node.ng339])return!0;return!1},cleanData:function(nodes){for(var i=0,ii=nodes.length;i<ii;i++)jqLiteRemoveData(nodes[i]),jqLiteOff(nodes[i])}},function(fn,name){JQLite[name]=fn}),forEach({data:jqLiteData,inheritedData:jqLiteInheritedData,scope:function(element){return jqLite.data(element,"$scope")||jqLiteInheritedData(element.parentNode||element,["$isolateScope","$scope"])},isolateScope:function(element){return jqLite.data(element,"$isolateScope")||jqLite.data(element,"$isolateScopeNoTemplate")},controller:jqLiteController,injector:function(element){return jqLiteInheritedData(element,"$injector")},removeAttr:function(element,name){element.removeAttribute(name)},hasClass:jqLiteHasClass,css:function(element,name,value){if(name=function(name){return kebabToCamel(name.replace(MS_HACK_REGEXP,"ms-"))}(name),!isDefined(value))return element.style[name];element.style[name]=value},attr:function(element,name,value){var ret,nodeType=element.nodeType;if(nodeType!==NODE_TYPE_TEXT&&2!==nodeType&&nodeType!==NODE_TYPE_COMMENT&&element.getAttribute){var lowercasedName=lowercase(name),isBooleanAttr=BOOLEAN_ATTR[lowercasedName];if(!isDefined(value))return ret=element.getAttribute(name),isBooleanAttr&&null!==ret&&(ret=lowercasedName),null===ret?void 0:ret;null===value||!1===value&&isBooleanAttr?element.removeAttribute(name):element.setAttribute(name,isBooleanAttr?lowercasedName:value)}},prop:function(element,name,value){if(!isDefined(value))return element[name];element[name]=value},text:(getText.$dv="",getText),val:function(element,value){if(isUndefined(value)){if(element.multiple&&"select"===nodeName_(element)){var result=[];return forEach(element.options,function(option){option.selected&&result.push(option.value||option.text)}),result}return element.value}element.value=value},html:function(element,value){if(isUndefined(value))return element.innerHTML;jqLiteDealoc(element,!0),element.innerHTML=value},empty:jqLiteEmpty},function(fn,name){JQLite.prototype[name]=function(arg1,arg2){var i,key,nodeCount=this.length;if(fn!==jqLiteEmpty&&isUndefined(2===fn.length&&fn!==jqLiteHasClass&&fn!==jqLiteController?arg1:arg2)){if(isObject(arg1)){for(i=0;i<nodeCount;i++)if(fn===jqLiteData)fn(this[i],arg1);else for(key in arg1)fn(this[i],key,arg1[key]);return this}for(var value=fn.$dv,jj=isUndefined(value)?Math.min(nodeCount,1):nodeCount,j=0;j<jj;j++){var nodeValue=fn(this[j],arg1,arg2);value=value?value+nodeValue:nodeValue}return value}for(i=0;i<nodeCount;i++)fn(this[i],arg1,arg2);return this}}),forEach({removeData:jqLiteRemoveData,on:function(element,type,fn,unsupported){if(isDefined(unsupported))throw jqLiteMinErr("onargs","jqLite#on() does not support the `selector` or `eventData` parameters");if(jqLiteAcceptsData(element)){var expandoStore=jqLiteExpandoStore(element,!0),events=expandoStore.events,handle=expandoStore.handle;handle=handle||(expandoStore.handle=createEventHandler(element,events));for(var types=0<=type.indexOf(" ")?type.split(" "):[type],i=types.length,addHandler=function(type,specialHandlerWrapper,noEventListener){var eventFns=events[type];eventFns||((eventFns=events[type]=[]).specialHandlerWrapper=specialHandlerWrapper,"$destroy"===type||noEventListener||element.addEventListener(type,handle)),eventFns.push(fn)};i--;)type=types[i],MOUSE_EVENT_MAP[type]?(addHandler(MOUSE_EVENT_MAP[type],specialMouseHandlerWrapper),addHandler(type,void 0,!0)):addHandler(type)}},off:jqLiteOff,one:function(element,type,fn){(element=jqLite(element)).on(type,function onFn(){element.off(type,fn),element.off(type,onFn)}),element.on(type,fn)},replaceWith:function(element,replaceNode){var index,parent=element.parentNode;jqLiteDealoc(element),forEach(new JQLite(replaceNode),function(node){index?parent.insertBefore(node,index.nextSibling):parent.replaceChild(node,element),index=node})},children:function(element){var children=[];return forEach(element.childNodes,function(element){element.nodeType===NODE_TYPE_ELEMENT&&children.push(element)}),children},contents:function(element){return element.contentDocument||element.childNodes||[]},append:function(element,node){var nodeType=element.nodeType;if(nodeType===NODE_TYPE_ELEMENT||nodeType===NODE_TYPE_DOCUMENT_FRAGMENT)for(var i=0,ii=(node=new JQLite(node)).length;i<ii;i++){var child=node[i];element.appendChild(child)}},prepend:function(element,node){if(element.nodeType===NODE_TYPE_ELEMENT){var index=element.firstChild;forEach(new JQLite(node),function(child){element.insertBefore(child,index)})}},wrap:function(element,wrapNode){!function(node,wrapper){var parent=node.parentNode;parent&&parent.replaceChild(wrapper,node),wrapper.appendChild(node)}(element,jqLite(wrapNode).eq(0).clone()[0])},remove:jqLiteRemove,detach:function(element){jqLiteRemove(element,!0)},after:function(element,newElement){var index=element,parent=element.parentNode;if(parent)for(var i=0,ii=(newElement=new JQLite(newElement)).length;i<ii;i++){var node=newElement[i];parent.insertBefore(node,index.nextSibling),index=node}},addClass:jqLiteAddClass,removeClass:jqLiteRemoveClass,toggleClass:function(element,selector,condition){selector&&forEach(selector.split(" "),function(className){var classCondition=condition;isUndefined(classCondition)&&(classCondition=!jqLiteHasClass(element,className)),(classCondition?jqLiteAddClass:jqLiteRemoveClass)(element,className)})},parent:function(element){var parent=element.parentNode;return parent&&parent.nodeType!==NODE_TYPE_DOCUMENT_FRAGMENT?parent:null},next:function(element){return element.nextElementSibling},find:function(element,selector){return element.getElementsByTagName?element.getElementsByTagName(selector):[]},clone:jqLiteClone,triggerHandler:function(element,event,extraParameters){var dummyEvent,eventFnsCopy,handlerArgs,eventName=event.type||event,expandoStore=jqLiteExpandoStore(element),events=expandoStore&&expandoStore.events,eventFns=events&&events[eventName];eventFns&&(dummyEvent={preventDefault:function(){this.defaultPrevented=!0},isDefaultPrevented:function(){return!0===this.defaultPrevented},stopImmediatePropagation:function(){this.immediatePropagationStopped=!0},isImmediatePropagationStopped:function(){return!0===this.immediatePropagationStopped},stopPropagation:noop,type:eventName,target:element},event.type&&(dummyEvent=extend(dummyEvent,event)),eventFnsCopy=shallowCopy(eventFns),handlerArgs=extraParameters?[dummyEvent].concat(extraParameters):[dummyEvent],forEach(eventFnsCopy,function(fn){dummyEvent.isImmediatePropagationStopped()||fn.apply(element,handlerArgs)}))}},function(fn,name){JQLite.prototype[name]=function(arg1,arg2,arg3){for(var value,i=0,ii=this.length;i<ii;i++)isUndefined(value)?isDefined(value=fn(this[i],arg1,arg2,arg3))&&(value=jqLite(value)):jqLiteAddNodes(value,fn(this[i],arg1,arg2,arg3));return isDefined(value)?value:this}}),JQLite.prototype.bind=JQLite.prototype.on,JQLite.prototype.unbind=JQLite.prototype.off;var nanKey=Object.create(null);function NgMapShim(){this._keys=[],this._values=[],this._lastKey=NaN,this._lastIndex=-1}NgMapShim.prototype={_idx:function(key){return key!==this._lastKey&&(this._lastKey=key,this._lastIndex=this._keys.indexOf(key)),this._lastIndex},_transformKey:function(key){return isNumberNaN(key)?nanKey:key},get:function(key){key=this._transformKey(key);var idx=this._idx(key);if(-1!==idx)return this._values[idx]},has:function(key){return key=this._transformKey(key),-1!==this._idx(key)},set:function(key,value){key=this._transformKey(key);var idx=this._idx(key);-1===idx&&(idx=this._lastIndex=this._keys.length),this._keys[idx]=key,this._values[idx]=value},delete:function(key){key=this._transformKey(key);var idx=this._idx(key);return-1!==idx&&(this._keys.splice(idx,1),this._values.splice(idx,1),this._lastKey=NaN,this._lastIndex=-1,!0)}};var NgMap=NgMapShim,$$MapProvider=[function(){this.$get=[function(){return NgMap}]}],ARROW_ARG=/^([^(]+?)=>/,FN_ARGS=/^[^(]*\(\s*([^)]*)\)/m,FN_ARG_SPLIT=/,/,FN_ARG=/^\s*(_?)(\S+?)\1\s*$/,STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,$injectorMinErr=minErr("$injector");function stringifyFn(fn){return Function.prototype.toString.call(fn)}function extractArgs(fn){var fnText=stringifyFn(fn).replace(STRIP_COMMENTS,"");return fnText.match(ARROW_ARG)||fnText.match(FN_ARGS)}function createInjector(modulesToLoad,strictDi){strictDi=!0===strictDi;var INSTANTIATING={},providerSuffix="Provider",path=[],loadedModules=new NgMap,providerCache={$provide:{provider:supportObject(provider),factory:supportObject(factory),service:supportObject(function(name,constructor){return factory(name,["$injector",function($injector){return $injector.instantiate(constructor)}])}),value:supportObject(function(name,val){return factory(name,valueFn(val),!1)}),constant:supportObject(function(name,value){assertNotHasOwnProperty(name,"constant"),providerCache[name]=value,instanceCache[name]=value}),decorator:function(serviceName,decorFn){var origProvider=providerInjector.get(serviceName+providerSuffix),orig$get=origProvider.$get;origProvider.$get=function(){var origInstance=instanceInjector.invoke(orig$get,origProvider);return instanceInjector.invoke(decorFn,null,{$delegate:origInstance})}}}},providerInjector=providerCache.$injector=createInternalInjector(providerCache,function(serviceName,caller){throw angular.isString(caller)&&path.push(caller),$injectorMinErr("unpr","Unknown provider: {0}",path.join(" <- "))}),instanceCache={},protoInstanceInjector=createInternalInjector(instanceCache,function(serviceName,caller){var provider=providerInjector.get(serviceName+providerSuffix,caller);return instanceInjector.invoke(provider.$get,provider,void 0,serviceName)}),instanceInjector=protoInstanceInjector;providerCache["$injector"+providerSuffix]={$get:valueFn(protoInstanceInjector)},instanceInjector.modules=providerInjector.modules=createMap();var runBlocks=loadModules(modulesToLoad);return(instanceInjector=protoInstanceInjector.get("$injector")).strictDi=strictDi,forEach(runBlocks,function(fn){fn&&instanceInjector.invoke(fn)}),instanceInjector.loadNewModules=function(mods){forEach(loadModules(mods),function(fn){fn&&instanceInjector.invoke(fn)})},instanceInjector;function supportObject(delegate){return function(key,value){if(!isObject(key))return delegate(key,value);forEach(key,reverseParams(delegate))}}function provider(name,provider_){if(assertNotHasOwnProperty(name,"service"),(isFunction(provider_)||isArray(provider_))&&(provider_=providerInjector.instantiate(provider_)),!provider_.$get)throw $injectorMinErr("pget","Provider '{0}' must define $get factory method.",name);return providerCache[name+providerSuffix]=provider_}function factory(name,factoryFn,enforce){return provider(name,{$get:!1!==enforce?function(name,factory){return function(){var result=instanceInjector.invoke(factory,this);if(isUndefined(result))throw $injectorMinErr("undef","Provider '{0}' must return a value from $get factory method.",name);return result}}(name,factoryFn):factoryFn})}function loadModules(modulesToLoad){assertArg(isUndefined(modulesToLoad)||isArray(modulesToLoad),"modulesToLoad","not an array");var moduleFn,runBlocks=[];return forEach(modulesToLoad,function(module){if(!loadedModules.get(module)){loadedModules.set(module,!0);try{isString(module)?(moduleFn=angularModule(module),instanceInjector.modules[module]=moduleFn,runBlocks=runBlocks.concat(loadModules(moduleFn.requires)).concat(moduleFn._runBlocks),runInvokeQueue(moduleFn._invokeQueue),runInvokeQueue(moduleFn._configBlocks)):isFunction(module)?runBlocks.push(providerInjector.invoke(module)):isArray(module)?runBlocks.push(providerInjector.invoke(module)):assertArgFn(module,"module")}catch(e){throw isArray(module)&&(module=module[module.length-1]),e.message&&e.stack&&-1===e.stack.indexOf(e.message)&&(e=e.message+"\n"+e.stack),$injectorMinErr("modulerr","Failed to instantiate module {0} due to:\n{1}",module,e.stack||e.message||e)}}function runInvokeQueue(queue){var i,ii;for(i=0,ii=queue.length;i<ii;i++){var invokeArgs=queue[i],provider=providerInjector.get(invokeArgs[0]);provider[invokeArgs[1]].apply(provider,invokeArgs[2])}}}),runBlocks}function createInternalInjector(cache,factory){function getService(serviceName,caller){if(cache.hasOwnProperty(serviceName)){if(cache[serviceName]===INSTANTIATING)throw $injectorMinErr("cdep","Circular dependency found: {0}",serviceName+" <- "+path.join(" <- "));return cache[serviceName]}try{return path.unshift(serviceName),cache[serviceName]=INSTANTIATING,cache[serviceName]=factory(serviceName,caller),cache[serviceName]}catch(err){throw cache[serviceName]===INSTANTIATING&&delete cache[serviceName],err}finally{path.shift()}}function injectionArgs(fn,locals,serviceName){for(var args=[],$inject=createInjector.$$annotate(fn,strictDi,serviceName),i=0,length=$inject.length;i<length;i++){var key=$inject[i];if("string"!=typeof key)throw $injectorMinErr("itkn","Incorrect injection token! Expected service name as string, got {0}",key);args.push(locals&&locals.hasOwnProperty(key)?locals[key]:getService(key,serviceName))}return args}return{invoke:function(fn,self,locals,serviceName){"string"==typeof locals&&(serviceName=locals,locals=null);var args=injectionArgs(fn,locals,serviceName);return isArray(fn)&&(fn=fn[fn.length-1]),function(func){if(msie||"function"!=typeof func)return!1;var result=func.$$ngIsClass;return isBoolean(result)||(result=func.$$ngIsClass=/^class\b/.test(stringifyFn(func))),result}(fn)?(args.unshift(null),new(Function.prototype.bind.apply(fn,args))):fn.apply(self,args)},instantiate:function(Type,locals,serviceName){var ctor=isArray(Type)?Type[Type.length-1]:Type,args=injectionArgs(Type,locals,serviceName);return args.unshift(null),new(Function.prototype.bind.apply(ctor,args))},get:getService,annotate:createInjector.$$annotate,has:function(name){return providerCache.hasOwnProperty(name+providerSuffix)||cache.hasOwnProperty(name)}}}}function $AnchorScrollProvider(){var autoScrollingEnabled=!0;this.disableAutoScrolling=function(){autoScrollingEnabled=!1},this.$get=["$window","$location","$rootScope",function($window,$location,$rootScope){var document=$window.document;function scrollTo(elem){if(elem){elem.scrollIntoView();var offset=function(){var offset=scroll.yOffset;if(isFunction(offset))offset=offset();else if(isElement(offset)){var elem=offset[0];offset="fixed"!==$window.getComputedStyle(elem).position?0:elem.getBoundingClientRect().bottom}else isNumber(offset)||(offset=0);return offset}();if(offset){var elemTop=elem.getBoundingClientRect().top;$window.scrollBy(0,elemTop-offset)}}else $window.scrollTo(0,0)}function scroll(hash){var elm;(hash=isString(hash)?hash:isNumber(hash)?hash.toString():$location.hash())?(elm=document.getElementById(hash))?scrollTo(elm):(elm=function(list){var result=null;return Array.prototype.some.call(list,function(element){if("a"===nodeName_(element))return result=element,!0}),result}(document.getElementsByName(hash)))?scrollTo(elm):"top"===hash&&scrollTo(null):scrollTo(null)}return autoScrollingEnabled&&$rootScope.$watch(function(){return $location.hash()},function(newVal,oldVal){newVal===oldVal&&""===newVal||function(action,win){"complete"===(win=win||window).document.readyState?win.setTimeout(action):jqLite(win).on("load",action)}(function(){$rootScope.$evalAsync(scroll)})}),scroll}]}createInjector.$$annotate=function(fn,strictDi,name){var $inject,last;if("function"==typeof fn){if(!($inject=fn.$inject)){if($inject=[],fn.length){if(strictDi)throw isString(name)&&name||(name=fn.name||function(fn){var args=extractArgs(fn);return args?"function("+(args[1]||"").replace(/[\s\r\n]+/," ")+")":"fn"}(fn)),$injectorMinErr("strictdi","{0} is not using explicit annotation and cannot be invoked in strict mode",name);forEach(extractArgs(fn)[1].split(FN_ARG_SPLIT),function(arg){arg.replace(FN_ARG,function(all,underscore,name){$inject.push(name)})})}fn.$inject=$inject}}else isArray(fn)?(assertArgFn(fn[last=fn.length-1],"fn"),$inject=fn.slice(0,last)):assertArgFn(fn,"fn",!0);return $inject};var $animateMinErr=minErr("$animate"),ELEMENT_NODE=1;function mergeClasses(a,b){return a||b?a?b?(isArray(a)&&(a=a.join(" ")),isArray(b)&&(b=b.join(" ")),a+" "+b):a:b:""}function prepareAnimateOptions(options){return isObject(options)?options:{}}function $$CoreAnimateJsProvider(){this.$get=noop}function $$CoreAnimateQueueProvider(){var postDigestQueue=new NgMap,postDigestElements=[];this.$get=["$$AnimateRunner","$rootScope",function($$AnimateRunner,$rootScope){return{enabled:noop,on:noop,off:noop,pin:noop,push:function(element,event,options,domOperation){domOperation&&domOperation(),(options=options||{}).from&&element.css(options.from),options.to&&element.css(options.to),(options.addClass||options.removeClass)&&function(element,add,remove){var data=postDigestQueue.get(element)||{},classesAdded=updateData(data,add,!0),classesRemoved=updateData(data,remove,!1);(classesAdded||classesRemoved)&&(postDigestQueue.set(element,data),postDigestElements.push(element),1===postDigestElements.length&&$rootScope.$$postDigest(handleCSSClassChanges))}(element,options.addClass,options.removeClass);var runner=new $$AnimateRunner;return runner.complete(),runner}};function updateData(data,classes,value){var changed=!1;return classes&&forEach(classes=isString(classes)?classes.split(" "):isArray(classes)?classes:[],function(className){className&&(changed=!0,data[className]=value)}),changed}function handleCSSClassChanges(){forEach(postDigestElements,function(element){var data=postDigestQueue.get(element);if(data){var existing=function(classes){isString(classes)&&(classes=classes.split(" "));var obj=createMap();return forEach(classes,function(klass){klass.length&&(obj[klass]=!0)}),obj}(element.attr("class")),toAdd="",toRemove="";forEach(data,function(status,className){status!==!!existing[className]&&(status?toAdd+=(toAdd.length?" ":"")+className:toRemove+=(toRemove.length?" ":"")+className)}),forEach(element,function(elm){toAdd&&jqLiteAddClass(elm,toAdd),toRemove&&jqLiteRemoveClass(elm,toRemove)}),postDigestQueue.delete(element)}}),postDigestElements.length=0}}]}function $$AnimateAsyncRunFactoryProvider(){this.$get=["$$rAF",function($$rAF){var waitQueue=[];function waitForTick(fn){waitQueue.push(fn),1<waitQueue.length||$$rAF(function(){for(var i=0;i<waitQueue.length;i++)waitQueue[i]();waitQueue=[]})}return function(){var passed=!1;return waitForTick(function(){passed=!0}),function(callback){passed?callback():waitForTick(callback)}}}]}function $$AnimateRunnerFactoryProvider(){this.$get=["$q","$sniffer","$$animateAsyncRun","$$isDocumentHidden","$timeout",function($q,$sniffer,$$animateAsyncRun,$$isDocumentHidden,$timeout){function AnimateRunner(host){this.setHost(host);var rafTick=$$animateAsyncRun();this._doneCallbacks=[],this._tick=function(fn){$$isDocumentHidden()?function(fn){$timeout(fn,0,!1)}(fn):rafTick(fn)},this._state=0}return AnimateRunner.chain=function(chain,callback){var index=0;!function next(){if(index===chain.length)return void callback(!0);chain[index](function(response){!1!==response?(index++,next()):callback(!1)})}()},AnimateRunner.all=function(runners,callback){var count=0,status=!0;function onProgress(response){status=status&&response,++count===runners.length&&callback(status)}forEach(runners,function(runner){runner.done(onProgress)})},AnimateRunner.prototype={setHost:function(host){this.host=host||{}},done:function(fn){2===this._state?fn():this._doneCallbacks.push(fn)},progress:noop,getPromise:function(){if(!this.promise){var self=this;this.promise=$q(function(resolve,reject){self.done(function(status){!1===status?reject():resolve()})})}return this.promise},then:function(resolveHandler,rejectHandler){return this.getPromise().then(resolveHandler,rejectHandler)},catch:function(handler){return this.getPromise().catch(handler)},finally:function(handler){return this.getPromise().finally(handler)},pause:function(){this.host.pause&&this.host.pause()},resume:function(){this.host.resume&&this.host.resume()},end:function(){this.host.end&&this.host.end(),this._resolve(!0)},cancel:function(){this.host.cancel&&this.host.cancel(),this._resolve(!1)},complete:function(response){var self=this;0===self._state&&(self._state=1,self._tick(function(){self._resolve(response)}))},_resolve:function(response){2!==this._state&&(forEach(this._doneCallbacks,function(fn){fn(response)}),this._doneCallbacks.length=0,this._state=2)}},AnimateRunner}]}function $CoreAnimateCssProvider(){this.$get=["$$rAF","$q","$$AnimateRunner",function($$rAF,$q,$$AnimateRunner){return function(element,initialOptions){var options=initialOptions||{};options.$$prepared||(options=copy(options)),options.cleanupStyles&&(options.from=options.to=null),options.from&&(element.css(options.from),options.from=null);var closed,runner=new $$AnimateRunner;return{start:run,end:run};function run(){return $$rAF(function(){!function(){options.addClass&&(element.addClass(options.addClass),options.addClass=null);options.removeClass&&(element.removeClass(options.removeClass),options.removeClass=null);options.to&&(element.css(options.to),options.to=null)}(),closed||runner.complete(),closed=!0}),runner}}}]}var $AnimateProvider=["$provide",function($provide){var provider=this,classNameFilter=null,customFilter=null;this.$$registeredAnimations=Object.create(null),this.register=function(name,factory){if(name&&"."!==name.charAt(0))throw $animateMinErr("notcsel","Expecting class selector starting with '.' got '{0}'.",name);var key=name+"-animation";provider.$$registeredAnimations[name.substr(1)]=key,$provide.factory(key,factory)},this.customFilter=function(filterFn){return 1===arguments.length&&(customFilter=isFunction(filterFn)?filterFn:null),customFilter},this.classNameFilter=function(expression){if(1===arguments.length&&((classNameFilter=expression instanceof RegExp?expression:null)&&new RegExp("[(\\s|\\/)]ng-animate[(\\s|\\/)]").test(classNameFilter.toString())))throw classNameFilter=null,$animateMinErr("nongcls",'$animateProvider.classNameFilter(regex) prohibits accepting a regex value which matches/contains the "{0}" CSS class.',"ng-animate");return classNameFilter},this.$get=["$$animateQueue",function($$animateQueue){function domInsert(element,parentElement,afterElement){if(afterElement){var afterNode=function(element){for(var i=0;i<element.length;i++){var elm=element[i];if(elm.nodeType===ELEMENT_NODE)return elm}}(afterElement);!afterNode||afterNode.parentNode||afterNode.previousElementSibling||(afterElement=null)}afterElement?afterElement.after(element):parentElement.prepend(element)}return{on:$$animateQueue.on,off:$$animateQueue.off,pin:$$animateQueue.pin,enabled:$$animateQueue.enabled,cancel:function(runner){runner.cancel&&runner.cancel()},enter:function(element,parent,after,options){return parent=parent&&jqLite(parent),after=after&&jqLite(after),domInsert(element,parent=parent||after.parent(),after),$$animateQueue.push(element,"enter",prepareAnimateOptions(options))},move:function(element,parent,after,options){return parent=parent&&jqLite(parent),after=after&&jqLite(after),domInsert(element,parent=parent||after.parent(),after),$$animateQueue.push(element,"move",prepareAnimateOptions(options))},leave:function(element,options){return $$animateQueue.push(element,"leave",prepareAnimateOptions(options),function(){element.remove()})},addClass:function(element,className,options){return(options=prepareAnimateOptions(options)).addClass=mergeClasses(options.addclass,className),$$animateQueue.push(element,"addClass",options)},removeClass:function(element,className,options){return(options=prepareAnimateOptions(options)).removeClass=mergeClasses(options.removeClass,className),$$animateQueue.push(element,"removeClass",options)},setClass:function(element,add,remove,options){return(options=prepareAnimateOptions(options)).addClass=mergeClasses(options.addClass,add),options.removeClass=mergeClasses(options.removeClass,remove),$$animateQueue.push(element,"setClass",options)},animate:function(element,from,to,className,options){return(options=prepareAnimateOptions(options)).from=options.from?extend(options.from,from):from,options.to=options.to?extend(options.to,to):to,className=className||"ng-inline-animate",options.tempClasses=mergeClasses(options.tempClasses,className),$$animateQueue.push(element,"animate",options)}}}]}];function Browser(window,document,$log,$sniffer,$$taskTrackerFactory){var self=this,location=window.location,history=window.history,setTimeout=window.setTimeout,clearTimeout=window.clearTimeout,pendingDeferIds={},taskTracker=$$taskTrackerFactory($log);self.isMock=!1,self.$$completeOutstandingRequest=taskTracker.completeTask,self.$$incOutstandingRequestCount=taskTracker.incTaskCount,self.notifyWhenNoOutstandingRequests=taskTracker.notifyWhenNoPendingTasks;var cachedState,lastHistoryState,lastBrowserUrl=location.href,baseElement=document.find("base"),pendingLocation=null,getCurrentState=$sniffer.history?function(){try{return history.state}catch(e){}}:noop;cacheState(),self.url=function(url,replace,state){if(isUndefined(state)&&(state=null),location!==window.location&&(location=window.location),history!==window.history&&(history=window.history),url){var sameState=lastHistoryState===state;if(lastBrowserUrl===url&&(!$sniffer.history||sameState))return self;var sameBase=lastBrowserUrl&&stripHash(lastBrowserUrl)===stripHash(url);return lastBrowserUrl=url,lastHistoryState=state,!$sniffer.history||sameBase&&sameState?(sameBase||(pendingLocation=url),replace?location.replace(url):sameBase?location.hash=function(url){var index=url.indexOf("#");return-1===index?"":url.substr(index)}(url):location.href=url,location.href!==url&&(pendingLocation=url)):(history[replace?"replaceState":"pushState"](state,"",url),cacheState()),pendingLocation=pendingLocation&&url,self}return function(url){return url.replace(/#$/,"")}(pendingLocation||location.href)},self.state=function(){return cachedState};var urlChangeListeners=[],urlChangeInit=!1;function cacheStateAndFireUrlChange(){pendingLocation=null,fireStateOrUrlChange()}var lastCachedState=null;function cacheState(){equals(cachedState=isUndefined(cachedState=getCurrentState())?null:cachedState,lastCachedState)&&(cachedState=lastCachedState),lastHistoryState=lastCachedState=cachedState}function fireStateOrUrlChange(){var prevLastHistoryState=lastHistoryState;cacheState(),lastBrowserUrl===self.url()&&prevLastHistoryState===cachedState||(lastBrowserUrl=self.url(),lastHistoryState=cachedState,forEach(urlChangeListeners,function(listener){listener(self.url(),cachedState)}))}self.onUrlChange=function(callback){return urlChangeInit||($sniffer.history&&jqLite(window).on("popstate",cacheStateAndFireUrlChange),jqLite(window).on("hashchange",cacheStateAndFireUrlChange),urlChangeInit=!0),urlChangeListeners.push(callback),callback},self.$$applicationDestroyed=function(){jqLite(window).off("hashchange popstate",cacheStateAndFireUrlChange)},self.$$checkUrlChange=fireStateOrUrlChange,self.baseHref=function(){var href=baseElement.attr("href");return href?href.replace(/^(https?:)?\/\/[^/]*/,""):""},self.defer=function(fn,delay,taskType){var timeoutId;return delay=delay||0,taskType=taskType||taskTracker.DEFAULT_TASK_TYPE,taskTracker.incTaskCount(taskType),timeoutId=setTimeout(function(){delete pendingDeferIds[timeoutId],taskTracker.completeTask(fn,taskType)},delay),pendingDeferIds[timeoutId]=taskType,timeoutId},self.defer.cancel=function(deferId){if(pendingDeferIds.hasOwnProperty(deferId)){var taskType=pendingDeferIds[deferId];return delete pendingDeferIds[deferId],clearTimeout(deferId),taskTracker.completeTask(noop,taskType),!0}return!1}}function $BrowserProvider(){this.$get=["$window","$log","$sniffer","$document","$$taskTrackerFactory",function($window,$log,$sniffer,$document,$$taskTrackerFactory){return new Browser($window,$document,$log,$sniffer,$$taskTrackerFactory)}]}function $CacheFactoryProvider(){this.$get=function(){var caches={};function cacheFactory(cacheId,options){if(cacheId in caches)throw minErr("$cacheFactory")("iid","CacheId '{0}' is already taken!",cacheId);var size=0,stats=extend({},options,{id:cacheId}),data=createMap(),capacity=options&&options.capacity||Number.MAX_VALUE,lruHash=createMap(),freshEnd=null,staleEnd=null;return caches[cacheId]={put:function(key,value){if(!isUndefined(value)){if(capacity<Number.MAX_VALUE)refresh(lruHash[key]||(lruHash[key]={key:key}));return key in data||size++,data[key]=value,capacity<size&&this.remove(staleEnd.key),value}},get:function(key){if(capacity<Number.MAX_VALUE){var lruEntry=lruHash[key];if(!lruEntry)return;refresh(lruEntry)}return data[key]},remove:function(key){if(capacity<Number.MAX_VALUE){var lruEntry=lruHash[key];if(!lruEntry)return;lruEntry===freshEnd&&(freshEnd=lruEntry.p),lruEntry===staleEnd&&(staleEnd=lruEntry.n),link(lruEntry.n,lruEntry.p),delete lruHash[key]}key in data&&(delete data[key],size--)},removeAll:function(){data=createMap(),size=0,lruHash=createMap(),freshEnd=staleEnd=null},destroy:function(){lruHash=stats=data=null,delete caches[cacheId]},info:function(){return extend({},stats,{size:size})}};function refresh(entry){entry!==freshEnd&&(staleEnd?staleEnd===entry&&(staleEnd=entry.n):staleEnd=entry,link(entry.n,entry.p),link(entry,freshEnd),(freshEnd=entry).n=null)}function link(nextEntry,prevEntry){nextEntry!==prevEntry&&(nextEntry&&(nextEntry.p=prevEntry),prevEntry&&(prevEntry.n=nextEntry))}}return cacheFactory.info=function(){var info={};return forEach(caches,function(cache,cacheId){info[cacheId]=cache.info()}),info},cacheFactory.get=function(cacheId){return caches[cacheId]},cacheFactory}}function $TemplateCacheProvider(){this.$get=["$cacheFactory",function($cacheFactory){return $cacheFactory("templates")}]}var $compileMinErr=minErr("$compile");var _UNINITIALIZED_VALUE=new function(){};function $CompileProvider($provide,$$sanitizeUriProvider){var hasDirectives={},COMMENT_DIRECTIVE_REGEXP=/^\s*directive:\s*([\w-]+)\s+(.*)$/,CLASS_DIRECTIVE_REGEXP=/(([\w-]+)(?::([^;]+))?;?)/,ALL_OR_NOTHING_ATTRS=function(str){var i,obj={},items=str.split(",");for(i=0;i<items.length;i++)obj[items[i]]=!0;return obj}("ngSrc,ngSrcset,src,srcset"),REQUIRE_PREFIX_REGEXP=/^(?:(\^\^?)?(\?)?(\^\^?)?)?/,EVENT_HANDLER_ATTR_REGEXP=/^(on[a-z]+|formaction)$/,bindingCache=createMap();function parseIsolateBindings(scope,directiveName,isController){var LOCAL_REGEXP=/^([@&]|[=<](\*?))(\??)\s*([\w$]*)$/,bindings=createMap();return forEach(scope,function(definition,scopeName){if((definition=definition.trim())in bindingCache)bindings[scopeName]=bindingCache[definition];else{var match=definition.match(LOCAL_REGEXP);if(!match)throw $compileMinErr("iscp","Invalid {3} for directive '{0}'. Definition: {... {1}: '{2}' ...}",directiveName,scopeName,definition,isController?"controller bindings definition":"isolate scope definition");bindings[scopeName]={mode:match[1][0],collection:"*"===match[2],optional:"?"===match[3],attrName:match[4]||scopeName},match[4]&&(bindingCache[definition]=bindings[scopeName])}}),bindings}function parseDirectiveBindings(directive,directiveName){var bindings={isolateScope:null,bindToController:null};if(isObject(directive.scope)&&(!0===directive.bindToController?(bindings.bindToController=parseIsolateBindings(directive.scope,directiveName,!0),bindings.isolateScope={}):bindings.isolateScope=parseIsolateBindings(directive.scope,directiveName,!1)),isObject(directive.bindToController)&&(bindings.bindToController=parseIsolateBindings(directive.bindToController,directiveName,!0)),bindings.bindToController&&!directive.controller)throw $compileMinErr("noctrl","Cannot bind to controller without directive '{0}'s controller.",directiveName);return bindings}this.directive=function registerDirective(name,directiveFactory){return assertArg(name,"name"),assertNotHasOwnProperty(name,"directive"),isString(name)?(function(name){var letter=name.charAt(0);if(!letter||letter!==lowercase(letter))throw $compileMinErr("baddir","Directive/Component name '{0}' is invalid. The first character must be a lowercase letter",name);if(name!==name.trim())throw $compileMinErr("baddir","Directive/Component name '{0}' is invalid. The name should not contain leading or trailing whitespaces",name)}(name),assertArg(directiveFactory,"directiveFactory"),hasDirectives.hasOwnProperty(name)||(hasDirectives[name]=[],$provide.factory(name+"Directive",["$injector","$exceptionHandler",function($injector,$exceptionHandler){var directives=[];return forEach(hasDirectives[name],function(directiveFactory,index){try{var directive=$injector.invoke(directiveFactory);isFunction(directive)?directive={compile:valueFn(directive)}:!directive.compile&&directive.link&&(directive.compile=valueFn(directive.link)),directive.priority=directive.priority||0,directive.index=index,directive.name=directive.name||name,directive.require=function(directive){var require=directive.require||directive.controller&&directive.name;return!isArray(require)&&isObject(require)&&forEach(require,function(value,key){var match=value.match(REQUIRE_PREFIX_REGEXP);value.substring(match[0].length)||(require[key]=match[0]+key)}),require}(directive),directive.restrict=function(restrict,name){if(restrict&&(!isString(restrict)||!/[EACM]/.test(restrict)))throw $compileMinErr("badrestrict","Restrict property '{0}' of directive '{1}' is invalid",restrict,name);return restrict||"EA"}(directive.restrict,name),directive.$$moduleName=directiveFactory.$$moduleName,directives.push(directive)}catch(e){$exceptionHandler(e)}}),directives}])),hasDirectives[name].push(directiveFactory)):forEach(name,reverseParams(registerDirective)),this},this.component=function registerComponent(name,options){if(!isString(name))return forEach(name,reverseParams(bind(this,registerComponent))),this;var controller=options.controller||function(){};function factory($injector){function makeInjectable(fn){return isFunction(fn)||isArray(fn)?function(tElement,tAttrs){return $injector.invoke(fn,this,{$element:tElement,$attrs:tAttrs})}:fn}var template=options.template||options.templateUrl?options.template:"",ddo={controller:controller,controllerAs:function(controller,ident){if(ident&&isString(ident))return ident;if(isString(controller)){var match=CNTRL_REG.exec(controller);if(match)return match[3]}}(options.controller)||options.controllerAs||"$ctrl",template:makeInjectable(template),templateUrl:makeInjectable(options.templateUrl),transclude:options.transclude,scope:{},bindToController:options.bindings||{},restrict:"E",require:options.require};return forEach(options,function(val,key){"$"===key.charAt(0)&&(ddo[key]=val)}),ddo}return forEach(options,function(val,key){"$"===key.charAt(0)&&(factory[key]=val,isFunction(controller)&&(controller[key]=val))}),factory.$inject=["$injector"],this.directive(name,factory)},this.aHrefSanitizationWhitelist=function(regexp){return isDefined(regexp)?($$sanitizeUriProvider.aHrefSanitizationWhitelist(regexp),this):$$sanitizeUriProvider.aHrefSanitizationWhitelist()},this.imgSrcSanitizationWhitelist=function(regexp){return isDefined(regexp)?($$sanitizeUriProvider.imgSrcSanitizationWhitelist(regexp),this):$$sanitizeUriProvider.imgSrcSanitizationWhitelist()};var debugInfoEnabled=!0,strictComponentBindingsEnabled=!(this.debugInfoEnabled=function(enabled){return isDefined(enabled)?(debugInfoEnabled=enabled,this):debugInfoEnabled});this.strictComponentBindingsEnabled=function(enabled){return isDefined(enabled)?(strictComponentBindingsEnabled=enabled,this):strictComponentBindingsEnabled};var TTL=10;this.onChangesTtl=function(value){return arguments.length?(TTL=value,this):TTL};var commentDirectivesEnabledConfig=!0;this.commentDirectivesEnabled=function(value){return arguments.length?(commentDirectivesEnabledConfig=value,this):commentDirectivesEnabledConfig};var cssClassDirectivesEnabledConfig=!0;this.cssClassDirectivesEnabled=function(value){return arguments.length?(cssClassDirectivesEnabledConfig=value,this):cssClassDirectivesEnabledConfig};var PROP_CONTEXTS=createMap();function registerContext(ctx,values){forEach(values,function(v){PROP_CONTEXTS[v.toLowerCase()]=ctx})}this.addPropertySecurityContext=function(elementName,propertyName,ctx){var key=elementName.toLowerCase()+"|"+propertyName.toLowerCase();if(key in PROP_CONTEXTS&&PROP_CONTEXTS[key]!==ctx)throw $compileMinErr("ctxoverride","Property context '{0}.{1}' already set to '{2}', cannot override to '{3}'.",elementName,propertyName,PROP_CONTEXTS[key],ctx);return PROP_CONTEXTS[key]=ctx,this},registerContext(SCE_CONTEXTS.HTML,["iframe|srcdoc","*|innerHTML","*|outerHTML"]),registerContext(SCE_CONTEXTS.CSS,["*|style"]),registerContext(SCE_CONTEXTS.URL,["area|href","area|ping","a|href","a|ping","blockquote|cite","body|background","del|cite","input|src","ins|cite","q|cite"]),registerContext(SCE_CONTEXTS.MEDIA_URL,["audio|src","img|src","img|srcset","source|src","source|srcset","track|src","video|src","video|poster"]),registerContext(SCE_CONTEXTS.RESOURCE_URL,["*|formAction","applet|code","applet|codebase","base|href","embed|src","frame|src","form|action","head|profile","html|manifest","iframe|src","link|href","media|src","object|codebase","object|data","script|src"]),this.$get=["$injector","$interpolate","$exceptionHandler","$templateRequest","$parse","$controller","$rootScope","$sce","$animate",function($injector,$interpolate,$exceptionHandler,$templateRequest,$parse,$controller,$rootScope,$sce,$animate){var onChangesQueue,SIMPLE_ATTR_NAME=/^\w/,specialAttrHolder=window.document.createElement("div"),commentDirectivesEnabled=commentDirectivesEnabledConfig,cssClassDirectivesEnabled=cssClassDirectivesEnabledConfig,onChangesTtl=TTL;function flushOnChangesQueue(){try{if(!--onChangesTtl)throw onChangesQueue=void 0,$compileMinErr("infchng","{0} $onChanges() iterations reached. Aborting!\n",TTL);$rootScope.$apply(function(){for(var i=0,ii=onChangesQueue.length;i<ii;++i)try{onChangesQueue[i]()}catch(e){$exceptionHandler(e)}onChangesQueue=void 0})}finally{onChangesTtl++}}function sanitizeSrcset(value,invokeType){if(!value)return value;if(!isString(value))throw $compileMinErr("srcset",'Can\'t pass trusted values to `{0}`: "{1}"',invokeType,value.toString());for(var result="",trimmedSrcset=trim(value),pattern=/\s/.test(trimmedSrcset)?/(\s+\d+x\s*,|\s+\d+w\s*,|\s+,|,\s+)/:/(,)/,rawUris=trimmedSrcset.split(pattern),nbrUrisWith2parts=Math.floor(rawUris.length/2),i=0;i<nbrUrisWith2parts;i++){var innerIdx=2*i;result+=$sce.getTrustedMediaUrl(trim(rawUris[innerIdx])),result+=" "+trim(rawUris[1+innerIdx])}var lastTuple=trim(rawUris[2*i]).split(/\s/);return result+=$sce.getTrustedMediaUrl(trim(lastTuple[0])),2===lastTuple.length&&(result+=" "+trim(lastTuple[1])),result}function Attributes(element,attributesToCopy){if(attributesToCopy){var i,l,key,keys=Object.keys(attributesToCopy);for(i=0,l=keys.length;i<l;i++)this[key=keys[i]]=attributesToCopy[key]}else this.$attr={};this.$$element=element}function safeAddClass($element,className){try{$element.addClass(className)}catch(e){}}Attributes.prototype={$normalize:directiveNormalize,$addClass:function(classVal){classVal&&0<classVal.length&&$animate.addClass(this.$$element,classVal)},$removeClass:function(classVal){classVal&&0<classVal.length&&$animate.removeClass(this.$$element,classVal)},$updateClass:function(newClasses,oldClasses){var toAdd=tokenDifference(newClasses,oldClasses);toAdd&&toAdd.length&&$animate.addClass(this.$$element,toAdd);var toRemove=tokenDifference(oldClasses,newClasses);toRemove&&toRemove.length&&$animate.removeClass(this.$$element,toRemove)},$set:function(key,value,writeAttr,attrName){var booleanKey=getBooleanAttrName(this.$$element[0],key),aliasedKey=function(name){return ALIASED_ATTR[name]}(key),observer=key;booleanKey?(this.$$element.prop(key,value),attrName=booleanKey):aliasedKey&&(this[aliasedKey]=value,observer=aliasedKey),this[key]=value,attrName?this.$attr[key]=attrName:(attrName=this.$attr[key])||(this.$attr[key]=attrName=snake_case(key,"-")),"img"===nodeName_(this.$$element)&&"srcset"===key&&(this[key]=value=sanitizeSrcset(value,"$set('srcset', value)")),!1!==writeAttr&&(null===value||isUndefined(value)?this.$$element.removeAttr(attrName):SIMPLE_ATTR_NAME.test(attrName)?this.$$element.attr(attrName,value):function(element,attrName,value){specialAttrHolder.innerHTML="<span "+attrName+">";var attributes=specialAttrHolder.firstChild.attributes,attribute=attributes[0];attributes.removeNamedItem(attribute.name),attribute.value=value,element.attributes.setNamedItem(attribute)}(this.$$element[0],attrName,value));var $$observers=this.$$observers;$$observers&&forEach($$observers[observer],function(fn){try{fn(value)}catch(e){$exceptionHandler(e)}})},$observe:function(key,fn){var attrs=this,$$observers=attrs.$$observers||(attrs.$$observers=createMap()),listeners=$$observers[key]||($$observers[key]=[]);return listeners.push(fn),$rootScope.$evalAsync(function(){listeners.$$inter||!attrs.hasOwnProperty(key)||isUndefined(attrs[key])||fn(attrs[key])}),function(){arrayRemove(listeners,fn)}}};var startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol(),denormalizeTemplate="{{"===startSymbol&&"}}"===endSymbol?identity:function(template){return template.replace(/\{\{/g,startSymbol).replace(/}}/g,endSymbol)},NG_PREFIX_BINDING=/^ng(Attr|Prop|On)([A-Z].*)$/,MULTI_ELEMENT_DIR_RE=/^(.+)Start$/;return compile.$$addBindingInfo=debugInfoEnabled?function($element,binding){var bindings=$element.data("$binding")||[];isArray(binding)?bindings=bindings.concat(binding):bindings.push(binding),$element.data("$binding",bindings)}:noop,compile.$$addBindingClass=debugInfoEnabled?function($element){safeAddClass($element,"ng-binding")}:noop,compile.$$addScopeInfo=debugInfoEnabled?function($element,scope,isolated,noTemplate){var dataName=isolated?noTemplate?"$isolateScopeNoTemplate":"$isolateScope":"$scope";$element.data(dataName,scope)}:noop,compile.$$addScopeClass=debugInfoEnabled?function($element,isolated){safeAddClass($element,isolated?"ng-isolate-scope":"ng-scope")}:noop,compile.$$createComment=function(directiveName,comment){var content="";return debugInfoEnabled&&(content=" "+(directiveName||"")+": ",comment&&(content+=comment+" ")),window.document.createComment(content)},compile;function compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext){$compileNodes instanceof jqLite||($compileNodes=jqLite($compileNodes));var compositeLinkFn=compileNodes($compileNodes,transcludeFn,$compileNodes,maxPriority,ignoreDirective,previousCompileContext);compile.$$addScopeClass($compileNodes);var namespace=null;return function(scope,cloneConnectFn,options){if(!$compileNodes)throw $compileMinErr("multilink","This element has already been linked.");assertArg(scope,"scope"),previousCompileContext&&previousCompileContext.needsNewScope&&(scope=scope.$parent.$new());var $linkNode,parentBoundTranscludeFn=(options=options||{}).parentBoundTranscludeFn,transcludeControllers=options.transcludeControllers,futureParentElement=options.futureParentElement;if(parentBoundTranscludeFn&&parentBoundTranscludeFn.$$boundTransclude&&(parentBoundTranscludeFn=parentBoundTranscludeFn.$$boundTransclude),$linkNode="html"!==(namespace=namespace||function(parentElement){var node=parentElement&&parentElement[0];return node&&"foreignobject"!==nodeName_(node)&&toString.call(node).match(/SVG/)?"svg":"html"}(futureParentElement))?jqLite(wrapTemplate(namespace,jqLite("<div></div>").append($compileNodes).html())):cloneConnectFn?JQLitePrototype.clone.call($compileNodes):$compileNodes,transcludeControllers)for(var controllerName in transcludeControllers)$linkNode.data("$"+controllerName+"Controller",transcludeControllers[controllerName].instance);return compile.$$addScopeInfo($linkNode,scope),cloneConnectFn&&cloneConnectFn($linkNode,scope),compositeLinkFn&&compositeLinkFn(scope,$linkNode,$linkNode,parentBoundTranscludeFn),cloneConnectFn||($compileNodes=compositeLinkFn=null),$linkNode}}function compileNodes(nodeList,transcludeFn,$rootElement,maxPriority,ignoreDirective,previousCompileContext){for(var attrs,directives,nodeLinkFn,childNodes,childLinkFn,linkFnFound,nodeLinkFnFound,linkFns=[],notLiveList=isArray(nodeList)||nodeList instanceof jqLite,i=0;i<nodeList.length;i++)attrs=new Attributes,11===msie&&mergeConsecutiveTextNodes(nodeList,i,notLiveList),(nodeLinkFn=(directives=collectDirectives(nodeList[i],[],attrs,0===i?maxPriority:void 0,ignoreDirective)).length?applyDirectivesToNode(directives,nodeList[i],attrs,transcludeFn,$rootElement,null,[],[],previousCompileContext):null)&&nodeLinkFn.scope&&compile.$$addScopeClass(attrs.$$element),childLinkFn=nodeLinkFn&&nodeLinkFn.terminal||!(childNodes=nodeList[i].childNodes)||!childNodes.length?null:compileNodes(childNodes,nodeLinkFn?(nodeLinkFn.transcludeOnThisElement||!nodeLinkFn.templateOnThisElement)&&nodeLinkFn.transclude:transcludeFn),(nodeLinkFn||childLinkFn)&&(linkFns.push(i,nodeLinkFn,childLinkFn),linkFnFound=!0,nodeLinkFnFound=nodeLinkFnFound||nodeLinkFn),previousCompileContext=null;return linkFnFound?function(scope,nodeList,$rootElement,parentBoundTranscludeFn){var nodeLinkFn,childLinkFn,node,childScope,i,ii,idx,childBoundTranscludeFn,stableNodeList;if(nodeLinkFnFound){var nodeListLength=nodeList.length;for(stableNodeList=new Array(nodeListLength),i=0;i<linkFns.length;i+=3)idx=linkFns[i],stableNodeList[idx]=nodeList[idx]}else stableNodeList=nodeList;for(i=0,ii=linkFns.length;i<ii;)node=stableNodeList[linkFns[i++]],nodeLinkFn=linkFns[i++],childLinkFn=linkFns[i++],nodeLinkFn?(nodeLinkFn.scope?(childScope=scope.$new(),compile.$$addScopeInfo(jqLite(node),childScope)):childScope=scope,childBoundTranscludeFn=nodeLinkFn.transcludeOnThisElement?createBoundTranscludeFn(scope,nodeLinkFn.transclude,parentBoundTranscludeFn):!nodeLinkFn.templateOnThisElement&&parentBoundTranscludeFn?parentBoundTranscludeFn:!parentBoundTranscludeFn&&transcludeFn?createBoundTranscludeFn(scope,transcludeFn):null,nodeLinkFn(childLinkFn,childScope,node,$rootElement,childBoundTranscludeFn)):childLinkFn&&childLinkFn(scope,node.childNodes,void 0,parentBoundTranscludeFn)}:null}function mergeConsecutiveTextNodes(nodeList,idx,notLiveList){var sibling,node=nodeList[idx],parent=node.parentNode;if(node.nodeType===NODE_TYPE_TEXT)for(;(sibling=parent?node.nextSibling:nodeList[idx+1])&&sibling.nodeType===NODE_TYPE_TEXT;)node.nodeValue=node.nodeValue+sibling.nodeValue,sibling.parentNode&&sibling.parentNode.removeChild(sibling),notLiveList&&sibling===nodeList[idx+1]&&nodeList.splice(idx+1,1)}function createBoundTranscludeFn(scope,transcludeFn,previousBoundTranscludeFn){function boundTranscludeFn(transcludedScope,cloneFn,controllers,futureParentElement,containingScope){return transcludedScope||((transcludedScope=scope.$new(!1,containingScope)).$$transcluded=!0),transcludeFn(transcludedScope,cloneFn,{parentBoundTranscludeFn:previousBoundTranscludeFn,transcludeControllers:controllers,futureParentElement:futureParentElement})}var boundSlots=boundTranscludeFn.$$slots=createMap();for(var slotName in transcludeFn.$$slots)transcludeFn.$$slots[slotName]?boundSlots[slotName]=createBoundTranscludeFn(scope,transcludeFn.$$slots[slotName],previousBoundTranscludeFn):boundSlots[slotName]=null;return boundTranscludeFn}function collectDirectives(node,directives,attrs,maxPriority,ignoreDirective){var match,nodeName,className,nodeType=node.nodeType,attrsMap=attrs.$attr;switch(nodeType){case NODE_TYPE_ELEMENT:addDirective(directives,directiveNormalize(nodeName=nodeName_(node)),"E",maxPriority,ignoreDirective);for(var attr,name,nName,value,ngPrefixMatch,nAttrs=node.attributes,j=0,jj=nAttrs&&nAttrs.length;j<jj;j++){var multiElementMatch,attrStartName=!1,attrEndName=!1,isNgAttr=!1,isNgProp=!1,isNgEvent=!1;name=(attr=nAttrs[j]).name,value=attr.value,(ngPrefixMatch=(nName=directiveNormalize(name.toLowerCase())).match(NG_PREFIX_BINDING))?(isNgAttr="Attr"===ngPrefixMatch[1],isNgProp="Prop"===ngPrefixMatch[1],isNgEvent="On"===ngPrefixMatch[1],name=name.replace(PREFIX_REGEXP,"").toLowerCase().substr(4+ngPrefixMatch[1].length).replace(/_(.)/g,function(match,letter){return letter.toUpperCase()})):(multiElementMatch=nName.match(MULTI_ELEMENT_DIR_RE))&&directiveIsMultiElement(multiElementMatch[1])&&(attrEndName=(attrStartName=name).substr(0,name.length-5)+"end",name=name.substr(0,name.length-6)),isNgProp||isNgEvent?(attrs[nName]=value,attrsMap[nName]=attr.name,isNgProp?addPropertyDirective(node,directives,nName,name):addEventDirective(directives,nName,name)):(attrsMap[nName=directiveNormalize(name.toLowerCase())]=name,!isNgAttr&&attrs.hasOwnProperty(nName)||(attrs[nName]=value,getBooleanAttrName(node,nName)&&(attrs[nName]=!0)),addAttrInterpolateDirective(node,directives,value,nName,isNgAttr),addDirective(directives,nName,"A",maxPriority,ignoreDirective,attrStartName,attrEndName))}if("input"===nodeName&&"hidden"===node.getAttribute("type")&&node.setAttribute("autocomplete","off"),!cssClassDirectivesEnabled)break;if(isObject(className=node.className)&&(className=className.animVal),isString(className)&&""!==className)for(;match=CLASS_DIRECTIVE_REGEXP.exec(className);)addDirective(directives,nName=directiveNormalize(match[2]),"C",maxPriority,ignoreDirective)&&(attrs[nName]=trim(match[3])),className=className.substr(match.index+match[0].length);break;case NODE_TYPE_TEXT:!function(directives,text){var interpolateFn=$interpolate(text,!0);interpolateFn&&directives.push({priority:0,compile:function(templateNode){var templateNodeParent=templateNode.parent(),hasCompileParent=!!templateNodeParent.length;return hasCompileParent&&compile.$$addBindingClass(templateNodeParent),function(scope,node){var parent=node.parent();hasCompileParent||compile.$$addBindingClass(parent),compile.$$addBindingInfo(parent,interpolateFn.expressions),scope.$watch(interpolateFn,function(value){node[0].nodeValue=value})}}})}(directives,node.nodeValue);break;case NODE_TYPE_COMMENT:if(!commentDirectivesEnabled)break;!function(node,directives,attrs,maxPriority,ignoreDirective){try{var match=COMMENT_DIRECTIVE_REGEXP.exec(node.nodeValue);if(match){var nName=directiveNormalize(match[1]);addDirective(directives,nName,"M",maxPriority,ignoreDirective)&&(attrs[nName]=trim(match[2]))}}catch(e){}}(node,directives,attrs,maxPriority,ignoreDirective)}return directives.sort(byPriority),directives}function groupScan(node,attrStart,attrEnd){var nodes=[],depth=0;if(attrStart&&node.hasAttribute&&node.hasAttribute(attrStart))do{if(!node)throw $compileMinErr("uterdir","Unterminated attribute, found '{0}' but no matching '{1}' found.",attrStart,attrEnd);node.nodeType===NODE_TYPE_ELEMENT&&(node.hasAttribute(attrStart)&&depth++,node.hasAttribute(attrEnd)&&depth--),nodes.push(node),node=node.nextSibling}while(0<depth);else nodes.push(node);return jqLite(nodes)}function groupElementsLinkFnWrapper(linkFn,attrStart,attrEnd){return function(scope,element,attrs,controllers,transcludeFn){return element=groupScan(element[0],attrStart,attrEnd),linkFn(scope,element,attrs,controllers,transcludeFn)}}function compilationGenerator(eager,$compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext){var compiled;return eager?compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext):function(){return compiled||(compiled=compile($compileNodes,transcludeFn,maxPriority,ignoreDirective,previousCompileContext),$compileNodes=transcludeFn=previousCompileContext=null),compiled.apply(this,arguments)}}function applyDirectivesToNode(directives,compileNode,templateAttrs,transcludeFn,jqCollection,originalReplaceDirective,preLinkFns,postLinkFns,previousCompileContext){previousCompileContext=previousCompileContext||{};for(var directive,directiveName,$template,linkFn,directiveValue,terminalPriority=-Number.MAX_VALUE,newScopeDirective=previousCompileContext.newScopeDirective,controllerDirectives=previousCompileContext.controllerDirectives,newIsolateScopeDirective=previousCompileContext.newIsolateScopeDirective,templateDirective=previousCompileContext.templateDirective,nonTlbTranscludeDirective=previousCompileContext.nonTlbTranscludeDirective,hasTranscludeDirective=!1,hasTemplate=!1,hasElementTranscludeDirective=previousCompileContext.hasElementTranscludeDirective,$compileNode=templateAttrs.$$element=jqLite(compileNode),replaceDirective=originalReplaceDirective,childTranscludeFn=transcludeFn,didScanForMultipleTransclusion=!1,mightHaveMultipleTransclusionError=!1,i=0,ii=directives.length;i<ii;i++){var attrStart=(directive=directives[i]).$$start,attrEnd=directive.$$end;if(attrStart&&($compileNode=groupScan(compileNode,attrStart,attrEnd)),$template=void 0,terminalPriority>directive.priority)break;if((directiveValue=directive.scope)&&(directive.templateUrl||(isObject(directiveValue)?(assertNoDuplicate("new/isolated scope",newIsolateScopeDirective||newScopeDirective,directive,$compileNode),newIsolateScopeDirective=directive):assertNoDuplicate("new/isolated scope",newIsolateScopeDirective,directive,$compileNode)),newScopeDirective=newScopeDirective||directive),directiveName=directive.name,!didScanForMultipleTransclusion&&(directive.replace&&(directive.templateUrl||directive.template)||directive.transclude&&!directive.$$tlb)){for(var candidateDirective,scanningIndex=i+1;candidateDirective=directives[scanningIndex++];)if(candidateDirective.transclude&&!candidateDirective.$$tlb||candidateDirective.replace&&(candidateDirective.templateUrl||candidateDirective.template)){mightHaveMultipleTransclusionError=!0;break}didScanForMultipleTransclusion=!0}if(!directive.templateUrl&&directive.controller&&(controllerDirectives=controllerDirectives||createMap(),assertNoDuplicate("'"+directiveName+"' controller",controllerDirectives[directiveName],directive,$compileNode),controllerDirectives[directiveName]=directive),directiveValue=directive.transclude)if(hasTranscludeDirective=!0,directive.$$tlb||(assertNoDuplicate("transclusion",nonTlbTranscludeDirective,directive,$compileNode),nonTlbTranscludeDirective=directive),"element"===directiveValue)hasElementTranscludeDirective=!0,terminalPriority=directive.priority,$template=$compileNode,$compileNode=templateAttrs.$$element=jqLite(compile.$$createComment(directiveName,templateAttrs[directiveName])),compileNode=$compileNode[0],replaceWith(jqCollection,sliceArgs($template),compileNode),childTranscludeFn=compilationGenerator(mightHaveMultipleTransclusionError,$template,transcludeFn,terminalPriority,replaceDirective&&replaceDirective.name,{nonTlbTranscludeDirective:nonTlbTranscludeDirective});else{var slots=createMap();if(isObject(directiveValue)){$template=window.document.createDocumentFragment();var slotMap=createMap(),filledSlots=createMap();for(var slotName in forEach(directiveValue,function(elementSelector,slotName){var optional="?"===elementSelector.charAt(0);elementSelector=optional?elementSelector.substring(1):elementSelector,slotMap[elementSelector]=slotName,slots[slotName]=null,filledSlots[slotName]=optional}),forEach($compileNode.contents(),function(node){var slotName=slotMap[directiveNormalize(nodeName_(node))];slotName?(filledSlots[slotName]=!0,slots[slotName]=slots[slotName]||window.document.createDocumentFragment(),slots[slotName].appendChild(node)):$template.appendChild(node)}),forEach(filledSlots,function(filled,slotName){if(!filled)throw $compileMinErr("reqslot","Required transclusion slot `{0}` was not filled.",slotName)}),slots)if(slots[slotName]){var slotCompileNodes=jqLite(slots[slotName].childNodes);slots[slotName]=compilationGenerator(mightHaveMultipleTransclusionError,slotCompileNodes,transcludeFn)}$template=jqLite($template.childNodes)}else $template=jqLite(jqLiteClone(compileNode)).contents();$compileNode.empty(),(childTranscludeFn=compilationGenerator(mightHaveMultipleTransclusionError,$template,transcludeFn,void 0,void 0,{needsNewScope:directive.$$isolateScope||directive.$$newScope})).$$slots=slots}if(directive.template)if(hasTemplate=!0,assertNoDuplicate("template",templateDirective,directive,$compileNode),directiveValue=isFunction((templateDirective=directive).template)?directive.template($compileNode,templateAttrs):directive.template,directiveValue=denormalizeTemplate(directiveValue),directive.replace){if(replaceDirective=directive,$template=jqLiteIsTextNode(directiveValue)?[]:removeComments(wrapTemplate(directive.templateNamespace,trim(directiveValue))),compileNode=$template[0],1!==$template.length||compileNode.nodeType!==NODE_TYPE_ELEMENT)throw $compileMinErr("tplrt","Template for directive '{0}' must have exactly one root element. {1}",directiveName,"");replaceWith(jqCollection,$compileNode,compileNode);var newTemplateAttrs={$attr:{}},templateDirectives=collectDirectives(compileNode,[],newTemplateAttrs),unprocessedDirectives=directives.splice(i+1,directives.length-(i+1));(newIsolateScopeDirective||newScopeDirective)&&markDirectiveScope(templateDirectives,newIsolateScopeDirective,newScopeDirective),directives=directives.concat(templateDirectives).concat(unprocessedDirectives),mergeTemplateAttributes(templateAttrs,newTemplateAttrs),ii=directives.length}else $compileNode.html(directiveValue);if(directive.templateUrl)hasTemplate=!0,assertNoDuplicate("template",templateDirective,directive,$compileNode),(templateDirective=directive).replace&&(replaceDirective=directive),nodeLinkFn=compileTemplateUrl(directives.splice(i,directives.length-i),$compileNode,templateAttrs,jqCollection,hasTranscludeDirective&&childTranscludeFn,preLinkFns,postLinkFns,{controllerDirectives:controllerDirectives,newScopeDirective:newScopeDirective!==directive&&newScopeDirective,newIsolateScopeDirective:newIsolateScopeDirective,templateDirective:templateDirective,nonTlbTranscludeDirective:nonTlbTranscludeDirective}),ii=directives.length;else if(directive.compile)try{linkFn=directive.compile($compileNode,templateAttrs,childTranscludeFn);var context=directive.$$originalDirective||directive;isFunction(linkFn)?addLinkFns(null,bind(context,linkFn),attrStart,attrEnd):linkFn&&addLinkFns(bind(context,linkFn.pre),bind(context,linkFn.post),attrStart,attrEnd)}catch(e){$exceptionHandler(e,startingTag($compileNode))}directive.terminal&&(nodeLinkFn.terminal=!0,terminalPriority=Math.max(terminalPriority,directive.priority))}return nodeLinkFn.scope=newScopeDirective&&!0===newScopeDirective.scope,nodeLinkFn.transcludeOnThisElement=hasTranscludeDirective,nodeLinkFn.templateOnThisElement=hasTemplate,nodeLinkFn.transclude=childTranscludeFn,previousCompileContext.hasElementTranscludeDirective=hasElementTranscludeDirective,nodeLinkFn;function addLinkFns(pre,post,attrStart,attrEnd){pre&&(attrStart&&(pre=groupElementsLinkFnWrapper(pre,attrStart,attrEnd)),pre.require=directive.require,pre.directiveName=directiveName,newIsolateScopeDirective!==directive&&!directive.$$isolateScope||(pre=cloneAndAnnotateFn(pre,{isolateScope:!0})),preLinkFns.push(pre)),post&&(attrStart&&(post=groupElementsLinkFnWrapper(post,attrStart,attrEnd)),post.require=directive.require,post.directiveName=directiveName,newIsolateScopeDirective!==directive&&!directive.$$isolateScope||(post=cloneAndAnnotateFn(post,{isolateScope:!0})),postLinkFns.push(post))}function nodeLinkFn(childLinkFn,scope,linkNode,$rootElement,boundTranscludeFn){var i,ii,linkFn,isolateScope,controllerScope,elementControllers,transcludeFn,$element,attrs,scopeBindingInfo;for(var name in compileNode===linkNode?$element=(attrs=templateAttrs).$$element:attrs=new Attributes($element=jqLite(linkNode),templateAttrs),controllerScope=scope,newIsolateScopeDirective?isolateScope=scope.$new(!0):newScopeDirective&&(controllerScope=scope.$parent),boundTranscludeFn&&((transcludeFn=function(scope,cloneAttachFn,futureParentElement,slotName){var transcludeControllers;isScope(scope)||(slotName=futureParentElement,futureParentElement=cloneAttachFn,cloneAttachFn=scope,scope=void 0);hasElementTranscludeDirective&&(transcludeControllers=elementControllers);futureParentElement=futureParentElement||(hasElementTranscludeDirective?$element.parent():$element);{if(!slotName)return boundTranscludeFn(scope,cloneAttachFn,transcludeControllers,futureParentElement,scopeToChild);var slotTranscludeFn=boundTranscludeFn.$$slots[slotName];if(slotTranscludeFn)return slotTranscludeFn(scope,cloneAttachFn,transcludeControllers,futureParentElement,scopeToChild);if(isUndefined(slotTranscludeFn))throw $compileMinErr("noslot",'No parent directive that requires a transclusion with slot name "{0}". Element: {1}',slotName,startingTag($element))}}).$$boundTransclude=boundTranscludeFn,transcludeFn.isSlotFilled=function(slotName){return!!boundTranscludeFn.$$slots[slotName]}),controllerDirectives&&(elementControllers=function($element,attrs,transcludeFn,controllerDirectives,isolateScope,scope,newIsolateScopeDirective){var elementControllers=createMap();for(var controllerKey in controllerDirectives){var directive=controllerDirectives[controllerKey],locals={$scope:directive===newIsolateScopeDirective||directive.$$isolateScope?isolateScope:scope,$element:$element,$attrs:attrs,$transclude:transcludeFn},controller=directive.controller;"@"===controller&&(controller=attrs[directive.name]);var controllerInstance=$controller(controller,locals,!0,directive.controllerAs);elementControllers[directive.name]=controllerInstance,$element.data("$"+directive.name+"Controller",controllerInstance.instance)}return elementControllers}($element,attrs,transcludeFn,controllerDirectives,isolateScope,scope,newIsolateScopeDirective)),newIsolateScopeDirective&&(compile.$$addScopeInfo($element,isolateScope,!0,!(templateDirective&&(templateDirective===newIsolateScopeDirective||templateDirective===newIsolateScopeDirective.$$originalDirective))),compile.$$addScopeClass($element,!0),isolateScope.$$isolateBindings=newIsolateScopeDirective.$$isolateBindings,(scopeBindingInfo=initializeDirectiveBindings(scope,attrs,isolateScope,isolateScope.$$isolateBindings,newIsolateScopeDirective)).removeWatches&&isolateScope.$on("$destroy",scopeBindingInfo.removeWatches)),elementControllers){var controllerDirective=controllerDirectives[name],controller=elementControllers[name],bindings=controllerDirective.$$bindings.bindToController;controller.instance=controller(),$element.data("$"+controllerDirective.name+"Controller",controller.instance),controller.bindingInfo=initializeDirectiveBindings(controllerScope,attrs,controller.instance,bindings,controllerDirective)}for(forEach(controllerDirectives,function(controllerDirective,name){var require=controllerDirective.require;controllerDirective.bindToController&&!isArray(require)&&isObject(require)&&extend(elementControllers[name].instance,getControllers(name,require,$element,elementControllers))}),forEach(elementControllers,function(controller){var controllerInstance=controller.instance;if(isFunction(controllerInstance.$onChanges))try{controllerInstance.$onChanges(controller.bindingInfo.initialChanges)}catch(e){$exceptionHandler(e)}if(isFunction(controllerInstance.$onInit))try{controllerInstance.$onInit()}catch(e){$exceptionHandler(e)}isFunction(controllerInstance.$doCheck)&&(controllerScope.$watch(function(){controllerInstance.$doCheck()}),controllerInstance.$doCheck()),isFunction(controllerInstance.$onDestroy)&&controllerScope.$on("$destroy",function(){controllerInstance.$onDestroy()})}),i=0,ii=preLinkFns.length;i<ii;i++)invokeLinkFn(linkFn=preLinkFns[i],linkFn.isolateScope?isolateScope:scope,$element,attrs,linkFn.require&&getControllers(linkFn.directiveName,linkFn.require,$element,elementControllers),transcludeFn);var scopeToChild=scope;for(newIsolateScopeDirective&&(newIsolateScopeDirective.template||null===newIsolateScopeDirective.templateUrl)&&(scopeToChild=isolateScope),childLinkFn&&childLinkFn(scopeToChild,linkNode.childNodes,void 0,boundTranscludeFn),i=postLinkFns.length-1;0<=i;i--)invokeLinkFn(linkFn=postLinkFns[i],linkFn.isolateScope?isolateScope:scope,$element,attrs,linkFn.require&&getControllers(linkFn.directiveName,linkFn.require,$element,elementControllers),transcludeFn);forEach(elementControllers,function(controller){var controllerInstance=controller.instance;isFunction(controllerInstance.$postLink)&&controllerInstance.$postLink()})}}function getControllers(directiveName,require,$element,elementControllers){var value;if(isString(require)){var match=require.match(REQUIRE_PREFIX_REGEXP),name=require.substring(match[0].length),inheritType=match[1]||match[3],optional="?"===match[2];if("^^"===inheritType?$element=$element.parent():value=(value=elementControllers&&elementControllers[name])&&value.instance,!value){var dataName="$"+name+"Controller";value="^^"===inheritType&&$element[0]&&$element[0].nodeType===NODE_TYPE_DOCUMENT?null:inheritType?$element.inheritedData(dataName):$element.data(dataName)}if(!value&&!optional)throw $compileMinErr("ctreq","Controller '{0}', required by directive '{1}', can't be found!",name,directiveName)}else if(isArray(require)){value=[];for(var i=0,ii=require.length;i<ii;i++)value[i]=getControllers(directiveName,require[i],$element,elementControllers)}else isObject(require)&&(value={},forEach(require,function(controller,property){value[property]=getControllers(directiveName,controller,$element,elementControllers)}));return value||null}function markDirectiveScope(directives,isolateScope,newScope){for(var j=0,jj=directives.length;j<jj;j++)directives[j]=inherit(directives[j],{$$isolateScope:isolateScope,$$newScope:newScope})}function addDirective(tDirectives,name,location,maxPriority,ignoreDirective,startAttrName,endAttrName){if(name===ignoreDirective)return null;var match=null;if(hasDirectives.hasOwnProperty(name))for(var directive,directives=$injector.get(name+"Directive"),i=0,ii=directives.length;i<ii;i++)if(directive=directives[i],(isUndefined(maxPriority)||maxPriority>directive.priority)&&-1!==directive.restrict.indexOf(location)){if(startAttrName&&(directive=inherit(directive,{$$start:startAttrName,$$end:endAttrName})),!directive.$$bindings){var bindings=directive.$$bindings=parseDirectiveBindings(directive,directive.name);isObject(bindings.isolateScope)&&(directive.$$isolateBindings=bindings.isolateScope)}tDirectives.push(directive),match=directive}return match}function directiveIsMultiElement(name){if(hasDirectives.hasOwnProperty(name))for(var directives=$injector.get(name+"Directive"),i=0,ii=directives.length;i<ii;i++)if(directives[i].multiElement)return!0;return!1}function mergeTemplateAttributes(dst,src){var srcAttr=src.$attr,dstAttr=dst.$attr;forEach(dst,function(value,key){"$"!==key.charAt(0)&&(src[key]&&src[key]!==value&&(value.length?value+=("style"===key?";":" ")+src[key]:value=src[key]),dst.$set(key,value,!0,srcAttr[key]))}),forEach(src,function(value,key){dst.hasOwnProperty(key)||"$"===key.charAt(0)||(dst[key]=value,"class"!==key&&"style"!==key&&(dstAttr[key]=srcAttr[key]))})}function compileTemplateUrl(directives,$compileNode,tAttrs,$rootElement,childTranscludeFn,preLinkFns,postLinkFns,previousCompileContext){var afterTemplateNodeLinkFn,afterTemplateChildLinkFn,linkQueue=[],beforeTemplateCompileNode=$compileNode[0],origAsyncDirective=directives.shift(),derivedSyncDirective=inherit(origAsyncDirective,{templateUrl:null,transclude:null,replace:null,$$originalDirective:origAsyncDirective}),templateUrl=isFunction(origAsyncDirective.templateUrl)?origAsyncDirective.templateUrl($compileNode,tAttrs):origAsyncDirective.templateUrl,templateNamespace=origAsyncDirective.templateNamespace;return $compileNode.empty(),$templateRequest(templateUrl).then(function(content){var compileNode,tempTemplateAttrs,$template,childBoundTranscludeFn;if(content=denormalizeTemplate(content),origAsyncDirective.replace){if($template=jqLiteIsTextNode(content)?[]:removeComments(wrapTemplate(templateNamespace,trim(content))),compileNode=$template[0],1!==$template.length||compileNode.nodeType!==NODE_TYPE_ELEMENT)throw $compileMinErr("tplrt","Template for directive '{0}' must have exactly one root element. {1}",origAsyncDirective.name,templateUrl);tempTemplateAttrs={$attr:{}},replaceWith($rootElement,$compileNode,compileNode);var templateDirectives=collectDirectives(compileNode,[],tempTemplateAttrs);isObject(origAsyncDirective.scope)&&markDirectiveScope(templateDirectives,!0),directives=templateDirectives.concat(directives),mergeTemplateAttributes(tAttrs,tempTemplateAttrs)}else compileNode=beforeTemplateCompileNode,$compileNode.html(content);for(directives.unshift(derivedSyncDirective),afterTemplateNodeLinkFn=applyDirectivesToNode(directives,compileNode,tAttrs,childTranscludeFn,$compileNode,origAsyncDirective,preLinkFns,postLinkFns,previousCompileContext),forEach($rootElement,function(node,i){node===compileNode&&($rootElement[i]=$compileNode[0])}),afterTemplateChildLinkFn=compileNodes($compileNode[0].childNodes,childTranscludeFn);linkQueue.length;){var scope=linkQueue.shift(),beforeTemplateLinkNode=linkQueue.shift(),linkRootElement=linkQueue.shift(),boundTranscludeFn=linkQueue.shift(),linkNode=$compileNode[0];if(!scope.$$destroyed){if(beforeTemplateLinkNode!==beforeTemplateCompileNode){var oldClasses=beforeTemplateLinkNode.className;previousCompileContext.hasElementTranscludeDirective&&origAsyncDirective.replace||(linkNode=jqLiteClone(compileNode)),replaceWith(linkRootElement,jqLite(beforeTemplateLinkNode),linkNode),safeAddClass(jqLite(linkNode),oldClasses)}childBoundTranscludeFn=afterTemplateNodeLinkFn.transcludeOnThisElement?createBoundTranscludeFn(scope,afterTemplateNodeLinkFn.transclude,boundTranscludeFn):boundTranscludeFn,afterTemplateNodeLinkFn(afterTemplateChildLinkFn,scope,linkNode,$rootElement,childBoundTranscludeFn)}}linkQueue=null}).catch(function(error){isError(error)&&$exceptionHandler(error)}),function(ignoreChildLinkFn,scope,node,rootElement,boundTranscludeFn){var childBoundTranscludeFn=boundTranscludeFn;scope.$$destroyed||(linkQueue?linkQueue.push(scope,node,rootElement,childBoundTranscludeFn):(afterTemplateNodeLinkFn.transcludeOnThisElement&&(childBoundTranscludeFn=createBoundTranscludeFn(scope,afterTemplateNodeLinkFn.transclude,boundTranscludeFn)),afterTemplateNodeLinkFn(afterTemplateChildLinkFn,scope,node,rootElement,childBoundTranscludeFn)))}}function byPriority(a,b){var diff=b.priority-a.priority;return 0!=diff?diff:a.name!==b.name?a.name<b.name?-1:1:a.index-b.index}function assertNoDuplicate(what,previousDirective,directive,element){function wrapModuleNameIfDefined(moduleName){return moduleName?" (module: "+moduleName+")":""}if(previousDirective)throw $compileMinErr("multidir","Multiple directives [{0}{1}, {2}{3}] asking for {4} on: {5}",previousDirective.name,wrapModuleNameIfDefined(previousDirective.$$moduleName),directive.name,wrapModuleNameIfDefined(directive.$$moduleName),what,startingTag(element))}function wrapTemplate(type,template){switch(type=lowercase(type||"html")){case"svg":case"math":var wrapper=window.document.createElement("div");return wrapper.innerHTML="<"+type+">"+template+"</"+type+">",wrapper.childNodes[0].childNodes;default:return template}}function sanitizeSrcsetPropertyValue(value){return sanitizeSrcset($sce.valueOf(value),"ng-prop-srcset")}function addPropertyDirective(node,directives,attrName,propName){if(EVENT_HANDLER_ATTR_REGEXP.test(propName))throw $compileMinErr("nodomevents","Property bindings for HTML DOM event properties are disallowed");var nodeName=nodeName_(node),trustedContext=function(nodeName,propNormalizedName){var prop=propNormalizedName.toLowerCase();return PROP_CONTEXTS[nodeName+"|"+prop]||PROP_CONTEXTS["*|"+prop]}(nodeName,propName),sanitizer=identity;"srcset"!==propName||"img"!==nodeName&&"source"!==nodeName?trustedContext&&(sanitizer=$sce.getTrusted.bind($sce,trustedContext)):sanitizer=sanitizeSrcsetPropertyValue,directives.push({priority:100,compile:function(_,attr){var ngPropGetter=$parse(attr[attrName]),ngPropWatch=$parse(attr[attrName],function(val){return $sce.valueOf(val)});return{pre:function(scope,$element){function applyPropValue(){var propValue=ngPropGetter(scope);$element.prop(propName,sanitizer(propValue))}applyPropValue(),scope.$watch(ngPropWatch,applyPropValue)}}}})}function addEventDirective(directives,attrName,eventName){directives.push(createEventDirective($parse,$rootScope,$exceptionHandler,attrName,eventName,!1))}function addAttrInterpolateDirective(node,directives,value,name,isNgAttr){var nodeName=nodeName_(node),trustedContext=function(nodeName,attrNormalizedName){return"srcdoc"===attrNormalizedName?$sce.HTML:"src"===attrNormalizedName||"ngSrc"===attrNormalizedName?-1===["img","video","audio","source","track"].indexOf(nodeName)?$sce.RESOURCE_URL:$sce.MEDIA_URL:"xlinkHref"===attrNormalizedName?"image"===nodeName?$sce.MEDIA_URL:"a"===nodeName?$sce.URL:$sce.RESOURCE_URL:"form"===nodeName&&"action"===attrNormalizedName||"base"===nodeName&&"href"===attrNormalizedName||"link"===nodeName&&"href"===attrNormalizedName?$sce.RESOURCE_URL:"a"!==nodeName||"href"!==attrNormalizedName&&"ngHref"!==attrNormalizedName?void 0:$sce.URL}(nodeName,name),mustHaveExpression=!isNgAttr,allOrNothing=ALL_OR_NOTHING_ATTRS[name]||isNgAttr,interpolateFn=$interpolate(value,mustHaveExpression,trustedContext,allOrNothing);if(interpolateFn){if("multiple"===name&&"select"===nodeName)throw $compileMinErr("selmulti","Binding to the 'multiple' attribute is not supported. Element: {0}",startingTag(node));if(EVENT_HANDLER_ATTR_REGEXP.test(name))throw $compileMinErr("nodomevents","Interpolations for HTML DOM event attributes are disallowed");directives.push({priority:100,compile:function(){return{pre:function(scope,element,attr){var $$observers=attr.$$observers||(attr.$$observers=createMap()),newValue=attr[name];newValue!==value&&(interpolateFn=newValue&&$interpolate(newValue,!0,trustedContext,allOrNothing),value=newValue),interpolateFn&&(attr[name]=interpolateFn(scope),($$observers[name]||($$observers[name]=[])).$$inter=!0,(attr.$$observers&&attr.$$observers[name].$$scope||scope).$watch(interpolateFn,function(newValue,oldValue){"class"===name&&newValue!==oldValue?attr.$updateClass(newValue,oldValue):attr.$set(name,newValue)}))}}}})}}function replaceWith($rootElement,elementsToRemove,newNode){var i,ii,firstElementToRemove=elementsToRemove[0],removeCount=elementsToRemove.length,parent=firstElementToRemove.parentNode;if($rootElement)for(i=0,ii=$rootElement.length;i<ii;i++)if($rootElement[i]===firstElementToRemove){$rootElement[i++]=newNode;for(var j=i,j2=j+removeCount-1,jj=$rootElement.length;j<jj;j++,j2++)j2<jj?$rootElement[j]=$rootElement[j2]:delete $rootElement[j];$rootElement.length-=removeCount-1,$rootElement.context===firstElementToRemove&&($rootElement.context=newNode);break}parent&&parent.replaceChild(newNode,firstElementToRemove);var fragment=window.document.createDocumentFragment();for(i=0;i<removeCount;i++)fragment.appendChild(elementsToRemove[i]);for(jqLite.hasData(firstElementToRemove)&&(jqLite.data(newNode,jqLite.data(firstElementToRemove)),jqLite(firstElementToRemove).off("$destroy")),jqLite.cleanData(fragment.querySelectorAll("*")),i=1;i<removeCount;i++)delete elementsToRemove[i];elementsToRemove[0]=newNode,elementsToRemove.length=1}function cloneAndAnnotateFn(fn,annotation){return extend(function(){return fn.apply(null,arguments)},fn,annotation)}function invokeLinkFn(linkFn,scope,$element,attrs,controllers,transcludeFn){try{linkFn(scope,$element,attrs,controllers,transcludeFn)}catch(e){$exceptionHandler(e,startingTag($element))}}function strictBindingsCheck(attrName,directiveName){if(strictComponentBindingsEnabled)throw $compileMinErr("missingattr","Attribute '{0}' of '{1}' is non-optional and must be set!",attrName,directiveName)}function initializeDirectiveBindings(scope,attrs,destination,bindings,directive){var changes,removeWatchCollection=[],initialChanges={};function recordChanges(key,currentValue,previousValue){isFunction(destination.$onChanges)&&!simpleCompare(currentValue,previousValue)&&(onChangesQueue||(scope.$$postDigest(flushOnChangesQueue),onChangesQueue=[]),changes||(changes={},onChangesQueue.push(triggerOnChangesHook)),changes[key]&&(previousValue=changes[key].previousValue),changes[key]=new SimpleChange(previousValue,currentValue))}function triggerOnChangesHook(){destination.$onChanges(changes),changes=void 0}return forEach(bindings,function(definition,scopeName){var lastValue,parentGet,parentSet,compare,removeWatch,attrName=definition.attrName,optional=definition.optional;switch(definition.mode){case"@":optional||hasOwnProperty.call(attrs,attrName)||(strictBindingsCheck(attrName,directive.name),destination[scopeName]=attrs[attrName]=void 0),removeWatch=attrs.$observe(attrName,function(value){if(isString(value)||isBoolean(value)){var oldValue=destination[scopeName];recordChanges(scopeName,value,oldValue),destination[scopeName]=value}}),attrs.$$observers[attrName].$$scope=scope,isString(lastValue=attrs[attrName])?destination[scopeName]=$interpolate(lastValue)(scope):isBoolean(lastValue)&&(destination[scopeName]=lastValue),initialChanges[scopeName]=new SimpleChange(_UNINITIALIZED_VALUE,destination[scopeName]),removeWatchCollection.push(removeWatch);break;case"=":if(!hasOwnProperty.call(attrs,attrName)){if(optional)break;strictBindingsCheck(attrName,directive.name),attrs[attrName]=void 0}if(optional&&!attrs[attrName])break;parentGet=$parse(attrs[attrName]),compare=parentGet.literal?equals:simpleCompare,parentSet=parentGet.assign||function(){throw lastValue=destination[scopeName]=parentGet(scope),$compileMinErr("nonassign","Expression '{0}' in attribute '{1}' used with directive '{2}' is non-assignable!",attrs[attrName],attrName,directive.name)},lastValue=destination[scopeName]=parentGet(scope);var parentValueWatch=function(parentValue){return compare(parentValue,destination[scopeName])||(compare(parentValue,lastValue)?parentSet(scope,parentValue=destination[scopeName]):destination[scopeName]=parentValue),lastValue=parentValue};parentValueWatch.$stateful=!0,removeWatch=definition.collection?scope.$watchCollection(attrs[attrName],parentValueWatch):scope.$watch($parse(attrs[attrName],parentValueWatch),null,parentGet.literal),removeWatchCollection.push(removeWatch);break;case"<":if(!hasOwnProperty.call(attrs,attrName)){if(optional)break;strictBindingsCheck(attrName,directive.name),attrs[attrName]=void 0}if(optional&&!attrs[attrName])break;var isLiteral=(parentGet=$parse(attrs[attrName])).literal,initialValue=destination[scopeName]=parentGet(scope);initialChanges[scopeName]=new SimpleChange(_UNINITIALIZED_VALUE,destination[scopeName]),removeWatch=scope[definition.collection?"$watchCollection":"$watch"](parentGet,function(newValue,oldValue){if(oldValue===newValue){if(oldValue===initialValue||isLiteral&&equals(oldValue,initialValue))return;oldValue=initialValue}recordChanges(scopeName,newValue,oldValue),destination[scopeName]=newValue}),removeWatchCollection.push(removeWatch);break;case"&":if(optional||hasOwnProperty.call(attrs,attrName)||strictBindingsCheck(attrName,directive.name),(parentGet=attrs.hasOwnProperty(attrName)?$parse(attrs[attrName]):noop)===noop&&optional)break;destination[scopeName]=function(locals){return parentGet(scope,locals)}}}),{initialChanges:initialChanges,removeWatches:removeWatchCollection.length&&function(){for(var i=0,ii=removeWatchCollection.length;i<ii;++i)removeWatchCollection[i]()}}}}]}function SimpleChange(previous,current){this.previousValue=previous,this.currentValue=current}$CompileProvider.$inject=["$provide","$$sanitizeUriProvider"],SimpleChange.prototype.isFirstChange=function(){return this.previousValue===_UNINITIALIZED_VALUE};var PREFIX_REGEXP=/^((?:x|data)[:\-_])/i,SPECIAL_CHARS_REGEXP=/[:\-_]+(.)/g;function directiveNormalize(name){return name.replace(PREFIX_REGEXP,"").replace(SPECIAL_CHARS_REGEXP,function(_,letter,offset){return offset?letter.toUpperCase():letter})}function tokenDifference(str1,str2){var values="",tokens1=str1.split(/\s+/),tokens2=str2.split(/\s+/);outer:for(var i=0;i<tokens1.length;i++){for(var token=tokens1[i],j=0;j<tokens2.length;j++)if(token===tokens2[j])continue outer;values+=(0<values.length?" ":"")+token}return values}function removeComments(jqNodes){var i=(jqNodes=jqLite(jqNodes)).length;if(i<=1)return jqNodes;for(;i--;){var node=jqNodes[i];(node.nodeType===NODE_TYPE_COMMENT||node.nodeType===NODE_TYPE_TEXT&&""===node.nodeValue.trim())&&splice.call(jqNodes,i,1)}return jqNodes}var $controllerMinErr=minErr("$controller"),CNTRL_REG=/^(\S+)(\s+as\s+([\w$]+))?$/;function $ControllerProvider(){var controllers={};this.has=function(name){return controllers.hasOwnProperty(name)},this.register=function(name,constructor){assertNotHasOwnProperty(name,"controller"),isObject(name)?extend(controllers,name):controllers[name]=constructor},this.$get=["$injector",function($injector){return function(expression,locals,later,ident){var instance,match,constructor,identifier;if(later=!0===later,ident&&isString(ident)&&(identifier=ident),isString(expression)){if(!(match=expression.match(CNTRL_REG)))throw $controllerMinErr("ctrlfmt","Badly formed controller string '{0}'. Must match `__name__ as __id__` or `__name__`.",expression);if(constructor=match[1],identifier=identifier||match[3],!(expression=controllers.hasOwnProperty(constructor)?controllers[constructor]:function(obj,path,bindFnToScope){if(!path)return obj;for(var key,keys=path.split("."),lastInstance=obj,len=keys.length,i=0;i<len;i++)key=keys[i],obj=obj&&(lastInstance=obj)[key];return!bindFnToScope&&isFunction(obj)?bind(lastInstance,obj):obj}(locals.$scope,constructor,!0)))throw $controllerMinErr("ctrlreg","The controller with the name '{0}' is not registered.",constructor);assertArgFn(expression,constructor,!0)}if(later){var controllerPrototype=(isArray(expression)?expression[expression.length-1]:expression).prototype;return instance=Object.create(controllerPrototype||null),identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name),extend(function(){var result=$injector.invoke(expression,instance,locals,constructor);return result!==instance&&(isObject(result)||isFunction(result))&&(instance=result,identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name)),instance},{instance:instance,identifier:identifier})}return instance=$injector.instantiate(expression,locals,constructor),identifier&&addIdentifier(locals,identifier,instance,constructor||expression.name),instance};function addIdentifier(locals,identifier,instance,name){if(!locals||!isObject(locals.$scope))throw minErr("$controller")("noscp","Cannot export controller '{0}' as '{1}'! No $scope object provided via `locals`.",name,identifier);locals.$scope[identifier]=instance}}]}function $DocumentProvider(){this.$get=["$window",function(window){return jqLite(window.document)}]}function $$IsDocumentHiddenProvider(){this.$get=["$document","$rootScope",function($document,$rootScope){var doc=$document[0],hidden=doc&&doc.hidden;function changeListener(){hidden=doc.hidden}return $document.on("visibilitychange",changeListener),$rootScope.$on("$destroy",function(){$document.off("visibilitychange",changeListener)}),function(){return hidden}}]}function $ExceptionHandlerProvider(){this.$get=["$log",function($log){return function(exception,cause){$log.error.apply($log,arguments)}}]}function $$ForceReflowProvider(){this.$get=["$document",function($document){return function(domNode){return domNode?!domNode.nodeType&&domNode instanceof jqLite&&(domNode=domNode[0]):domNode=$document[0].body,domNode.offsetWidth+1}}]}var APPLICATION_JSON="application/json",CONTENT_TYPE_APPLICATION_JSON={"Content-Type":APPLICATION_JSON+";charset=utf-8"},JSON_START=/^\[|^\{(?!\{)/,JSON_ENDS={"[":/]$/,"{":/}$/},JSON_PROTECTION_PREFIX=/^\)]\}',?\n/,$httpMinErr=minErr("$http");function serializeValue(v){return isObject(v)?isDate(v)?v.toISOString():toJson(v):v}function $HttpParamSerializerProvider(){this.$get=function(){return function(params){if(!params)return"";var parts=[];return forEachSorted(params,function(value,key){null===value||isUndefined(value)||isFunction(value)||(isArray(value)?forEach(value,function(v){parts.push(encodeUriQuery(key)+"="+encodeUriQuery(serializeValue(v)))}):parts.push(encodeUriQuery(key)+"="+encodeUriQuery(serializeValue(value))))}),parts.join("&")}}}function $HttpParamSerializerJQLikeProvider(){this.$get=function(){return function(params){if(!params)return"";var parts=[];return function serialize(toSerialize,prefix,topLevel){isArray(toSerialize)?forEach(toSerialize,function(value,index){serialize(value,prefix+"["+(isObject(value)?index:"")+"]")}):isObject(toSerialize)&&!isDate(toSerialize)?forEachSorted(toSerialize,function(value,key){serialize(value,prefix+(topLevel?"":"[")+key+(topLevel?"":"]"))}):(isFunction(toSerialize)&&(toSerialize=toSerialize()),parts.push(encodeUriQuery(prefix)+"="+(null==toSerialize?"":encodeUriQuery(serializeValue(toSerialize)))))}(params,"",!0),parts.join("&")}}}function defaultHttpResponseTransform(data,headers){if(isString(data)){var tempData=data.replace(JSON_PROTECTION_PREFIX,"").trim();if(tempData){var contentType=headers("Content-Type"),hasJsonContentType=contentType&&0===contentType.indexOf(APPLICATION_JSON);if(hasJsonContentType||function(str){var jsonStart=str.match(JSON_START);return jsonStart&&JSON_ENDS[jsonStart[0]].test(str)}(tempData))try{data=fromJson(tempData)}catch(e){if(!hasJsonContentType)return data;throw $httpMinErr("baddata",'Data must be a valid JSON object. Received: "{0}". Parse error: "{1}"',data,e)}}}return data}function parseHeaders(headers){var i,parsed=createMap();function fillInParsed(key,val){key&&(parsed[key]=parsed[key]?parsed[key]+", "+val:val)}return isString(headers)?forEach(headers.split("\n"),function(line){i=line.indexOf(":"),fillInParsed(lowercase(trim(line.substr(0,i))),trim(line.substr(i+1)))}):isObject(headers)&&forEach(headers,function(headerVal,headerKey){fillInParsed(lowercase(headerKey),trim(headerVal))}),parsed}function headersGetter(headers){var headersObj;return function(name){if(headersObj=headersObj||parseHeaders(headers),name){var value=headersObj[lowercase(name)];return void 0===value&&(value=null),value}return headersObj}}function transformData(data,headers,status,fns){return isFunction(fns)?fns(data,headers,status):(forEach(fns,function(fn){data=fn(data,headers,status)}),data)}function isSuccess(status){return 200<=status&&status<300}function $HttpProvider(){var defaults=this.defaults={transformResponse:[defaultHttpResponseTransform],transformRequest:[function(d){return!isObject(d)||function(obj){return"[object File]"===toString.call(obj)}(d)||function(obj){return"[object Blob]"===toString.call(obj)}(d)||function(obj){return"[object FormData]"===toString.call(obj)}(d)?d:toJson(d)}],headers:{common:{Accept:"application/json, text/plain, */*"},post:shallowCopy(CONTENT_TYPE_APPLICATION_JSON),put:shallowCopy(CONTENT_TYPE_APPLICATION_JSON),patch:shallowCopy(CONTENT_TYPE_APPLICATION_JSON)},xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",paramSerializer:"$httpParamSerializer",jsonpCallbackParam:"callback"},useApplyAsync=!1;this.useApplyAsync=function(value){return isDefined(value)?(useApplyAsync=!!value,this):useApplyAsync};var interceptorFactories=this.interceptors=[],xsrfWhitelistedOrigins=this.xsrfWhitelistedOrigins=[];this.$get=["$browser","$httpBackend","$$cookieReader","$cacheFactory","$rootScope","$q","$injector","$sce",function($browser,$httpBackend,$$cookieReader,$cacheFactory,$rootScope,$q,$injector,$sce){var defaultCache=$cacheFactory("$http");defaults.paramSerializer=isString(defaults.paramSerializer)?$injector.get(defaults.paramSerializer):defaults.paramSerializer;var reversedInterceptors=[];forEach(interceptorFactories,function(interceptorFactory){reversedInterceptors.unshift(isString(interceptorFactory)?$injector.get(interceptorFactory):$injector.invoke(interceptorFactory))});var urlIsAllowedOrigin=function(whitelistedOriginUrls){var parsedAllowedOriginUrls=[originUrl].concat(whitelistedOriginUrls.map(urlResolve));return function(requestUrl){var parsedUrl=urlResolve(requestUrl);return parsedAllowedOriginUrls.some(urlsAreSameOrigin.bind(null,parsedUrl))}}(xsrfWhitelistedOrigins);function $http(requestConfig){if(!isObject(requestConfig))throw minErr("$http")("badreq","Http request configuration must be an object.  Received: {0}",requestConfig);if(!isString($sce.valueOf(requestConfig.url)))throw minErr("$http")("badreq","Http request configuration url must be a string or a $sce trusted object.  Received: {0}",requestConfig.url);var config=extend({method:"get",transformRequest:defaults.transformRequest,transformResponse:defaults.transformResponse,paramSerializer:defaults.paramSerializer,jsonpCallbackParam:defaults.jsonpCallbackParam},requestConfig);config.headers=function(config){var defHeaderName,lowercaseDefHeaderName,reqHeaderName,defHeaders=defaults.headers,reqHeaders=extend({},config.headers);defHeaders=extend({},defHeaders.common,defHeaders[lowercase(config.method)]);defaultHeadersIteration:for(defHeaderName in defHeaders){for(reqHeaderName in lowercaseDefHeaderName=lowercase(defHeaderName),reqHeaders)if(lowercase(reqHeaderName)===lowercaseDefHeaderName)continue defaultHeadersIteration;reqHeaders[defHeaderName]=defHeaders[defHeaderName]}return function(headers,config){var headerContent,processedHeaders={};return forEach(headers,function(headerFn,header){isFunction(headerFn)?null!=(headerContent=headerFn(config))&&(processedHeaders[header]=headerContent):processedHeaders[header]=headerFn}),processedHeaders}(reqHeaders,shallowCopy(config))}(requestConfig),config.method=uppercase(config.method),config.paramSerializer=isString(config.paramSerializer)?$injector.get(config.paramSerializer):config.paramSerializer,$browser.$$incOutstandingRequestCount("$http");var requestInterceptors=[],responseInterceptors=[],promise=$q.resolve(config);return forEach(reversedInterceptors,function(interceptor){(interceptor.request||interceptor.requestError)&&requestInterceptors.unshift(interceptor.request,interceptor.requestError),(interceptor.response||interceptor.responseError)&&responseInterceptors.push(interceptor.response,interceptor.responseError)}),promise=(promise=chainInterceptors(promise=(promise=chainInterceptors(promise,requestInterceptors)).then(function(config){var headers=config.headers,reqData=transformData(config.data,headersGetter(headers),void 0,config.transformRequest);isUndefined(reqData)&&forEach(headers,function(value,header){"content-type"===lowercase(header)&&delete headers[header]});isUndefined(config.withCredentials)&&!isUndefined(defaults.withCredentials)&&(config.withCredentials=defaults.withCredentials);return function(config,reqData){var cache,cachedResp,deferred=$q.defer(),promise=deferred.promise,reqHeaders=config.headers,isJsonp="jsonp"===lowercase(config.method),url=config.url;isJsonp?url=$sce.getTrustedResourceUrl(url):isString(url)||(url=$sce.valueOf(url));url=function(url,serializedParams){0<serializedParams.length&&(url+=(-1===url.indexOf("?")?"?":"&")+serializedParams);return url}(url,config.paramSerializer(config.params)),isJsonp&&(url=function(url,cbKey){var parts=url.split("?");if(2<parts.length)throw $httpMinErr("badjsonp",'Illegal use more than one "?", in url, "{1}"',url);return forEach(parseKeyValue(parts[1]),function(value,key){if("JSON_CALLBACK"===value)throw $httpMinErr("badjsonp",'Illegal use of JSON_CALLBACK in url, "{0}"',url);if(key===cbKey)throw $httpMinErr("badjsonp",'Illegal use of callback param, "{0}", in url, "{1}"',cbKey,url)}),url+=(-1===url.indexOf("?")?"?":"&")+cbKey+"=JSON_CALLBACK"}(url,config.jsonpCallbackParam));$http.pendingRequests.push(config),promise.then(removePendingReq,removePendingReq),!config.cache&&!defaults.cache||!1===config.cache||"GET"!==config.method&&"JSONP"!==config.method||(cache=isObject(config.cache)?config.cache:isObject(defaults.cache)?defaults.cache:defaultCache);cache&&(isDefined(cachedResp=cache.get(url))?isPromiseLike(cachedResp)?cachedResp.then(resolvePromiseWithResult,resolvePromiseWithResult):isArray(cachedResp)?resolvePromise(cachedResp[1],cachedResp[0],shallowCopy(cachedResp[2]),cachedResp[3],cachedResp[4]):resolvePromise(cachedResp,200,{},"OK","complete"):cache.put(url,promise));if(isUndefined(cachedResp)){var xsrfValue=urlIsAllowedOrigin(config.url)?$$cookieReader()[config.xsrfCookieName||defaults.xsrfCookieName]:void 0;xsrfValue&&(reqHeaders[config.xsrfHeaderName||defaults.xsrfHeaderName]=xsrfValue),$httpBackend(config.method,url,reqData,function(status,response,headersString,statusText,xhrStatus){cache&&(isSuccess(status)?cache.put(url,[status,response,parseHeaders(headersString),statusText,xhrStatus]):cache.remove(url));function resolveHttpPromise(){resolvePromise(response,status,headersString,statusText,xhrStatus)}useApplyAsync?$rootScope.$applyAsync(resolveHttpPromise):(resolveHttpPromise(),$rootScope.$$phase||$rootScope.$apply())},reqHeaders,config.timeout,config.withCredentials,config.responseType,createApplyHandlers(config.eventHandlers),createApplyHandlers(config.uploadEventHandlers))}return promise;function createApplyHandlers(eventHandlers){if(eventHandlers){var applyHandlers={};return forEach(eventHandlers,function(eventHandler,key){applyHandlers[key]=function(event){function callEventHandler(){eventHandler(event)}useApplyAsync?$rootScope.$applyAsync(callEventHandler):$rootScope.$$phase?callEventHandler():$rootScope.$apply(callEventHandler)}}),applyHandlers}}function resolvePromise(response,status,headers,statusText,xhrStatus){(isSuccess(status=-1<=status?status:0)?deferred.resolve:deferred.reject)({data:response,status:status,headers:headersGetter(headers),config:config,statusText:statusText,xhrStatus:xhrStatus})}function resolvePromiseWithResult(result){resolvePromise(result.data,result.status,shallowCopy(result.headers()),result.statusText,result.xhrStatus)}function removePendingReq(){var idx=$http.pendingRequests.indexOf(config);-1!==idx&&$http.pendingRequests.splice(idx,1)}}(config,reqData).then(transformResponse,transformResponse)}),responseInterceptors)).finally(function(){$browser.$$completeOutstandingRequest(noop,"$http")});function chainInterceptors(promise,interceptors){for(var i=0,ii=interceptors.length;i<ii;){var thenFn=interceptors[i++],rejectFn=interceptors[i++];promise=promise.then(thenFn,rejectFn)}return interceptors.length=0,promise}function transformResponse(response){var resp=extend({},response);return resp.data=transformData(response.data,response.headers,response.status,config.transformResponse),isSuccess(response.status)?resp:$q.reject(resp)}}return $http.pendingRequests=[],function(names){forEach(arguments,function(name){$http[name]=function(url,config){return $http(extend({},config||{},{method:name,url:url}))}})}("get","delete","head","jsonp"),function(name){forEach(arguments,function(name){$http[name]=function(url,data,config){return $http(extend({},config||{},{method:name,url:url,data:data}))}})}("post","put","patch"),$http.defaults=defaults,$http}]}function $xhrFactoryProvider(){this.$get=function(){return function(){return new window.XMLHttpRequest}}}function $HttpBackendProvider(){this.$get=["$browser","$jsonpCallbacks","$document","$xhrFactory",function($browser,$jsonpCallbacks,$document,$xhrFactory){return function($browser,createXhr,$browserDefer,callbacks,rawDocument){return function(method,url,post,callback,headers,timeout,withCredentials,responseType,eventHandlers,uploadEventHandlers){if(url=url||$browser.url(),"jsonp"===lowercase(method))var callbackPath=callbacks.createCallback(url),jsonpDone=function(url,callbackPath,done){url=url.replace("JSON_CALLBACK",callbackPath);var script=rawDocument.createElement("script"),callback=null;return script.type="text/javascript",script.src=url,script.async=!0,callback=function(event){script.removeEventListener("load",callback),script.removeEventListener("error",callback),rawDocument.body.removeChild(script),script=null;var status=-1,text="unknown";event&&("load"!==event.type||callbacks.wasCalled(callbackPath)||(event={type:"error"}),text=event.type,status="error"===event.type?404:200),done&&done(status,text)},script.addEventListener("load",callback),script.addEventListener("error",callback),rawDocument.body.appendChild(script),callback}(url,callbackPath,function(status,text){var response=200===status&&callbacks.getResponse(callbackPath);completeRequest(callback,status,response,"",text,"complete"),callbacks.removeCallback(callbackPath)});else{var xhr=createXhr(method,url),abortedByTimeout=!1;xhr.open(method,url,!0),forEach(headers,function(value,key){isDefined(value)&&xhr.setRequestHeader(key,value)}),xhr.onload=function(){var statusText=xhr.statusText||"",response="response"in xhr?xhr.response:xhr.responseText,status=1223===xhr.status?204:xhr.status;0===status&&(status=response?200:"file"===urlResolve(url).protocol?404:0),completeRequest(callback,status,response,xhr.getAllResponseHeaders(),statusText,"complete")};if(xhr.onerror=function(){completeRequest(callback,-1,null,null,"","error")},xhr.ontimeout=function(){completeRequest(callback,-1,null,null,"","timeout")},xhr.onabort=function(){completeRequest(callback,-1,null,null,"",abortedByTimeout?"timeout":"abort")},forEach(eventHandlers,function(value,key){xhr.addEventListener(key,value)}),forEach(uploadEventHandlers,function(value,key){xhr.upload.addEventListener(key,value)}),withCredentials&&(xhr.withCredentials=!0),responseType)try{xhr.responseType=responseType}catch(e){if("json"!==responseType)throw e}xhr.send(isUndefined(post)?null:post)}if(0<timeout)var timeoutId=$browserDefer(function(){timeoutRequest("timeout")},timeout);else isPromiseLike(timeout)&&timeout.then(function(){timeoutRequest(isDefined(timeout.$$timeoutId)?"timeout":"abort")});function timeoutRequest(reason){abortedByTimeout="timeout"===reason,jsonpDone&&jsonpDone(),xhr&&xhr.abort()}function completeRequest(callback,status,response,headersString,statusText,xhrStatus){isDefined(timeoutId)&&$browserDefer.cancel(timeoutId),jsonpDone=xhr=null,callback(status,response,headersString,statusText,xhrStatus)}}}($browser,$xhrFactory,$browser.defer,$jsonpCallbacks,$document[0])}]}var $interpolateMinErr=angular.$interpolateMinErr=minErr("$interpolate");function $InterpolateProvider(){var startSymbol="{{",endSymbol="}}";this.startSymbol=function(value){return value?(startSymbol=value,this):startSymbol},this.endSymbol=function(value){return value?(endSymbol=value,this):endSymbol},this.$get=["$parse","$exceptionHandler","$sce",function($parse,$exceptionHandler,$sce){var startSymbolLength=startSymbol.length,endSymbolLength=endSymbol.length,escapedStartRegexp=new RegExp(startSymbol.replace(/./g,escape),"g"),escapedEndRegexp=new RegExp(endSymbol.replace(/./g,escape),"g");function escape(ch){return"\\\\\\"+ch}function unescapeText(text){return text.replace(escapedStartRegexp,startSymbol).replace(escapedEndRegexp,endSymbol)}function constantWatchDelegate(scope,listener,objectEquality,constantInterp){var unwatch=scope.$watch(function(scope){return unwatch(),constantInterp(scope)},listener,objectEquality);return unwatch}function $interpolate(text,mustHaveExpression,trustedContext,allOrNothing){var contextAllowsConcatenation=trustedContext===$sce.URL||trustedContext===$sce.MEDIA_URL;if(!text.length||-1===text.indexOf(startSymbol)){if(mustHaveExpression&&!contextAllowsConcatenation)return;var unescapedText=unescapeText(text);contextAllowsConcatenation&&(unescapedText=$sce.getTrusted(trustedContext,unescapedText));var constantInterp=valueFn(unescapedText);return constantInterp.exp=text,constantInterp.expressions=[],constantInterp.$$watchDelegate=constantWatchDelegate,constantInterp}allOrNothing=!!allOrNothing;for(var startIndex,endIndex,parseFns,exp,singleExpression,index=0,expressions=[],textLength=text.length,concat=[],expressionPositions=[];index<textLength;){if(-1===(startIndex=text.indexOf(startSymbol,index))||-1===(endIndex=text.indexOf(endSymbol,startIndex+startSymbolLength))){index!==textLength&&concat.push(unescapeText(text.substring(index)));break}index!==startIndex&&concat.push(unescapeText(text.substring(index,startIndex))),exp=text.substring(startIndex+startSymbolLength,endIndex),expressions.push(exp),index=endIndex+endSymbolLength,expressionPositions.push(concat.length),concat.push("")}singleExpression=1===concat.length&&1===expressionPositions.length;var interceptor=contextAllowsConcatenation&&singleExpression?void 0:function(value){try{return value=trustedContext&&!contextAllowsConcatenation?$sce.getTrusted(trustedContext,value):$sce.valueOf(value),allOrNothing&&!isDefined(value)?value:stringify(value)}catch(err){$exceptionHandler($interpolateMinErr.interr(text,err))}};if(parseFns=expressions.map(function(exp){return $parse(exp,interceptor)}),!mustHaveExpression||expressions.length){var compute=function(values){for(var i=0,ii=expressions.length;i<ii;i++){if(allOrNothing&&isUndefined(values[i]))return;concat[expressionPositions[i]]=values[i]}return contextAllowsConcatenation?$sce.getTrusted(trustedContext,singleExpression?concat[0]:concat.join("")):(trustedContext&&1<concat.length&&$interpolateMinErr.throwNoconcat(text),concat.join(""))};return extend(function(context){var i=0,ii=expressions.length,values=new Array(ii);try{for(;i<ii;i++)values[i]=parseFns[i](context);return compute(values)}catch(err){$exceptionHandler($interpolateMinErr.interr(text,err))}},{exp:text,expressions:expressions,$$watchDelegate:function(scope,listener){var lastValue;return scope.$watchGroup(parseFns,function(values,oldValues){var currValue=compute(values);listener.call(this,currValue,values!==oldValues?lastValue:currValue,scope),lastValue=currValue})}})}}return $interpolate.startSymbol=function(){return startSymbol},$interpolate.endSymbol=function(){return endSymbol},$interpolate}]}$interpolateMinErr.throwNoconcat=function(text){throw $interpolateMinErr("noconcat","Error while interpolating: {0}\nStrict Contextual Escaping disallows interpolations that concatenate multiple expressions when a trusted value is required.  See http://docs.angularjs.org/api/ng.$sce",text)},$interpolateMinErr.interr=function(text,err){return $interpolateMinErr("interr","Can't interpolate: {0}\n{1}",text,err.toString())};var $intervalMinErr=minErr("$interval");function $IntervalProvider(){this.$get=["$$intervalFactory","$window",function($$intervalFactory,$window){function clearIntervalFn(id){$window.clearInterval(id),delete intervals[id]}var intervals={},interval=$$intervalFactory(function(tick,delay,deferred){var id=$window.setInterval(tick,delay);return intervals[id]=deferred,id},clearIntervalFn);return interval.cancel=function(promise){if(!promise)return!1;if(!promise.hasOwnProperty("$$intervalId"))throw $intervalMinErr("badprom","`$interval.cancel()` called with a promise that was not generated by `$interval()`.");if(!intervals.hasOwnProperty(promise.$$intervalId))return!1;var id=promise.$$intervalId,deferred=intervals[id];return markQExceptionHandled(deferred.promise),deferred.reject("canceled"),clearIntervalFn(id),!0},interval}]}function $$IntervalFactoryProvider(){this.$get=["$browser","$q","$$q","$rootScope",function($browser,$q,$$q,$rootScope){return function(setIntervalFn,clearIntervalFn){return function(fn,delay,count,invokeApply){var hasParams=4<arguments.length,args=hasParams?sliceArgs(arguments,4):[],iteration=0,skipApply=isDefined(invokeApply)&&!invokeApply,deferred=(skipApply?$$q:$q).defer(),promise=deferred.promise;function callback(){hasParams?fn.apply(null,args):fn(iteration)}return count=isDefined(count)?count:0,promise.$$intervalId=setIntervalFn(function(){skipApply?$browser.defer(callback):$rootScope.$evalAsync(callback),deferred.notify(iteration++),0<count&&count<=iteration&&(deferred.resolve(iteration),clearIntervalFn(promise.$$intervalId)),skipApply||$rootScope.$apply()},delay,deferred,skipApply),promise}}}]}function $jsonpCallbacksProvider(){this.$get=function(){var callbacks=angular.callbacks,callbackMap={};return{createCallback:function(url){var callbackId="_"+(callbacks.$$counter++).toString(36),callbackPath="angular.callbacks."+callbackId,callback=function(callbackId){var callback=function(data){callback.data=data,callback.called=!0};return callback.id=callbackId,callback}(callbackId);return callbackMap[callbackPath]=callbacks[callbackId]=callback,callbackPath},wasCalled:function(callbackPath){return callbackMap[callbackPath].called},getResponse:function(callbackPath){return callbackMap[callbackPath].data},removeCallback:function(callbackPath){var callback=callbackMap[callbackPath];delete callbacks[callback.id],delete callbackMap[callbackPath]}}}}var PATH_MATCH=/^([^?#]*)(\?([^#]*))?(#(.*))?$/,DEFAULT_PORTS={http:80,https:443,ftp:21},$locationMinErr=minErr("$location");function normalizePath(pathValue,searchValue,hashValue){var search=function(obj){var parts=[];return forEach(obj,function(value,key){isArray(value)?forEach(value,function(arrayValue){parts.push(encodeUriQuery(key,!0)+(!0===arrayValue?"":"="+encodeUriQuery(arrayValue,!0)))}):parts.push(encodeUriQuery(key,!0)+(!0===value?"":"="+encodeUriQuery(value,!0)))}),parts.length?parts.join("&"):""}(searchValue),hash=hashValue?"#"+encodeUriSegment(hashValue):"";return function(path){for(var segments=path.split("/"),i=segments.length;i--;)segments[i]=encodeUriSegment(segments[i].replace(/%2F/g,"/"));return segments.join("/")}(pathValue)+(search?"?"+search:"")+hash}function parseAbsoluteUrl(absoluteUrl,locationObj){var parsedUrl=urlResolve(absoluteUrl);locationObj.$$protocol=parsedUrl.protocol,locationObj.$$host=parsedUrl.hostname,locationObj.$$port=toInt(parsedUrl.port)||DEFAULT_PORTS[parsedUrl.protocol]||null}var DOUBLE_SLASH_REGEX=/^\s*[\\/]{2,}/;function parseAppUrl(url,locationObj,html5Mode){if(DOUBLE_SLASH_REGEX.test(url))throw $locationMinErr("badpath",'Invalid url "{0}".',url);var prefixed="/"!==url.charAt(0);prefixed&&(url="/"+url);var match=urlResolve(url),path=prefixed&&"/"===match.pathname.charAt(0)?match.pathname.substring(1):match.pathname;locationObj.$$path=function(path,html5Mode){for(var segments=path.split("/"),i=segments.length;i--;)segments[i]=decodeURIComponent(segments[i]),html5Mode&&(segments[i]=segments[i].replace(/\//g,"%2F"));return segments.join("/")}(path,html5Mode),locationObj.$$search=parseKeyValue(match.search),locationObj.$$hash=decodeURIComponent(match.hash),locationObj.$$path&&"/"!==locationObj.$$path.charAt(0)&&(locationObj.$$path="/"+locationObj.$$path)}function startsWith(str,search){return str.slice(0,search.length)===search}function stripBaseUrl(base,url){if(startsWith(url,base))return url.substr(base.length)}function stripHash(url){var index=url.indexOf("#");return-1===index?url:url.substr(0,index)}function LocationHtml5Url(appBase,appBaseNoFile,basePrefix){this.$$html5=!0,basePrefix=basePrefix||"",parseAbsoluteUrl(appBase,this),this.$$parse=function(url){var pathUrl=stripBaseUrl(appBaseNoFile,url);if(!isString(pathUrl))throw $locationMinErr("ipthprfx",'Invalid url "{0}", missing path prefix "{1}".',url,appBaseNoFile);parseAppUrl(pathUrl,this,!0),this.$$path||(this.$$path="/"),this.$$compose()},this.$$normalizeUrl=function(url){return appBaseNoFile+url.substr(1)},this.$$parseLinkUrl=function(url,relHref){return relHref&&"#"===relHref[0]?(this.hash(relHref.slice(1)),!0):(isDefined(appUrl=stripBaseUrl(appBase,url))?(prevAppUrl=appUrl,rewrittenUrl=basePrefix&&isDefined(appUrl=stripBaseUrl(basePrefix,appUrl))?appBaseNoFile+(stripBaseUrl("/",appUrl)||appUrl):appBase+prevAppUrl):isDefined(appUrl=stripBaseUrl(appBaseNoFile,url))?rewrittenUrl=appBaseNoFile+appUrl:appBaseNoFile===url+"/"&&(rewrittenUrl=appBaseNoFile),rewrittenUrl&&this.$$parse(rewrittenUrl),!!rewrittenUrl);var appUrl,prevAppUrl,rewrittenUrl}}function LocationHashbangUrl(appBase,appBaseNoFile,hashPrefix){parseAbsoluteUrl(appBase,this),this.$$parse=function(url){var withoutHashUrl,withoutBaseUrl=stripBaseUrl(appBase,url)||stripBaseUrl(appBaseNoFile,url);isUndefined(withoutBaseUrl)||"#"!==withoutBaseUrl.charAt(0)?this.$$html5?withoutHashUrl=withoutBaseUrl:(withoutHashUrl="",isUndefined(withoutBaseUrl)&&(appBase=url,this.replace())):isUndefined(withoutHashUrl=stripBaseUrl(hashPrefix,withoutBaseUrl))&&(withoutHashUrl=withoutBaseUrl),parseAppUrl(withoutHashUrl,this,!1),this.$$path=function(path,url,base){var firstPathSegmentMatch,windowsFilePathExp=/^\/[A-Z]:(\/.*)/;startsWith(url,base)&&(url=url.replace(base,""));if(windowsFilePathExp.exec(url))return path;return(firstPathSegmentMatch=windowsFilePathExp.exec(path))?firstPathSegmentMatch[1]:path}(this.$$path,withoutHashUrl,appBase),this.$$compose()},this.$$normalizeUrl=function(url){return appBase+(url?hashPrefix+url:"")},this.$$parseLinkUrl=function(url,relHref){return stripHash(appBase)===stripHash(url)&&(this.$$parse(url),!0)}}function LocationHashbangInHtml5Url(appBase,appBaseNoFile,hashPrefix){this.$$html5=!0,LocationHashbangUrl.apply(this,arguments),this.$$parseLinkUrl=function(url,relHref){return relHref&&"#"===relHref[0]?(this.hash(relHref.slice(1)),!0):(appBase===stripHash(url)?rewrittenUrl=url:(appUrl=stripBaseUrl(appBaseNoFile,url))?rewrittenUrl=appBase+hashPrefix+appUrl:appBaseNoFile===url+"/"&&(rewrittenUrl=appBaseNoFile),rewrittenUrl&&this.$$parse(rewrittenUrl),!!rewrittenUrl);var rewrittenUrl,appUrl},this.$$normalizeUrl=function(url){return appBase+hashPrefix+url}}var locationPrototype={$$absUrl:"",$$html5:!1,$$replace:!1,$$compose:function(){this.$$url=normalizePath(this.$$path,this.$$search,this.$$hash),this.$$absUrl=this.$$normalizeUrl(this.$$url),this.$$urlUpdatedByLocation=!0},absUrl:locationGetter("$$absUrl"),url:function(url){if(isUndefined(url))return this.$$url;var match=PATH_MATCH.exec(url);return!match[1]&&""!==url||this.path(decodeURIComponent(match[1])),(match[2]||match[1]||""===url)&&this.search(match[3]||""),this.hash(match[5]||""),this},protocol:locationGetter("$$protocol"),host:locationGetter("$$host"),port:locationGetter("$$port"),path:locationGetterSetter("$$path",function(path){return"/"===(path=null!==path?path.toString():"").charAt(0)?path:"/"+path}),search:function(search,paramValue){switch(arguments.length){case 0:return this.$$search;case 1:if(isString(search)||isNumber(search))search=search.toString(),this.$$search=parseKeyValue(search);else{if(!isObject(search))throw $locationMinErr("isrcharg","The first argument of the `$location#search()` call must be a string or an object.");forEach(search=copy(search,{}),function(value,key){null==value&&delete search[key]}),this.$$search=search}break;default:isUndefined(paramValue)||null===paramValue?delete this.$$search[search]:this.$$search[search]=paramValue}return this.$$compose(),this},hash:locationGetterSetter("$$hash",function(hash){return null!==hash?hash.toString():""}),replace:function(){return this.$$replace=!0,this}};function locationGetter(property){return function(){return this[property]}}function locationGetterSetter(property,preprocess){return function(value){return isUndefined(value)?this[property]:(this[property]=preprocess(value),this.$$compose(),this)}}function $LocationProvider(){var hashPrefix="!",html5Mode={enabled:!1,requireBase:!0,rewriteLinks:!0};this.hashPrefix=function(prefix){return isDefined(prefix)?(hashPrefix=prefix,this):hashPrefix},this.html5Mode=function(mode){return isBoolean(mode)?(html5Mode.enabled=mode,this):isObject(mode)?(isBoolean(mode.enabled)&&(html5Mode.enabled=mode.enabled),isBoolean(mode.requireBase)&&(html5Mode.requireBase=mode.requireBase),(isBoolean(mode.rewriteLinks)||isString(mode.rewriteLinks))&&(html5Mode.rewriteLinks=mode.rewriteLinks),this):html5Mode},this.$get=["$rootScope","$browser","$sniffer","$rootElement","$window",function($rootScope,$browser,$sniffer,$rootElement,$window){var $location,LocationMode,appBase,baseHref=$browser.baseHref(),initialUrl=$browser.url();if(html5Mode.enabled){if(!baseHref&&html5Mode.requireBase)throw $locationMinErr("nobase","$location in HTML5 mode requires a <base> tag to be present!");appBase=function(url){return url.substring(0,url.indexOf("/",url.indexOf("//")+2))}(initialUrl)+(baseHref||"/"),LocationMode=$sniffer.history?LocationHtml5Url:LocationHashbangInHtml5Url}else appBase=stripHash(initialUrl),LocationMode=LocationHashbangUrl;var appBaseNoFile=function(url){return url.substr(0,stripHash(url).lastIndexOf("/")+1)}(appBase);($location=new LocationMode(appBase,appBaseNoFile,"#"+hashPrefix)).$$parseLinkUrl(initialUrl,initialUrl),$location.$$state=$browser.state();var IGNORE_URI_REGEXP=/^\s*(javascript|mailto):/i;function setBrowserUrlWithFallback(url,replace,state){var oldUrl=$location.url(),oldState=$location.$$state;try{$browser.url(url,replace,state),$location.$$state=$browser.state()}catch(e){throw $location.url(oldUrl),$location.$$state=oldState,e}}$rootElement.on("click",function(event){var rewriteLinks=html5Mode.rewriteLinks;if(rewriteLinks&&!event.ctrlKey&&!event.metaKey&&!event.shiftKey&&2!==event.which&&2!==event.button){for(var elm=jqLite(event.target);"a"!==nodeName_(elm[0]);)if(elm[0]===$rootElement[0]||!(elm=elm.parent())[0])return;if(!isString(rewriteLinks)||!isUndefined(elm.attr(rewriteLinks))){var absHref=elm.prop("href"),relHref=elm.attr("href")||elm.attr("xlink:href");isObject(absHref)&&"[object SVGAnimatedString]"===absHref.toString()&&(absHref=urlResolve(absHref.animVal).href),IGNORE_URI_REGEXP.test(absHref)||!absHref||elm.attr("target")||event.isDefaultPrevented()||$location.$$parseLinkUrl(absHref,relHref)&&(event.preventDefault(),$location.absUrl()!==$browser.url()&&$rootScope.$apply())}}}),$location.absUrl()!==initialUrl&&$browser.url($location.absUrl(),!0);var initializing=!0;return $browser.onUrlChange(function(newUrl,newState){startsWith(newUrl,appBaseNoFile)?($rootScope.$evalAsync(function(){var defaultPrevented,oldUrl=$location.absUrl(),oldState=$location.$$state;$location.$$parse(newUrl),$location.$$state=newState,defaultPrevented=$rootScope.$broadcast("$locationChangeStart",newUrl,oldUrl,newState,oldState).defaultPrevented,$location.absUrl()===newUrl&&(defaultPrevented?($location.$$parse(oldUrl),setBrowserUrlWithFallback(oldUrl,!1,$location.$$state=oldState)):(initializing=!1,afterLocationChange(oldUrl,oldState)))}),$rootScope.$$phase||$rootScope.$digest()):$window.location.href=newUrl}),$rootScope.$watch(function(){if(initializing||$location.$$urlUpdatedByLocation){$location.$$urlUpdatedByLocation=!1;var oldUrl=$browser.url(),newUrl=$location.absUrl(),oldState=$browser.state(),currentReplace=$location.$$replace,urlOrStateChanged=!function(a,b){return a===b||urlResolve(a).href===urlResolve(b).href}(oldUrl,newUrl)||$location.$$html5&&$sniffer.history&&oldState!==$location.$$state;(initializing||urlOrStateChanged)&&(initializing=!1,$rootScope.$evalAsync(function(){var newUrl=$location.absUrl(),defaultPrevented=$rootScope.$broadcast("$locationChangeStart",newUrl,oldUrl,$location.$$state,oldState).defaultPrevented;$location.absUrl()===newUrl&&(defaultPrevented?($location.$$parse(oldUrl),$location.$$state=oldState):(urlOrStateChanged&&setBrowserUrlWithFallback(newUrl,currentReplace,oldState===$location.$$state?null:$location.$$state),afterLocationChange(oldUrl,oldState)))}))}$location.$$replace=!1}),$location;function afterLocationChange(oldUrl,oldState){$rootScope.$broadcast("$locationChangeSuccess",$location.absUrl(),oldUrl,$location.$$state,oldState)}}]}function $LogProvider(){var debug=!0,self=this;this.debugEnabled=function(flag){return isDefined(flag)?(debug=flag,this):debug},this.$get=["$window",function($window){var fn,formatStackTrace=msie||/\bEdge\//.test($window.navigator&&$window.navigator.userAgent);return{log:consoleLog("log"),info:consoleLog("info"),warn:consoleLog("warn"),error:consoleLog("error"),debug:(fn=consoleLog("debug"),function(){debug&&fn.apply(self,arguments)})};function consoleLog(type){var console=$window.console||{},logFn=console[type]||console.log||noop;return function(){var args=[];return forEach(arguments,function(arg){args.push(function(arg){return isError(arg)&&(arg.stack&&formatStackTrace?arg=arg.message&&-1===arg.stack.indexOf(arg.message)?"Error: "+arg.message+"\n"+arg.stack:arg.stack:arg.sourceURL&&(arg=arg.message+"\n"+arg.sourceURL+":"+arg.line)),arg}(arg))}),Function.prototype.apply.call(logFn,console,args)}}}]}forEach([LocationHashbangInHtml5Url,LocationHashbangUrl,LocationHtml5Url],function(Location){Location.prototype=Object.create(locationPrototype),Location.prototype.state=function(state){if(!arguments.length)return this.$$state;if(Location!==LocationHtml5Url||!this.$$html5)throw $locationMinErr("nostate","History API state support is available only in HTML5 mode and only in browsers supporting HTML5 History API");return this.$$state=isUndefined(state)?null:state,this.$$urlUpdatedByLocation=!0,this}});var $parseMinErr=minErr("$parse"),objectValueOf={}.constructor.prototype.valueOf;function getStringValue(name){return name+""}var OPERATORS=createMap();forEach("+ - * / % === !== == != < > <= >= && || ! = |".split(" "),function(operator){OPERATORS[operator]=!0});var ESCAPE={n:"\n",f:"\f",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'},Lexer=function(options){this.options=options};Lexer.prototype={constructor:Lexer,lex:function(text){for(this.text=text,this.index=0,this.tokens=[];this.index<this.text.length;){var ch=this.text.charAt(this.index);if('"'===ch||"'"===ch)this.readString(ch);else if(this.isNumber(ch)||"."===ch&&this.isNumber(this.peek()))this.readNumber();else if(this.isIdentifierStart(this.peekMultichar()))this.readIdent();else if(this.is(ch,"(){}[].,;:?"))this.tokens.push({index:this.index,text:ch}),this.index++;else if(this.isWhitespace(ch))this.index++;else{var ch2=ch+this.peek(),ch3=ch2+this.peek(2),op1=OPERATORS[ch],op2=OPERATORS[ch2],op3=OPERATORS[ch3];if(op1||op2||op3){var token=op3?ch3:op2?ch2:ch;this.tokens.push({index:this.index,text:token,operator:!0}),this.index+=token.length}else this.throwError("Unexpected next character ",this.index,this.index+1)}}return this.tokens},is:function(ch,chars){return-1!==chars.indexOf(ch)},peek:function(i){var num=i||1;return this.index+num<this.text.length&&this.text.charAt(this.index+num)},isNumber:function(ch){return"0"<=ch&&ch<="9"&&"string"==typeof ch},isWhitespace:function(ch){return" "===ch||"\r"===ch||"\t"===ch||"\n"===ch||"\v"===ch||"Â "===ch},isIdentifierStart:function(ch){return this.options.isIdentifierStart?this.options.isIdentifierStart(ch,this.codePointAt(ch)):this.isValidIdentifierStart(ch)},isValidIdentifierStart:function(ch){return"a"<=ch&&ch<="z"||"A"<=ch&&ch<="Z"||"_"===ch||"$"===ch},isIdentifierContinue:function(ch){return this.options.isIdentifierContinue?this.options.isIdentifierContinue(ch,this.codePointAt(ch)):this.isValidIdentifierContinue(ch)},isValidIdentifierContinue:function(ch,cp){return this.isValidIdentifierStart(ch,cp)||this.isNumber(ch)},codePointAt:function(ch){return 1===ch.length?ch.charCodeAt(0):(ch.charCodeAt(0)<<10)+ch.charCodeAt(1)-56613888},peekMultichar:function(){var ch=this.text.charAt(this.index),peek=this.peek();if(!peek)return ch;var cp1=ch.charCodeAt(0),cp2=peek.charCodeAt(0);return 55296<=cp1&&cp1<=56319&&56320<=cp2&&cp2<=57343?ch+peek:ch},isExpOperator:function(ch){return"-"===ch||"+"===ch||this.isNumber(ch)},throwError:function(error,start,end){end=end||this.index;var colStr=isDefined(start)?"s "+start+"-"+this.index+" ["+this.text.substring(start,end)+"]":" "+end;throw $parseMinErr("lexerr","Lexer Error: {0} at column{1} in expression [{2}].",error,colStr,this.text)},readNumber:function(){for(var number="",start=this.index;this.index<this.text.length;){var ch=lowercase(this.text.charAt(this.index));if("."===ch||this.isNumber(ch))number+=ch;else{var peekCh=this.peek();if("e"===ch&&this.isExpOperator(peekCh))number+=ch;else if(this.isExpOperator(ch)&&peekCh&&this.isNumber(peekCh)&&"e"===number.charAt(number.length-1))number+=ch;else{if(!this.isExpOperator(ch)||peekCh&&this.isNumber(peekCh)||"e"!==number.charAt(number.length-1))break;this.throwError("Invalid exponent")}}this.index++}this.tokens.push({index:start,text:number,constant:!0,value:Number(number)})},readIdent:function(){var start=this.index;for(this.index+=this.peekMultichar().length;this.index<this.text.length;){var ch=this.peekMultichar();if(!this.isIdentifierContinue(ch))break;this.index+=ch.length}this.tokens.push({index:start,text:this.text.slice(start,this.index),identifier:!0})},readString:function(quote){var start=this.index;this.index++;for(var string="",rawString=quote,escape=!1;this.index<this.text.length;){var ch=this.text.charAt(this.index);if(rawString+=ch,escape){if("u"===ch){var hex=this.text.substring(this.index+1,this.index+5);hex.match(/[\da-f]{4}/i)||this.throwError("Invalid unicode escape [\\u"+hex+"]"),this.index+=4,string+=String.fromCharCode(parseInt(hex,16))}else{string+=ESCAPE[ch]||ch}escape=!1}else if("\\"===ch)escape=!0;else{if(ch===quote)return this.index++,void this.tokens.push({index:start,text:rawString,constant:!0,value:string});string+=ch}this.index++}this.throwError("Unterminated quote",start)}};var AST=function(lexer,options){this.lexer=lexer,this.options=options};function ifDefined(v,d){return void 0!==v?v:d}function plusFn(l,r){return void 0===l?r:void 0===r?l:l+r}AST.Program="Program",AST.ExpressionStatement="ExpressionStatement",AST.AssignmentExpression="AssignmentExpression",AST.ConditionalExpression="ConditionalExpression",AST.LogicalExpression="LogicalExpression",AST.BinaryExpression="BinaryExpression",AST.UnaryExpression="UnaryExpression",AST.CallExpression="CallExpression",AST.MemberExpression="MemberExpression",AST.Identifier="Identifier",AST.Literal="Literal",AST.ArrayExpression="ArrayExpression",AST.Property="Property",AST.ObjectExpression="ObjectExpression",AST.ThisExpression="ThisExpression",AST.LocalsExpression="LocalsExpression",AST.NGValueParameter="NGValueParameter",AST.prototype={ast:function(text){this.text=text,this.tokens=this.lexer.lex(text);var value=this.program();return 0!==this.tokens.length&&this.throwError("is an unexpected token",this.tokens[0]),value},program:function(){for(var body=[];;)if(0<this.tokens.length&&!this.peek("}",")",";","]")&&body.push(this.expressionStatement()),!this.expect(";"))return{type:AST.Program,body:body}},expressionStatement:function(){return{type:AST.ExpressionStatement,expression:this.filterChain()}},filterChain:function(){for(var left=this.expression();this.expect("|");)left=this.filter(left);return left},expression:function(){return this.assignment()},assignment:function(){var result=this.ternary();if(this.expect("=")){if(!isAssignable(result))throw $parseMinErr("lval","Trying to assign a value to a non l-value");result={type:AST.AssignmentExpression,left:result,right:this.assignment(),operator:"="}}return result},ternary:function(){var alternate,consequent,test=this.logicalOR();return this.expect("?")&&(alternate=this.expression(),this.consume(":"))?(consequent=this.expression(),{type:AST.ConditionalExpression,test:test,alternate:alternate,consequent:consequent}):test},logicalOR:function(){for(var left=this.logicalAND();this.expect("||");)left={type:AST.LogicalExpression,operator:"||",left:left,right:this.logicalAND()};return left},logicalAND:function(){for(var left=this.equality();this.expect("&&");)left={type:AST.LogicalExpression,operator:"&&",left:left,right:this.equality()};return left},equality:function(){for(var token,left=this.relational();token=this.expect("==","!=","===","!==");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.relational()};return left},relational:function(){for(var token,left=this.additive();token=this.expect("<",">","<=",">=");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.additive()};return left},additive:function(){for(var token,left=this.multiplicative();token=this.expect("+","-");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.multiplicative()};return left},multiplicative:function(){for(var token,left=this.unary();token=this.expect("*","/","%");)left={type:AST.BinaryExpression,operator:token.text,left:left,right:this.unary()};return left},unary:function(){var token;return(token=this.expect("+","-","!"))?{type:AST.UnaryExpression,operator:token.text,prefix:!0,argument:this.unary()}:this.primary()},primary:function(){var primary,next;for(this.expect("(")?(primary=this.filterChain(),this.consume(")")):this.expect("[")?primary=this.arrayDeclaration():this.expect("{")?primary=this.object():this.selfReferential.hasOwnProperty(this.peek().text)?primary=copy(this.selfReferential[this.consume().text]):this.options.literals.hasOwnProperty(this.peek().text)?primary={type:AST.Literal,value:this.options.literals[this.consume().text]}:this.peek().identifier?primary=this.identifier():this.peek().constant?primary=this.constant():this.throwError("not a primary expression",this.peek());next=this.expect("(","[",".");)"("===next.text?(primary={type:AST.CallExpression,callee:primary,arguments:this.parseArguments()},this.consume(")")):"["===next.text?(primary={type:AST.MemberExpression,object:primary,property:this.expression(),computed:!0},this.consume("]")):"."===next.text?primary={type:AST.MemberExpression,object:primary,property:this.identifier(),computed:!1}:this.throwError("IMPOSSIBLE");return primary},filter:function(baseExpression){for(var args=[baseExpression],result={type:AST.CallExpression,callee:this.identifier(),arguments:args,filter:!0};this.expect(":");)args.push(this.expression());return result},parseArguments:function(){var args=[];if(")"!==this.peekToken().text)for(;args.push(this.filterChain()),this.expect(","););return args},identifier:function(){var token=this.consume();return token.identifier||this.throwError("is not a valid identifier",token),{type:AST.Identifier,name:token.text}},constant:function(){return{type:AST.Literal,value:this.consume().value}},arrayDeclaration:function(){var elements=[];if("]"!==this.peekToken().text)do{if(this.peek("]"))break;elements.push(this.expression())}while(this.expect(","));return this.consume("]"),{type:AST.ArrayExpression,elements:elements}},object:function(){var property,properties=[];if("}"!==this.peekToken().text)do{if(this.peek("}"))break;property={type:AST.Property,kind:"init"},this.peek().constant?(property.key=this.constant(),property.computed=!1,this.consume(":"),property.value=this.expression()):this.peek().identifier?(property.key=this.identifier(),property.computed=!1,this.peek(":")?(this.consume(":"),property.value=this.expression()):property.value=property.key):this.peek("[")?(this.consume("["),property.key=this.expression(),this.consume("]"),property.computed=!0,this.consume(":"),property.value=this.expression()):this.throwError("invalid key",this.peek()),properties.push(property)}while(this.expect(","));return this.consume("}"),{type:AST.ObjectExpression,properties:properties}},throwError:function(msg,token){throw $parseMinErr("syntax","Syntax Error: Token '{0}' {1} at column {2} of the expression [{3}] starting at [{4}].",token.text,msg,token.index+1,this.text,this.text.substring(token.index))},consume:function(e1){if(0===this.tokens.length)throw $parseMinErr("ueoe","Unexpected end of expression: {0}",this.text);var token=this.expect(e1);return token||this.throwError("is unexpected, expecting ["+e1+"]",this.peek()),token},peekToken:function(){if(0===this.tokens.length)throw $parseMinErr("ueoe","Unexpected end of expression: {0}",this.text);return this.tokens[0]},peek:function(e1,e2,e3,e4){return this.peekAhead(0,e1,e2,e3,e4)},peekAhead:function(i,e1,e2,e3,e4){if(this.tokens.length>i){var token=this.tokens[i],t=token.text;if(t===e1||t===e2||t===e3||t===e4||!e1&&!e2&&!e3&&!e4)return token}return!1},expect:function(e1,e2,e3,e4){var token=this.peek(e1,e2,e3,e4);return!!token&&(this.tokens.shift(),token)},selfReferential:{this:{type:AST.ThisExpression},$locals:{type:AST.LocalsExpression}}};var PURITY_ABSOLUTE=1,PURITY_RELATIVE=2;function findConstantAndWatchExpressions(ast,$filter,parentIsPure){var allConstants,argsToWatch,isStatelessFilter,astIsPure=ast.isPure=function(node,parentIsPure){switch(node.type){case AST.MemberExpression:if(node.computed)return!1;break;case AST.UnaryExpression:return PURITY_ABSOLUTE;case AST.BinaryExpression:return"+"!==node.operator&&PURITY_ABSOLUTE;case AST.CallExpression:return!1}return void 0===parentIsPure?PURITY_RELATIVE:parentIsPure}(ast,parentIsPure);switch(ast.type){case AST.Program:allConstants=!0,forEach(ast.body,function(expr){findConstantAndWatchExpressions(expr.expression,$filter,astIsPure),allConstants=allConstants&&expr.expression.constant}),ast.constant=allConstants;break;case AST.Literal:ast.constant=!0,ast.toWatch=[];break;case AST.UnaryExpression:findConstantAndWatchExpressions(ast.argument,$filter,astIsPure),ast.constant=ast.argument.constant,ast.toWatch=ast.argument.toWatch;break;case AST.BinaryExpression:findConstantAndWatchExpressions(ast.left,$filter,astIsPure),findConstantAndWatchExpressions(ast.right,$filter,astIsPure),ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=ast.left.toWatch.concat(ast.right.toWatch);break;case AST.LogicalExpression:findConstantAndWatchExpressions(ast.left,$filter,astIsPure),findConstantAndWatchExpressions(ast.right,$filter,astIsPure),ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=ast.constant?[]:[ast];break;case AST.ConditionalExpression:findConstantAndWatchExpressions(ast.test,$filter,astIsPure),findConstantAndWatchExpressions(ast.alternate,$filter,astIsPure),findConstantAndWatchExpressions(ast.consequent,$filter,astIsPure),ast.constant=ast.test.constant&&ast.alternate.constant&&ast.consequent.constant,ast.toWatch=ast.constant?[]:[ast];break;case AST.Identifier:ast.constant=!1,ast.toWatch=[ast];break;case AST.MemberExpression:findConstantAndWatchExpressions(ast.object,$filter,astIsPure),ast.computed&&findConstantAndWatchExpressions(ast.property,$filter,astIsPure),ast.constant=ast.object.constant&&(!ast.computed||ast.property.constant),ast.toWatch=ast.constant?[]:[ast];break;case AST.CallExpression:isStatelessFilter=!!ast.filter&&function($filter,filterName){return!$filter(filterName).$stateful}($filter,ast.callee.name),allConstants=isStatelessFilter,argsToWatch=[],forEach(ast.arguments,function(expr){findConstantAndWatchExpressions(expr,$filter,astIsPure),allConstants=allConstants&&expr.constant,argsToWatch.push.apply(argsToWatch,expr.toWatch)}),ast.constant=allConstants,ast.toWatch=isStatelessFilter?argsToWatch:[ast];break;case AST.AssignmentExpression:findConstantAndWatchExpressions(ast.left,$filter,astIsPure),findConstantAndWatchExpressions(ast.right,$filter,astIsPure),ast.constant=ast.left.constant&&ast.right.constant,ast.toWatch=[ast];break;case AST.ArrayExpression:allConstants=!0,argsToWatch=[],forEach(ast.elements,function(expr){findConstantAndWatchExpressions(expr,$filter,astIsPure),allConstants=allConstants&&expr.constant,argsToWatch.push.apply(argsToWatch,expr.toWatch)}),ast.constant=allConstants,ast.toWatch=argsToWatch;break;case AST.ObjectExpression:allConstants=!0,argsToWatch=[],forEach(ast.properties,function(property){findConstantAndWatchExpressions(property.value,$filter,astIsPure),allConstants=allConstants&&property.value.constant,argsToWatch.push.apply(argsToWatch,property.value.toWatch),property.computed&&(findConstantAndWatchExpressions(property.key,$filter,!1),allConstants=allConstants&&property.key.constant,argsToWatch.push.apply(argsToWatch,property.key.toWatch))}),ast.constant=allConstants,ast.toWatch=argsToWatch;break;case AST.ThisExpression:case AST.LocalsExpression:ast.constant=!1,ast.toWatch=[]}}function getInputs(body){if(1===body.length){var lastExpression=body[0].expression,candidate=lastExpression.toWatch;return 1!==candidate.length?candidate:candidate[0]!==lastExpression?candidate:void 0}}function isAssignable(ast){return ast.type===AST.Identifier||ast.type===AST.MemberExpression}function assignableAST(ast){if(1===ast.body.length&&isAssignable(ast.body[0].expression))return{type:AST.AssignmentExpression,left:ast.body[0].expression,right:{type:AST.NGValueParameter},operator:"="}}function ASTCompiler($filter){this.$filter=$filter}function ASTInterpreter($filter){this.$filter=$filter}function Parser(lexer,$filter,options){this.ast=new AST(lexer,options),this.astCompiler=options.csp?new ASTInterpreter($filter):new ASTCompiler($filter)}function getValueOf(value){return isFunction(value.valueOf)?value.valueOf():objectValueOf.call(value)}function $ParseProvider(){var identStart,identContinue,cache=createMap(),literals={true:!0,false:!1,null:null,undefined:void 0};this.addLiteral=function(literalName,literalValue){literals[literalName]=literalValue},this.setIdentifierFns=function(identifierStart,identifierContinue){return identStart=identifierStart,identContinue=identifierContinue,this},this.$get=["$filter",function($filter){var $parseOptions={csp:csp().noUnsafeEval,literals:copy(literals),isIdentifierStart:isFunction(identStart)&&identStart,isIdentifierContinue:isFunction(identContinue)&&identContinue};return $parse.$$getAst=function(exp){return new Parser(new Lexer($parseOptions),$filter,$parseOptions).getAst(exp).ast},$parse;function $parse(exp,interceptorFn){var parsedExpression,cacheKey;switch(typeof exp){case"string":if(exp=exp.trim(),!(parsedExpression=cache[cacheKey=exp]))parsedExpression=new Parser(new Lexer($parseOptions),$filter,$parseOptions).parse(exp),cache[cacheKey]=addWatchDelegate(parsedExpression);return addInterceptor(parsedExpression,interceptorFn);case"function":return addInterceptor(exp,interceptorFn);default:return addInterceptor(noop,interceptorFn)}}function expressionInputDirtyCheck(newValue,oldValueOfValue,compareObjectIdentity){return null==newValue||null==oldValueOfValue?newValue===oldValueOfValue:!("object"==typeof newValue&&"object"==typeof(newValue=getValueOf(newValue))&&!compareObjectIdentity)&&(newValue===oldValueOfValue||newValue!=newValue&&oldValueOfValue!=oldValueOfValue)}function inputsWatchDelegate(scope,listener,objectEquality,parsedExpression,prettyPrintExpression){var lastResult,inputExpressions=parsedExpression.inputs;if(1===inputExpressions.length){var oldInputValueOf=expressionInputDirtyCheck;return inputExpressions=inputExpressions[0],scope.$watch(function(scope){var newInputValue=inputExpressions(scope);return expressionInputDirtyCheck(newInputValue,oldInputValueOf,inputExpressions.isPure)||(lastResult=parsedExpression(scope,void 0,void 0,[newInputValue]),oldInputValueOf=newInputValue&&getValueOf(newInputValue)),lastResult},listener,objectEquality,prettyPrintExpression)}for(var oldInputValueOfValues=[],oldInputValues=[],i=0,ii=inputExpressions.length;i<ii;i++)oldInputValueOfValues[i]=expressionInputDirtyCheck,oldInputValues[i]=null;return scope.$watch(function(scope){for(var changed=!1,i=0,ii=inputExpressions.length;i<ii;i++){var newInputValue=inputExpressions[i](scope);(changed=changed||!expressionInputDirtyCheck(newInputValue,oldInputValueOfValues[i],inputExpressions[i].isPure))&&(oldInputValues[i]=newInputValue,oldInputValueOfValues[i]=newInputValue&&getValueOf(newInputValue))}return changed&&(lastResult=parsedExpression(scope,void 0,void 0,oldInputValues)),lastResult},listener,objectEquality,prettyPrintExpression)}function oneTimeWatchDelegate(scope,listener,objectEquality,parsedExpression,prettyPrintExpression){var unwatch,lastValue,isDone=parsedExpression.literal?isAllDefined:isDefined,exp=parsedExpression.$$intercepted||parsedExpression,post=parsedExpression.$$interceptor||identity,useInputs=parsedExpression.inputs&&!exp.inputs;return oneTimeWatch.literal=parsedExpression.literal,oneTimeWatch.constant=parsedExpression.constant,oneTimeWatch.inputs=parsedExpression.inputs,addWatchDelegate(oneTimeWatch),unwatch=scope.$watch(oneTimeWatch,listener,objectEquality,prettyPrintExpression);function unwatchIfDone(){isDone(lastValue)&&unwatch()}function oneTimeWatch(scope,locals,assign,inputs){return lastValue=useInputs&&inputs?inputs[0]:exp(scope,locals,assign,inputs),isDone(lastValue)&&scope.$$postDigest(unwatchIfDone),post(lastValue)}}function isAllDefined(value){var allDefined=!0;return forEach(value,function(val){isDefined(val)||(allDefined=!1)}),allDefined}function constantWatchDelegate(scope,listener,objectEquality,parsedExpression){var unwatch=scope.$watch(function(scope){return unwatch(),parsedExpression(scope)},listener,objectEquality);return unwatch}function addWatchDelegate(parsedExpression){return parsedExpression.constant?parsedExpression.$$watchDelegate=constantWatchDelegate:parsedExpression.oneTime?parsedExpression.$$watchDelegate=oneTimeWatchDelegate:parsedExpression.inputs&&(parsedExpression.$$watchDelegate=inputsWatchDelegate),parsedExpression}function addInterceptor(parsedExpression,interceptorFn){if(!interceptorFn)return parsedExpression;parsedExpression.$$interceptor&&(interceptorFn=function(first,second){function chainedInterceptor(value){return second(first(value))}return chainedInterceptor.$stateful=first.$stateful||second.$stateful,chainedInterceptor.$$pure=first.$$pure&&second.$$pure,chainedInterceptor}(parsedExpression.$$interceptor,interceptorFn),parsedExpression=parsedExpression.$$intercepted);function fn(scope,locals,assign,inputs){var value=useInputs&&inputs?inputs[0]:parsedExpression(scope,locals,assign,inputs);return interceptorFn(value)}var useInputs=!1;return fn.$$intercepted=parsedExpression,fn.$$interceptor=interceptorFn,fn.literal=parsedExpression.literal,fn.oneTime=parsedExpression.oneTime,fn.constant=parsedExpression.constant,interceptorFn.$stateful||(useInputs=!parsedExpression.inputs,fn.inputs=parsedExpression.inputs?parsedExpression.inputs:[parsedExpression],interceptorFn.$$pure||(fn.inputs=fn.inputs.map(function(e){return e.isPure===PURITY_RELATIVE?function(s){return e(s)}:e}))),addWatchDelegate(fn)}}]}function $QProvider(){var errorOnUnhandledRejections=!0;this.$get=["$rootScope","$exceptionHandler",function($rootScope,$exceptionHandler){return qFactory(function(callback){$rootScope.$evalAsync(callback)},$exceptionHandler,errorOnUnhandledRejections)}],this.errorOnUnhandledRejections=function(value){return isDefined(value)?(errorOnUnhandledRejections=value,this):errorOnUnhandledRejections}}function $$QProvider(){var errorOnUnhandledRejections=!0;this.$get=["$browser","$exceptionHandler",function($browser,$exceptionHandler){return qFactory(function(callback){$browser.defer(callback)},$exceptionHandler,errorOnUnhandledRejections)}],this.errorOnUnhandledRejections=function(value){return isDefined(value)?(errorOnUnhandledRejections=value,this):errorOnUnhandledRejections}}function qFactory(nextTick,exceptionHandler,errorOnUnhandledRejections){var $qMinErr=minErr("$q",TypeError),queueSize=0,checkQueue=[];function defer(){return new Deferred}function Deferred(){var promise=this.promise=new Promise;this.resolve=function(val){resolvePromise(promise,val)},this.reject=function(reason){rejectPromise(promise,reason)},this.notify=function(progress){notifyPromise(promise,progress)}}function Promise(){this.$$state={status:0}}function processChecks(){for(;!queueSize&&checkQueue.length;){var toCheck=checkQueue.shift();if(!isStateExceptionHandled(toCheck)){markQStateExceptionHandled(toCheck);var errorMessage="Possibly unhandled rejection: "+toDebugString(toCheck.value);isError(toCheck.value)?exceptionHandler(toCheck.value,errorMessage):exceptionHandler(errorMessage)}}}function scheduleProcessQueue(state){!errorOnUnhandledRejections||state.pending||2!==state.status||isStateExceptionHandled(state)||(0===queueSize&&0===checkQueue.length&&nextTick(processChecks),checkQueue.push(state)),!state.processScheduled&&state.pending&&(state.processScheduled=!0,++queueSize,nextTick(function(){!function(state){var fn,promise,pending;pending=state.pending,state.processScheduled=!1,state.pending=void 0;try{for(var i=0,ii=pending.length;i<ii;++i){markQStateExceptionHandled(state),promise=pending[i][0],fn=pending[i][state.status];try{isFunction(fn)?resolvePromise(promise,fn(state.value)):1===state.status?resolvePromise(promise,state.value):rejectPromise(promise,state.value)}catch(e){rejectPromise(promise,e),e&&!0===e.$$passToExceptionHandler&&exceptionHandler(e)}}}finally{--queueSize,errorOnUnhandledRejections&&0===queueSize&&nextTick(processChecks)}}(state)}))}function resolvePromise(promise,val){promise.$$state.status||(val===promise?$$reject(promise,$qMinErr("qcycle","Expected promise to be resolved with value other than itself '{0}'",val)):function $$resolve(promise,val){var then;var done=!1;try{(isObject(val)||isFunction(val))&&(then=val.then),isFunction(then)?(promise.$$state.status=-1,then.call(val,doResolve,doReject,doNotify)):(promise.$$state.value=val,promise.$$state.status=1,scheduleProcessQueue(promise.$$state))}catch(e){doReject(e)}function doResolve(val){done||(done=!0,$$resolve(promise,val))}function doReject(val){done||(done=!0,$$reject(promise,val))}function doNotify(progress){notifyPromise(promise,progress)}}(promise,val))}function rejectPromise(promise,reason){promise.$$state.status||$$reject(promise,reason)}function $$reject(promise,reason){promise.$$state.value=reason,promise.$$state.status=2,scheduleProcessQueue(promise.$$state)}function notifyPromise(promise,progress){var callbacks=promise.$$state.pending;promise.$$state.status<=0&&callbacks&&callbacks.length&&nextTick(function(){for(var callback,result,i=0,ii=callbacks.length;i<ii;i++){result=callbacks[i][0],callback=callbacks[i][3];try{notifyPromise(result,isFunction(callback)?callback(progress):progress)}catch(e){exceptionHandler(e)}}})}function reject(reason){var result=new Promise;return rejectPromise(result,reason),result}function handleCallback(value,resolver,callback){var callbackOutput=null;try{isFunction(callback)&&(callbackOutput=callback())}catch(e){return reject(e)}return isPromiseLike(callbackOutput)?callbackOutput.then(function(){return resolver(value)},reject):resolver(value)}function when(value,callback,errback,progressBack){var result=new Promise;return resolvePromise(result,value),result.then(callback,errback,progressBack)}extend(Promise.prototype,{then:function(onFulfilled,onRejected,progressBack){if(isUndefined(onFulfilled)&&isUndefined(onRejected)&&isUndefined(progressBack))return this;var result=new Promise;return this.$$state.pending=this.$$state.pending||[],this.$$state.pending.push([result,onFulfilled,onRejected,progressBack]),0<this.$$state.status&&scheduleProcessQueue(this.$$state),result},catch:function(callback){return this.then(null,callback)},finally:function(callback,progressBack){return this.then(function(value){return handleCallback(value,resolve,callback)},function(error){return handleCallback(error,reject,callback)},progressBack)}});var resolve=when;function $Q(resolver){if(!isFunction(resolver))throw $qMinErr("norslvr","Expected resolverFn, got '{0}'",resolver);var promise=new Promise;return resolver(function(value){resolvePromise(promise,value)},function(reason){rejectPromise(promise,reason)}),promise}return $Q.prototype=Promise.prototype,$Q.defer=defer,$Q.reject=reject,$Q.when=when,$Q.resolve=resolve,$Q.all=function(promises){var result=new Promise,counter=0,results=isArray(promises)?[]:{};return forEach(promises,function(promise,key){counter++,when(promise).then(function(value){results[key]=value,--counter||resolvePromise(result,results)},function(reason){rejectPromise(result,reason)})}),0===counter&&resolvePromise(result,results),result},$Q.race=function(promises){var deferred=defer();return forEach(promises,function(promise){when(promise).then(deferred.resolve,deferred.reject)}),deferred.promise},$Q}function isStateExceptionHandled(state){return!!state.pur}function markQStateExceptionHandled(state){state.pur=!0}function markQExceptionHandled(q){markQStateExceptionHandled(q.$$state)}function $$RAFProvider(){this.$get=["$window","$timeout",function($window,$timeout){var requestAnimationFrame=$window.requestAnimationFrame||$window.webkitRequestAnimationFrame,cancelAnimationFrame=$window.cancelAnimationFrame||$window.webkitCancelAnimationFrame||$window.webkitCancelRequestAnimationFrame,rafSupported=!!requestAnimationFrame,raf=rafSupported?function(fn){var id=requestAnimationFrame(fn);return function(){cancelAnimationFrame(id)}}:function(fn){var timer=$timeout(fn,16.66,!1);return function(){$timeout.cancel(timer)}};return raf.supported=rafSupported,raf}]}function $RootScopeProvider(){var TTL=10,$rootScopeMinErr=minErr("$rootScope"),lastDirtyWatch=null,applyAsyncId=null;this.digestTtl=function(value){return arguments.length&&(TTL=value),TTL},this.$get=["$exceptionHandler","$parse","$browser",function($exceptionHandler,$parse,$browser){function destroyChildScope($event){$event.currentScope.$$destroyed=!0}function Scope(){this.$id=nextUid(),this.$$phase=this.$parent=this.$$watchers=this.$$nextSibling=this.$$prevSibling=this.$$childHead=this.$$childTail=null,(this.$root=this).$$destroyed=!1,this.$$suspended=!1,this.$$listeners={},this.$$listenerCount={},this.$$watchersCount=0,this.$$isolateBindings=null}Scope.prototype={constructor:Scope,$new:function(isolate,parent){var child;return parent=parent||this,isolate?(child=new Scope).$root=this.$root:(this.$$ChildScope||(this.$$ChildScope=function(parent){function ChildScope(){this.$$watchers=this.$$nextSibling=this.$$childHead=this.$$childTail=null,this.$$listeners={},this.$$listenerCount={},this.$$watchersCount=0,this.$id=nextUid(),this.$$ChildScope=null,this.$$suspended=!1}return ChildScope.prototype=parent,ChildScope}(this)),child=new this.$$ChildScope),child.$parent=parent,child.$$prevSibling=parent.$$childTail,parent.$$childHead?(parent.$$childTail.$$nextSibling=child,parent.$$childTail=child):parent.$$childHead=parent.$$childTail=child,!isolate&&parent===this||child.$on("$destroy",destroyChildScope),child},$watch:function(watchExp,listener,objectEquality,prettyPrintExpression){var get=$parse(watchExp),fn=isFunction(listener)?listener:noop;if(get.$$watchDelegate)return get.$$watchDelegate(this,fn,objectEquality,get,watchExp);var scope=this,array=scope.$$watchers,watcher={fn:fn,last:initWatchVal,get:get,exp:prettyPrintExpression||watchExp,eq:!!objectEquality};return lastDirtyWatch=null,array||((array=scope.$$watchers=[]).$$digestWatchIndex=-1),array.unshift(watcher),array.$$digestWatchIndex++,incrementWatchersCount(this,1),function(){var index=arrayRemove(array,watcher);0<=index&&(incrementWatchersCount(scope,-1),index<array.$$digestWatchIndex&&array.$$digestWatchIndex--),lastDirtyWatch=null}},$watchGroup:function(watchExpressions,listener){var oldValues=new Array(watchExpressions.length),newValues=new Array(watchExpressions.length),deregisterFns=[],self=this,changeReactionScheduled=!1,firstRun=!0;if(!watchExpressions.length){var shouldCall=!0;return self.$evalAsync(function(){shouldCall&&listener(newValues,newValues,self)}),function(){shouldCall=!1}}if(1===watchExpressions.length)return this.$watch(watchExpressions[0],function(value,oldValue,scope){newValues[0]=value,oldValues[0]=oldValue,listener(newValues,value===oldValue?newValues:oldValues,scope)});function watchGroupAction(){changeReactionScheduled=!1;try{firstRun?(firstRun=!1,listener(newValues,newValues,self)):listener(newValues,oldValues,self)}finally{for(var i=0;i<watchExpressions.length;i++)oldValues[i]=newValues[i]}}return forEach(watchExpressions,function(expr,i){var unwatchFn=self.$watch(expr,function(value){newValues[i]=value,changeReactionScheduled||(changeReactionScheduled=!0,self.$evalAsync(watchGroupAction))});deregisterFns.push(unwatchFn)}),function(){for(;deregisterFns.length;)deregisterFns.shift()()}},$watchCollection:function(obj,listener){$watchCollectionInterceptor.$$pure=$parse(obj).literal,$watchCollectionInterceptor.$stateful=!$watchCollectionInterceptor.$$pure;var newValue,oldValue,veryOldValue,self=this,trackVeryOldValue=1<listener.length,changeDetected=0,changeDetector=$parse(obj,$watchCollectionInterceptor),internalArray=[],internalObject={},initRun=!0,oldLength=0;function $watchCollectionInterceptor(_value){var newLength,key,newItem,oldItem;if(!isUndefined(newValue=_value)){if(isObject(newValue))if(isArrayLike(newValue)){oldValue!==internalArray&&(oldLength=(oldValue=internalArray).length=0,changeDetected++),newLength=newValue.length,oldLength!==newLength&&(changeDetected++,oldValue.length=oldLength=newLength);for(var i=0;i<newLength;i++)oldItem=oldValue[i],newItem=newValue[i],oldItem!=oldItem&&newItem!=newItem||oldItem===newItem||(changeDetected++,oldValue[i]=newItem)}else{for(key in oldValue!==internalObject&&(oldValue=internalObject={},oldLength=0,changeDetected++),newLength=0,newValue)hasOwnProperty.call(newValue,key)&&(newLength++,newItem=newValue[key],oldItem=oldValue[key],key in oldValue?oldItem!=oldItem&&newItem!=newItem||oldItem===newItem||(changeDetected++,oldValue[key]=newItem):(oldLength++,oldValue[key]=newItem,changeDetected++));if(newLength<oldLength)for(key in changeDetected++,oldValue)hasOwnProperty.call(newValue,key)||(oldLength--,delete oldValue[key])}else oldValue!==newValue&&(oldValue=newValue,changeDetected++);return changeDetected}}return this.$watch(changeDetector,function(){if(initRun?(initRun=!1,listener(newValue,newValue,self)):listener(newValue,veryOldValue,self),trackVeryOldValue)if(isObject(newValue))if(isArrayLike(newValue)){veryOldValue=new Array(newValue.length);for(var i=0;i<newValue.length;i++)veryOldValue[i]=newValue[i]}else for(var key in veryOldValue={},newValue)hasOwnProperty.call(newValue,key)&&(veryOldValue[key]=newValue[key]);else veryOldValue=newValue})},$digest:function(){var watch,value,last,watchers,dirty,next,current,logIdx,asyncTask,ttl=TTL,target=asyncQueue.length?$rootScope:this,watchLog=[];beginPhase("$digest"),$browser.$$checkUrlChange(),this===$rootScope&&null!==applyAsyncId&&($browser.defer.cancel(applyAsyncId),flushApplyAsync()),lastDirtyWatch=null;do{dirty=!1,current=target;for(var asyncQueuePosition=0;asyncQueuePosition<asyncQueue.length;asyncQueuePosition++){try{(0,(asyncTask=asyncQueue[asyncQueuePosition]).fn)(asyncTask.scope,asyncTask.locals)}catch(e){$exceptionHandler(e)}lastDirtyWatch=null}asyncQueue.length=0;traverseScopesLoop:do{if(watchers=!current.$$suspended&&current.$$watchers)for(watchers.$$digestWatchIndex=watchers.length;watchers.$$digestWatchIndex--;)try{if(watch=watchers[watchers.$$digestWatchIndex])if((value=(0,watch.get)(current))===(last=watch.last)||(watch.eq?equals(value,last):isNumberNaN(value)&&isNumberNaN(last))){if(watch===lastDirtyWatch){dirty=!1;break traverseScopesLoop}}else dirty=!0,(lastDirtyWatch=watch).last=watch.eq?copy(value,null):value,(0,watch.fn)(value,last===initWatchVal?value:last,current),ttl<5&&(watchLog[logIdx=4-ttl]||(watchLog[logIdx]=[]),watchLog[logIdx].push({msg:isFunction(watch.exp)?"fn: "+(watch.exp.name||watch.exp.toString()):watch.exp,newVal:value,oldVal:last}))}catch(e){$exceptionHandler(e)}if(!(next=!current.$$suspended&&current.$$watchersCount&&current.$$childHead||current!==target&&current.$$nextSibling))for(;current!==target&&!(next=current.$$nextSibling);)current=current.$parent}while(current=next);if((dirty||asyncQueue.length)&&!ttl--)throw clearPhase(),$rootScopeMinErr("infdig","{0} $digest() iterations reached. Aborting!\nWatchers fired in the last 5 iterations: {1}",TTL,watchLog)}while(dirty||asyncQueue.length);for(clearPhase();postDigestQueuePosition<postDigestQueue.length;)try{postDigestQueue[postDigestQueuePosition++]()}catch(e){$exceptionHandler(e)}postDigestQueue.length=postDigestQueuePosition=0,$browser.$$checkUrlChange()},$suspend:function(){this.$$suspended=!0},$isSuspended:function(){return this.$$suspended},$resume:function(){this.$$suspended=!1},$destroy:function(){if(!this.$$destroyed){var parent=this.$parent;for(var eventName in this.$broadcast("$destroy"),this.$$destroyed=!0,this===$rootScope&&$browser.$$applicationDestroyed(),incrementWatchersCount(this,-this.$$watchersCount),this.$$listenerCount)decrementListenerCount(this,this.$$listenerCount[eventName],eventName);parent&&parent.$$childHead===this&&(parent.$$childHead=this.$$nextSibling),parent&&parent.$$childTail===this&&(parent.$$childTail=this.$$prevSibling),this.$$prevSibling&&(this.$$prevSibling.$$nextSibling=this.$$nextSibling),this.$$nextSibling&&(this.$$nextSibling.$$prevSibling=this.$$prevSibling),this.$destroy=this.$digest=this.$apply=this.$evalAsync=this.$applyAsync=noop,this.$on=this.$watch=this.$watchGroup=function(){return noop},this.$$listeners={},this.$$nextSibling=null,function cleanUpScope($scope){9===msie&&($scope.$$childHead&&cleanUpScope($scope.$$childHead),$scope.$$nextSibling&&cleanUpScope($scope.$$nextSibling)),$scope.$parent=$scope.$$nextSibling=$scope.$$prevSibling=$scope.$$childHead=$scope.$$childTail=$scope.$root=$scope.$$watchers=null}(this)}},$eval:function(expr,locals){return $parse(expr)(this,locals)},$evalAsync:function(expr,locals){$rootScope.$$phase||asyncQueue.length||$browser.defer(function(){asyncQueue.length&&$rootScope.$digest()},null,"$evalAsync"),asyncQueue.push({scope:this,fn:$parse(expr),locals:locals})},$$postDigest:function(fn){postDigestQueue.push(fn)},$apply:function(expr){try{beginPhase("$apply");try{return this.$eval(expr)}finally{clearPhase()}}catch(e){$exceptionHandler(e)}finally{try{$rootScope.$digest()}catch(e){throw $exceptionHandler(e),e}}},$applyAsync:function(expr){var scope=this;expr&&applyAsyncQueue.push(function(){scope.$eval(expr)}),expr=$parse(expr),null===applyAsyncId&&(applyAsyncId=$browser.defer(function(){$rootScope.$apply(flushApplyAsync)},null,"$applyAsync"))},$on:function(name,listener){var namedListeners=this.$$listeners[name];namedListeners||(this.$$listeners[name]=namedListeners=[]),namedListeners.push(listener);for(var current=this;current.$$listenerCount[name]||(current.$$listenerCount[name]=0),current.$$listenerCount[name]++,current=current.$parent;);var self=this;return function(){var indexOfListener=namedListeners.indexOf(listener);-1!==indexOfListener&&(delete namedListeners[indexOfListener],decrementListenerCount(self,1,name))}},$emit:function(name,args){var namedListeners,i,length,empty=[],scope=this,stopPropagation=!1,event={name:name,targetScope:scope,stopPropagation:function(){stopPropagation=!0},preventDefault:function(){event.defaultPrevented=!0},defaultPrevented:!1},listenerArgs=concat([event],arguments,1);do{for(namedListeners=scope.$$listeners[name]||empty,event.currentScope=scope,i=0,length=namedListeners.length;i<length;i++)if(namedListeners[i])try{namedListeners[i].apply(null,listenerArgs)}catch(e){$exceptionHandler(e)}else namedListeners.splice(i,1),i--,length--;if(stopPropagation)break;scope=scope.$parent}while(scope);return event.currentScope=null,event},$broadcast:function(name,args){var current=this,next=this,event={name:name,targetScope:this,preventDefault:function(){event.defaultPrevented=!0},defaultPrevented:!1};if(!this.$$listenerCount[name])return event;for(var listeners,i,length,listenerArgs=concat([event],arguments,1);current=next;){for(i=0,length=(listeners=(event.currentScope=current).$$listeners[name]||[]).length;i<length;i++)if(listeners[i])try{listeners[i].apply(null,listenerArgs)}catch(e){$exceptionHandler(e)}else listeners.splice(i,1),i--,length--;if(!(next=current.$$listenerCount[name]&&current.$$childHead||current!==this&&current.$$nextSibling))for(;current!==this&&!(next=current.$$nextSibling);)current=current.$parent}return event.currentScope=null,event}};var $rootScope=new Scope,asyncQueue=$rootScope.$$asyncQueue=[],postDigestQueue=$rootScope.$$postDigestQueue=[],applyAsyncQueue=$rootScope.$$applyAsyncQueue=[],postDigestQueuePosition=0;return $rootScope;function beginPhase(phase){if($rootScope.$$phase)throw $rootScopeMinErr("inprog","{0} already in progress",$rootScope.$$phase);$rootScope.$$phase=phase}function clearPhase(){$rootScope.$$phase=null}function incrementWatchersCount(current,count){for(;current.$$watchersCount+=count,current=current.$parent;);}function decrementListenerCount(current,count,name){for(;current.$$listenerCount[name]-=count,0===current.$$listenerCount[name]&&delete current.$$listenerCount[name],current=current.$parent;);}function initWatchVal(){}function flushApplyAsync(){for(;applyAsyncQueue.length;)try{applyAsyncQueue.shift()()}catch(e){$exceptionHandler(e)}applyAsyncId=null}}]}function $$SanitizeUriProvider(){var aHrefSanitizationWhitelist=/^\s*(https?|s?ftp|mailto|tel|file):/,imgSrcSanitizationWhitelist=/^\s*((https?|ftp|file|blob):|data:image\/)/;this.aHrefSanitizationWhitelist=function(regexp){return isDefined(regexp)?(aHrefSanitizationWhitelist=regexp,this):aHrefSanitizationWhitelist},this.imgSrcSanitizationWhitelist=function(regexp){return isDefined(regexp)?(imgSrcSanitizationWhitelist=regexp,this):imgSrcSanitizationWhitelist},this.$get=function(){return function(uri,isMediaUrl){var regex=isMediaUrl?imgSrcSanitizationWhitelist:aHrefSanitizationWhitelist,normalizedVal=urlResolve(uri&&uri.trim()).href;return""===normalizedVal||normalizedVal.match(regex)?uri:"unsafe:"+normalizedVal}}}ASTCompiler.prototype={compile:function(ast){var self=this;this.state={nextId:0,filters:{},fn:{vars:[],body:[],own:{}},assign:{vars:[],body:[],own:{}},inputs:[]},findConstantAndWatchExpressions(ast,self.$filter);var assignable,extra="";if(this.stage="assign",assignable=assignableAST(ast)){this.state.computing="assign";var result=this.nextId();this.recurse(assignable,result),this.return_(result),extra="fn.assign="+this.generateFunction("assign","s,v,l")}var toWatch=getInputs(ast.body);self.stage="inputs",forEach(toWatch,function(watch,key){var fnKey="fn"+key;self.state[fnKey]={vars:[],body:[],own:{}},self.state.computing=fnKey;var intoId=self.nextId();self.recurse(watch,intoId),self.return_(intoId),self.state.inputs.push({name:fnKey,isPure:watch.isPure}),watch.watchId=key}),this.state.computing="fn",this.stage="main",this.recurse(ast);var fnString='"'+this.USE+" "+this.STRICT+'";\n'+this.filterPrefix()+"var fn="+this.generateFunction("fn","s,l,a,i")+extra+this.watchFns()+"return fn;",fn=new Function("$filter","getStringValue","ifDefined","plus",fnString)(this.$filter,getStringValue,ifDefined,plusFn);return this.state=this.stage=void 0,fn},USE:"use",STRICT:"strict",watchFns:function(){var result=[],inputs=this.state.inputs,self=this;return forEach(inputs,function(input){result.push("var "+input.name+"="+self.generateFunction(input.name,"s")),input.isPure&&result.push(input.name,".isPure="+JSON.stringify(input.isPure)+";")}),inputs.length&&result.push("fn.inputs=["+inputs.map(function(i){return i.name}).join(",")+"];"),result.join("")},generateFunction:function(name,params){return"function("+params+"){"+this.varsPrefix(name)+this.body(name)+"};"},filterPrefix:function(){var parts=[],self=this;return forEach(this.state.filters,function(id,filter){parts.push(id+"=$filter("+self.escape(filter)+")")}),parts.length?"var "+parts.join(",")+";":""},varsPrefix:function(section){return this.state[section].vars.length?"var "+this.state[section].vars.join(",")+";":""},body:function(section){return this.state[section].body.join("")},recurse:function(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck){var left,right,args,expression,computed,self=this;if(recursionFn=recursionFn||noop,!skipWatchIdCheck&&isDefined(ast.watchId))return intoId=intoId||this.nextId(),void this.if_("i",this.lazyAssign(intoId,this.computedMember("i",ast.watchId)),this.lazyRecurse(ast,intoId,nameId,recursionFn,create,!0));switch(ast.type){case AST.Program:forEach(ast.body,function(expression,pos){self.recurse(expression.expression,void 0,void 0,function(expr){right=expr}),pos!==ast.body.length-1?self.current().body.push(right,";"):self.return_(right)});break;case AST.Literal:expression=this.escape(ast.value),this.assign(intoId,expression),recursionFn(intoId||expression);break;case AST.UnaryExpression:this.recurse(ast.argument,void 0,void 0,function(expr){right=expr}),expression=ast.operator+"("+this.ifDefined(right,0)+")",this.assign(intoId,expression),recursionFn(expression);break;case AST.BinaryExpression:this.recurse(ast.left,void 0,void 0,function(expr){left=expr}),this.recurse(ast.right,void 0,void 0,function(expr){right=expr}),expression="+"===ast.operator?this.plus(left,right):"-"===ast.operator?this.ifDefined(left,0)+ast.operator+this.ifDefined(right,0):"("+left+")"+ast.operator+"("+right+")",this.assign(intoId,expression),recursionFn(expression);break;case AST.LogicalExpression:intoId=intoId||this.nextId(),self.recurse(ast.left,intoId),self.if_("&&"===ast.operator?intoId:self.not(intoId),self.lazyRecurse(ast.right,intoId)),recursionFn(intoId);break;case AST.ConditionalExpression:intoId=intoId||this.nextId(),self.recurse(ast.test,intoId),self.if_(intoId,self.lazyRecurse(ast.alternate,intoId),self.lazyRecurse(ast.consequent,intoId)),recursionFn(intoId);break;case AST.Identifier:intoId=intoId||this.nextId(),nameId&&(nameId.context="inputs"===self.stage?"s":this.assign(this.nextId(),this.getHasOwnProperty("l",ast.name)+"?l:s"),nameId.computed=!1,nameId.name=ast.name),self.if_("inputs"===self.stage||self.not(self.getHasOwnProperty("l",ast.name)),function(){self.if_("inputs"===self.stage||"s",function(){create&&1!==create&&self.if_(self.isNull(self.nonComputedMember("s",ast.name)),self.lazyAssign(self.nonComputedMember("s",ast.name),"{}")),self.assign(intoId,self.nonComputedMember("s",ast.name))})},intoId&&self.lazyAssign(intoId,self.nonComputedMember("l",ast.name))),recursionFn(intoId);break;case AST.MemberExpression:left=nameId&&(nameId.context=this.nextId())||this.nextId(),intoId=intoId||this.nextId(),self.recurse(ast.object,left,void 0,function(){self.if_(self.notNull(left),function(){ast.computed?(right=self.nextId(),self.recurse(ast.property,right),self.getStringValue(right),create&&1!==create&&self.if_(self.not(self.computedMember(left,right)),self.lazyAssign(self.computedMember(left,right),"{}")),expression=self.computedMember(left,right),self.assign(intoId,expression),nameId&&(nameId.computed=!0,nameId.name=right)):(create&&1!==create&&self.if_(self.isNull(self.nonComputedMember(left,ast.property.name)),self.lazyAssign(self.nonComputedMember(left,ast.property.name),"{}")),expression=self.nonComputedMember(left,ast.property.name),self.assign(intoId,expression),nameId&&(nameId.computed=!1,nameId.name=ast.property.name))},function(){self.assign(intoId,"undefined")}),recursionFn(intoId)},!!create);break;case AST.CallExpression:intoId=intoId||this.nextId(),ast.filter?(right=self.filter(ast.callee.name),args=[],forEach(ast.arguments,function(expr){var argument=self.nextId();self.recurse(expr,argument),args.push(argument)}),expression=right+"("+args.join(",")+")",self.assign(intoId,expression),recursionFn(intoId)):(right=self.nextId(),left={},args=[],self.recurse(ast.callee,right,left,function(){self.if_(self.notNull(right),function(){forEach(ast.arguments,function(expr){self.recurse(expr,ast.constant?void 0:self.nextId(),void 0,function(argument){args.push(argument)})}),expression=left.name?self.member(left.context,left.name,left.computed)+"("+args.join(",")+")":right+"("+args.join(",")+")",self.assign(intoId,expression)},function(){self.assign(intoId,"undefined")}),recursionFn(intoId)}));break;case AST.AssignmentExpression:right=this.nextId(),left={},this.recurse(ast.left,void 0,left,function(){self.if_(self.notNull(left.context),function(){self.recurse(ast.right,right),expression=self.member(left.context,left.name,left.computed)+ast.operator+right,self.assign(intoId,expression),recursionFn(intoId||expression)})},1);break;case AST.ArrayExpression:args=[],forEach(ast.elements,function(expr){self.recurse(expr,ast.constant?void 0:self.nextId(),void 0,function(argument){args.push(argument)})}),expression="["+args.join(",")+"]",this.assign(intoId,expression),recursionFn(intoId||expression);break;case AST.ObjectExpression:computed=!(args=[]),forEach(ast.properties,function(property){property.computed&&(computed=!0)}),computed?(intoId=intoId||this.nextId(),this.assign(intoId,"{}"),forEach(ast.properties,function(property){property.computed?(left=self.nextId(),self.recurse(property.key,left)):left=property.key.type===AST.Identifier?property.key.name:""+property.key.value,right=self.nextId(),self.recurse(property.value,right),self.assign(self.member(intoId,left,property.computed),right)})):(forEach(ast.properties,function(property){self.recurse(property.value,ast.constant?void 0:self.nextId(),void 0,function(expr){args.push(self.escape(property.key.type===AST.Identifier?property.key.name:""+property.key.value)+":"+expr)})}),expression="{"+args.join(",")+"}",this.assign(intoId,expression)),recursionFn(intoId||expression);break;case AST.ThisExpression:this.assign(intoId,"s"),recursionFn(intoId||"s");break;case AST.LocalsExpression:this.assign(intoId,"l"),recursionFn(intoId||"l");break;case AST.NGValueParameter:this.assign(intoId,"v"),recursionFn(intoId||"v")}},getHasOwnProperty:function(element,property){var key=element+"."+property,own=this.current().own;return own.hasOwnProperty(key)||(own[key]=this.nextId(!1,element+"&&("+this.escape(property)+" in "+element+")")),own[key]},assign:function(id,value){if(id)return this.current().body.push(id,"=",value,";"),id},filter:function(filterName){return this.state.filters.hasOwnProperty(filterName)||(this.state.filters[filterName]=this.nextId(!0)),this.state.filters[filterName]},ifDefined:function(id,defaultValue){return"ifDefined("+id+","+this.escape(defaultValue)+")"},plus:function(left,right){return"plus("+left+","+right+")"},return_:function(id){this.current().body.push("return ",id,";")},if_:function(test,alternate,consequent){if(!0===test)alternate();else{var body=this.current().body;body.push("if(",test,"){"),alternate(),body.push("}"),consequent&&(body.push("else{"),consequent(),body.push("}"))}},not:function(expression){return"!("+expression+")"},isNull:function(expression){return expression+"==null"},notNull:function(expression){return expression+"!=null"},nonComputedMember:function(left,right){return/^[$_a-zA-Z][$_a-zA-Z0-9]*$/.test(right)?left+"."+right:left+'["'+right.replace(/[^$_a-zA-Z0-9]/g,this.stringEscapeFn)+'"]'},computedMember:function(left,right){return left+"["+right+"]"},member:function(left,right,computed){return computed?this.computedMember(left,right):this.nonComputedMember(left,right)},getStringValue:function(item){this.assign(item,"getStringValue("+item+")")},lazyRecurse:function(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck){var self=this;return function(){self.recurse(ast,intoId,nameId,recursionFn,create,skipWatchIdCheck)}},lazyAssign:function(id,value){var self=this;return function(){self.assign(id,value)}},stringEscapeRegex:/[^ a-zA-Z0-9]/g,stringEscapeFn:function(c){return"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)},escape:function(value){if(isString(value))return"'"+value.replace(this.stringEscapeRegex,this.stringEscapeFn)+"'";if(isNumber(value))return value.toString();if(!0===value)return"true";if(!1===value)return"false";if(null===value)return"null";if(void 0===value)return"undefined";throw $parseMinErr("esc","IMPOSSIBLE")},nextId:function(skip,init){var id="v"+this.state.nextId++;return skip||this.current().vars.push(id+(init?"="+init:"")),id},current:function(){return this.state[this.state.computing]}},ASTInterpreter.prototype={compile:function(ast){var assignable,assign,self=this;findConstantAndWatchExpressions(ast,self.$filter),(assignable=assignableAST(ast))&&(assign=this.recurse(assignable));var inputs,toWatch=getInputs(ast.body);toWatch&&(inputs=[],forEach(toWatch,function(watch,key){var input=self.recurse(watch);input.isPure=watch.isPure,watch.input=input,inputs.push(input),watch.watchId=key}));var expressions=[];forEach(ast.body,function(expression){expressions.push(self.recurse(expression.expression))});var fn=0===ast.body.length?noop:1===ast.body.length?expressions[0]:function(scope,locals){var lastValue;return forEach(expressions,function(exp){lastValue=exp(scope,locals)}),lastValue};return assign&&(fn.assign=function(scope,value,locals){return assign(scope,locals,value)}),inputs&&(fn.inputs=inputs),fn},recurse:function(ast,context,create){var left,right,args,self=this;if(ast.input)return this.inputs(ast.input,ast.watchId);switch(ast.type){case AST.Literal:return this.value(ast.value,context);case AST.UnaryExpression:return right=this.recurse(ast.argument),this["unary"+ast.operator](right,context);case AST.BinaryExpression:case AST.LogicalExpression:return left=this.recurse(ast.left),right=this.recurse(ast.right),this["binary"+ast.operator](left,right,context);case AST.ConditionalExpression:return this["ternary?:"](this.recurse(ast.test),this.recurse(ast.alternate),this.recurse(ast.consequent),context);case AST.Identifier:return self.identifier(ast.name,context,create);case AST.MemberExpression:return left=this.recurse(ast.object,!1,!!create),ast.computed||(right=ast.property.name),ast.computed&&(right=this.recurse(ast.property)),ast.computed?this.computedMember(left,right,context,create):this.nonComputedMember(left,right,context,create);case AST.CallExpression:return args=[],forEach(ast.arguments,function(expr){args.push(self.recurse(expr))}),ast.filter&&(right=this.$filter(ast.callee.name)),ast.filter||(right=this.recurse(ast.callee,!0)),ast.filter?function(scope,locals,assign,inputs){for(var values=[],i=0;i<args.length;++i)values.push(args[i](scope,locals,assign,inputs));var value=right.apply(void 0,values,inputs);return context?{context:void 0,name:void 0,value:value}:value}:function(scope,locals,assign,inputs){var value,rhs=right(scope,locals,assign,inputs);if(null!=rhs.value){for(var values=[],i=0;i<args.length;++i)values.push(args[i](scope,locals,assign,inputs));value=rhs.value.apply(rhs.context,values)}return context?{value:value}:value};case AST.AssignmentExpression:return left=this.recurse(ast.left,!0,1),right=this.recurse(ast.right),function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs),rhs=right(scope,locals,assign,inputs);return lhs.context[lhs.name]=rhs,context?{value:rhs}:rhs};case AST.ArrayExpression:return args=[],forEach(ast.elements,function(expr){args.push(self.recurse(expr))}),function(scope,locals,assign,inputs){for(var value=[],i=0;i<args.length;++i)value.push(args[i](scope,locals,assign,inputs));return context?{value:value}:value};case AST.ObjectExpression:return args=[],forEach(ast.properties,function(property){property.computed?args.push({key:self.recurse(property.key),computed:!0,value:self.recurse(property.value)}):args.push({key:property.key.type===AST.Identifier?property.key.name:""+property.key.value,computed:!1,value:self.recurse(property.value)})}),function(scope,locals,assign,inputs){for(var value={},i=0;i<args.length;++i)args[i].computed?value[args[i].key(scope,locals,assign,inputs)]=args[i].value(scope,locals,assign,inputs):value[args[i].key]=args[i].value(scope,locals,assign,inputs);return context?{value:value}:value};case AST.ThisExpression:return function(scope){return context?{value:scope}:scope};case AST.LocalsExpression:return function(scope,locals){return context?{value:locals}:locals};case AST.NGValueParameter:return function(scope,locals,assign){return context?{value:assign}:assign}}},"unary+":function(argument,context){return function(scope,locals,assign,inputs){var arg=argument(scope,locals,assign,inputs);return arg=isDefined(arg)?+arg:0,context?{value:arg}:arg}},"unary-":function(argument,context){return function(scope,locals,assign,inputs){var arg=argument(scope,locals,assign,inputs);return arg=isDefined(arg)?-arg:-0,context?{value:arg}:arg}},"unary!":function(argument,context){return function(scope,locals,assign,inputs){var arg=!argument(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary+":function(left,right,context){return function(scope,locals,assign,inputs){var arg=plusFn(left(scope,locals,assign,inputs),right(scope,locals,assign,inputs));return context?{value:arg}:arg}},"binary-":function(left,right,context){return function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs),rhs=right(scope,locals,assign,inputs),arg=(isDefined(lhs)?lhs:0)-(isDefined(rhs)?rhs:0);return context?{value:arg}:arg}},"binary*":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)*right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary/":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)/right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary%":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)%right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary===":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)===right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary!==":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)!==right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary==":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)==right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary!=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)!=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary<":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)<right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary>":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)>right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary<=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)<=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary>=":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)>=right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary&&":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)&&right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"binary||":function(left,right,context){return function(scope,locals,assign,inputs){var arg=left(scope,locals,assign,inputs)||right(scope,locals,assign,inputs);return context?{value:arg}:arg}},"ternary?:":function(test,alternate,consequent,context){return function(scope,locals,assign,inputs){var arg=test(scope,locals,assign,inputs)?alternate(scope,locals,assign,inputs):consequent(scope,locals,assign,inputs);return context?{value:arg}:arg}},value:function(value,context){return function(){return context?{context:void 0,name:void 0,value:value}:value}},identifier:function(name,context,create){return function(scope,locals,assign,inputs){var base=locals&&name in locals?locals:scope;create&&1!==create&&base&&null==base[name]&&(base[name]={});var value=base?base[name]:void 0;return context?{context:base,name:name,value:value}:value}},computedMember:function(left,right,context,create){return function(scope,locals,assign,inputs){var rhs,value,lhs=left(scope,locals,assign,inputs);return null!=lhs&&(rhs=getStringValue(rhs=right(scope,locals,assign,inputs)),create&&1!==create&&lhs&&!lhs[rhs]&&(lhs[rhs]={}),value=lhs[rhs]),context?{context:lhs,name:rhs,value:value}:value}},nonComputedMember:function(left,right,context,create){return function(scope,locals,assign,inputs){var lhs=left(scope,locals,assign,inputs);create&&1!==create&&lhs&&null==lhs[right]&&(lhs[right]={});var value=null!=lhs?lhs[right]:void 0;return context?{context:lhs,name:right,value:value}:value}},inputs:function(input,watchId){return function(scope,value,locals,inputs){return inputs?inputs[watchId]:input(scope,value,locals)}}},Parser.prototype={constructor:Parser,parse:function(text){var ast=this.getAst(text),fn=this.astCompiler.compile(ast.ast);return fn.literal=function(ast){return 0===ast.body.length||1===ast.body.length&&(ast.body[0].expression.type===AST.Literal||ast.body[0].expression.type===AST.ArrayExpression||ast.body[0].expression.type===AST.ObjectExpression)}(ast.ast),fn.constant=function(ast){return ast.constant}(ast.ast),fn.oneTime=ast.oneTime,fn},getAst:function(exp){var oneTime=!1;return":"===(exp=exp.trim()).charAt(0)&&":"===exp.charAt(1)&&(oneTime=!0,exp=exp.substring(2)),{ast:this.ast.ast(exp),oneTime:oneTime}}};var $sceMinErr=minErr("$sce"),SCE_CONTEXTS={HTML:"html",CSS:"css",MEDIA_URL:"mediaUrl",URL:"url",RESOURCE_URL:"resourceUrl",JS:"js"},UNDERSCORE_LOWERCASE_REGEXP=/_([a-z])/g;function snakeToCamel(name){return name.replace(UNDERSCORE_LOWERCASE_REGEXP,fnCamelCaseReplace)}function adjustMatchers(matchers){var adjustedMatchers=[];return isDefined(matchers)&&forEach(matchers,function(matcher){adjustedMatchers.push(function(matcher){if("self"===matcher)return matcher;if(isString(matcher)){if(-1<matcher.indexOf("***"))throw $sceMinErr("iwcard","Illegal sequence *** in string matcher.  String: {0}",matcher);return matcher=escapeForRegexp(matcher).replace(/\\\*\\\*/g,".*").replace(/\\\*/g,"[^:/.?&;]*"),new RegExp("^"+matcher+"$")}if(isRegExp(matcher))return new RegExp("^"+matcher.source+"$");throw $sceMinErr("imatcher",'Matchers may only be "self", string patterns or RegExp objects')}(matcher))}),adjustedMatchers}function $SceDelegateProvider(){this.SCE_CONTEXTS=SCE_CONTEXTS;var resourceUrlWhitelist=["self"],resourceUrlBlacklist=[];this.resourceUrlWhitelist=function(value){return arguments.length&&(resourceUrlWhitelist=adjustMatchers(value)),resourceUrlWhitelist},this.resourceUrlBlacklist=function(value){return arguments.length&&(resourceUrlBlacklist=adjustMatchers(value)),resourceUrlBlacklist},this.$get=["$injector","$$sanitizeUri",function($injector,$$sanitizeUri){var htmlSanitizer=function(html){throw $sceMinErr("unsafe","Attempting to use an unsafe value in a safe context.")};function matchUrl(matcher,parsedUrl){return"self"===matcher?function(requestUrl){return urlsAreSameOrigin(requestUrl,originUrl)}(parsedUrl)||function(requestUrl){return urlsAreSameOrigin(requestUrl,function(){if(window.document.baseURI)return window.document.baseURI;baseUrlParsingNode||((baseUrlParsingNode=window.document.createElement("a")).href=".",baseUrlParsingNode=baseUrlParsingNode.cloneNode(!1));return baseUrlParsingNode.href}())}(parsedUrl):!!matcher.exec(parsedUrl.href)}function generateHolderType(Base){function holderType(trustedValue){this.$$unwrapTrustedValue=function(){return trustedValue}}return Base&&(holderType.prototype=new Base),holderType.prototype.valueOf=function(){return this.$$unwrapTrustedValue()},holderType.prototype.toString=function(){return this.$$unwrapTrustedValue().toString()},holderType}$injector.has("$sanitize")&&(htmlSanitizer=$injector.get("$sanitize"));var trustedValueHolderBase=generateHolderType(),byType={};return byType[SCE_CONTEXTS.HTML]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.CSS]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.MEDIA_URL]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.URL]=generateHolderType(byType[SCE_CONTEXTS.MEDIA_URL]),byType[SCE_CONTEXTS.JS]=generateHolderType(trustedValueHolderBase),byType[SCE_CONTEXTS.RESOURCE_URL]=generateHolderType(byType[SCE_CONTEXTS.URL]),{trustAs:function(type,trustedValue){var Constructor=byType.hasOwnProperty(type)?byType[type]:null;if(!Constructor)throw $sceMinErr("icontext","Attempted to trust a value in invalid context. Context: {0}; Value: {1}",type,trustedValue);if(null===trustedValue||isUndefined(trustedValue)||""===trustedValue)return trustedValue;if("string"!=typeof trustedValue)throw $sceMinErr("itype","Attempted to trust a non-string value in a content requiring a string: Context: {0}",type);return new Constructor(trustedValue)},getTrusted:function(type,maybeTrusted){if(null===maybeTrusted||isUndefined(maybeTrusted)||""===maybeTrusted)return maybeTrusted;var constructor=byType.hasOwnProperty(type)?byType[type]:null;if(constructor&&maybeTrusted instanceof constructor)return maybeTrusted.$$unwrapTrustedValue();if(isFunction(maybeTrusted.$$unwrapTrustedValue)&&(maybeTrusted=maybeTrusted.$$unwrapTrustedValue()),type===SCE_CONTEXTS.MEDIA_URL||type===SCE_CONTEXTS.URL)return $$sanitizeUri(maybeTrusted.toString(),type===SCE_CONTEXTS.MEDIA_URL);if(type===SCE_CONTEXTS.RESOURCE_URL){if(function(url){var i,n,parsedUrl=urlResolve(url.toString()),allowed=!1;for(i=0,n=resourceUrlWhitelist.length;i<n;i++)if(matchUrl(resourceUrlWhitelist[i],parsedUrl)){allowed=!0;break}if(allowed)for(i=0,n=resourceUrlBlacklist.length;i<n;i++)if(matchUrl(resourceUrlBlacklist[i],parsedUrl)){allowed=!1;break}return allowed}(maybeTrusted))return maybeTrusted;throw $sceMinErr("insecurl","Blocked loading resource from url not allowed by $sceDelegate policy.  URL: {0}",maybeTrusted.toString())}if(type===SCE_CONTEXTS.HTML)return htmlSanitizer(maybeTrusted);throw $sceMinErr("unsafe","Attempting to use an unsafe value in a safe context.")},valueOf:function(maybeTrusted){return maybeTrusted instanceof trustedValueHolderBase?maybeTrusted.$$unwrapTrustedValue():maybeTrusted}}}]}function $SceProvider(){var enabled=!0;this.enabled=function(value){return arguments.length&&(enabled=!!value),enabled},this.$get=["$parse","$sceDelegate",function($parse,$sceDelegate){if(enabled&&msie<8)throw $sceMinErr("iequirks","Strict Contextual Escaping does not support Internet Explorer version < 11 in quirks mode.  You can fix this by adding the text <!doctype html> to the top of your HTML document.  See http://docs.angularjs.org/api/ng.$sce for more information.");var sce=shallowCopy(SCE_CONTEXTS);sce.isEnabled=function(){return enabled},sce.trustAs=$sceDelegate.trustAs,sce.getTrusted=$sceDelegate.getTrusted,sce.valueOf=$sceDelegate.valueOf,enabled||(sce.trustAs=sce.getTrusted=function(type,value){return value},sce.valueOf=identity),sce.parseAs=function(type,expr){var parsed=$parse(expr);return parsed.literal&&parsed.constant?parsed:$parse(expr,function(value){return sce.getTrusted(type,value)})};var parse=sce.parseAs,getTrusted=sce.getTrusted,trustAs=sce.trustAs;return forEach(SCE_CONTEXTS,function(enumValue,name){var lName=lowercase(name);sce[snakeToCamel("parse_as_"+lName)]=function(expr){return parse(enumValue,expr)},sce[snakeToCamel("get_trusted_"+lName)]=function(value){return getTrusted(enumValue,value)},sce[snakeToCamel("trust_as_"+lName)]=function(value){return trustAs(enumValue,value)}}),sce}]}function $SnifferProvider(){this.$get=["$window","$document",function($window,$document){var eventSupport={},hasHistoryPushState=!(!($window.nw&&$window.nw.process)&&$window.chrome&&($window.chrome.app&&$window.chrome.app.runtime||!$window.chrome.app&&$window.chrome.runtime&&$window.chrome.runtime.id))&&$window.history&&$window.history.pushState,android=toInt((/android (\d+)/.exec(lowercase(($window.navigator||{}).userAgent))||[])[1]),boxee=/Boxee/i.test(($window.navigator||{}).userAgent),document=$document[0]||{},bodyStyle=document.body&&document.body.style,transitions=!1,animations=!1;return bodyStyle&&(transitions=!!("transition"in bodyStyle||"webkitTransition"in bodyStyle),animations=!!("animation"in bodyStyle||"webkitAnimation"in bodyStyle)),{history:!(!hasHistoryPushState||android<4||boxee),hasEvent:function(event){if("input"===event&&msie)return!1;if(isUndefined(eventSupport[event])){var divElm=document.createElement("div");eventSupport[event]="on"+event in divElm}return eventSupport[event]},csp:csp(),transitions:transitions,animations:animations,android:android}}]}function $$TaskTrackerFactoryProvider(){this.$get=valueFn(function(log){return new TaskTracker(log)})}function TaskTracker(log){var taskCounts={},taskCallbacks=[],ALL_TASKS_TYPE=this.ALL_TASKS_TYPE="$$all$$",DEFAULT_TASK_TYPE=this.DEFAULT_TASK_TYPE="$$default$$";function getLastCallback(){var cbInfo=taskCallbacks.pop();return cbInfo&&cbInfo.cb}function getLastCallbackForType(taskType){for(var i=taskCallbacks.length-1;0<=i;--i){var cbInfo=taskCallbacks[i];if(cbInfo.type===taskType)return taskCallbacks.splice(i,1),cbInfo.cb}}this.completeTask=function(fn,taskType){taskType=taskType||DEFAULT_TASK_TYPE;try{fn()}finally{!function(taskType){taskCounts[taskType=taskType||DEFAULT_TASK_TYPE]&&(taskCounts[taskType]--,taskCounts[ALL_TASKS_TYPE]--)}(taskType);var countForType=taskCounts[taskType],countForAll=taskCounts[ALL_TASKS_TYPE];if(!countForAll||!countForType)for(var nextCb,getNextCallback=countForAll?getLastCallbackForType:getLastCallback;nextCb=getNextCallback(taskType);)try{nextCb()}catch(e){log.error(e)}}},this.incTaskCount=function(taskType){taskCounts[taskType=taskType||DEFAULT_TASK_TYPE]=(taskCounts[taskType]||0)+1,taskCounts[ALL_TASKS_TYPE]=(taskCounts[ALL_TASKS_TYPE]||0)+1},this.notifyWhenNoPendingTasks=function(callback,taskType){taskCounts[taskType=taskType||ALL_TASKS_TYPE]?taskCallbacks.push({type:taskType,cb:callback}):callback()}}var $templateRequestMinErr=minErr("$templateRequest");function $TemplateRequestProvider(){var httpOptions;this.httpOptions=function(val){return val?(httpOptions=val,this):httpOptions},this.$get=["$exceptionHandler","$templateCache","$http","$q","$sce",function($exceptionHandler,$templateCache,$http,$q,$sce){function handleRequestFn(tpl,ignoreRequestError){handleRequestFn.totalPendingRequests++,isString(tpl)&&!isUndefined($templateCache.get(tpl))||(tpl=$sce.getTrustedResourceUrl(tpl));var transformResponse=$http.defaults&&$http.defaults.transformResponse;return isArray(transformResponse)?transformResponse=transformResponse.filter(function(transformer){return transformer!==defaultHttpResponseTransform}):transformResponse===defaultHttpResponseTransform&&(transformResponse=null),$http.get(tpl,extend({cache:$templateCache,transformResponse:transformResponse},httpOptions)).finally(function(){handleRequestFn.totalPendingRequests--}).then(function(response){return $templateCache.put(tpl,response.data)},function(resp){ignoreRequestError||(resp=$templateRequestMinErr("tpload","Failed to load template: {0} (HTTP status: {1} {2})",tpl,resp.status,resp.statusText),$exceptionHandler(resp));return $q.reject(resp)})}return handleRequestFn.totalPendingRequests=0,handleRequestFn}]}function $$TestabilityProvider(){this.$get=["$rootScope","$browser","$location",function($rootScope,$browser,$location){var testability={findBindings:function(element,expression,opt_exactMatch){var bindings=element.getElementsByClassName("ng-binding"),matches=[];return forEach(bindings,function(binding){var dataBinding=angular.element(binding).data("$binding");dataBinding&&forEach(dataBinding,function(bindingName){opt_exactMatch?new RegExp("(^|\\s)"+escapeForRegexp(expression)+"(\\s|\\||$)").test(bindingName)&&matches.push(binding):-1!==bindingName.indexOf(expression)&&matches.push(binding)})}),matches},findModels:function(element,expression,opt_exactMatch){for(var prefixes=["ng-","data-ng-","ng\\:"],p=0;p<prefixes.length;++p){var selector="["+prefixes[p]+"model"+(opt_exactMatch?"=":"*=")+'"'+expression+'"]',elements=element.querySelectorAll(selector);if(elements.length)return elements}},getLocation:function(){return $location.url()},setLocation:function(url){url!==$location.url()&&($location.url(url),$rootScope.$digest())},whenStable:function(callback){$browser.notifyWhenNoOutstandingRequests(callback)}};return testability}]}var $timeoutMinErr=minErr("$timeout");function $TimeoutProvider(){this.$get=["$rootScope","$browser","$q","$$q","$exceptionHandler",function($rootScope,$browser,$q,$$q,$exceptionHandler){var deferreds={};function timeout(fn,delay,invokeApply){isFunction(fn)||(invokeApply=delay,delay=fn,fn=noop);var timeoutId,args=sliceArgs(arguments,3),skipApply=isDefined(invokeApply)&&!invokeApply,deferred=(skipApply?$$q:$q).defer(),promise=deferred.promise;return timeoutId=$browser.defer(function(){try{deferred.resolve(fn.apply(null,args))}catch(e){deferred.reject(e),$exceptionHandler(e)}finally{delete deferreds[promise.$$timeoutId]}skipApply||$rootScope.$apply()},delay,"$timeout"),promise.$$timeoutId=timeoutId,deferreds[timeoutId]=deferred,promise}return timeout.cancel=function(promise){if(!promise)return!1;if(!promise.hasOwnProperty("$$timeoutId"))throw $timeoutMinErr("badprom","`$timeout.cancel()` called with a promise that was not generated by `$timeout()`.");if(!deferreds.hasOwnProperty(promise.$$timeoutId))return!1;var id=promise.$$timeoutId,deferred=deferreds[id];return markQExceptionHandled(deferred.promise),deferred.reject("canceled"),delete deferreds[id],$browser.defer.cancel(id)},timeout}]}var baseUrlParsingNode,urlParsingNode=window.document.createElement("a"),originUrl=urlResolve(window.location.href);function urlResolve(url){if(!isString(url))return url;var href=url;return msie&&(urlParsingNode.setAttribute("href",href),href=urlParsingNode.href),urlParsingNode.setAttribute("href",href),{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:"/"===urlParsingNode.pathname.charAt(0)?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}function urlsAreSameOrigin(url1,url2){return url1=urlResolve(url1),url2=urlResolve(url2),url1.protocol===url2.protocol&&url1.host===url2.host}function $WindowProvider(){this.$get=valueFn(window)}function $$CookieReader($document){var rawDocument=$document[0]||{},lastCookies={},lastCookieString="";function safeDecodeURIComponent(str){try{return decodeURIComponent(str)}catch(e){return str}}return function(){var cookieArray,cookie,i,index,name,currentCookieString=function(rawDocument){try{return rawDocument.cookie||""}catch(e){return""}}(rawDocument);if(currentCookieString!==lastCookieString)for(cookieArray=(lastCookieString=currentCookieString).split("; "),lastCookies={},i=0;i<cookieArray.length;i++)0<(index=(cookie=cookieArray[i]).indexOf("="))&&(name=safeDecodeURIComponent(cookie.substring(0,index)),isUndefined(lastCookies[name])&&(lastCookies[name]=safeDecodeURIComponent(cookie.substring(index+1))));return lastCookies}}function $$CookieReaderProvider(){this.$get=$$CookieReader}function $FilterProvider($provide){var suffix="Filter";function register(name,factory){if(isObject(name)){var filters={};return forEach(name,function(filter,key){filters[key]=register(key,filter)}),filters}return $provide.factory(name+suffix,factory)}this.register=register,this.$get=["$injector",function($injector){return function(name){return $injector.get(name+suffix)}}],register("currency",currencyFilter),register("date",dateFilter),register("filter",filterFilter),register("json",jsonFilter),register("limitTo",limitToFilter),register("lowercase",lowercaseFilter),register("number",numberFilter),register("orderBy",orderByFilter),register("uppercase",uppercaseFilter)}function filterFilter(){return function(array,expression,comparator,anyPropertyKey){if(!isArrayLike(array)){if(null==array)return array;throw minErr("filter")("notarray","Expected array but received: {0}",array)}var predicateFn,matchAgainstAnyProp;switch(anyPropertyKey=anyPropertyKey||"$",getTypeForFilter(expression)){case"function":predicateFn=expression;break;case"boolean":case"null":case"number":case"string":matchAgainstAnyProp=!0;case"object":predicateFn=function(expression,comparator,anyPropertyKey,matchAgainstAnyProp){var shouldMatchPrimitives=isObject(expression)&&anyPropertyKey in expression;!0===comparator?comparator=equals:isFunction(comparator)||(comparator=function(actual,expected){return!isUndefined(actual)&&(null===actual||null===expected?actual===expected:!(isObject(expected)||isObject(actual)&&!hasCustomToString(actual))&&(actual=lowercase(""+actual),expected=lowercase(""+expected),-1!==actual.indexOf(expected)))});return function(item){return shouldMatchPrimitives&&!isObject(item)?deepCompare(item,expression[anyPropertyKey],comparator,anyPropertyKey,!1):deepCompare(item,expression,comparator,anyPropertyKey,matchAgainstAnyProp)}}(expression,comparator,anyPropertyKey,matchAgainstAnyProp);break;default:return array}return Array.prototype.filter.call(array,predicateFn)}}function deepCompare(actual,expected,comparator,anyPropertyKey,matchAgainstAnyProp,dontMatchWholeObject){var actualType=getTypeForFilter(actual),expectedType=getTypeForFilter(expected);if("string"===expectedType&&"!"===expected.charAt(0))return!deepCompare(actual,expected.substring(1),comparator,anyPropertyKey,matchAgainstAnyProp);if(isArray(actual))return actual.some(function(item){return deepCompare(item,expected,comparator,anyPropertyKey,matchAgainstAnyProp)});switch(actualType){case"object":var key;if(matchAgainstAnyProp){for(key in actual)if(key.charAt&&"$"!==key.charAt(0)&&deepCompare(actual[key],expected,comparator,anyPropertyKey,!0))return!0;return!dontMatchWholeObject&&deepCompare(actual,expected,comparator,anyPropertyKey,!1)}if("object"!==expectedType)return comparator(actual,expected);for(key in expected){var expectedVal=expected[key];if(!isFunction(expectedVal)&&!isUndefined(expectedVal)){var matchAnyProperty=key===anyPropertyKey;if(!deepCompare(matchAnyProperty?actual:actual[key],expectedVal,comparator,anyPropertyKey,matchAnyProperty,matchAnyProperty))return!1}}return!0;case"function":return!1;default:return comparator(actual,expected)}}function getTypeForFilter(val){return null===val?"null":typeof val}$$CookieReader.$inject=["$document"],$FilterProvider.$inject=["$provide"];var MAX_DIGITS=22,DECIMAL_SEP=".",ZERO_CHAR="0";function currencyFilter($locale){var formats=$locale.NUMBER_FORMATS;return function(amount,currencySymbol,fractionSize){isUndefined(currencySymbol)&&(currencySymbol=formats.CURRENCY_SYM),isUndefined(fractionSize)&&(fractionSize=formats.PATTERNS[1].maxFrac);var currencySymbolRe=currencySymbol?/\u00A4/g:/\s*\u00A4\s*/g;return null==amount?amount:formatNumber(amount,formats.PATTERNS[1],formats.GROUP_SEP,formats.DECIMAL_SEP,fractionSize).replace(currencySymbolRe,currencySymbol)}}function numberFilter($locale){var formats=$locale.NUMBER_FORMATS;return function(number,fractionSize){return null==number?number:formatNumber(number,formats.PATTERNS[0],formats.GROUP_SEP,formats.DECIMAL_SEP,fractionSize)}}function formatNumber(number,pattern,groupSep,decimalSep,fractionSize){if(!isString(number)&&!isNumber(number)||isNaN(number))return"";var parsedNumber,isInfinity=!isFinite(number),isZero=!1,numStr=Math.abs(number)+"",formattedText="";if(isInfinity)formattedText="â";else{(function(parsedNumber,fractionSize,minFrac,maxFrac){var digits=parsedNumber.d,fractionLen=digits.length-parsedNumber.i,roundAt=(fractionSize=isUndefined(fractionSize)?Math.min(Math.max(minFrac,fractionLen),maxFrac):+fractionSize)+parsedNumber.i,digit=digits[roundAt];if(0<roundAt){digits.splice(Math.max(parsedNumber.i,roundAt));for(var j=roundAt;j<digits.length;j++)digits[j]=0}else{fractionLen=Math.max(0,fractionLen),parsedNumber.i=1,digits.length=Math.max(1,roundAt=fractionSize+1),digits[0]=0;for(var i=1;i<roundAt;i++)digits[i]=0}if(5<=digit)if(roundAt-1<0){for(var k=0;roundAt<k;k--)digits.unshift(0),parsedNumber.i++;digits.unshift(1),parsedNumber.i++}else digits[roundAt-1]++;for(;fractionLen<Math.max(0,fractionSize);fractionLen++)digits.push(0);var carry=digits.reduceRight(function(carry,d,i,digits){return d+=carry,digits[i]=d%10,Math.floor(d/10)},0);carry&&(digits.unshift(carry),parsedNumber.i++)})(parsedNumber=function(numStr){var digits,numberOfIntegerDigits,i,j,zeros,exponent=0;for(-1<(numberOfIntegerDigits=numStr.indexOf(DECIMAL_SEP))&&(numStr=numStr.replace(DECIMAL_SEP,"")),0<(i=numStr.search(/e/i))?(numberOfIntegerDigits<0&&(numberOfIntegerDigits=i),numberOfIntegerDigits+=+numStr.slice(i+1),numStr=numStr.substring(0,i)):numberOfIntegerDigits<0&&(numberOfIntegerDigits=numStr.length),i=0;numStr.charAt(i)===ZERO_CHAR;i++);if(i===(zeros=numStr.length))digits=[0],numberOfIntegerDigits=1;else{for(zeros--;numStr.charAt(zeros)===ZERO_CHAR;)zeros--;for(numberOfIntegerDigits-=i,digits=[],j=0;i<=zeros;i++,j++)digits[j]=+numStr.charAt(i)}return MAX_DIGITS<numberOfIntegerDigits&&(digits=digits.splice(0,MAX_DIGITS-1),exponent=numberOfIntegerDigits-1,numberOfIntegerDigits=1),{d:digits,e:exponent,i:numberOfIntegerDigits}}(numStr),fractionSize,pattern.minFrac,pattern.maxFrac);var digits=parsedNumber.d,integerLen=parsedNumber.i,exponent=parsedNumber.e,decimals=[];for(isZero=digits.reduce(function(isZero,d){return isZero&&!d},!0);integerLen<0;)digits.unshift(0),integerLen++;0<integerLen?decimals=digits.splice(integerLen,digits.length):(decimals=digits,digits=[0]);var groups=[];for(digits.length>=pattern.lgSize&&groups.unshift(digits.splice(-pattern.lgSize,digits.length).join(""));digits.length>pattern.gSize;)groups.unshift(digits.splice(-pattern.gSize,digits.length).join(""));digits.length&&groups.unshift(digits.join("")),formattedText=groups.join(groupSep),decimals.length&&(formattedText+=decimalSep+decimals.join("")),exponent&&(formattedText+="e+"+exponent)}return number<0&&!isZero?pattern.negPre+formattedText+pattern.negSuf:pattern.posPre+formattedText+pattern.posSuf}function padNumber(num,digits,trim,negWrap){var neg="";for((num<0||negWrap&&num<=0)&&(negWrap?num=1-num:(num=-num,neg="-")),num=""+num;num.length<digits;)num=ZERO_CHAR+num;return trim&&(num=num.substr(num.length-digits)),neg+num}function dateGetter(name,size,offset,trim,negWrap){return offset=offset||0,function(date){var value=date["get"+name]();return(0<offset||-offset<value)&&(value+=offset),0===value&&-12===offset&&(value=12),padNumber(value,size,trim,negWrap)}}function dateStrGetter(name,shortForm,standAlone){return function(date,formats){var value=date["get"+name]();return formats[uppercase((standAlone?"STANDALONE":"")+(shortForm?"SHORT":"")+name)][value]}}function getFirstThursdayOfYear(year){var dayOfWeekOnFirst=new Date(year,0,1).getDay();return new Date(year,0,(dayOfWeekOnFirst<=4?5:12)-dayOfWeekOnFirst)}function weekGetter(size){return function(date){var firstThurs=getFirstThursdayOfYear(date.getFullYear()),diff=+function(datetime){return new Date(datetime.getFullYear(),datetime.getMonth(),datetime.getDate()+(4-datetime.getDay()))}(date)-+firstThurs;return padNumber(1+Math.round(diff/6048e5),size)}}function eraGetter(date,formats){return date.getFullYear()<=0?formats.ERAS[0]:formats.ERAS[1]}currencyFilter.$inject=["$locale"];var DATE_FORMATS={yyyy:dateGetter("FullYear",4,0,!(numberFilter.$inject=["$locale"]),!0),yy:dateGetter("FullYear",2,0,!0,!0),y:dateGetter("FullYear",1,0,!1,!0),MMMM:dateStrGetter("Month"),MMM:dateStrGetter("Month",!0),MM:dateGetter("Month",2,1),M:dateGetter("Month",1,1),LLLL:dateStrGetter("Month",!1,!0),dd:dateGetter("Date",2),d:dateGetter("Date",1),HH:dateGetter("Hours",2),H:dateGetter("Hours",1),hh:dateGetter("Hours",2,-12),h:dateGetter("Hours",1,-12),mm:dateGetter("Minutes",2),m:dateGetter("Minutes",1),ss:dateGetter("Seconds",2),s:dateGetter("Seconds",1),sss:dateGetter("Milliseconds",3),EEEE:dateStrGetter("Day"),EEE:dateStrGetter("Day",!0),a:function(date,formats){return date.getHours()<12?formats.AMPMS[0]:formats.AMPMS[1]},Z:function(date,formats,offset){var zone=-1*offset,paddedZone=0<=zone?"+":"";return paddedZone+=padNumber(Math[0<zone?"floor":"ceil"](zone/60),2)+padNumber(Math.abs(zone%60),2)},ww:weekGetter(2),w:weekGetter(1),G:eraGetter,GG:eraGetter,GGG:eraGetter,GGGG:function(date,formats){return date.getFullYear()<=0?formats.ERANAMES[0]:formats.ERANAMES[1]}},DATE_FORMATS_SPLIT=/((?:[^yMLdHhmsaZEwG']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|L+|d+|H+|h+|m+|s+|a|Z|G+|w+))([\s\S]*)/,NUMBER_STRING=/^-?\d+$/;function dateFilter($locale){var R_ISO8601_STR=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/;return function(date,format,timezone){var fn,match,text="",parts=[];if(format=format||"mediumDate",format=$locale.DATETIME_FORMATS[format]||format,isString(date)&&(date=NUMBER_STRING.test(date)?toInt(date):function(string){var match;if(match=string.match(R_ISO8601_STR)){var date=new Date(0),tzHour=0,tzMin=0,dateSetter=match[8]?date.setUTCFullYear:date.setFullYear,timeSetter=match[8]?date.setUTCHours:date.setHours;match[9]&&(tzHour=toInt(match[9]+match[10]),tzMin=toInt(match[9]+match[11])),dateSetter.call(date,toInt(match[1]),toInt(match[2])-1,toInt(match[3]));var h=toInt(match[4]||0)-tzHour,m=toInt(match[5]||0)-tzMin,s=toInt(match[6]||0),ms=Math.round(1e3*parseFloat("0."+(match[7]||0)));return timeSetter.call(date,h,m,s,ms),date}return string}(date)),isNumber(date)&&(date=new Date(date)),!isDate(date)||!isFinite(date.getTime()))return date;for(;format;)format=(match=DATE_FORMATS_SPLIT.exec(format))?(parts=concat(parts,match,1)).pop():(parts.push(format),null);var dateTimezoneOffset=date.getTimezoneOffset();return timezone&&(dateTimezoneOffset=timezoneToOffset(timezone,dateTimezoneOffset),date=convertTimezoneToLocal(date,timezone,!0)),forEach(parts,function(value){fn=DATE_FORMATS[value],text+=fn?fn(date,$locale.DATETIME_FORMATS,dateTimezoneOffset):"''"===value?"'":value.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),text}}function jsonFilter(){return function(object,spacing){return isUndefined(spacing)&&(spacing=2),toJson(object,spacing)}}dateFilter.$inject=["$locale"];var lowercaseFilter=valueFn(lowercase),uppercaseFilter=valueFn(uppercase);function limitToFilter(){return function(input,limit,begin){return limit=Math.abs(Number(limit))===1/0?Number(limit):toInt(limit),isNumberNaN(limit)?input:(isNumber(input)&&(input=input.toString()),isArrayLike(input)?(begin=(begin=!begin||isNaN(begin)?0:toInt(begin))<0?Math.max(0,input.length+begin):begin,0<=limit?sliceFn(input,begin,begin+limit):0===begin?sliceFn(input,limit,input.length):sliceFn(input,Math.max(0,begin+limit),begin)):input)}}function sliceFn(input,begin,end){return isString(input)?input.slice(begin,end):slice.call(input,begin,end)}function orderByFilter($parse){return function(array,sortPredicate,reverseOrder,compareFn){if(null==array)return array;if(!isArrayLike(array))throw minErr("orderBy")("notarray","Expected array but received: {0}",array);isArray(sortPredicate)||(sortPredicate=[sortPredicate]),0===sortPredicate.length&&(sortPredicate=["+"]);var predicates=function(sortPredicates){return sortPredicates.map(function(predicate){var descending=1,get=identity;if(isFunction(predicate))get=predicate;else if(isString(predicate)&&("+"!==predicate.charAt(0)&&"-"!==predicate.charAt(0)||(descending="-"===predicate.charAt(0)?-1:1,predicate=predicate.substring(1)),""!==predicate&&(get=$parse(predicate)).constant)){var key=get();get=function(value){return value[key]}}return{get:get,descending:descending}})}(sortPredicate),descending=reverseOrder?-1:1,compare=isFunction(compareFn)?compareFn:defaultCompare,compareValues=Array.prototype.map.call(array,function(value,index){return{value:value,tieBreaker:{value:index,type:"number",index:index},predicateValues:predicates.map(function(predicate){return function(value,index){var type=typeof value;null===value?type="null":"object"===type&&(value=function(value){if(isFunction(value.valueOf)&&isPrimitive(value=value.valueOf()))return value;if(hasCustomToString(value)&&isPrimitive(value=value.toString()))return value;return value}(value));return{value:value,type:type,index:index}}(predicate.get(value),index)})}});return compareValues.sort(function(v1,v2){for(var i=0,ii=predicates.length;i<ii;i++){var result=compare(v1.predicateValues[i],v2.predicateValues[i]);if(result)return result*predicates[i].descending*descending}return(compare(v1.tieBreaker,v2.tieBreaker)||defaultCompare(v1.tieBreaker,v2.tieBreaker))*descending}),array=compareValues.map(function(item){return item.value})};function isPrimitive(value){switch(typeof value){case"number":case"boolean":case"string":return!0;default:return!1}}function defaultCompare(v1,v2){var result=0,type1=v1.type,type2=v2.type;if(type1===type2){var value1=v1.value,value2=v2.value;"string"===type1?(value1=value1.toLowerCase(),value2=value2.toLowerCase()):"object"===type1&&(isObject(value1)&&(value1=v1.index),isObject(value2)&&(value2=v2.index)),value1!==value2&&(result=value1<value2?-1:1)}else result="undefined"===type1?1:"undefined"===type2?-1:"null"===type1?1:"null"===type2?-1:type1<type2?-1:1;return result}}function ngDirective(directive){return isFunction(directive)&&(directive={link:directive}),directive.restrict=directive.restrict||"AC",valueFn(directive)}orderByFilter.$inject=["$parse"];var htmlAnchorDirective=valueFn({restrict:"E",compile:function(element,attr){if(!attr.href&&!attr.xlinkHref)return function(scope,element){if("a"===element[0].nodeName.toLowerCase()){var href="[object SVGAnimatedString]"===toString.call(element.prop("href"))?"xlink:href":"href";element.on("click",function(event){element.attr(href)||event.preventDefault()})}}}}),ngAttributeAliasDirectives={};forEach(BOOLEAN_ATTR,function(propName,attrName){if("multiple"!==propName){var normalized=directiveNormalize("ng-"+attrName),linkFn=defaultLinkFn;"checked"===propName&&(linkFn=function(scope,element,attr){attr.ngModel!==attr[normalized]&&defaultLinkFn(scope,0,attr)}),ngAttributeAliasDirectives[normalized]=function(){return{restrict:"A",priority:100,link:linkFn}}}function defaultLinkFn(scope,element,attr){scope.$watch(attr[normalized],function(value){attr.$set(attrName,!!value)})}}),forEach(ALIASED_ATTR,function(htmlAttr,ngAttr){ngAttributeAliasDirectives[ngAttr]=function(){return{priority:100,link:function(scope,element,attr){if("ngPattern"===ngAttr&&"/"===attr.ngPattern.charAt(0)){var match=attr.ngPattern.match(REGEX_STRING_REGEXP);if(match)return void attr.$set("ngPattern",new RegExp(match[1],match[2]))}scope.$watch(attr[ngAttr],function(value){attr.$set(ngAttr,value)})}}}}),forEach(["src","srcset","href"],function(attrName){var normalized=directiveNormalize("ng-"+attrName);ngAttributeAliasDirectives[normalized]=function(){return{priority:99,link:function(scope,element,attr){var propName=attrName,name=attrName;"href"===attrName&&"[object SVGAnimatedString]"===toString.call(element.prop("href"))&&(name="xlinkHref",attr.$attr[name]="xlink:href",propName=null),attr.$observe(normalized,function(value){value?(attr.$set(name,value),msie&&propName&&element.prop(propName,attr[name])):"href"===attrName&&attr.$set(name,null)})}}}});var nullFormCtrl={$addControl:noop,$getControls:valueFn([]),$$renameControl:function(control,name){control.$name=name},$removeControl:noop,$setValidity:noop,$setDirty:noop,$setPristine:noop,$setSubmitted:noop,$$setSubmitted:noop};function FormController($element,$attrs,$scope,$animate,$interpolate){this.$$controls=[],this.$error={},this.$$success={},this.$pending=void 0,this.$name=$interpolate($attrs.name||$attrs.ngForm||"")($scope),this.$dirty=!1,this.$pristine=!0,this.$valid=!0,this.$invalid=!1,this.$submitted=!1,this.$$parentForm=nullFormCtrl,this.$$element=$element,this.$$animate=$animate,setupValidity(this)}FormController.$inject=["$element","$attrs","$scope","$animate","$interpolate"],FormController.prototype={$rollbackViewValue:function(){forEach(this.$$controls,function(control){control.$rollbackViewValue()})},$commitViewValue:function(){forEach(this.$$controls,function(control){control.$commitViewValue()})},$addControl:function(control){assertNotHasOwnProperty(control.$name,"input"),this.$$controls.push(control),control.$name&&(this[control.$name]=control),control.$$parentForm=this},$getControls:function(){return shallowCopy(this.$$controls)},$$renameControl:function(control,newName){var oldName=control.$name;this[oldName]===control&&delete this[oldName],(this[newName]=control).$name=newName},$removeControl:function(control){control.$name&&this[control.$name]===control&&delete this[control.$name],forEach(this.$pending,function(value,name){this.$setValidity(name,null,control)},this),forEach(this.$error,function(value,name){this.$setValidity(name,null,control)},this),forEach(this.$$success,function(value,name){this.$setValidity(name,null,control)},this),arrayRemove(this.$$controls,control),control.$$parentForm=nullFormCtrl},$setDirty:function(){this.$$animate.removeClass(this.$$element,PRISTINE_CLASS),this.$$animate.addClass(this.$$element,DIRTY_CLASS),this.$dirty=!0,this.$pristine=!1,this.$$parentForm.$setDirty()},$setPristine:function(){this.$$animate.setClass(this.$$element,PRISTINE_CLASS,DIRTY_CLASS+" ng-submitted"),this.$dirty=!1,this.$pristine=!0,this.$submitted=!1,forEach(this.$$controls,function(control){control.$setPristine()})},$setUntouched:function(){forEach(this.$$controls,function(control){control.$setUntouched()})},$setSubmitted:function(){for(var rootForm=this;rootForm.$$parentForm&&rootForm.$$parentForm!==nullFormCtrl;)rootForm=rootForm.$$parentForm;rootForm.$$setSubmitted()},$$setSubmitted:function(){this.$$animate.addClass(this.$$element,"ng-submitted"),this.$submitted=!0,forEach(this.$$controls,function(control){control.$$setSubmitted&&control.$$setSubmitted()})}},addSetValidityMethod({clazz:FormController,set:function(object,property,controller){var list=object[property];list?-1===list.indexOf(controller)&&list.push(controller):object[property]=[controller]},unset:function(object,property,controller){var list=object[property];list&&(arrayRemove(list,controller),0===list.length&&delete object[property])}});function formDirectiveFactory(isNgForm){return["$timeout","$parse",function($timeout,$parse){return{name:"form",restrict:isNgForm?"EAC":"E",require:["form","^^?form"],controller:FormController,compile:function(formElement,attr){formElement.addClass(PRISTINE_CLASS).addClass(VALID_CLASS);var nameAttr=attr.name?"name":!(!isNgForm||!attr.ngForm)&&"ngForm";return{pre:function(scope,formElement,attr,ctrls){var controller=ctrls[0];if(!("action"in attr)){var handleFormSubmission=function(event){scope.$apply(function(){controller.$commitViewValue(),controller.$setSubmitted()}),event.preventDefault()};formElement[0].addEventListener("submit",handleFormSubmission),formElement.on("$destroy",function(){$timeout(function(){formElement[0].removeEventListener("submit",handleFormSubmission)},0,!1)})}(ctrls[1]||controller.$$parentForm).$addControl(controller);var setter=nameAttr?getSetter(controller.$name):noop;nameAttr&&(setter(scope,controller),attr.$observe(nameAttr,function(newValue){controller.$name!==newValue&&(setter(scope,void 0),controller.$$parentForm.$$renameControl(controller,newValue),(setter=getSetter(controller.$name))(scope,controller))})),formElement.on("$destroy",function(){controller.$$parentForm.$removeControl(controller),setter(scope,void 0),extend(controller,nullFormCtrl)})}}}};function getSetter(expression){return""===expression?$parse('this[""]').assign:$parse(expression).assign||noop}}]}var formDirective=formDirectiveFactory(),ngFormDirective=formDirectiveFactory(!0);function setupValidity(instance){instance.$$classCache={},instance.$$classCache[INVALID_CLASS]=!(instance.$$classCache[VALID_CLASS]=instance.$$element.hasClass(VALID_CLASS))}function addSetValidityMethod(context){var clazz=context.clazz,set=context.set,unset=context.unset;function cachedToggleClass(ctrl,className,switchValue){switchValue&&!ctrl.$$classCache[className]?(ctrl.$$animate.addClass(ctrl.$$element,className),ctrl.$$classCache[className]=!0):!switchValue&&ctrl.$$classCache[className]&&(ctrl.$$animate.removeClass(ctrl.$$element,className),ctrl.$$classCache[className]=!1)}function toggleValidationCss(ctrl,validationErrorKey,isValid){validationErrorKey=validationErrorKey?"-"+snake_case(validationErrorKey,"-"):"",cachedToggleClass(ctrl,VALID_CLASS+validationErrorKey,!0===isValid),cachedToggleClass(ctrl,INVALID_CLASS+validationErrorKey,!1===isValid)}clazz.prototype.$setValidity=function(validationErrorKey,state,controller){var combinedState;isUndefined(state)?function(ctrl,name,value,controller){ctrl[name]||(ctrl[name]={});set(ctrl[name],value,controller)}(this,"$pending",validationErrorKey,controller):function(ctrl,name,value,controller){ctrl[name]&&unset(ctrl[name],value,controller);isObjectEmpty(ctrl[name])&&(ctrl[name]=void 0)}(this,"$pending",validationErrorKey,controller),isBoolean(state)?state?(unset(this.$error,validationErrorKey,controller),set(this.$$success,validationErrorKey,controller)):(set(this.$error,validationErrorKey,controller),unset(this.$$success,validationErrorKey,controller)):(unset(this.$error,validationErrorKey,controller),unset(this.$$success,validationErrorKey,controller)),this.$pending?(cachedToggleClass(this,"ng-pending",!0),this.$valid=this.$invalid=void 0,toggleValidationCss(this,"",null)):(cachedToggleClass(this,"ng-pending",!1),this.$valid=isObjectEmpty(this.$error),this.$invalid=!this.$valid,toggleValidationCss(this,"",this.$valid)),toggleValidationCss(this,validationErrorKey,combinedState=this.$pending&&this.$pending[validationErrorKey]?void 0:!this.$error[validationErrorKey]&&(!!this.$$success[validationErrorKey]||null)),this.$$parentForm.$setValidity(validationErrorKey,combinedState,this)}}function isObjectEmpty(obj){if(obj)for(var prop in obj)if(obj.hasOwnProperty(prop))return!1;return!0}var ISO_DATE_REGEXP=/^\d{4,}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+(?:[+-][0-2]\d:[0-5]\d|Z)$/,URL_REGEXP=/^[a-z][a-z\d.+-]*:\/*(?:[^:@]+(?::[^@]+)?@)?(?:[^\s:/?#]+|\[[a-f\d:]+])(?::\d+)?(?:\/[^?#]*)?(?:\?[^#]*)?(?:#.*)?$/i,EMAIL_REGEXP=/^(?=.{1,254}$)(?=.{1,64}@)[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+(\.[-!#$%&'*+/0-9=?A-Z^_`a-z{|}~]+)*@[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?(\.[A-Za-z0-9]([A-Za-z0-9-]{0,61}[A-Za-z0-9])?)*$/,NUMBER_REGEXP=/^\s*(-|\+)?(\d+|(\d*(\.\d*)))([eE][+-]?\d+)?\s*$/,DATE_REGEXP=/^(\d{4,})-(\d{2})-(\d{2})$/,DATETIMELOCAL_REGEXP=/^(\d{4,})-(\d\d)-(\d\d)T(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,WEEK_REGEXP=/^(\d{4,})-W(\d\d)$/,MONTH_REGEXP=/^(\d{4,})-(\d\d)$/,TIME_REGEXP=/^(\d\d):(\d\d)(?::(\d\d)(\.\d{1,3})?)?$/,PARTIAL_VALIDATION_EVENTS="keydown wheel mousedown",PARTIAL_VALIDATION_TYPES=createMap();forEach("date,datetime-local,month,time,week".split(","),function(type){PARTIAL_VALIDATION_TYPES[type]=!0});var inputType={text:function(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl)},date:createDateInputType("date",DATE_REGEXP,createDateParser(DATE_REGEXP,["yyyy","MM","dd"]),"yyyy-MM-dd"),"datetime-local":createDateInputType("datetimelocal",DATETIMELOCAL_REGEXP,createDateParser(DATETIMELOCAL_REGEXP,["yyyy","MM","dd","HH","mm","ss","sss"]),"yyyy-MM-ddTHH:mm:ss.sss"),time:createDateInputType("time",TIME_REGEXP,createDateParser(TIME_REGEXP,["HH","mm","ss","sss"]),"HH:mm:ss.sss"),week:createDateInputType("week",WEEK_REGEXP,function(isoWeek,existingDate){if(isDate(isoWeek))return isoWeek;if(isString(isoWeek)){WEEK_REGEXP.lastIndex=0;var parts=WEEK_REGEXP.exec(isoWeek);if(parts){var year=+parts[1],week=+parts[2],hours=0,minutes=0,seconds=0,milliseconds=0,firstThurs=getFirstThursdayOfYear(year),addDays=7*(week-1);return existingDate&&(hours=existingDate.getHours(),minutes=existingDate.getMinutes(),seconds=existingDate.getSeconds(),milliseconds=existingDate.getMilliseconds()),new Date(year,0,firstThurs.getDate()+addDays,hours,minutes,seconds,milliseconds)}}return NaN},"yyyy-Www"),month:createDateInputType("month",MONTH_REGEXP,createDateParser(MONTH_REGEXP,["yyyy","MM"]),"yyyy-MM"),number:function(scope,element,attr,ctrl,$sniffer,$browser){var minVal,maxVal;badInputChecker(scope,element,attr,ctrl,"number"),numberFormatterParser(ctrl),baseInputType(scope,element,attr,ctrl,$sniffer,$browser),(isDefined(attr.min)||attr.ngMin)&&(ctrl.$validators.min=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(minVal)||minVal<=viewValue},attr.$observe("min",function(val){minVal=parseNumberAttrVal(val),ctrl.$validate()}));(isDefined(attr.max)||attr.ngMax)&&(ctrl.$validators.max=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(maxVal)||viewValue<=maxVal},attr.$observe("max",function(val){maxVal=parseNumberAttrVal(val),ctrl.$validate()}));if(isDefined(attr.step)||attr.ngStep){var stepVal;ctrl.$validators.step=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(stepVal)||isValidForStep(viewValue,minVal||0,stepVal)},attr.$observe("step",function(val){stepVal=parseNumberAttrVal(val),ctrl.$validate()})}},url:function(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl),ctrl.$validators.url=function(modelValue,viewValue){var value=modelValue||viewValue;return ctrl.$isEmpty(value)||URL_REGEXP.test(value)}},email:function(scope,element,attr,ctrl,$sniffer,$browser){baseInputType(scope,element,attr,ctrl,$sniffer,$browser),stringBasedInputType(ctrl),ctrl.$validators.email=function(modelValue,viewValue){var value=modelValue||viewValue;return ctrl.$isEmpty(value)||EMAIL_REGEXP.test(value)}},radio:function(scope,element,attr,ctrl){var doTrim=!attr.ngTrim||"false"!==trim(attr.ngTrim);isUndefined(attr.name)&&element.attr("name",nextUid());element.on("change",function(ev){var value;element[0].checked&&(value=attr.value,doTrim&&(value=trim(value)),ctrl.$setViewValue(value,ev&&ev.type))}),ctrl.$render=function(){var value=attr.value;doTrim&&(value=trim(value)),element[0].checked=value===ctrl.$viewValue},attr.$observe("value",ctrl.$render)},range:function(scope,element,attr,ctrl,$sniffer,$browser){badInputChecker(scope,element,attr,ctrl,"range"),numberFormatterParser(ctrl),baseInputType(scope,element,attr,ctrl,$sniffer,$browser);var supportsRange=ctrl.$$hasNativeValidators&&"range"===element[0].type,minVal=supportsRange?0:void 0,maxVal=supportsRange?100:void 0,stepVal=supportsRange?1:void 0,validity=element[0].validity,hasMinAttr=isDefined(attr.min),hasMaxAttr=isDefined(attr.max),hasStepAttr=isDefined(attr.step),originalRender=ctrl.$render;ctrl.$render=supportsRange&&isDefined(validity.rangeUnderflow)&&isDefined(validity.rangeOverflow)?function(){originalRender(),ctrl.$setViewValue(element.val())}:originalRender,hasMinAttr&&(ctrl.$validators.min=supportsRange?function(){return!0}:function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(minVal)||minVal<=viewValue},setInitialValueAndObserver("min",function(val){if(minVal=parseNumberAttrVal(val),isNumberNaN(ctrl.$modelValue))return;if(supportsRange){var elVal=element.val();elVal<minVal&&(elVal=minVal,element.val(elVal)),ctrl.$setViewValue(elVal)}else ctrl.$validate()}));hasMaxAttr&&(ctrl.$validators.max=supportsRange?function(){return!0}:function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(maxVal)||viewValue<=maxVal},setInitialValueAndObserver("max",function(val){if(maxVal=parseNumberAttrVal(val),isNumberNaN(ctrl.$modelValue))return;if(supportsRange){var elVal=element.val();maxVal<elVal&&(element.val(maxVal),elVal=maxVal<minVal?minVal:maxVal),ctrl.$setViewValue(elVal)}else ctrl.$validate()}));hasStepAttr&&(ctrl.$validators.step=supportsRange?function(){return!validity.stepMismatch}:function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(stepVal)||isValidForStep(viewValue,minVal||0,stepVal)},setInitialValueAndObserver("step",function(val){if(stepVal=parseNumberAttrVal(val),isNumberNaN(ctrl.$modelValue))return;supportsRange&&ctrl.$viewValue!==element.val()?ctrl.$setViewValue(element.val()):ctrl.$validate()}));function setInitialValueAndObserver(htmlAttrName,changeFn){element.attr(htmlAttrName,attr[htmlAttrName]),attr.$observe(htmlAttrName,changeFn)}},checkbox:function(scope,element,attr,ctrl,$sniffer,$browser,$filter,$parse){var trueValue=parseConstantExpr($parse,scope,"ngTrueValue",attr.ngTrueValue,!0),falseValue=parseConstantExpr($parse,scope,"ngFalseValue",attr.ngFalseValue,!1);element.on("change",function(ev){ctrl.$setViewValue(element[0].checked,ev&&ev.type)}),ctrl.$render=function(){element[0].checked=ctrl.$viewValue},ctrl.$isEmpty=function(value){return!1===value},ctrl.$formatters.push(function(value){return equals(value,trueValue)}),ctrl.$parsers.push(function(value){return value?trueValue:falseValue})},hidden:noop,button:noop,submit:noop,reset:noop,file:noop};function stringBasedInputType(ctrl){ctrl.$formatters.push(function(value){return ctrl.$isEmpty(value)?value:value.toString()})}function baseInputType(scope,element,attr,ctrl,$sniffer,$browser){var timeout,type=lowercase(element[0].type);if(!$sniffer.android){var composing=!1;element.on("compositionstart",function(){composing=!0}),element.on("compositionupdate",function(ev){!isUndefined(ev.data)&&""!==ev.data||(composing=!1)}),element.on("compositionend",function(){composing=!1,listener()})}var listener=function(ev){if(timeout&&($browser.defer.cancel(timeout),timeout=null),!composing){var value=element.val(),event=ev&&ev.type;"password"===type||attr.ngTrim&&"false"===attr.ngTrim||(value=trim(value)),(ctrl.$viewValue!==value||""===value&&ctrl.$$hasNativeValidators)&&ctrl.$setViewValue(value,event)}};if($sniffer.hasEvent("input"))element.on("input",listener);else{var deferListener=function(ev,input,origValue){timeout=timeout||$browser.defer(function(){timeout=null,input&&input.value===origValue||listener(ev)})};element.on("keydown",function(event){var key=event.keyCode;91===key||15<key&&key<19||37<=key&&key<=40||deferListener(event,this,this.value)}),$sniffer.hasEvent("paste")&&element.on("paste cut drop",deferListener)}element.on("change",listener),PARTIAL_VALIDATION_TYPES[type]&&ctrl.$$hasNativeValidators&&type===attr.type&&element.on(PARTIAL_VALIDATION_EVENTS,function(ev){if(!timeout){var validity=this[VALIDITY_STATE_PROPERTY],origBadInput=validity.badInput,origTypeMismatch=validity.typeMismatch;timeout=$browser.defer(function(){timeout=null,validity.badInput===origBadInput&&validity.typeMismatch===origTypeMismatch||listener(ev)})}}),ctrl.$render=function(){var value=ctrl.$isEmpty(ctrl.$viewValue)?"":ctrl.$viewValue;element.val()!==value&&element.val(value)}}function createDateParser(regexp,mapping){return function(iso,previousDate){var parts,map;if(isDate(iso))return iso;if(isString(iso)){if('"'===iso.charAt(0)&&'"'===iso.charAt(iso.length-1)&&(iso=iso.substring(1,iso.length-1)),ISO_DATE_REGEXP.test(iso))return new Date(iso);if(regexp.lastIndex=0,parts=regexp.exec(iso)){parts.shift(),map=previousDate?{yyyy:previousDate.getFullYear(),MM:previousDate.getMonth()+1,dd:previousDate.getDate(),HH:previousDate.getHours(),mm:previousDate.getMinutes(),ss:previousDate.getSeconds(),sss:previousDate.getMilliseconds()/1e3}:{yyyy:1970,MM:1,dd:1,HH:0,mm:0,ss:0,sss:0},forEach(parts,function(part,index){index<mapping.length&&(map[mapping[index]]=+part)});var date=new Date(map.yyyy,map.MM-1,map.dd,map.HH,map.mm,map.ss||0,1e3*map.sss||0);return map.yyyy<100&&date.setFullYear(map.yyyy),date}}return NaN}}function createDateInputType(type,regexp,parseDate,format){return function(scope,element,attr,ctrl,$sniffer,$browser,$filter){badInputChecker(scope,element,attr,ctrl,type),baseInputType(0,element,attr,ctrl,$sniffer,$browser);var previousDate,previousTimezone,minVal,maxVal,isTimeType="time"===type||"datetimelocal"===type;ctrl.$parsers.push(function(value){return ctrl.$isEmpty(value)?null:regexp.test(value)?parseDateAndConvertTimeZoneToLocal(value,previousDate):void(ctrl.$$parserName=type)}),ctrl.$formatters.push(function(value){if(value&&!isDate(value))throw ngModelMinErr("datefmt","Expected `{0}` to be a date",value);if(isValidDate(value)){previousDate=value;var timezone=ctrl.$options.getOption("timezone");return timezone&&(previousDate=convertTimezoneToLocal(previousDate,previousTimezone=timezone,!0)),function(value,timezone){var targetFormat=format;isTimeType&&isString(ctrl.$options.getOption("timeSecondsFormat"))&&(targetFormat=format.replace("ss.sss",ctrl.$options.getOption("timeSecondsFormat")).replace(/:$/,""));var formatted=$filter("date")(value,targetFormat,timezone);isTimeType&&ctrl.$options.getOption("timeStripZeroSeconds")&&(formatted=formatted.replace(/(?::00)?(?:\.000)?$/,""));return formatted}(value,timezone)}return previousTimezone=previousDate=null,""}),(isDefined(attr.min)||attr.ngMin)&&(ctrl.$validators.min=function(value){return!isValidDate(value)||isUndefined(minVal)||parseDate(value)>=minVal},attr.$observe("min",function(val){minVal=parseObservedDateValue(val),ctrl.$validate()}));(isDefined(attr.max)||attr.ngMax)&&(ctrl.$validators.max=function(value){return!isValidDate(value)||isUndefined(maxVal)||parseDate(value)<=maxVal},attr.$observe("max",function(val){maxVal=parseObservedDateValue(val),ctrl.$validate()}));function isValidDate(value){return value&&!(value.getTime&&value.getTime()!=value.getTime())}function parseObservedDateValue(val){return isDefined(val)&&!isDate(val)?parseDateAndConvertTimeZoneToLocal(val)||void 0:val}function parseDateAndConvertTimeZoneToLocal(value,previousDate){var timezone=ctrl.$options.getOption("timezone");previousTimezone&&previousTimezone!==timezone&&(previousDate=addDateMinutes(previousDate,timezoneToOffset(previousTimezone)));var parsedDate=parseDate(value,previousDate);return!isNaN(parsedDate)&&timezone&&(parsedDate=convertTimezoneToLocal(parsedDate,timezone)),parsedDate}}}function badInputChecker(scope,element,attr,ctrl,parserName){var node=element[0];(ctrl.$$hasNativeValidators=isObject(node.validity))&&ctrl.$parsers.push(function(value){var validity=element.prop(VALIDITY_STATE_PROPERTY)||{};if(!validity.badInput&&!validity.typeMismatch)return value;ctrl.$$parserName=parserName})}function numberFormatterParser(ctrl){ctrl.$parsers.push(function(value){return ctrl.$isEmpty(value)?null:NUMBER_REGEXP.test(value)?parseFloat(value):void(ctrl.$$parserName="number")}),ctrl.$formatters.push(function(value){if(!ctrl.$isEmpty(value)){if(!isNumber(value))throw ngModelMinErr("numfmt","Expected `{0}` to be a number",value);value=value.toString()}return value})}function parseNumberAttrVal(val){return isDefined(val)&&!isNumber(val)&&(val=parseFloat(val)),isNumberNaN(val)?void 0:val}function isNumberInteger(num){return(0|num)===num}function countDecimals(num){var numString=num.toString(),decimalSymbolIndex=numString.indexOf(".");if(-1!==decimalSymbolIndex)return numString.length-decimalSymbolIndex-1;if(-1<num&&num<1){var match=/e-(\d+)$/.exec(numString);if(match)return Number(match[1])}return 0}function isValidForStep(viewValue,stepBase,step){var value=Number(viewValue),isNonIntegerValue=!isNumberInteger(value),isNonIntegerStepBase=!isNumberInteger(stepBase),isNonIntegerStep=!isNumberInteger(step);if(isNonIntegerValue||isNonIntegerStepBase||isNonIntegerStep){var valueDecimals=isNonIntegerValue?countDecimals(value):0,stepBaseDecimals=isNonIntegerStepBase?countDecimals(stepBase):0,stepDecimals=isNonIntegerStep?countDecimals(step):0,decimalCount=Math.max(valueDecimals,stepBaseDecimals,stepDecimals),multiplier=Math.pow(10,decimalCount);value*=multiplier,stepBase*=multiplier,step*=multiplier,isNonIntegerValue&&(value=Math.round(value)),isNonIntegerStepBase&&(stepBase=Math.round(stepBase)),isNonIntegerStep&&(step=Math.round(step))}return(value-stepBase)%step==0}function parseConstantExpr($parse,context,name,expression,fallback){var parseFn;if(isDefined(expression)){if(!(parseFn=$parse(expression)).constant)throw ngModelMinErr("constexpr","Expected constant expression for `{0}`, but saw `{1}`.",name,expression);return parseFn(context)}return fallback}function ngValueDirective(){function updateElementValue(element,attr,value){var propValue=isDefined(value)?value:9===msie?"":null;element.prop("value",propValue),attr.$set("value",value)}return{restrict:"A",priority:100,compile:function(tpl,tplAttr){return CONSTANT_VALUE_REGEXP.test(tplAttr.ngValue)?function(scope,elm,attr){updateElementValue(elm,attr,scope.$eval(attr.ngValue))}:function(scope,elm,attr){scope.$watch(attr.ngValue,function(value){updateElementValue(elm,attr,value)})}}}}var inputDirective=["$browser","$sniffer","$filter","$parse",function($browser,$sniffer,$filter,$parse){return{restrict:"E",require:["?ngModel"],link:{pre:function(scope,element,attr,ctrls){ctrls[0]&&(inputType[lowercase(attr.type)]||inputType.text)(scope,element,attr,ctrls[0],$sniffer,$browser,$filter,$parse)}}}}],CONSTANT_VALUE_REGEXP=/^(true|false|\d+)$/,ngBindDirective=["$compile",function($compile){return{restrict:"AC",compile:function(templateElement){return $compile.$$addBindingClass(templateElement),function(scope,element,attr){$compile.$$addBindingInfo(element,attr.ngBind),element=element[0],scope.$watch(attr.ngBind,function(value){element.textContent=stringify(value)})}}}}],ngBindTemplateDirective=["$interpolate","$compile",function($interpolate,$compile){return{compile:function(templateElement){return $compile.$$addBindingClass(templateElement),function(scope,element,attr){var interpolateFn=$interpolate(element.attr(attr.$attr.ngBindTemplate));$compile.$$addBindingInfo(element,interpolateFn.expressions),element=element[0],attr.$observe("ngBindTemplate",function(value){element.textContent=isUndefined(value)?"":value})}}}}],ngBindHtmlDirective=["$sce","$parse","$compile",function($sce,$parse,$compile){return{restrict:"A",compile:function(tElement,tAttrs){var ngBindHtmlGetter=$parse(tAttrs.ngBindHtml),ngBindHtmlWatch=$parse(tAttrs.ngBindHtml,function(val){return $sce.valueOf(val)});return $compile.$$addBindingClass(tElement),function(scope,element,attr){$compile.$$addBindingInfo(element,attr.ngBindHtml),scope.$watch(ngBindHtmlWatch,function(){var value=ngBindHtmlGetter(scope);element.html($sce.getTrustedHtml(value)||"")})}}}}],ngChangeDirective=valueFn({restrict:"A",require:"ngModel",link:function(scope,element,attr,ctrl){ctrl.$viewChangeListeners.push(function(){scope.$eval(attr.ngChange)})}});function classDirective(name,selector){var indexWatchExpression;return name="ngClass"+name,["$parse",function($parse){return{restrict:"AC",link:function(scope,element,attr){var oldClassString,classCounts=element.data("$classCounts"),oldModulo=!0;function digestClassCounts(classArray,count){var classesToUpdate=[];return forEach(classArray,function(className){(0<count||classCounts[className])&&(classCounts[className]=(classCounts[className]||0)+count,classCounts[className]===+(0<count)&&classesToUpdate.push(className))}),classesToUpdate.join(" ")}classCounts||(classCounts=createMap(),element.data("$classCounts",classCounts)),"ngClass"!==name&&(indexWatchExpression=indexWatchExpression||$parse("$index",function($index){return 1&$index}),scope.$watch(indexWatchExpression,function(newModulo){newModulo===selector?function(classString){classString=digestClassCounts(split(classString),1),attr.$addClass(classString)}(oldClassString):function(classString){classString=digestClassCounts(split(classString),-1),attr.$removeClass(classString)}(oldClassString);oldModulo=newModulo})),scope.$watch($parse(attr[name],toClassString),function(newClassString){oldModulo===selector&&function(oldClassString,newClassString){var oldClassArray=split(oldClassString),newClassArray=split(newClassString),toRemoveArray=arrayDifference(oldClassArray,newClassArray),toAddArray=arrayDifference(newClassArray,oldClassArray),toRemoveString=digestClassCounts(toRemoveArray,-1),toAddString=digestClassCounts(toAddArray,1);attr.$addClass(toAddString),attr.$removeClass(toRemoveString)}(oldClassString,newClassString);oldClassString=newClassString})}}}];function arrayDifference(tokens1,tokens2){if(!tokens1||!tokens1.length)return[];if(!tokens2||!tokens2.length)return tokens1;var values=[];outer:for(var i=0;i<tokens1.length;i++){for(var token=tokens1[i],j=0;j<tokens2.length;j++)if(token===tokens2[j])continue outer;values.push(token)}return values}function split(classString){return classString&&classString.split(" ")}function toClassString(classValue){var classString=classValue;return isArray(classValue)?classString=classValue.map(toClassString).join(" "):isObject(classValue)&&(classString=Object.keys(classValue).filter(function(key){return classValue[key]}).join(" ")),classString}}var ngClassDirective=classDirective("",!0),ngClassOddDirective=classDirective("Odd",0),ngClassEvenDirective=classDirective("Even",1),ngCloakDirective=ngDirective({compile:function(element,attr){attr.$set("ngCloak",void 0),element.removeClass("ng-cloak")}}),ngControllerDirective=[function(){return{restrict:"A",scope:!0,controller:"@",priority:500}}],ngEventDirectives={},forceAsyncEvents={blur:!0,focus:!0};function createEventDirective($parse,$rootScope,$exceptionHandler,directiveName,eventName,forceAsync){return{restrict:"A",compile:function($element,attr){var fn=$parse(attr[directiveName]);return function(scope,element){element.on(eventName,function(event){function callback(){fn(scope,{$event:event})}if($rootScope.$$phase)if(forceAsync)scope.$evalAsync(callback);else try{callback()}catch(error){$exceptionHandler(error)}else scope.$apply(callback)})}}}}forEach("click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste".split(" "),function(eventName){var directiveName=directiveNormalize("ng-"+eventName);ngEventDirectives[directiveName]=["$parse","$rootScope","$exceptionHandler",function($parse,$rootScope,$exceptionHandler){return createEventDirective($parse,$rootScope,$exceptionHandler,directiveName,eventName,forceAsyncEvents[eventName])}]});function ngListDirective(){return{restrict:"A",priority:100,require:"ngModel",link:function(scope,element,attr,ctrl){var ngList=attr.ngList||", ",trimValues="false"!==attr.ngTrim,separator=trimValues?trim(ngList):ngList;ctrl.$parsers.push(function(viewValue){if(!isUndefined(viewValue)){var list=[];return viewValue&&forEach(viewValue.split(separator),function(value){value&&list.push(trimValues?trim(value):value)}),list}}),ctrl.$formatters.push(function(value){if(isArray(value))return value.join(ngList)}),ctrl.$isEmpty=function(value){return!value||!value.length}}}}var ngIfDirective=["$animate","$compile",function($animate,$compile){return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",$$tlb:!0,link:function($scope,$element,$attr,ctrl,$transclude){var block,childScope,previousElements;$scope.$watch($attr.ngIf,function(value){value?childScope||$transclude(function(clone,newScope){childScope=newScope,clone[clone.length++]=$compile.$$createComment("end ngIf",$attr.ngIf),block={clone:clone},$animate.enter(clone,$element.parent(),$element)}):(previousElements&&(previousElements.remove(),previousElements=null),childScope&&(childScope.$destroy(),childScope=null),block&&(previousElements=getBlockNodes(block.clone),$animate.leave(previousElements).done(function(response){!1!==response&&(previousElements=null)}),block=null))})}}}],ngIncludeDirective=["$templateRequest","$anchorScroll","$animate",function($templateRequest,$anchorScroll,$animate){return{restrict:"ECA",priority:400,terminal:!0,transclude:"element",controller:angular.noop,compile:function(element,attr){var srcExp=attr.ngInclude||attr.src,onloadExp=attr.onload||"",autoScrollExp=attr.autoscroll;return function(scope,$element,$attr,ctrl,$transclude){function cleanupLastIncludeContent(){previousElement&&(previousElement.remove(),previousElement=null),currentScope&&(currentScope.$destroy(),currentScope=null),currentElement&&($animate.leave(currentElement).done(function(response){!1!==response&&(previousElement=null)}),previousElement=currentElement,currentElement=null)}var currentScope,previousElement,currentElement,changeCounter=0;scope.$watch(srcExp,function(src){function afterAnimation(response){!1===response||!isDefined(autoScrollExp)||autoScrollExp&&!scope.$eval(autoScrollExp)||$anchorScroll()}var thisChangeId=++changeCounter;src?($templateRequest(src,!0).then(function(response){if(!scope.$$destroyed&&thisChangeId===changeCounter){var newScope=scope.$new();ctrl.template=response;var clone=$transclude(newScope,function(clone){cleanupLastIncludeContent(),$animate.enter(clone,null,$element).done(afterAnimation)});currentElement=clone,(currentScope=newScope).$emit("$includeContentLoaded",src),scope.$eval(onloadExp)}},function(){scope.$$destroyed||thisChangeId===changeCounter&&(cleanupLastIncludeContent(),scope.$emit("$includeContentError",src))}),scope.$emit("$includeContentRequested",src)):(cleanupLastIncludeContent(),ctrl.template=null)})}}}}],ngIncludeFillContentDirective=["$compile",function($compile){return{restrict:"ECA",priority:-400,require:"ngInclude",link:function(scope,$element,$attr,ctrl){if(toString.call($element[0]).match(/SVG/))return $element.empty(),void $compile(jqLiteBuildFragment(ctrl.template,window.document).childNodes)(scope,function(clone){$element.append(clone)},{futureParentElement:$element});$element.html(ctrl.template),$compile($element.contents())(scope)}}}],ngInitDirective=ngDirective({priority:450,compile:function(){return{pre:function(scope,element,attrs){scope.$eval(attrs.ngInit)}}}}),VALID_CLASS="ng-valid",INVALID_CLASS="ng-invalid",PRISTINE_CLASS="ng-pristine",DIRTY_CLASS="ng-dirty",ngModelMinErr=minErr("ngModel");function NgModelController($scope,$exceptionHandler,$attr,$element,$parse,$animate,$timeout,$q,$interpolate){this.$viewValue=Number.NaN,this.$modelValue=Number.NaN,this.$$rawModelValue=void 0,this.$validators={},this.$asyncValidators={},this.$parsers=[],this.$formatters=[],this.$viewChangeListeners=[],this.$untouched=!0,this.$touched=!1,this.$pristine=!0,this.$dirty=!1,this.$valid=!0,this.$invalid=!1,this.$error={},this.$$success={},this.$pending=void 0,this.$name=$interpolate($attr.name||"",!1)($scope),this.$$parentForm=nullFormCtrl,this.$options=defaultModelOptions,this.$$updateEvents="",this.$$updateEventHandler=this.$$updateEventHandler.bind(this),this.$$parsedNgModel=$parse($attr.ngModel),this.$$parsedNgModelAssign=this.$$parsedNgModel.assign,this.$$ngModelGet=this.$$parsedNgModel,this.$$ngModelSet=this.$$parsedNgModelAssign,this.$$pendingDebounce=null,this.$$parserValid=void 0,this.$$parserName="parse",this.$$currentValidationRunId=0,this.$$scope=$scope,this.$$rootScope=$scope.$root,this.$$attr=$attr,this.$$element=$element,this.$$animate=$animate,this.$$timeout=$timeout,this.$$parse=$parse,this.$$q=$q,this.$$exceptionHandler=$exceptionHandler,setupValidity(this),function(ctrl){ctrl.$$scope.$watch(function(scope){var modelValue=ctrl.$$ngModelGet(scope);return modelValue===ctrl.$modelValue||ctrl.$modelValue!=ctrl.$modelValue&&modelValue!=modelValue||ctrl.$$setModelValue(modelValue),modelValue})}(this)}NgModelController.$inject=["$scope","$exceptionHandler","$attrs","$element","$parse","$animate","$timeout","$q","$interpolate"],NgModelController.prototype={$$initGetterSetters:function(){if(this.$options.getOption("getterSetter")){var invokeModelGetter=this.$$parse(this.$$attr.ngModel+"()"),invokeModelSetter=this.$$parse(this.$$attr.ngModel+"($$$p)");this.$$ngModelGet=function($scope){var modelValue=this.$$parsedNgModel($scope);return isFunction(modelValue)&&(modelValue=invokeModelGetter($scope)),modelValue},this.$$ngModelSet=function($scope,newValue){isFunction(this.$$parsedNgModel($scope))?invokeModelSetter($scope,{$$$p:newValue}):this.$$parsedNgModelAssign($scope,newValue)}}else if(!this.$$parsedNgModel.assign)throw ngModelMinErr("nonassign","Expression '{0}' is non-assignable. Element: {1}",this.$$attr.ngModel,startingTag(this.$$element))},$render:noop,$isEmpty:function(value){return isUndefined(value)||""===value||null===value||value!=value},$$updateEmptyClasses:function(value){this.$isEmpty(value)?(this.$$animate.removeClass(this.$$element,"ng-not-empty"),this.$$animate.addClass(this.$$element,"ng-empty")):(this.$$animate.removeClass(this.$$element,"ng-empty"),this.$$animate.addClass(this.$$element,"ng-not-empty"))},$setPristine:function(){this.$dirty=!1,this.$pristine=!0,this.$$animate.removeClass(this.$$element,DIRTY_CLASS),this.$$animate.addClass(this.$$element,PRISTINE_CLASS)},$setDirty:function(){this.$dirty=!0,this.$pristine=!1,this.$$animate.removeClass(this.$$element,PRISTINE_CLASS),this.$$animate.addClass(this.$$element,DIRTY_CLASS),this.$$parentForm.$setDirty()},$setUntouched:function(){this.$touched=!1,this.$untouched=!0,this.$$animate.setClass(this.$$element,"ng-untouched","ng-touched")},$setTouched:function(){this.$touched=!0,this.$untouched=!1,this.$$animate.setClass(this.$$element,"ng-touched","ng-untouched")},$rollbackViewValue:function(){this.$$timeout.cancel(this.$$pendingDebounce),this.$viewValue=this.$$lastCommittedViewValue,this.$render()},$validate:function(){if(!isNumberNaN(this.$modelValue)){var viewValue=this.$$lastCommittedViewValue,modelValue=this.$$rawModelValue,prevValid=this.$valid,prevModelValue=this.$modelValue,allowInvalid=this.$options.getOption("allowInvalid"),that=this;this.$$runValidators(modelValue,viewValue,function(allValid){allowInvalid||prevValid===allValid||(that.$modelValue=allValid?modelValue:void 0,that.$modelValue!==prevModelValue&&that.$$writeModelToScope())})}},$$runValidators:function(modelValue,viewValue,doneCallback){this.$$currentValidationRunId++;var syncValidatorsValid,validatorPromises,allValid,localValidationRunId=this.$$currentValidationRunId,that=this;(function(){var errorKey=that.$$parserName;{if(!isUndefined(that.$$parserValid))return that.$$parserValid||(forEach(that.$validators,function(v,name){setValidity(name,null)}),forEach(that.$asyncValidators,function(v,name){setValidity(name,null)})),setValidity(errorKey,that.$$parserValid),that.$$parserValid;setValidity(errorKey,null)}return!0})()?(syncValidatorsValid=!0,forEach(that.$validators,function(validator,name){var result=Boolean(validator(modelValue,viewValue));syncValidatorsValid=syncValidatorsValid&&result,setValidity(name,result)}),syncValidatorsValid||(forEach(that.$asyncValidators,function(v,name){setValidity(name,null)}),0)?(validatorPromises=[],allValid=!0,forEach(that.$asyncValidators,function(validator,name){var promise=validator(modelValue,viewValue);if(!isPromiseLike(promise))throw ngModelMinErr("nopromise","Expected asynchronous validator to return a promise but got '{0}' instead.",promise);setValidity(name,void 0),validatorPromises.push(promise.then(function(){setValidity(name,!0)},function(){setValidity(name,allValid=!1)}))}),validatorPromises.length?that.$$q.all(validatorPromises).then(function(){validationDone(allValid)},noop):validationDone(!0)):validationDone(!1)):validationDone(!1);function setValidity(name,isValid){localValidationRunId===that.$$currentValidationRunId&&that.$setValidity(name,isValid)}function validationDone(allValid){localValidationRunId===that.$$currentValidationRunId&&doneCallback(allValid)}},$commitViewValue:function(){var viewValue=this.$viewValue;this.$$timeout.cancel(this.$$pendingDebounce),(this.$$lastCommittedViewValue!==viewValue||""===viewValue&&this.$$hasNativeValidators)&&(this.$$updateEmptyClasses(viewValue),this.$$lastCommittedViewValue=viewValue,this.$pristine&&this.$setDirty(),this.$$parseAndValidate())},$$parseAndValidate:function(){var modelValue=this.$$lastCommittedViewValue,that=this;if(this.$$parserValid=!isUndefined(modelValue)||void 0,this.$setValidity(this.$$parserName,null),this.$$parserName="parse",this.$$parserValid)for(var i=0;i<this.$parsers.length;i++)if(isUndefined(modelValue=this.$parsers[i](modelValue))){this.$$parserValid=!1;break}isNumberNaN(this.$modelValue)&&(this.$modelValue=this.$$ngModelGet(this.$$scope));var prevModelValue=this.$modelValue,allowInvalid=this.$options.getOption("allowInvalid");function writeToModelIfNeeded(){that.$modelValue!==prevModelValue&&that.$$writeModelToScope()}this.$$rawModelValue=modelValue,allowInvalid&&(this.$modelValue=modelValue,writeToModelIfNeeded()),this.$$runValidators(modelValue,this.$$lastCommittedViewValue,function(allValid){allowInvalid||(that.$modelValue=allValid?modelValue:void 0,writeToModelIfNeeded())})},$$writeModelToScope:function(){this.$$ngModelSet(this.$$scope,this.$modelValue),forEach(this.$viewChangeListeners,function(listener){try{listener()}catch(e){this.$$exceptionHandler(e)}},this)},$setViewValue:function(value,trigger){this.$viewValue=value,this.$options.getOption("updateOnDefault")&&this.$$debounceViewValueCommit(trigger)},$$debounceViewValueCommit:function(trigger){var debounceDelay=this.$options.getOption("debounce");isNumber(debounceDelay[trigger])?debounceDelay=debounceDelay[trigger]:isNumber(debounceDelay.default)&&-1===this.$options.getOption("updateOn").indexOf(trigger)?debounceDelay=debounceDelay.default:isNumber(debounceDelay["*"])&&(debounceDelay=debounceDelay["*"]),this.$$timeout.cancel(this.$$pendingDebounce);var that=this;0<debounceDelay?this.$$pendingDebounce=this.$$timeout(function(){that.$commitViewValue()},debounceDelay):this.$$rootScope.$$phase?this.$commitViewValue():this.$$scope.$apply(function(){that.$commitViewValue()})},$overrideModelOptions:function(options){this.$options=this.$options.createChild(options),this.$$setUpdateOnEvents()},$processModelValue:function(){var viewValue=this.$$format();this.$viewValue!==viewValue&&(this.$$updateEmptyClasses(viewValue),this.$viewValue=this.$$lastCommittedViewValue=viewValue,this.$render(),this.$$runValidators(this.$modelValue,this.$viewValue,noop))},$$format:function(){for(var formatters=this.$formatters,idx=formatters.length,viewValue=this.$modelValue;idx--;)viewValue=formatters[idx](viewValue);return viewValue},$$setModelValue:function(modelValue){this.$modelValue=this.$$rawModelValue=modelValue,this.$$parserValid=void 0,this.$processModelValue()},$$setUpdateOnEvents:function(){this.$$updateEvents&&this.$$element.off(this.$$updateEvents,this.$$updateEventHandler),this.$$updateEvents=this.$options.getOption("updateOn"),this.$$updateEvents&&this.$$element.on(this.$$updateEvents,this.$$updateEventHandler)},$$updateEventHandler:function(ev){this.$$debounceViewValueCommit(ev&&ev.type)}},addSetValidityMethod({clazz:NgModelController,set:function(object,property){object[property]=!0},unset:function(object,property){delete object[property]}});var defaultModelOptions,ngModelDirective=["$rootScope",function($rootScope){return{restrict:"A",require:["ngModel","^?form","^?ngModelOptions"],controller:NgModelController,priority:1,compile:function(element){return element.addClass(PRISTINE_CLASS).addClass("ng-untouched").addClass(VALID_CLASS),{pre:function(scope,element,attr,ctrls){var modelCtrl=ctrls[0],formCtrl=ctrls[1]||modelCtrl.$$parentForm,optionsCtrl=ctrls[2];optionsCtrl&&(modelCtrl.$options=optionsCtrl.$options),modelCtrl.$$initGetterSetters(),formCtrl.$addControl(modelCtrl),attr.$observe("name",function(newValue){modelCtrl.$name!==newValue&&modelCtrl.$$parentForm.$$renameControl(modelCtrl,newValue)}),scope.$on("$destroy",function(){modelCtrl.$$parentForm.$removeControl(modelCtrl)})},post:function(scope,element,attr,ctrls){var modelCtrl=ctrls[0];function setTouched(){modelCtrl.$setTouched()}modelCtrl.$$setUpdateOnEvents(),element.on("blur",function(){modelCtrl.$touched||($rootScope.$$phase?scope.$evalAsync(setTouched):scope.$apply(setTouched))})}}}}}],DEFAULT_REGEXP=/(\s+|^)default(\s+|$)/;function ModelOptions(options){this.$$options=options}ModelOptions.prototype={getOption:function(name){return this.$$options[name]},createChild:function(options){var inheritAll=!1;return forEach(options=extend({},options),function(option,key){"$inherit"===option?"*"===key?inheritAll=!0:(options[key]=this.$$options[key],"updateOn"===key&&(options.updateOnDefault=this.$$options.updateOnDefault)):"updateOn"===key&&(options.updateOnDefault=!1,options[key]=trim(option.replace(DEFAULT_REGEXP,function(){return options.updateOnDefault=!0," "})))},this),inheritAll&&(delete options["*"],defaults(options,this.$$options)),defaults(options,defaultModelOptions.$$options),new ModelOptions(options)}},defaultModelOptions=new ModelOptions({updateOn:"",updateOnDefault:!0,debounce:0,getterSetter:!1,allowInvalid:!1,timezone:null});function ngModelOptionsDirective(){function NgModelOptionsController($attrs,$scope){this.$$attrs=$attrs,this.$$scope=$scope}return NgModelOptionsController.$inject=["$attrs","$scope"],NgModelOptionsController.prototype={$onInit:function(){var parentOptions=this.parentCtrl?this.parentCtrl.$options:defaultModelOptions,modelOptionsDefinition=this.$$scope.$eval(this.$$attrs.ngModelOptions);this.$options=parentOptions.createChild(modelOptionsDefinition)}},{restrict:"A",priority:10,require:{parentCtrl:"?^^ngModelOptions"},bindToController:!0,controller:NgModelOptionsController}}function defaults(dst,src){forEach(src,function(value,key){isDefined(dst[key])||(dst[key]=value)})}var ngNonBindableDirective=ngDirective({terminal:!0,priority:1e3}),ngOptionsMinErr=minErr("ngOptions"),NG_OPTIONS_REGEXP=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([$\w][$\w]*)|(?:\(\s*([$\w][$\w]*)\s*,\s*([$\w][$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,ngOptionsDirective=["$compile","$document","$parse",function($compile,$document,$parse){function parseOptionsExpression(optionsExp,selectElement,scope){var match=optionsExp.match(NG_OPTIONS_REGEXP);if(!match)throw ngOptionsMinErr("iexp","Expected expression in form of '_select_ (as _label_)? for (_key_,)?_value_ in _collection_' but got '{0}'. Element: {1}",optionsExp,startingTag(selectElement));function getTrackByValue(value,key){return getTrackByValueFn(value,getLocals(value,key))}var valueName=match[5]||match[7],keyName=match[6],selectAs=/ as /.test(match[0])&&match[1],trackBy=match[9],valueFn=$parse(match[2]?match[1]:valueName),viewValueFn=selectAs&&$parse(selectAs)||valueFn,trackByFn=trackBy&&$parse(trackBy),getTrackByValueFn=trackBy?function(value,locals){return trackByFn(scope,locals)}:function(value){return hashKey(value)},displayFn=$parse(match[2]||match[1]),groupByFn=$parse(match[3]||""),disableWhenFn=$parse(match[4]||""),valuesFn=$parse(match[8]),locals={},getLocals=keyName?function(value,key){return locals[keyName]=key,locals[valueName]=value,locals}:function(value){return locals[valueName]=value,locals};function Option(selectValue,viewValue,label,group,disabled){this.selectValue=selectValue,this.viewValue=viewValue,this.label=label,this.group=group,this.disabled=disabled}function getOptionValuesKeys(optionValues){var optionValuesKeys;if(!keyName&&isArrayLike(optionValues))optionValuesKeys=optionValues;else for(var itemKey in optionValuesKeys=[],optionValues)optionValues.hasOwnProperty(itemKey)&&"$"!==itemKey.charAt(0)&&optionValuesKeys.push(itemKey);return optionValuesKeys}return{trackBy:trackBy,getTrackByValue:getTrackByValue,getWatchables:$parse(valuesFn,function(optionValues){for(var watchedArray=[],optionValuesKeys=getOptionValuesKeys(optionValues=optionValues||[]),optionValuesLength=optionValuesKeys.length,index=0;index<optionValuesLength;index++){var key=optionValues===optionValuesKeys?index:optionValuesKeys[index],value=optionValues[key],locals=getLocals(value,key),selectValue=getTrackByValueFn(value,locals);if(watchedArray.push(selectValue),match[2]||match[1]){var label=displayFn(scope,locals);watchedArray.push(label)}if(match[4]){var disableWhen=disableWhenFn(scope,locals);watchedArray.push(disableWhen)}}return watchedArray}),getOptions:function(){for(var optionItems=[],selectValueMap={},optionValues=valuesFn(scope)||[],optionValuesKeys=getOptionValuesKeys(optionValues),optionValuesLength=optionValuesKeys.length,index=0;index<optionValuesLength;index++){var key=optionValues===optionValuesKeys?index:optionValuesKeys[index],value=optionValues[key],locals=getLocals(value,key),viewValue=viewValueFn(scope,locals),selectValue=getTrackByValueFn(viewValue,locals),optionItem=new Option(selectValue,viewValue,displayFn(scope,locals),groupByFn(scope,locals),disableWhenFn(scope,locals));optionItems.push(optionItem),selectValueMap[selectValue]=optionItem}return{items:optionItems,selectValueMap:selectValueMap,getOptionFromViewValue:function(value){return selectValueMap[getTrackByValue(value)]},getViewValueFromOption:function(option){return trackBy?copy(option.viewValue):option.viewValue}}}}}var optionTemplate=window.document.createElement("option"),optGroupTemplate=window.document.createElement("optgroup");return{restrict:"A",terminal:!0,require:["select","ngModel"],link:{pre:function(scope,selectElement,attr,ctrls){ctrls[0].registerOption=noop},post:function(scope,selectElement,attr,ctrls){for(var selectCtrl=ctrls[0],ngModelCtrl=ctrls[1],multiple=attr.multiple,i=0,children=selectElement.children(),ii=children.length;i<ii;i++)if(""===children[i].value){selectCtrl.hasEmptyOption=!0,selectCtrl.emptyOption=children.eq(i);break}selectElement.empty();var options,providedEmptyOption=!!selectCtrl.emptyOption;jqLite(optionTemplate.cloneNode(!1)).val("?");var ngOptions=parseOptionsExpression(attr.ngOptions,selectElement,scope),listFragment=$document[0].createDocumentFragment();function addOptionElement(option,parent){var optionElement=optionTemplate.cloneNode(!1);parent.appendChild(optionElement),function(option,element){(option.element=element).disabled=option.disabled,option.label!==element.label&&(element.label=option.label,element.textContent=option.label);element.value=option.selectValue}(option,optionElement)}function getAndUpdateSelectedOption(viewValue){var option=options.getOptionFromViewValue(viewValue),element=option&&option.element;return element&&!element.selected&&(element.selected=!0),option}selectCtrl.generateUnknownOptionValue=function(val){return"?"},multiple?(selectCtrl.writeValue=function(values){if(options){var selectedOptions=values&&values.map(getAndUpdateSelectedOption)||[];options.items.forEach(function(option){option.element.selected&&!includes(selectedOptions,option)&&(option.element.selected=!1)})}},selectCtrl.readValue=function(){var selectedValues=selectElement.val()||[],selections=[];return forEach(selectedValues,function(value){var option=options.selectValueMap[value];option&&!option.disabled&&selections.push(options.getViewValueFromOption(option))}),selections},ngOptions.trackBy&&scope.$watchCollection(function(){if(isArray(ngModelCtrl.$viewValue))return ngModelCtrl.$viewValue.map(function(value){return ngOptions.getTrackByValue(value)})},function(){ngModelCtrl.$render()})):(selectCtrl.writeValue=function(value){if(options){var selectedOption=selectElement[0].options[selectElement[0].selectedIndex],option=options.getOptionFromViewValue(value);selectedOption&&selectedOption.removeAttribute("selected"),option?(selectElement[0].value!==option.selectValue&&(selectCtrl.removeUnknownOption(),selectElement[0].value=option.selectValue,option.element.selected=!0),option.element.setAttribute("selected","selected")):selectCtrl.selectUnknownOrEmptyOption(value)}},selectCtrl.readValue=function(){var selectedOption=options.selectValueMap[selectElement.val()];return selectedOption&&!selectedOption.disabled?(selectCtrl.unselectEmptyOption(),selectCtrl.removeUnknownOption(),options.getViewValueFromOption(selectedOption)):null},ngOptions.trackBy&&scope.$watch(function(){return ngOptions.getTrackByValue(ngModelCtrl.$viewValue)},function(){ngModelCtrl.$render()})),providedEmptyOption&&($compile(selectCtrl.emptyOption)(scope),selectElement.prepend(selectCtrl.emptyOption),selectCtrl.emptyOption[0].nodeType===NODE_TYPE_COMMENT?(selectCtrl.hasEmptyOption=!1,selectCtrl.registerOption=function(optionScope,optionEl){""===optionEl.val()&&(selectCtrl.hasEmptyOption=!0,selectCtrl.emptyOption=optionEl,selectCtrl.emptyOption.removeClass("ng-scope"),ngModelCtrl.$render(),optionEl.on("$destroy",function(){var needsRerender=selectCtrl.$isEmptyOptionSelected();selectCtrl.hasEmptyOption=!1,selectCtrl.emptyOption=void 0,needsRerender&&ngModelCtrl.$render()}))}):selectCtrl.emptyOption.removeClass("ng-scope")),scope.$watchCollection(ngOptions.getWatchables,function(){var previousValue=options&&selectCtrl.readValue();if(options)for(var i=options.items.length-1;0<=i;i--){var option=options.items[i];isDefined(option.group)?jqLiteRemove(option.element.parentNode):jqLiteRemove(option.element)}options=ngOptions.getOptions();var groupElementMap={};if(options.items.forEach(function(option){var groupElement;isDefined(option.group)?((groupElement=groupElementMap[option.group])||(groupElement=optGroupTemplate.cloneNode(!1),listFragment.appendChild(groupElement),groupElement.label=null===option.group?"null":option.group,groupElementMap[option.group]=groupElement),addOptionElement(option,groupElement)):addOptionElement(option,listFragment)}),selectElement[0].appendChild(listFragment),ngModelCtrl.$render(),!ngModelCtrl.$isEmpty(previousValue)){var nextValue=selectCtrl.readValue();(ngOptions.trackBy||multiple?equals(previousValue,nextValue):previousValue===nextValue)||(ngModelCtrl.$setViewValue(nextValue),ngModelCtrl.$render())}})}}}}],ngPluralizeDirective=["$locale","$interpolate","$log",function($locale,$interpolate,$log){var BRACE=/{}/g,IS_WHEN=/^when(Minus)?(.+)$/;return{link:function(scope,element,attr){var lastCount,numberExp=attr.count,whenExp=attr.$attr.when&&element.attr(attr.$attr.when),offset=attr.offset||0,whens=scope.$eval(whenExp)||{},whensExpFns={},startSymbol=$interpolate.startSymbol(),endSymbol=$interpolate.endSymbol(),braceReplacement=startSymbol+numberExp+"-"+offset+endSymbol,watchRemover=angular.noop;function updateElementText(newText){element.text(newText||"")}forEach(attr,function(expression,attributeName){var tmpMatch=IS_WHEN.exec(attributeName);if(tmpMatch){var whenKey=(tmpMatch[1]?"-":"")+lowercase(tmpMatch[2]);whens[whenKey]=element.attr(attr.$attr[attributeName])}}),forEach(whens,function(expression,key){whensExpFns[key]=$interpolate(expression.replace(BRACE,braceReplacement))}),scope.$watch(numberExp,function(newVal){var count=parseFloat(newVal),countIsNaN=isNumberNaN(count);if(countIsNaN||count in whens||(count=$locale.pluralCat(count-offset)),!(count===lastCount||countIsNaN&&isNumberNaN(lastCount))){watchRemover();var whenExpFn=whensExpFns[count];isUndefined(whenExpFn)?(null!=newVal&&$log.debug("ngPluralize: no rule defined for '"+count+"' in "+whenExp),watchRemover=noop,updateElementText()):watchRemover=scope.$watch(whenExpFn,updateElementText),lastCount=count}})}}}],ngRefMinErr=minErr("ngRef"),ngRefDirective=["$parse",function($parse){return{priority:-1,restrict:"A",compile:function(tElement,tAttrs){var controllerName=directiveNormalize(nodeName_(tElement)),getter=$parse(tAttrs.ngRef),setter=getter.assign||function(){throw ngRefMinErr("nonassign",'Expression in ngRef="{0}" is non-assignable!',tAttrs.ngRef)};return function(scope,element,attrs){var refValue;if(attrs.hasOwnProperty("ngRefRead")){if("$element"===attrs.ngRefRead)refValue=element;else if(!(refValue=element.data("$"+attrs.ngRefRead+"Controller")))throw ngRefMinErr("noctrl",'The controller for ngRefRead="{0}" could not be found on ngRef="{1}"',attrs.ngRefRead,tAttrs.ngRef)}else refValue=element.data("$"+controllerName+"Controller");setter(scope,refValue=refValue||element),element.on("$destroy",function(){getter(scope)===refValue&&setter(scope,null)})}}}}],ngRepeatDirective=["$parse","$animate","$compile",function($parse,$animate,$compile){function updateScope(scope,index,valueIdentifier,value,keyIdentifier,key,arrayLength){scope[valueIdentifier]=value,keyIdentifier&&(scope[keyIdentifier]=key),scope.$index=index,scope.$first=0===index,scope.$last=index===arrayLength-1,scope.$middle=!(scope.$first||scope.$last),scope.$odd=!(scope.$even=0==(1&index))}function getBlockStart(block){return block.clone[0]}function getBlockEnd(block){return block.clone[block.clone.length-1]}var ngRepeatMinErr=minErr("ngRepeat");return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,compile:function($element,$attr){var expression=$attr.ngRepeat,ngRepeatEndComment=$compile.$$createComment("end ngRepeat",expression),match=expression.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/);if(!match)throw ngRepeatMinErr("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",expression);var lhs=match[1],rhs=match[2],aliasAs=match[3],trackByExp=match[4];if(!(match=lhs.match(/^(?:(\s*[$\w]+)|\(\s*([$\w]+)\s*,\s*([$\w]+)\s*\))$/)))throw ngRepeatMinErr("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",lhs);var trackByExpGetter,trackByIdExpFn,trackByIdArrayFn,trackByIdObjFn,valueIdentifier=match[3]||match[1],keyIdentifier=match[2];if(aliasAs&&(!/^[$a-zA-Z_][$a-zA-Z0-9_]*$/.test(aliasAs)||/^(null|undefined|this|\$index|\$first|\$middle|\$last|\$even|\$odd|\$parent|\$root|\$id)$/.test(aliasAs)))throw ngRepeatMinErr("badident","alias '{0}' is invalid --- must be a valid JS identifier which is not a reserved name.",aliasAs);var hashFnLocals={$id:hashKey};return trackByExp?trackByExpGetter=$parse(trackByExp):(trackByIdArrayFn=function(key,value){return hashKey(value)},trackByIdObjFn=function(key){return key}),function($scope,$element,$attr,ctrl,$transclude){trackByExpGetter&&(trackByIdExpFn=function(key,value,index){return keyIdentifier&&(hashFnLocals[keyIdentifier]=key),hashFnLocals[valueIdentifier]=value,hashFnLocals.$index=index,trackByExpGetter($scope,hashFnLocals)});var lastBlockMap=createMap();$scope.$watchCollection(rhs,function(collection){var index,length,nextNode,collectionLength,key,value,trackById,trackByIdFn,collectionKeys,block,nextBlockOrder,elementsToRemove,previousNode=$element[0],nextBlockMap=createMap();if(aliasAs&&($scope[aliasAs]=collection),isArrayLike(collection))collectionKeys=collection,trackByIdFn=trackByIdExpFn||trackByIdArrayFn;else for(var itemKey in trackByIdFn=trackByIdExpFn||trackByIdObjFn,collectionKeys=[],collection)hasOwnProperty.call(collection,itemKey)&&"$"!==itemKey.charAt(0)&&collectionKeys.push(itemKey);for(collectionLength=collectionKeys.length,nextBlockOrder=new Array(collectionLength),index=0;index<collectionLength;index++)if(key=collection===collectionKeys?index:collectionKeys[index],value=collection[key],trackById=trackByIdFn(key,value,index),lastBlockMap[trackById])block=lastBlockMap[trackById],delete lastBlockMap[trackById],nextBlockMap[trackById]=block,nextBlockOrder[index]=block;else{if(nextBlockMap[trackById])throw forEach(nextBlockOrder,function(block){block&&block.scope&&(lastBlockMap[block.id]=block)}),ngRepeatMinErr("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}, Duplicate value: {2}",expression,trackById,value);nextBlockOrder[index]={id:trackById,scope:void 0,clone:void 0},nextBlockMap[trackById]=!0}for(var blockKey in lastBlockMap){if(elementsToRemove=getBlockNodes((block=lastBlockMap[blockKey]).clone),$animate.leave(elementsToRemove),elementsToRemove[0].parentNode)for(index=0,length=elementsToRemove.length;index<length;index++)elementsToRemove[index].$$NG_REMOVED=!0;block.scope.$destroy()}for(index=0;index<collectionLength;index++)if(key=collection===collectionKeys?index:collectionKeys[index],value=collection[key],(block=nextBlockOrder[index]).scope){for(nextNode=previousNode;(nextNode=nextNode.nextSibling)&&nextNode.$$NG_REMOVED;);getBlockStart(block)!==nextNode&&$animate.move(getBlockNodes(block.clone),null,previousNode),previousNode=getBlockEnd(block),updateScope(block.scope,index,valueIdentifier,value,keyIdentifier,key,collectionLength)}else $transclude(function(clone,scope){block.scope=scope;var endNode=ngRepeatEndComment.cloneNode(!1);clone[clone.length++]=endNode,$animate.enter(clone,null,previousNode),previousNode=endNode,block.clone=clone,nextBlockMap[block.id]=block,updateScope(block.scope,index,valueIdentifier,value,keyIdentifier,key,collectionLength)});lastBlockMap=nextBlockMap})}}}}],ngShowDirective=["$animate",function($animate){return{restrict:"A",multiElement:!0,link:function(scope,element,attr){scope.$watch(attr.ngShow,function(value){$animate[value?"removeClass":"addClass"](element,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],ngHideDirective=["$animate",function($animate){return{restrict:"A",multiElement:!0,link:function(scope,element,attr){scope.$watch(attr.ngHide,function(value){$animate[value?"addClass":"removeClass"](element,"ng-hide",{tempClasses:"ng-hide-animate"})})}}}],ngStyleDirective=ngDirective(function(scope,element,attr){scope.$watchCollection(attr.ngStyle,function(newStyles,oldStyles){oldStyles&&newStyles!==oldStyles&&forEach(oldStyles,function(val,style){element.css(style,"")}),newStyles&&element.css(newStyles)})}),ngSwitchDirective=["$animate","$compile",function($animate,$compile){return{require:"ngSwitch",controller:["$scope",function(){this.cases={}}],link:function(scope,element,attr,ngSwitchController){function spliceFactory(array,index){return function(response){!1!==response&&array.splice(index,1)}}var watchExpr=attr.ngSwitch||attr.on,selectedTranscludes=[],selectedElements=[],previousLeaveAnimations=[],selectedScopes=[];scope.$watch(watchExpr,function(value){for(var i,ii;previousLeaveAnimations.length;)$animate.cancel(previousLeaveAnimations.pop());for(i=0,ii=selectedScopes.length;i<ii;++i){var selected=getBlockNodes(selectedElements[i].clone);selectedScopes[i].$destroy(),(previousLeaveAnimations[i]=$animate.leave(selected)).done(spliceFactory(previousLeaveAnimations,i))}selectedElements.length=0,selectedScopes.length=0,(selectedTranscludes=ngSwitchController.cases["!"+value]||ngSwitchController.cases["?"])&&forEach(selectedTranscludes,function(selectedTransclude){selectedTransclude.transclude(function(caseElement,selectedScope){selectedScopes.push(selectedScope);var anchor=selectedTransclude.element;caseElement[caseElement.length++]=$compile.$$createComment("end ngSwitchWhen");var block={clone:caseElement};selectedElements.push(block),$animate.enter(caseElement,anchor.parent(),anchor)})})})}}}],ngSwitchWhenDirective=ngDirective({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(scope,element,attrs,ctrl,$transclude){forEach(attrs.ngSwitchWhen.split(attrs.ngSwitchWhenSeparator).sort().filter(function(element,index,array){return array[index-1]!==element}),function(whenCase){ctrl.cases["!"+whenCase]=ctrl.cases["!"+whenCase]||[],ctrl.cases["!"+whenCase].push({transclude:$transclude,element:element})})}}),ngSwitchDefaultDirective=ngDirective({transclude:"element",priority:1200,require:"^ngSwitch",multiElement:!0,link:function(scope,element,attr,ctrl,$transclude){ctrl.cases["?"]=ctrl.cases["?"]||[],ctrl.cases["?"].push({transclude:$transclude,element:element})}}),ngTranscludeMinErr=minErr("ngTransclude"),ngTranscludeDirective=["$compile",function($compile){return{restrict:"EAC",compile:function(tElement){var fallbackLinkFn=$compile(tElement.contents());return tElement.empty(),function($scope,$element,$attrs,controller,$transclude){if(!$transclude)throw ngTranscludeMinErr("orphan","Illegal use of ngTransclude directive in the template! No parent directive that requires a transclusion found. Element: {0}",startingTag($element));$attrs.ngTransclude===$attrs.$attr.ngTransclude&&($attrs.ngTransclude="");var slotName=$attrs.ngTransclude||$attrs.ngTranscludeSlot;function useFallbackContent(){fallbackLinkFn($scope,function(clone){$element.append(clone)})}$transclude(function(clone,transcludedScope){clone.length&&function(nodes){for(var i=0,ii=nodes.length;i<ii;i++){var node=nodes[i];if(node.nodeType!==NODE_TYPE_TEXT||node.nodeValue.trim())return!0}}(clone)?$element.append(clone):(useFallbackContent(),transcludedScope.$destroy())},null,slotName),slotName&&!$transclude.isSlotFilled(slotName)&&useFallbackContent()}}}}],scriptDirective=["$templateCache",function($templateCache){return{restrict:"E",terminal:!0,compile:function(element,attr){if("text/ng-template"===attr.type){var templateUrl=attr.id,text=element[0].text;$templateCache.put(templateUrl,text)}}}}],noopNgModelController={$setViewValue:noop,$render:noop};function setOptionSelectedStatus(optionEl,value){optionEl.prop("selected",value),optionEl.attr("selected",value)}function selectDirective(){return{restrict:"E",require:["select","?ngModel"],controller:SelectController,priority:1,link:{pre:function(scope,element,attr,ctrls){var selectCtrl=ctrls[0],ngModelCtrl=ctrls[1];if(!ngModelCtrl)return void(selectCtrl.registerOption=noop);if(selectCtrl.ngModelCtrl=ngModelCtrl,element.on("change",function(){selectCtrl.removeUnknownOption(),scope.$apply(function(){ngModelCtrl.$setViewValue(selectCtrl.readValue())})}),attr.multiple){selectCtrl.multiple=!0,selectCtrl.readValue=function(){var array=[];return forEach(element.find("option"),function(option){if(option.selected&&!option.disabled){var val=option.value;array.push(val in selectCtrl.selectValueMap?selectCtrl.selectValueMap[val]:val)}}),array},selectCtrl.writeValue=function(value){forEach(element.find("option"),function(option){var shouldBeSelected=!!value&&(includes(value,option.value)||includes(value,selectCtrl.selectValueMap[option.value]));shouldBeSelected!==option.selected&&setOptionSelectedStatus(jqLite(option),shouldBeSelected)})};var lastView,lastViewRef=NaN;scope.$watch(function(){lastViewRef!==ngModelCtrl.$viewValue||equals(lastView,ngModelCtrl.$viewValue)||(lastView=shallowCopy(ngModelCtrl.$viewValue),ngModelCtrl.$render()),lastViewRef=ngModelCtrl.$viewValue}),ngModelCtrl.$isEmpty=function(value){return!value||0===value.length}}},post:function(scope,element,attrs,ctrls){var ngModelCtrl=ctrls[1];if(!ngModelCtrl)return;var selectCtrl=ctrls[0];ngModelCtrl.$render=function(){selectCtrl.writeValue(ngModelCtrl.$viewValue)}}}}}function requiredDirective(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){ctrl&&(attr.required=!0,ctrl.$validators.required=function(modelValue,viewValue){return!attr.required||!ctrl.$isEmpty(viewValue)},attr.$observe("required",function(){ctrl.$validate()}))}}}function patternDirective(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var regexp,patternExp=attr.ngPattern||attr.pattern;attr.$observe("pattern",function(regex){if(isString(regex)&&0<regex.length&&(regex=new RegExp("^"+regex+"$")),regex&&!regex.test)throw minErr("ngPattern")("noregexp","Expected {0} to be a RegExp but was {1}. Element: {2}",patternExp,regex,startingTag(elm));regexp=regex||void 0,ctrl.$validate()}),ctrl.$validators.pattern=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||isUndefined(regexp)||regexp.test(viewValue)}}}}}function maxlengthDirective(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var maxlength=-1;attr.$observe("maxlength",function(value){var intVal=toInt(value);maxlength=isNumberNaN(intVal)?-1:intVal,ctrl.$validate()}),ctrl.$validators.maxlength=function(modelValue,viewValue){return maxlength<0||ctrl.$isEmpty(viewValue)||viewValue.length<=maxlength}}}}}function minlengthDirective(){return{restrict:"A",require:"?ngModel",link:function(scope,elm,attr,ctrl){if(ctrl){var minlength=0;attr.$observe("minlength",function(value){minlength=toInt(value)||0,ctrl.$validate()}),ctrl.$validators.minlength=function(modelValue,viewValue){return ctrl.$isEmpty(viewValue)||viewValue.length>=minlength}}}}}var SelectController=["$element","$scope",function($element,$scope){var self=this,optionsMap=new NgMap;self.selectValueMap={},self.ngModelCtrl=noopNgModelController,self.multiple=!1,self.unknownOption=jqLite(window.document.createElement("option")),self.hasEmptyOption=!1,self.emptyOption=void 0,self.renderUnknownOption=function(val){var unknownVal=self.generateUnknownOptionValue(val);self.unknownOption.val(unknownVal),$element.prepend(self.unknownOption),setOptionSelectedStatus(self.unknownOption,!0),$element.val(unknownVal)},self.updateUnknownOption=function(val){var unknownVal=self.generateUnknownOptionValue(val);self.unknownOption.val(unknownVal),setOptionSelectedStatus(self.unknownOption,!0),$element.val(unknownVal)},self.generateUnknownOptionValue=function(val){return"? "+hashKey(val)+" ?"},self.removeUnknownOption=function(){self.unknownOption.parent()&&self.unknownOption.remove()},self.selectEmptyOption=function(){self.emptyOption&&($element.val(""),setOptionSelectedStatus(self.emptyOption,!0))},self.unselectEmptyOption=function(){self.hasEmptyOption&&setOptionSelectedStatus(self.emptyOption,!1)},$scope.$on("$destroy",function(){self.renderUnknownOption=noop}),self.readValue=function(){var val=$element.val(),realVal=val in self.selectValueMap?self.selectValueMap[val]:val;return self.hasOption(realVal)?realVal:null},self.writeValue=function(value){var currentlySelectedOption=$element[0].options[$element[0].selectedIndex];if(currentlySelectedOption&&setOptionSelectedStatus(jqLite(currentlySelectedOption),!1),self.hasOption(value)){self.removeUnknownOption();var hashedVal=hashKey(value);$element.val(hashedVal in self.selectValueMap?hashedVal:value);var selectedOption=$element[0].options[$element[0].selectedIndex];setOptionSelectedStatus(jqLite(selectedOption),!0)}else self.selectUnknownOrEmptyOption(value)},self.addOption=function(value,element){if(element[0].nodeType!==NODE_TYPE_COMMENT){assertNotHasOwnProperty(value,'"option value"'),""===value&&(self.hasEmptyOption=!0,self.emptyOption=element);var count=optionsMap.get(value)||0;optionsMap.set(value,count+1),scheduleRender()}},self.removeOption=function(value){var count=optionsMap.get(value);count&&(1===count?(optionsMap.delete(value),""===value&&(self.hasEmptyOption=!1,self.emptyOption=void 0)):optionsMap.set(value,count-1))},self.hasOption=function(value){return!!optionsMap.get(value)},self.$hasEmptyOption=function(){return self.hasEmptyOption},self.$isUnknownOptionSelected=function(){return $element[0].options[0]===self.unknownOption[0]},self.$isEmptyOptionSelected=function(){return self.hasEmptyOption&&$element[0].options[$element[0].selectedIndex]===self.emptyOption[0]};var renderScheduled=!(self.selectUnknownOrEmptyOption=function(value){null==value&&self.emptyOption?(self.removeUnknownOption(),self.selectEmptyOption()):self.unknownOption.parent().length?self.updateUnknownOption(value):self.renderUnknownOption(value)});function scheduleRender(){renderScheduled||(renderScheduled=!0,$scope.$$postDigest(function(){renderScheduled=!1,self.ngModelCtrl.$render()}))}var updateScheduled=!1;function scheduleViewValueUpdate(renderAfter){updateScheduled||(updateScheduled=!0,$scope.$$postDigest(function(){$scope.$$destroyed||(updateScheduled=!1,self.ngModelCtrl.$setViewValue(self.readValue()),renderAfter&&self.ngModelCtrl.$render())}))}self.registerOption=function(optionScope,optionElement,optionAttrs,interpolateValueFn,interpolateTextFn){var oldVal,hashedVal;optionAttrs.$attr.ngValue?optionAttrs.$observe("value",function(newVal){var removal,previouslySelected=optionElement.prop("selected");isDefined(hashedVal)&&(self.removeOption(oldVal),delete self.selectValueMap[hashedVal],removal=!0),hashedVal=hashKey(newVal),oldVal=newVal,self.selectValueMap[hashedVal]=newVal,self.addOption(newVal,optionElement),optionElement.attr("value",hashedVal),removal&&previouslySelected&&scheduleViewValueUpdate()}):interpolateValueFn?optionAttrs.$observe("value",function(newVal){var removal;self.readValue();var previouslySelected=optionElement.prop("selected");isDefined(oldVal)&&(self.removeOption(oldVal),removal=!0),oldVal=newVal,self.addOption(newVal,optionElement),removal&&previouslySelected&&scheduleViewValueUpdate()}):interpolateTextFn?optionScope.$watch(interpolateTextFn,function(newVal,oldVal){optionAttrs.$set("value",newVal);var previouslySelected=optionElement.prop("selected");oldVal!==newVal&&self.removeOption(oldVal),self.addOption(newVal,optionElement),oldVal&&previouslySelected&&scheduleViewValueUpdate()}):self.addOption(optionAttrs.value,optionElement);optionAttrs.$observe("disabled",function(newVal){("true"===newVal||newVal&&optionElement.prop("selected"))&&(self.multiple?scheduleViewValueUpdate(!0):(self.ngModelCtrl.$setViewValue(null),self.ngModelCtrl.$render()))}),optionElement.on("$destroy",function(){var currentValue=self.readValue(),removeValue=optionAttrs.value;self.removeOption(removeValue),scheduleRender(),(self.multiple&&currentValue&&-1!==currentValue.indexOf(removeValue)||currentValue===removeValue)&&scheduleViewValueUpdate(!0)})}}],optionDirective=["$interpolate",function($interpolate){return{restrict:"E",priority:100,compile:function(element,attr){var interpolateValueFn,interpolateTextFn;return isDefined(attr.ngValue)||(isDefined(attr.value)?interpolateValueFn=$interpolate(attr.value,!0):(interpolateTextFn=$interpolate(element.text(),!0))||attr.$set("value",element.text())),function(scope,element,attr){var parent=element.parent(),selectCtrl=parent.data("$selectController")||parent.parent().data("$selectController");selectCtrl&&selectCtrl.registerOption(scope,element,attr,interpolateValueFn,interpolateTextFn)}}}}];window.angular.bootstrap?window.console&&console.log("WARNING: Tried to load AngularJS more than once."):(function(){var originalCleanData;if(!bindJQueryFired){var jqName=jq();(jQuery=isUndefined(jqName)?window.jQuery:jqName?window[jqName]:void 0)&&jQuery.fn.on?extend((jqLite=jQuery).fn,{scope:JQLitePrototype.scope,isolateScope:JQLitePrototype.isolateScope,controller:JQLitePrototype.controller,injector:JQLitePrototype.injector,inheritedData:JQLitePrototype.inheritedData}):jqLite=JQLite,originalCleanData=jqLite.cleanData,jqLite.cleanData=function(elems){for(var events,elem,i=0;null!=(elem=elems[i]);i++)(events=(jqLite._data(elem)||{}).events)&&events.$destroy&&jqLite(elem).triggerHandler("$destroy");originalCleanData(elems)},angular.element=jqLite,bindJQueryFired=!0}}(),function(angular){extend(angular,{errorHandlingConfig:errorHandlingConfig,bootstrap:bootstrap,copy:copy,extend:extend,merge:merge,equals:equals,element:jqLite,forEach:forEach,injector:createInjector,noop:noop,bind:bind,toJson:toJson,fromJson:fromJson,identity:identity,isUndefined:isUndefined,isDefined:isDefined,isString:isString,isFunction:isFunction,isObject:isObject,isNumber:isNumber,isElement:isElement,isArray:isArray,version:version,isDate:isDate,callbacks:{$$counter:0},getTestability:getTestability,reloadWithDebugInfo:reloadWithDebugInfo,$$minErr:minErr,$$csp:csp,$$encodeUriSegment:encodeUriSegment,$$encodeUriQuery:encodeUriQuery,$$lowercase:lowercase,$$stringify:stringify,$$uppercase:uppercase}),(angularModule=function(window){var $injectorMinErr=minErr("$injector"),ngMinErr=minErr("ng");function ensure(obj,name,factory){return obj[name]||(obj[name]=factory())}var angular=ensure(window,"angular",Object);return angular.$$minErr=angular.$$minErr||minErr,ensure(angular,"module",function(){var modules={};return function(name,requires,configFn){var info={};return function(name,context){if("hasOwnProperty"===name)throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}(name,"module"),requires&&modules.hasOwnProperty(name)&&(modules[name]=null),ensure(modules,name,function(){if(!requires)throw $injectorMinErr("nomod","Module '{0}' is not available! You either misspelled the module name or forgot to load it. If registering a module ensure that you specify the dependencies as the second argument.",name);var invokeQueue=[],configBlocks=[],runBlocks=[],config=invokeLater("$injector","invoke","push",configBlocks),moduleInstance={_invokeQueue:invokeQueue,_configBlocks:configBlocks,_runBlocks:runBlocks,info:function(value){if(isDefined(value)){if(!isObject(value))throw ngMinErr("aobj","Argument '{0}' must be an object","value");return info=value,this}return info},requires:requires,name:name,provider:invokeLaterAndSetModuleName("$provide","provider"),factory:invokeLaterAndSetModuleName("$provide","factory"),service:invokeLaterAndSetModuleName("$provide","service"),value:invokeLater("$provide","value"),constant:invokeLater("$provide","constant","unshift"),decorator:invokeLaterAndSetModuleName("$provide","decorator",configBlocks),animation:invokeLaterAndSetModuleName("$animateProvider","register"),filter:invokeLaterAndSetModuleName("$filterProvider","register"),controller:invokeLaterAndSetModuleName("$controllerProvider","register"),directive:invokeLaterAndSetModuleName("$compileProvider","directive"),component:invokeLaterAndSetModuleName("$compileProvider","component"),config:config,run:function(block){return runBlocks.push(block),this}};return configFn&&config(configFn),moduleInstance;function invokeLater(provider,method,insertMethod,queue){return queue=queue||invokeQueue,function(){return queue[insertMethod||"push"]([provider,method,arguments]),moduleInstance}}function invokeLaterAndSetModuleName(provider,method,queue){return queue=queue||invokeQueue,function(recipeName,factoryFunction){return factoryFunction&&isFunction(factoryFunction)&&(factoryFunction.$$moduleName=name),queue.push([provider,method,arguments]),moduleInstance}}})}})}(window))("ng",["ngLocale"],["$provide",function($provide){$provide.provider({$$sanitizeUri:$$SanitizeUriProvider}),$provide.provider("$compile",$CompileProvider).directive({a:htmlAnchorDirective,input:inputDirective,textarea:inputDirective,form:formDirective,script:scriptDirective,select:selectDirective,option:optionDirective,ngBind:ngBindDirective,ngBindHtml:ngBindHtmlDirective,ngBindTemplate:ngBindTemplateDirective,ngClass:ngClassDirective,ngClassEven:ngClassEvenDirective,ngClassOdd:ngClassOddDirective,ngCloak:ngCloakDirective,ngController:ngControllerDirective,ngForm:ngFormDirective,ngHide:ngHideDirective,ngIf:ngIfDirective,ngInclude:ngIncludeDirective,ngInit:ngInitDirective,ngNonBindable:ngNonBindableDirective,ngPluralize:ngPluralizeDirective,ngRef:ngRefDirective,ngRepeat:ngRepeatDirective,ngShow:ngShowDirective,ngStyle:ngStyleDirective,ngSwitch:ngSwitchDirective,ngSwitchWhen:ngSwitchWhenDirective,ngSwitchDefault:ngSwitchDefaultDirective,ngOptions:ngOptionsDirective,ngTransclude:ngTranscludeDirective,ngModel:ngModelDirective,ngList:ngListDirective,ngChange:ngChangeDirective,pattern:patternDirective,ngPattern:patternDirective,required:requiredDirective,ngRequired:requiredDirective,minlength:minlengthDirective,ngMinlength:minlengthDirective,maxlength:maxlengthDirective,ngMaxlength:maxlengthDirective,ngValue:ngValueDirective,ngModelOptions:ngModelOptionsDirective}).directive({ngInclude:ngIncludeFillContentDirective}).directive(ngAttributeAliasDirectives).directive(ngEventDirectives),$provide.provider({$anchorScroll:$AnchorScrollProvider,$animate:$AnimateProvider,$animateCss:$CoreAnimateCssProvider,$$animateJs:$$CoreAnimateJsProvider,$$animateQueue:$$CoreAnimateQueueProvider,$$AnimateRunner:$$AnimateRunnerFactoryProvider,$$animateAsyncRun:$$AnimateAsyncRunFactoryProvider,$browser:$BrowserProvider,$cacheFactory:$CacheFactoryProvider,$controller:$ControllerProvider,$document:$DocumentProvider,$$isDocumentHidden:$$IsDocumentHiddenProvider,$exceptionHandler:$ExceptionHandlerProvider,$filter:$FilterProvider,$$forceReflow:$$ForceReflowProvider,$interpolate:$InterpolateProvider,$interval:$IntervalProvider,$$intervalFactory:$$IntervalFactoryProvider,$http:$HttpProvider,$httpParamSerializer:$HttpParamSerializerProvider,$httpParamSerializerJQLike:$HttpParamSerializerJQLikeProvider,$httpBackend:$HttpBackendProvider,$xhrFactory:$xhrFactoryProvider,$jsonpCallbacks:$jsonpCallbacksProvider,$location:$LocationProvider,$log:$LogProvider,$parse:$ParseProvider,$rootScope:$RootScopeProvider,$q:$QProvider,$$q:$$QProvider,$sce:$SceProvider,$sceDelegate:$SceDelegateProvider,$sniffer:$SnifferProvider,$$taskTrackerFactory:$$TaskTrackerFactoryProvider,$templateCache:$TemplateCacheProvider,$templateRequest:$TemplateRequestProvider,$$testability:$$TestabilityProvider,$timeout:$TimeoutProvider,$window:$WindowProvider,$$rAF:$$RAFProvider,$$jqLite:$$jqLiteProvider,$$Map:$$MapProvider,$$cookieReader:$$CookieReaderProvider})}]).info({angularVersion:"1.7.4"})}(angular),angular.module("ngLocale",[],["$provide",function($provide){var PLURAL_CATEGORY_ONE="one",PLURAL_CATEGORY_OTHER="other";function getVF(n,opt_precision){var v=opt_precision;void 0===v&&(v=Math.min(function(n){var i=(n+="").indexOf(".");return-1==i?0:n.length-i-1}(n),3));var base=Math.pow(10,v);return{v:v,f:(n*base|0)%base}}$provide.value("$locale",{DATETIME_FORMATS:{AMPMS:["AM","PM"],DAY:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ERANAMES:["Before Christ","Anno Domini"],ERAS:["BC","AD"],FIRSTDAYOFWEEK:6,MONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],SHORTDAY:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],SHORTMONTH:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],STANDALONEMONTH:["January","February","March","April","May","June","July","August","September","October","November","December"],WEEKENDRANGE:[5,6],fullDate:"EEEE, MMMM d, y",longDate:"MMMM d, y",medium:"MMM d, y h:mm:ss a",mediumDate:"MMM d, y",mediumTime:"h:mm:ss a",short:"M/d/yy h:mm a",shortDate:"M/d/yy",shortTime:"h:mm a"},NUMBER_FORMATS:{CURRENCY_SYM:"$",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-Â¤",negSuf:"",posPre:"Â¤",posSuf:""}]},id:"en-us",localeID:"en_US",pluralCat:function(n,opt_precision){var i=0|n,vf=getVF(n,opt_precision);return 1==i&&0==vf.v?PLURAL_CATEGORY_ONE:PLURAL_CATEGORY_OTHER}})}]),jqLite(function(){angularInit(window.document,bootstrap)}))}(window),window.angular.$$csp().noInlineStyle||window.angular.element(document.head).prepend('<style type="text/css">@charset "UTF-8";[ng\\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\\:form{display:block;}.ng-animate-shim{visibility:hidden;}.ng-anchor{position:absolute;}</style>')},function(module,exports,__webpack_require__){"use strict";(function(global){
/*!
Copyright (C) 2015 by WebReflection

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/
function encode(str){return encodeURIComponent(str).replace(find,replacer)}function decode(str){return decodeURIComponent(str.replace(plus," "))}function URLSearchParams(query){if(this[secret]=Object.create(null),query)for(var index,value,pairs=(query||"").split("&"),i=0,length=pairs.length;i<length;i++)-1<(index=(value=pairs[i]).indexOf("="))&&this.append(decode(value.slice(0,index)),decode(value.slice(index+1)))}var URLSearchParamsProto=URLSearchParams.prototype,find=/[!'\(\)~]|%20|%00/g,plus=/\+/g,replace={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"},replacer=function(match){return replace[match]},iterable=function(){try{return!!Symbol.iterator}catch(error){return!1}}(),secret="__URLSearchParams__:"+Math.random();URLSearchParamsProto.append=function(name,value){var dict=this[secret];name in dict?dict[name].push(""+value):dict[name]=[""+value]},URLSearchParamsProto.delete=function(name){delete this[secret][name]},URLSearchParamsProto.get=function(name){var dict=this[secret];return name in dict?dict[name][0]:null},URLSearchParamsProto.getAll=function(name){var dict=this[secret];return name in dict?dict[name].slice(0):[]},URLSearchParamsProto.has=function(name){return name in this[secret]},URLSearchParamsProto.set=function(name,value){this[secret][name]=[""+value]},URLSearchParamsProto.forEach=function(callback,thisArg){var dict=this[secret];Object.getOwnPropertyNames(dict).forEach(function(name){dict[name].forEach(function(value){callback.call(thisArg,value,name,this)},this)},this)},URLSearchParamsProto.keys=function(){var items=[];this.forEach(function(value,name){items.push(name)});var iterator={next:function(){var value=items.shift();return{done:void 0===value,value:value}}};return iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator},URLSearchParamsProto.values=function(){var items=[];this.forEach(function(value){items.push(value)});var iterator={next:function(){var value=items.shift();return{done:void 0===value,value:value}}};return iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator},URLSearchParamsProto.entries=function(){var items=[];this.forEach(function(value,name){items.push([name,value])});var iterator={next:function(){var value=items.shift();return{done:void 0===value,value:value}}};return iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator},iterable&&(URLSearchParamsProto[Symbol.iterator]=URLSearchParamsProto.entries),URLSearchParamsProto.toJSON=function(){return{}},URLSearchParamsProto.toString=function(){var i,key,name,value,dict=this[secret],query=[];for(key in dict)for(name=encode(key),i=0,value=dict[key];i<value.length;i++)query.push(name+"="+encode(value[i]));return query.join("&")},module.exports=global.URLSearchParams||URLSearchParams}).call(this,__webpack_require__(16))},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(38),types={string:{validate:function(){return!0}},select:{validate:function(){return!0}},select1:{validate:function(){return!0}},decimal:{convert:function(x){var num=Number(x);return isNaN(num)||num===Number.POSITIVE_INFINITY||num===Number.NEGATIVE_INFINITY?"":num},validate:function(x){var num=Number(x);return!isNaN(num)&&num!==Number.POSITIVE_INFINITY&&num!==Number.NEGATIVE_INFINITY}},int:{convert:function(x){var num=Number(x);return isNaN(num)||num===Number.POSITIVE_INFINITY||num===Number.NEGATIVE_INFINITY?"":0<=num?Math.floor(num):-Math.floor(Math.abs(num))},validate:function(x){var num=Number(x);return!isNaN(num)&&num!==Number.POSITIVE_INFINITY&&num!==Number.NEGATIVE_INFINITY&&Math.round(num)===num&&num.toString()===x.toString()}},date:{validate:function(x){var segments=/([0-9]{4})-([0-9]{2})-([0-9]{2})/.exec(x);if(segments&&4===segments.length){var year=Number(segments[1]),month=Number(segments[2])-1,day=Number(segments[3]),date=new Date(year,month,day);return date.getFullYear()===year&&date.getMonth()===month&&date.getDate()===day}return!1},convert:function(x){var date;return"Invalid Date"===(date=utils.isNumber(x)?new Date(24*x*60*60*1e3):this.validate(x)?new Date(x):"Invalid Date").toString()?"":date.getUTCFullYear().toString().pad(4)+"-"+(date.getUTCMonth()+1).toString().pad(2)+"-"+date.getUTCDate().toString().pad(2)}},datetime:{validate:function(x){var parts=x.split("T");return 2===parts.length&&(types.date.validate(parts[0])&&types.time.validate(parts[1],!1))},convert:function(x){var date="Invalid Date",parts=x.split("T");if(utils.isNumber(x))date=new Date(24*x*60*60*1e3);else if(/[0-9]T[0-9]/.test(x)&&2===parts.length){var convertedDate=types.date.convert(parts[0]),convertedTime=types.time.convert(parts[1],!1);if(convertedDate&&convertedTime)return convertedDate+"T"+convertedTime}return"Invalid Date"!==date.toString()?date.toISOLocalString():""}},time:{validate:function(x,requireMillis){var m=x.match(/^(\d\d):(\d\d):(\d\d)\.\d\d\d(\+|-)(\d\d):(\d\d)$/);return requireMillis="boolean"!=typeof requireMillis||requireMillis,m||requireMillis||(m=x.match(/^(\d\d):(\d\d):(\d\d)(\+|-)(\d\d):(\d\d)$/)),!!m&&(m[1]<24&&0<=m[1]&&m[2]<60&&0<=m[2]&&m[3]<60&&0<=m[3]&&m[5]<24&&0<=m[5]&&m[6]<60&&0<=m[6])},convert:function(x,requireMillis){var date,parts,time,secs,tz,offset,o={};if(requireMillis="boolean"!=typeof requireMillis||requireMillis,!/^[0-9]{1,2}:[0-9]{1,2}(:[0-9.]*)?/.test(x)){if("Invalid Date"===(date=new Date(x)).toString())return"";x=date.getHours()+":"+date.getMinutes()+":"+date.getSeconds()+"."+date.getMilliseconds()+date.getTimezoneOffsetAsTime()}return(parts=x.toString().split(/(\+|-|Z)/)).length<1?"":(time=parts[0].split(":"),tz=parts[2]?[parts[1]].concat(parts[2].split(":")):"Z"===parts[1]?["+","00","00"]:[],o.hours=time[0].pad(2),o.minutes=time[1].pad(2),secs=time[2]?time[2].split("."):["00"],o.seconds=secs[0],o.milliseconds=secs[1]||(requireMillis?"000":void 0),offset=0===tz.length?(new Date).getTimezoneOffsetAsTime():tz[0]+tz[1].pad(2)+":"+(tz[2]?tz[2].pad(2):"00"),x=o.hours+":"+o.minutes+":"+o.seconds+(o.milliseconds?"."+o.milliseconds:"")+offset,this.validate(x,requireMillis)?x:"")}},barcode:{validate:function(){return!0}},geopoint:{validate:function(x){var coords=x.toString().trim().split(" ");return""!==coords[0]&&-90<=coords[0]&&coords[0]<=90&&""!==coords[1]&&-180<=coords[1]&&coords[1]<=180&&(void 0===coords[2]||!isNaN(coords[2]))&&(void 0===coords[3]||!isNaN(coords[3])&&0<=coords[3])},convert:function(x){return x.toString().trim()}},geotrace:{validate:function(x){var geopoints=x.toString().split(";");return 2<=geopoints.length&&geopoints.every(function(geopoint){return types.geopoint.validate(geopoint)})},convert:function(x){return x.toString().trim()}},geoshape:{validate:function(x){var geopoints=x.toString().split(";");return 4<=geopoints.length&&geopoints[0]===geopoints[geopoints.length-1]&&geopoints.every(function(geopoint){return types.geopoint.validate(geopoint)})},convert:function(x){return x.toString().trim()}},binary:{validate:function(){return!0}}};module.exports=types},function(module,exports,__webpack_require__){"use strict";__webpack_require__(202),String.prototype.pad=function(digits){for(var x=this;x.length<digits;)x="0"+x;return x},void 0===console.deprecate&&(console.deprecate=function(bad,good){console.warn(bad+" is deprecated. Use "+good+" instead.")})},function(module,exports,__webpack_require__){"use strict";var Promise=__webpack_require__(58),$=__webpack_require__(2),utils=__webpack_require__(38),fileManager={},t=__webpack_require__(46).t;fileManager.init=function(){return Promise.resolve(!0)},fileManager.isWaitingForPermissions=function(){return!1},fileManager.getFileUrl=function(subject){return new Promise(function(resolve,reject){subject?"string"==typeof subject?reject("no!"):"object"==typeof subject?fileManager.isTooLarge(subject)?reject(new Error(t("filepicker.toolargeerror",{maxSize:fileManager.getMaxSizeReadable()}))):resolve(URL.createObjectURL(subject)):reject(new Error("Unknown error occurred")):resolve(null)})},fileManager.getObjectUrl=function(subject){return fileManager.getFileUrl(subject).then(function(url){return/https?:\/\//.test(url)?fileManager.urlToBlob(url).then(URL.createObjectURL):url})},fileManager.urlToBlob=function(url){var xhr=new XMLHttpRequest;return new Promise(function(resolve){xhr.open("GET",url),xhr.responseType="blob",xhr.onload=function(){resolve(xhr.response)},xhr.send()})},fileManager.getCurrentFiles=function(){var files=[];return $("form.or").find('input[type="file"]:not(.ignore), input[type="text"][data-drawing="true"]').each(function(){var newFilename,file=null,canvas=null;"file"===this.type?file=this.files[0]:this.value&&(canvas=$(this).closest(".question")[0].querySelector(".draw-widget canvas"))&&((file=utils.dataUriToBlobSync(canvas.toDataURL())).name=this.value),file&&file.name&&(newFilename=utils.getFilename(file,this.dataset.filenamePostfix),(file=new Blob([file],{type:file.type})).name=newFilename,files.push(file))}),files},fileManager.isTooLarge=function(){return!1},fileManager.getMaxSizeReadable=function(){return"5MB"},module.exports=fileManager},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8),bind=__webpack_require__(72),Axios=__webpack_require__(137),defaults=__webpack_require__(59);function createInstance(defaultConfig){var context=new Axios(defaultConfig),instance=bind(Axios.prototype.request,context);return utils.extend(instance,Axios.prototype,context),utils.extend(instance,context),instance}var axios=createInstance(defaults);axios.Axios=Axios,axios.create=function(instanceConfig){return createInstance(utils.merge(defaults,instanceConfig))},axios.Cancel=__webpack_require__(77),axios.CancelToken=__webpack_require__(150),axios.isCancel=__webpack_require__(76),axios.all=function(promises){return Promise.all(promises)},axios.spread=__webpack_require__(151),module.exports=axios,module.exports.default=axios},function(module,exports){
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
module.exports=function(obj){return null!=obj&&null!=obj.constructor&&"function"==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}},function(module,exports,__webpack_require__){"use strict";var defaults=__webpack_require__(59),utils=__webpack_require__(8),InterceptorManager=__webpack_require__(145),dispatchRequest=__webpack_require__(146);function Axios(instanceConfig){this.defaults=instanceConfig,this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios.prototype.request=function(config,argument_1){"string"==typeof config&&(config=utils.merge({url:arguments[0]},argument_1)),(config=utils.merge(defaults,{method:"get"},this.defaults,config)).method=config.method.toLowerCase();var chain=[dispatchRequest,void 0],promise=Promise.resolve(config);for(this.interceptors.request.forEach(function(interceptor){chain.unshift(interceptor.fulfilled,interceptor.rejected)}),this.interceptors.response.forEach(function(interceptor){chain.push(interceptor.fulfilled,interceptor.rejected)});chain.length;)promise=promise.then(chain.shift(),chain.shift());return promise},utils.forEach(["delete","get","head","options"],function(method){Axios.prototype[method]=function(url,config){return this.request(utils.merge(config||{},{method:method,url:url}))}}),utils.forEach(["post","put","patch"],function(method){Axios.prototype[method]=function(url,data,config){return this.request(utils.merge(config||{},{method:method,url:url,data:data}))}}),module.exports=Axios},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8);module.exports=function(headers,normalizedName){utils.forEach(headers,function(value,name){name!==normalizedName&&name.toUpperCase()===normalizedName.toUpperCase()&&(headers[normalizedName]=value,delete headers[name])})}},function(module,exports,__webpack_require__){"use strict";var createError=__webpack_require__(75);module.exports=function(resolve,reject,response){var validateStatus=response.config.validateStatus;response.status&&validateStatus&&!validateStatus(response.status)?reject(createError("Request failed with status code "+response.status,response.config,null,response.request,response)):resolve(response)}},function(module,exports,__webpack_require__){"use strict";module.exports=function(error,config,code,request,response){return error.config=config,code&&(error.code=code),error.request=request,error.response=response,error}},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8);function encode(val){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}module.exports=function(url,params,paramsSerializer){if(!params)return url;var serializedParams;if(paramsSerializer)serializedParams=paramsSerializer(params);else if(utils.isURLSearchParams(params))serializedParams=params.toString();else{var parts=[];utils.forEach(params,function(val,key){null!=val&&(utils.isArray(val)?key+="[]":val=[val],utils.forEach(val,function(v){utils.isDate(v)?v=v.toISOString():utils.isObject(v)&&(v=JSON.stringify(v)),parts.push(encode(key)+"="+encode(v))}))}),serializedParams=parts.join("&")}return serializedParams&&(url+=(-1===url.indexOf("?")?"?":"&")+serializedParams),url}},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8),ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];module.exports=function(headers){var key,val,i,parsed={};return headers&&utils.forEach(headers.split("\n"),function(line){if(i=line.indexOf(":"),key=utils.trim(line.substr(0,i)).toLowerCase(),val=utils.trim(line.substr(i+1)),key){if(parsed[key]&&0<=ignoreDuplicateOf.indexOf(key))return;parsed[key]="set-cookie"===key?(parsed[key]?parsed[key]:[]).concat([val]):parsed[key]?parsed[key]+", "+val:val}}),parsed}},function(module,exports,__webpack_require__){"use strict";var originURL,msie,urlParsingNode,utils=__webpack_require__(8);function resolveURL(url){var href=url;return msie&&(urlParsingNode.setAttribute("href",href),href=urlParsingNode.href),urlParsingNode.setAttribute("href",href),{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:"/"===urlParsingNode.pathname.charAt(0)?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}module.exports=utils.isStandardBrowserEnv()?(msie=/(msie|trident)/i.test(navigator.userAgent),urlParsingNode=document.createElement("a"),originURL=resolveURL(window.location.href),function(requestURL){var parsed=utils.isString(requestURL)?resolveURL(requestURL):requestURL;return parsed.protocol===originURL.protocol&&parsed.host===originURL.host}):function(){return!0}},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8);module.exports=utils.isStandardBrowserEnv()?{write:function(name,value,expires,path,domain,secure){var cookie=[];cookie.push(name+"="+encodeURIComponent(value)),utils.isNumber(expires)&&cookie.push("expires="+new Date(expires).toGMTString()),utils.isString(path)&&cookie.push("path="+path),utils.isString(domain)&&cookie.push("domain="+domain),!0===secure&&cookie.push("secure"),document.cookie=cookie.join("; ")},read:function(name){var match=document.cookie.match(new RegExp("(^|;\\s*)("+name+")=([^;]*)"));return match?decodeURIComponent(match[3]):null},remove:function(name){this.write(name,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8);function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function(fulfilled,rejected){return this.handlers.push({fulfilled:fulfilled,rejected:rejected}),this.handlers.length-1},InterceptorManager.prototype.eject=function(id){this.handlers[id]&&(this.handlers[id]=null)},InterceptorManager.prototype.forEach=function(fn){utils.forEach(this.handlers,function(h){null!==h&&fn(h)})},module.exports=InterceptorManager},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8),transformData=__webpack_require__(147),isCancel=__webpack_require__(76),defaults=__webpack_require__(59),isAbsoluteURL=__webpack_require__(148),combineURLs=__webpack_require__(149);function throwIfCancellationRequested(config){config.cancelToken&&config.cancelToken.throwIfRequested()}module.exports=function(config){return throwIfCancellationRequested(config),config.baseURL&&!isAbsoluteURL(config.url)&&(config.url=combineURLs(config.baseURL,config.url)),config.headers=config.headers||{},config.data=transformData(config.data,config.headers,config.transformRequest),config.headers=utils.merge(config.headers.common||{},config.headers[config.method]||{},config.headers||{}),utils.forEach(["delete","get","head","post","put","patch","common"],function(method){delete config.headers[method]}),(config.adapter||defaults.adapter)(config).then(function(response){return throwIfCancellationRequested(config),response.data=transformData(response.data,response.headers,config.transformResponse),response},function(reason){return isCancel(reason)||(throwIfCancellationRequested(config),reason&&reason.response&&(reason.response.data=transformData(reason.response.data,reason.response.headers,config.transformResponse))),Promise.reject(reason)})}},function(module,exports,__webpack_require__){"use strict";var utils=__webpack_require__(8);module.exports=function(data,headers,fns){return utils.forEach(fns,function(fn){data=fn(data,headers)}),data}},function(module,exports,__webpack_require__){"use strict";module.exports=function(url){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(url)}},function(module,exports,__webpack_require__){"use strict";module.exports=function(baseURL,relativeURL){return relativeURL?baseURL.replace(/\/+$/,"")+"/"+relativeURL.replace(/^\/+/,""):baseURL}},function(module,exports,__webpack_require__){"use strict";var Cancel=__webpack_require__(77);function CancelToken(executor){if("function"!=typeof executor)throw new TypeError("executor must be a function.");var resolvePromise;this.promise=new Promise(function(resolve){resolvePromise=resolve});var token=this;executor(function(message){token.reason||(token.reason=new Cancel(message),resolvePromise(token.reason))})}CancelToken.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},CancelToken.source=function(){var cancel;return{token:new CancelToken(function(c){cancel=c}),cancel:cancel}},module.exports=CancelToken},function(module,exports,__webpack_require__){"use strict";module.exports=function(callback){return function(arr){return callback.apply(null,arr)}}},function(module,exports,__webpack_require__){"use strict";var immediate=__webpack_require__(65);function INTERNAL(){}var handlers={},REJECTED=["REJECTED"],FULFILLED=["FULFILLED"],PENDING=["PENDING"];function Promise(resolver){if("function"!=typeof resolver)throw new TypeError("resolver must be a function");this.state=PENDING,this.queue=[],this.outcome=void 0,resolver!==INTERNAL&&safelyResolveThenable(this,resolver)}function QueueItem(promise,onFulfilled,onRejected){this.promise=promise,"function"==typeof onFulfilled&&(this.onFulfilled=onFulfilled,this.callFulfilled=this.otherCallFulfilled),"function"==typeof onRejected&&(this.onRejected=onRejected,this.callRejected=this.otherCallRejected)}function unwrap(promise,func,value){immediate(function(){var returnValue;try{returnValue=func(value)}catch(e){return handlers.reject(promise,e)}returnValue===promise?handlers.reject(promise,new TypeError("Cannot resolve promise with itself")):handlers.resolve(promise,returnValue)})}function getThen(obj){var then=obj&&obj.then;if(obj&&("object"==typeof obj||"function"==typeof obj)&&"function"==typeof then)return function(){then.apply(obj,arguments)}}function safelyResolveThenable(self,thenable){var called=!1;function onError(value){called||(called=!0,handlers.reject(self,value))}function onSuccess(value){called||(called=!0,handlers.resolve(self,value))}var result=tryCatch(function(){thenable(onSuccess,onError)});"error"===result.status&&onError(result.value)}function tryCatch(func,value){var out={};try{out.value=func(value),out.status="success"}catch(e){out.status="error",out.value=e}return out}(module.exports=Promise).prototype.catch=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){if("function"!=typeof onFulfilled&&this.state===FULFILLED||"function"!=typeof onRejected&&this.state===REJECTED)return this;var promise=new this.constructor(INTERNAL);this.state!==PENDING?unwrap(promise,this.state===FULFILLED?onFulfilled:onRejected,this.outcome):this.queue.push(new QueueItem(promise,onFulfilled,onRejected));return promise},QueueItem.prototype.callFulfilled=function(value){handlers.resolve(this.promise,value)},QueueItem.prototype.otherCallFulfilled=function(value){unwrap(this.promise,this.onFulfilled,value)},QueueItem.prototype.callRejected=function(value){handlers.reject(this.promise,value)},QueueItem.prototype.otherCallRejected=function(value){unwrap(this.promise,this.onRejected,value)},handlers.resolve=function(self,value){var result=tryCatch(getThen,value);if("error"===result.status)return handlers.reject(self,result.value);var thenable=result.value;if(thenable)safelyResolveThenable(self,thenable);else{self.state=FULFILLED,self.outcome=value;for(var i=-1,len=self.queue.length;++i<len;)self.queue[i].callFulfilled(value)}return self},handlers.reject=function(self,error){self.state=REJECTED,self.outcome=error;for(var i=-1,len=self.queue.length;++i<len;)self.queue[i].callRejected(error);return self},Promise.resolve=function(value){if(value instanceof this)return value;return handlers.resolve(new this(INTERNAL),value)},Promise.reject=function(reason){var promise=new this(INTERNAL);return handlers.reject(promise,reason)},Promise.all=function(iterable){var self=this;if("[object Array]"!==Object.prototype.toString.call(iterable))return this.reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return this.resolve([]);var values=new Array(len),resolved=0,i=-1,promise=new this(INTERNAL);for(;++i<len;)allResolver(iterable[i],i);return promise;function allResolver(value,i){self.resolve(value).then(function(outValue){values[i]=outValue,++resolved!==len||called||(called=!0,handlers.resolve(promise,values))},function(error){called||(called=!0,handlers.reject(promise,error))})}},Promise.race=function(iterable){var self=this;if("[object Array]"!==Object.prototype.toString.call(iterable))return this.reject(new TypeError("must be an array"));var len=iterable.length,called=!1;if(!len)return this.resolve([]);var i=-1,promise=new this(INTERNAL);for(;++i<len;)value=iterable[i],self.resolve(value).then(function(response){called||(called=!0,handlers.resolve(promise,response))},function(error){called||(called=!0,handlers.reject(promise,error))});var value;return promise}},function(module,exports,__webpack_require__){"use strict";module.exports=function(fun){return function(){var len=arguments.length;if(len){for(var args=[],i=-1;++i<len;)args[i]=arguments[i];return fun.call(this,args)}return fun.call(this,[])}}},function(module,exports,__webpack_require__){"use strict";var ReflectOwnKeys,R="object"==typeof Reflect?Reflect:null,ReflectApply=R&&"function"==typeof R.apply?R.apply:function(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};ReflectOwnKeys=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}:function(target){return Object.getOwnPropertyNames(target)};var NumberIsNaN=Number.isNaN||function(value){return value!=value};function EventEmitter(){EventEmitter.init.call(this)}((module.exports=EventEmitter).EventEmitter=EventEmitter).prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing;if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener);if(void 0===(events=target._events)?(events=target._events=Object.create(null),target._eventsCount=0):(void 0!==events.newListener&&(target.emit("newListener",type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]),void 0===existing)existing=events[type]=listener,++target._eventsCount;else if("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),0<(m=$getMaxListeners(target))&&existing.length>m&&!existing.warned){existing.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=target,w.type=type,w.count=existing.length,function(warning){console&&console.warn&&console.warn(warning)}(w)}return target}function _onceWrap(target,type,listener){var state={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},wrapped=function(){for(var args=[],i=0;i<arguments.length;i++)args.push(arguments[i]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,ReflectApply(this.listener,this.target,args))}.bind(state);return wrapped.listener=listener,state.wrapFn=wrapped}function _listeners(target,type,unwrap){var events=target._events;if(void 0===events)return[];var evlistener=events[type];return void 0===evlistener?[]:"function"==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?function(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}(evlistener):arrayClone(evlistener,evlistener.length)}function listenerCount(type){var events=this._events;if(void 0!==events){var evlistener=events[type];if("function"==typeof evlistener)return 1;if(void 0!==evlistener)return evlistener.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||NumberIsNaN(arg))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".");defaultMaxListeners=arg}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||NumberIsNaN(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(type){for(var args=[],i=1;i<arguments.length;i++)args.push(arguments[i]);var doError="error"===type,events=this._events;if(void 0!==events)doError=doError&&void 0===events.error;else if(!doError)return!1;if(doError){var er;if(0<args.length&&(er=args[0]),er instanceof Error)throw er;var err=new Error("Unhandled error."+(er?" ("+er.message+")":""));throw err.context=er,err}var handler=events[type];if(void 0===handler)return!1;if("function"==typeof handler)ReflectApply(handler,this,args);else{var len=handler.length,listeners=arrayClone(handler,len);for(i=0;i<len;++i)ReflectApply(listeners[i],this,args)}return!0},EventEmitter.prototype.on=EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener);return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener);return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener);if(void 0===(events=this._events))return this;if(void 0===(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=Object.create(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;0<=i;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function(list,index){for(;index+1<list.length;index++)list[index]=list[index+1];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),void 0!==events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var listeners,events,i;if(void 0===(events=this._events))return this;if(void 0===events.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==events[type]&&(0==--this._eventsCount?this._events=Object.create(null):delete events[type]),this;if(0===arguments.length){var key,keys=Object.keys(events);for(i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(void 0!==listeners)for(i=listeners.length-1;0<=i;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return 0<this._eventsCount?ReflectOwnKeys(this._events):[]}},function(module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;function TempCtor(){}TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},function(module,exports,__webpack_require__){var v1=__webpack_require__(157),v4=__webpack_require__(158),uuid=v4;uuid.v1=v1,uuid.v4=v4,module.exports=uuid},function(module,exports,__webpack_require__){var _nodeId,_clockseq,rng=__webpack_require__(78),bytesToUuid=__webpack_require__(79),_lastMSecs=0,_lastNSecs=0;module.exports=function(options,buf,offset){var i=buf&&offset||0,b=buf||[],node=(options=options||{}).node||_nodeId,clockseq=void 0!==options.clockseq?options.clockseq:_clockseq;if(null==node||null==clockseq){var seedBytes=rng();null==node&&(node=_nodeId=[1|seedBytes[0],seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]),null==clockseq&&(clockseq=_clockseq=16383&(seedBytes[6]<<8|seedBytes[7]))}var msecs=void 0!==options.msecs?options.msecs:(new Date).getTime(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||_lastMSecs<msecs)&&void 0===options.nsecs&&(nsecs=0),1e4<=nsecs)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_clockseq=clockseq;var tl=(1e4*(268435455&(msecs+=122192928e5))+(_lastNSecs=nsecs))%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var n=0;n<6;++n)b[i+n]=node[n];return buf||bytesToUuid(b)}},function(module,exports,__webpack_require__){var rng=__webpack_require__(78),bytesToUuid=__webpack_require__(79);module.exports=function(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"===options?new Array(16):null,options=null);var rnds=(options=options||{}).random||(options.rng||rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;++ii)buf[i+ii]=rnds[ii];return buf||bytesToUuid(rnds)}},function(module,exports,__webpack_require__){(function(process){function load(){var r;try{r=exports.storage.debug}catch(e){}return!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG),r}(exports=module.exports=__webpack_require__(160)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},exports.formatArgs=function(args){var useColors=this.useColors;if(args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff),!useColors)return;var c="color: "+this.color;args.splice(1,0,c,"color: inherit");var index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,function(match){"%%"!==match&&(index++,"%c"===match&&(lastC=index))}),args.splice(lastC,0,c)},exports.save=function(namespaces){try{null==namespaces?exports.storage.removeItem("debug"):exports.storage.debug=namespaces}catch(e){}},exports.load=load,exports.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},exports.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],exports.formatters.j=function(v){try{return JSON.stringify(v)}catch(err){return"[UnexpectedJSONParseError]: "+err.message}},exports.enable(load())}).call(this,__webpack_require__(73))},function(module,exports,__webpack_require__){function createDebug(namespace){var prevTime;function debug(){if(debug.enabled){var self=debug,curr=+new Date,ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr;for(var args=new Array(arguments.length),i=0;i<args.length;i++)args[i]=arguments[i];args[0]=exports.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");var index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"==typeof formatter){var val=args[index];match=formatter.call(self,val),args.splice(index,1),index--}return match}),exports.formatArgs.call(self,args),(debug.log||exports.log||console.log.bind(console)).apply(self,args)}}return debug.namespace=namespace,debug.enabled=exports.enabled(namespace),debug.useColors=exports.useColors(),debug.color=function(namespace){var i,hash=0;for(i in namespace)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return exports.colors[Math.abs(hash)%exports.colors.length]}(namespace),debug.destroy=destroy,"function"==typeof exports.init&&exports.init(debug),exports.instances.push(debug),debug}function destroy(){var index=exports.instances.indexOf(this);return-1!==index&&(exports.instances.splice(index,1),!0)}(exports=module.exports=createDebug.debug=createDebug.default=createDebug).coerce=function(val){return val instanceof Error?val.stack||val.message:val},exports.disable=function(){exports.enable("")},exports.enable=function(namespaces){var i;exports.save(namespaces),exports.names=[],exports.skips=[];var split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length;for(i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):exports.names.push(new RegExp("^"+namespaces+"$")));for(i=0;i<exports.instances.length;i++){var instance=exports.instances[i];instance.enabled=exports.enabled(instance.namespace)}},exports.enabled=function(name){if("*"===name[name.length-1])return!0;var i,len;for(i=0,len=exports.skips.length;i<len;i++)if(exports.skips[i].test(name))return!1;for(i=0,len=exports.names.length;i<len;i++)if(exports.names[i].test(name))return!0;return!1},exports.humanize=__webpack_require__(161),exports.instances=[],exports.names=[],exports.skips=[],exports.formatters={}},function(module,exports){var s=1e3,m=6e4,h=36e5,d=24*h;function plural(ms,n,name){if(!(ms<n))return ms<1.5*n?Math.floor(ms/n)+" "+name:Math.ceil(ms/n)+" "+name+"s"}module.exports=function(val,options){options=options||{};var type=typeof val;if("string"==type&&0<val.length)return function(str){if(100<(str=String(str)).length)return;var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);switch((match[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(val);if("number"==type&&!1===isNaN(val))return options.long?function(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}(val):function(ms){if(d<=ms)return Math.round(ms/d)+"d";if(h<=ms)return Math.round(ms/h)+"h";if(m<=ms)return Math.round(ms/m)+"m";if(s<=ms)return Math.round(ms/s)+"s";return ms+"ms"}(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},function(module,exports,__webpack_require__){module.exports=function(undefined){"use strict";var hex_chr=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function md5cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a+=(b&c|~b&d)+k[0]-680876936|0,d+=((a=(a<<7|a>>>25)+b|0)&b|~a&c)+k[1]-389564586|0,c+=((d=(d<<12|d>>>20)+a|0)&a|~d&b)+k[2]+606105819|0,b+=((c=(c<<17|c>>>15)+d|0)&d|~c&a)+k[3]-1044525330|0,a+=((b=(b<<22|b>>>10)+c|0)&c|~b&d)+k[4]-176418897|0,d+=((a=(a<<7|a>>>25)+b|0)&b|~a&c)+k[5]+1200080426|0,c+=((d=(d<<12|d>>>20)+a|0)&a|~d&b)+k[6]-1473231341|0,b+=((c=(c<<17|c>>>15)+d|0)&d|~c&a)+k[7]-45705983|0,a+=((b=(b<<22|b>>>10)+c|0)&c|~b&d)+k[8]+1770035416|0,d+=((a=(a<<7|a>>>25)+b|0)&b|~a&c)+k[9]-1958414417|0,c+=((d=(d<<12|d>>>20)+a|0)&a|~d&b)+k[10]-42063|0,b+=((c=(c<<17|c>>>15)+d|0)&d|~c&a)+k[11]-1990404162|0,a+=((b=(b<<22|b>>>10)+c|0)&c|~b&d)+k[12]+1804603682|0,d+=((a=(a<<7|a>>>25)+b|0)&b|~a&c)+k[13]-40341101|0,c+=((d=(d<<12|d>>>20)+a|0)&a|~d&b)+k[14]-1502002290|0,b+=((c=(c<<17|c>>>15)+d|0)&d|~c&a)+k[15]+1236535329|0,a+=((b=(b<<22|b>>>10)+c|0)&d|c&~d)+k[1]-165796510|0,d+=((a=(a<<5|a>>>27)+b|0)&c|b&~c)+k[6]-1069501632|0,c+=((d=(d<<9|d>>>23)+a|0)&b|a&~b)+k[11]+643717713|0,b+=((c=(c<<14|c>>>18)+d|0)&a|d&~a)+k[0]-373897302|0,a+=((b=(b<<20|b>>>12)+c|0)&d|c&~d)+k[5]-701558691|0,d+=((a=(a<<5|a>>>27)+b|0)&c|b&~c)+k[10]+38016083|0,c+=((d=(d<<9|d>>>23)+a|0)&b|a&~b)+k[15]-660478335|0,b+=((c=(c<<14|c>>>18)+d|0)&a|d&~a)+k[4]-405537848|0,a+=((b=(b<<20|b>>>12)+c|0)&d|c&~d)+k[9]+568446438|0,d+=((a=(a<<5|a>>>27)+b|0)&c|b&~c)+k[14]-1019803690|0,c+=((d=(d<<9|d>>>23)+a|0)&b|a&~b)+k[3]-187363961|0,b+=((c=(c<<14|c>>>18)+d|0)&a|d&~a)+k[8]+1163531501|0,a+=((b=(b<<20|b>>>12)+c|0)&d|c&~d)+k[13]-1444681467|0,d+=((a=(a<<5|a>>>27)+b|0)&c|b&~c)+k[2]-51403784|0,c+=((d=(d<<9|d>>>23)+a|0)&b|a&~b)+k[7]+1735328473|0,b+=((c=(c<<14|c>>>18)+d|0)&a|d&~a)+k[12]-1926607734|0,a+=((b=(b<<20|b>>>12)+c|0)^c^d)+k[5]-378558|0,d+=((a=(a<<4|a>>>28)+b|0)^b^c)+k[8]-2022574463|0,c+=((d=(d<<11|d>>>21)+a|0)^a^b)+k[11]+1839030562|0,b+=((c=(c<<16|c>>>16)+d|0)^d^a)+k[14]-35309556|0,a+=((b=(b<<23|b>>>9)+c|0)^c^d)+k[1]-1530992060|0,d+=((a=(a<<4|a>>>28)+b|0)^b^c)+k[4]+1272893353|0,c+=((d=(d<<11|d>>>21)+a|0)^a^b)+k[7]-155497632|0,b+=((c=(c<<16|c>>>16)+d|0)^d^a)+k[10]-1094730640|0,a+=((b=(b<<23|b>>>9)+c|0)^c^d)+k[13]+681279174|0,d+=((a=(a<<4|a>>>28)+b|0)^b^c)+k[0]-358537222|0,c+=((d=(d<<11|d>>>21)+a|0)^a^b)+k[3]-722521979|0,b+=((c=(c<<16|c>>>16)+d|0)^d^a)+k[6]+76029189|0,a+=((b=(b<<23|b>>>9)+c|0)^c^d)+k[9]-640364487|0,d+=((a=(a<<4|a>>>28)+b|0)^b^c)+k[12]-421815835|0,c+=((d=(d<<11|d>>>21)+a|0)^a^b)+k[15]+530742520|0,b+=((c=(c<<16|c>>>16)+d|0)^d^a)+k[2]-995338651|0,a+=(c^((b=(b<<23|b>>>9)+c|0)|~d))+k[0]-198630844|0,d+=(b^((a=(a<<6|a>>>26)+b|0)|~c))+k[7]+1126891415|0,c+=(a^((d=(d<<10|d>>>22)+a|0)|~b))+k[14]-1416354905|0,b+=(d^((c=(c<<15|c>>>17)+d|0)|~a))+k[5]-57434055|0,a+=(c^((b=(b<<21|b>>>11)+c|0)|~d))+k[12]+1700485571|0,d+=(b^((a=(a<<6|a>>>26)+b|0)|~c))+k[3]-1894986606|0,c+=(a^((d=(d<<10|d>>>22)+a|0)|~b))+k[10]-1051523|0,b+=(d^((c=(c<<15|c>>>17)+d|0)|~a))+k[1]-2054922799|0,a+=(c^((b=(b<<21|b>>>11)+c|0)|~d))+k[8]+1873313359|0,d+=(b^((a=(a<<6|a>>>26)+b|0)|~c))+k[15]-30611744|0,c+=(a^((d=(d<<10|d>>>22)+a|0)|~b))+k[6]-1560198380|0,b+=(d^((c=(c<<15|c>>>17)+d|0)|~a))+k[13]+1309151649|0,a+=(c^((b=(b<<21|b>>>11)+c|0)|~d))+k[4]-145523070|0,d+=(b^((a=(a<<6|a>>>26)+b|0)|~c))+k[11]-1120210379|0,c+=(a^((d=(d<<10|d>>>22)+a|0)|~b))+k[2]+718787259|0,b=((b+=(d^((c=(c<<15|c>>>17)+d|0)|~a))+k[9]-343485551|0)<<21|b>>>11)+c|0,x[0]=a+x[0]|0,x[1]=b+x[1]|0,x[2]=c+x[2]|0,x[3]=d+x[3]|0}function md5blk(s){var i,md5blks=[];for(i=0;i<64;i+=4)md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24);return md5blks}function md5blk_array(a){var i,md5blks=[];for(i=0;i<64;i+=4)md5blks[i>>2]=a[i]+(a[i+1]<<8)+(a[i+2]<<16)+(a[i+3]<<24);return md5blks}function md51(s){var i,length,tail,tmp,lo,hi,n=s.length,state=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=n;i+=64)md5cycle(state,md5blk(s.substring(i-64,i)));for(s=s.substring(i-64),length=s.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<length;i+=1)tail[i>>2]|=s.charCodeAt(i)<<(i%4<<3);if(tail[i>>2]|=128<<(i%4<<3),55<i)for(md5cycle(state,tail),i=0;i<16;i+=1)tail[i]=0;return tmp=(tmp=8*n).toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(state,tail),state}function rhex(n){var j,s="";for(j=0;j<4;j+=1)s+=hex_chr[n>>8*j+4&15]+hex_chr[n>>8*j&15];return s}function hex(x){var i;for(i=0;i<x.length;i+=1)x[i]=rhex(x[i]);return x.join("")}function toUtf8(str){return/[\u0080-\uFFFF]/.test(str)&&(str=unescape(encodeURIComponent(str))),str}function hexToBinaryString(hex){var x,bytes=[],length=hex.length;for(x=0;x<length-1;x+=2)bytes.push(parseInt(hex.substr(x,2),16));return String.fromCharCode.apply(String,bytes)}function SparkMD5(){this.reset()}return"5d41402abc4b2a76b9719d911017c592"!==hex(md51("hello"))&&function(x,y){var lsw=(65535&x)+(65535&y),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|65535&lsw},"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function clamp(val,length){return(val=0|val||0)<0?Math.max(val+length,0):Math.min(val,length)}ArrayBuffer.prototype.slice=function(from,to){var num,target,targetArray,sourceArray,length=this.byteLength,begin=clamp(from,length),end=length;return to!==undefined&&(end=clamp(to,length)),end<begin?new ArrayBuffer(0):(num=end-begin,target=new ArrayBuffer(num),targetArray=new Uint8Array(target),sourceArray=new Uint8Array(this,begin,num),targetArray.set(sourceArray),target)}}(),SparkMD5.prototype.append=function(str){return this.appendBinary(toUtf8(str)),this},SparkMD5.prototype.appendBinary=function(contents){this._buff+=contents,this._length+=contents.length;var i,length=this._buff.length;for(i=64;i<=length;i+=64)md5cycle(this._hash,md5blk(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},SparkMD5.prototype.end=function(raw){var i,ret,buff=this._buff,length=buff.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<length;i+=1)tail[i>>2]|=buff.charCodeAt(i)<<(i%4<<3);return this._finish(tail,length),ret=hex(this._hash),raw&&(ret=hexToBinaryString(ret)),this.reset(),ret},SparkMD5.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},SparkMD5.prototype.setState=function(state){return this._buff=state.buff,this._length=state.length,this._hash=state.hash,this},SparkMD5.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},SparkMD5.prototype._finish=function(tail,length){var tmp,lo,hi,i=length;if(tail[i>>2]|=128<<(i%4<<3),55<i)for(md5cycle(this._hash,tail),i=0;i<16;i+=1)tail[i]=0;tmp=(tmp=8*this._length).toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(this._hash,tail)},SparkMD5.hash=function(str,raw){return SparkMD5.hashBinary(toUtf8(str),raw)},SparkMD5.hashBinary=function(content,raw){var ret=hex(md51(content));return raw?hexToBinaryString(ret):ret},(SparkMD5.ArrayBuffer=function(){this.reset()}).prototype.append=function(arr){var i,buff=function(first,second,returnUInt8Array){var result=new Uint8Array(first.byteLength+second.byteLength);return result.set(new Uint8Array(first)),result.set(new Uint8Array(second),first.byteLength),returnUInt8Array?result:result.buffer}(this._buff.buffer,arr,!0),length=buff.length;for(this._length+=arr.byteLength,i=64;i<=length;i+=64)md5cycle(this._hash,md5blk_array(buff.subarray(i-64,i)));return this._buff=i-64<length?new Uint8Array(buff.buffer.slice(i-64)):new Uint8Array(0),this},SparkMD5.ArrayBuffer.prototype.end=function(raw){var i,ret,buff=this._buff,length=buff.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<length;i+=1)tail[i>>2]|=buff[i]<<(i%4<<3);return this._finish(tail,length),ret=hex(this._hash),raw&&(ret=hexToBinaryString(ret)),this.reset(),ret},SparkMD5.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},SparkMD5.ArrayBuffer.prototype.getState=function(){var state=SparkMD5.prototype.getState.call(this);return state.buff=function(buff){return String.fromCharCode.apply(null,new Uint8Array(buff))}(state.buff),state},SparkMD5.ArrayBuffer.prototype.setState=function(state){return state.buff=function(str,returnUInt8Array){var i,length=str.length,buff=new ArrayBuffer(length),arr=new Uint8Array(buff);for(i=0;i<length;i+=1)arr[i]=str.charCodeAt(i);return returnUInt8Array?arr:buff}(state.buff,!0),SparkMD5.prototype.setState.call(this,state)},SparkMD5.ArrayBuffer.prototype.destroy=SparkMD5.prototype.destroy,SparkMD5.ArrayBuffer.prototype._finish=SparkMD5.prototype._finish,SparkMD5.ArrayBuffer.hash=function(arr,raw){var ret=hex(function(a){var i,length,tail,tmp,lo,hi,n=a.length,state=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=n;i+=64)md5cycle(state,md5blk_array(a.subarray(i-64,i)));for(a=i-64<n?a.subarray(i-64):new Uint8Array(0),length=a.length,tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<length;i+=1)tail[i>>2]|=a[i]<<(i%4<<3);if(tail[i>>2]|=128<<(i%4<<3),55<i)for(md5cycle(state,tail),i=0;i<16;i+=1)tail[i]=0;return tmp=(tmp=8*n).toString(16).match(/(.*?)(.{0,8})$/),lo=parseInt(tmp[2],16),hi=parseInt(tmp[1],16)||0,tail[14]=lo,tail[15]=hi,md5cycle(state,tail),state}(new Uint8Array(arr)));return raw?hexToBinaryString(ret):ret},SparkMD5}()},function(module,exports,__webpack_require__){"use strict";function pop(obj,stack,metaStack){var lastMetaElement=metaStack[metaStack.length-1];obj===lastMetaElement.element&&(metaStack.pop(),lastMetaElement=metaStack[metaStack.length-1]);var element=lastMetaElement.element,lastElementIndex=lastMetaElement.index;if(Array.isArray(element))element.push(obj);else if(lastElementIndex===stack.length-2){element[stack.pop()]=obj}else stack.push(obj)}exports.stringify=function(input){var queue=[];queue.push({obj:input});for(var next,obj,val,i,arrayPrefix,keys,k,key,value,objPrefix,res="";next=queue.pop();)if(obj=next.obj,res+=next.prefix||"",val=next.val||"")res+=val;else if("object"!=typeof obj)res+=void 0===obj?null:JSON.stringify(obj);else if(null===obj)res+="null";else if(Array.isArray(obj)){for(queue.push({val:"]"}),i=obj.length-1;0<=i;i--)arrayPrefix=0===i?"":",",queue.push({obj:obj[i],prefix:arrayPrefix});queue.push({val:"["})}else{for(k in keys=[],obj)obj.hasOwnProperty(k)&&keys.push(k);for(queue.push({val:"}"}),i=keys.length-1;0<=i;i--)value=obj[key=keys[i]],objPrefix=0<i?",":"",objPrefix+=JSON.stringify(key)+":",queue.push({obj:value,prefix:objPrefix});queue.push({val:"{"})}return res},exports.parse=function(str){for(var collationIndex,parsedNum,numChar,parsedString,lastCh,numConsecutiveSlashes,ch,arrayElement,objElement,stack=[],metaStack=[],i=0;;)if("}"!==(collationIndex=str[i++])&&"]"!==collationIndex&&void 0!==collationIndex)switch(collationIndex){case" ":case"\t":case"\n":case":":case",":break;case"n":i+=3,pop(null,stack,metaStack);break;case"t":i+=3,pop(!0,stack,metaStack);break;case"f":i+=4,pop(!1,stack,metaStack);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(parsedNum="",i--;;){if(numChar=str[i++],!/[\d\.\-e\+]/.test(numChar)){i--;break}parsedNum+=numChar}pop(parseFloat(parsedNum),stack,metaStack);break;case'"':for(parsedString="",lastCh=void 0,numConsecutiveSlashes=0;'"'!==(ch=str[i++])||"\\"===lastCh&&numConsecutiveSlashes%2==1;)parsedString+=ch,"\\"===(lastCh=ch)?numConsecutiveSlashes++:numConsecutiveSlashes=0;pop(JSON.parse('"'+parsedString+'"'),stack,metaStack);break;case"[":arrayElement={element:[],index:stack.length},stack.push(arrayElement.element),metaStack.push(arrayElement);break;case"{":objElement={element:{},index:stack.length},stack.push(objElement.element),metaStack.push(objElement);break;default:throw new Error("unexpectedly reached end of input: "+collationIndex)}else{if(1===stack.length)return stack.pop();pop(stack.pop(),stack,metaStack)}}},function(module,exports,__webpack_require__){"use strict";var Promise=__webpack_require__(58);module.exports={alert:function(content){return window.alert(content),Promise.resolve()},confirm:function(content){return new Promise(function(resolve,reject){window.confirm(content)?resolve():reject()})},prompt:function(content,def){return new Promise(function(resolve,reject){var value=window.prompt(content,def);value?resolve(value):reject()})}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";(function(global){var FormModel,Nodeset,MergeXML=__webpack_require__(416),utils=__webpack_require__(38),$=__webpack_require__(2),Promise=__webpack_require__(58),FormLogicError=__webpack_require__(417),config=__webpack_require__(71),types=__webpack_require__(132),INSTANCE=/instance\(\s*(["'])((?:(?!\1)[A-z0-9.\-_]+))\1\s*\)/g,OPENROSA=/(decimal-date-time\(|pow\(|indexed-repeat\(|format-date\(|coalesce\(|join\(|max\(|min\(|random\(|substr\(|int\(|uuid\(|regex\(|now\(|today\(|date\(|if\(|boolean-from-string\(|checklist\(|selected\(|selected-at\(|round\(|area\(|position\([^)])/,OPENROSA_XFORMS_NS="http://openrosa.org/xforms",JAVAROSA_XFORMS_NS="http://openrosa.org/javarosa",ENKETO_XFORMS_NS="http://enketo.org/xforms";__webpack_require__(133),((FormModel=function(data,options){"string"==typeof data&&(data={modelStr:data}),data.external=data.external||[],data.submitted=void 0===data.submitted||data.submitted,(options=options||{}).full=void 0===options.full||options.full,this.$events=$("<div/>"),this.convertedExpressions={},this.templates={},this.loadErrors=[],this.data=data,this.options=options,this.namespaces={}}).prototype={get version(){return this.evaluate("/node()/@version","string",null,null,!0)},get instanceID(){return this.getMetaNode("instanceID").getVal()[0]},get deprecatedID(){return this.getMetaNode("deprecatedID").getVal()[0]||""},get instanceName(){return this.getMetaNode("instanceName").getVal()[0]}}).init=function(){var id,i,instanceDoc,secondaryInstanceChildren,that=this;this.data.modelStr=this.data.modelStr.replace(/\s(xmlns=("|')[^\s>]+("|'))/g," data-$1"),this.options.full||(this.data.modelStr=this.data.modelStr.replace(/^(<model\s*><instance((?!<instance).)+<\/instance\s*>\s*)(<instance.+<\/instance\s*>)*/,"$1"));try{id="model",this.xml=$.parseXML(this.data.modelStr),this.data.external.forEach(function(instance){for(id='instance "'+instance.id+'"'||!1,instanceDoc=that.getSecondaryInstance(instance.id),secondaryInstanceChildren=instanceDoc.childNodes,i=secondaryInstanceChildren.length-1;0<=i;i--)instanceDoc.removeChild(secondaryInstanceChildren[i]);instanceDoc.appendChild($.parseXML(instance.xmlStr).firstChild)}),this.createSession("__session",this.data.session)}catch(e){console.error("parseXML error"),this.loadErrors.push("Error trying to parse XML "+id+". "+e.message)}if(this.xml){try{this.$=$(this.xml),this.hasInstance=!!this.xml.querySelector("model > instance"),this.rootElement=this.xml.querySelector("instance > *")||this.xml.documentElement,this.setNamespaces(),this.getMetaNode("instanceID").get().get(0)||that.loadErrors.push("Invalid primary instance. Missing instanceID node."),this.$.find("model > instance[src]:empty").each(function(index,instance){that.loadErrors.push('External instance "'+$(instance).attr("id")+'" is empty.')}),this.trimValues(),this.extractTemplates()}catch(e){console.error(e),this.loadErrors.push(e.name+": "+e.message)}try{id="record",this.data.instanceStr&&this.mergeXml(this.data.instanceStr),this.setInstanceIdAndDeprecatedId()}catch(e){console.error(e),this.loadErrors.push("Error trying to parse XML "+id+". "+e.message)}}return this.loadErrors},FormModel.prototype.createSession=function(id,sessObj){var instance,session,model=this.xml.querySelector("model"),fixedProps=["deviceid","username","email","phonenumber","simserial","subscriberid"];model&&(sessObj="object"==typeof sessObj?sessObj:{},(instance=model.querySelector('instance[id="'+id+'"]'))||(instance=$.parseXML('<instance id="'+id+'"/>').documentElement,this.xml.adoptNode(instance),model.appendChild(instance)),fixedProps.forEach(function(prop){sessObj[prop]=sessObj[prop]||utils.readCookie("__enketo_meta_"+prop)||prop+" not found"}),session=$.parseXML("<session><context>"+fixedProps.map(function(prop){return"<"+prop+">"+sessObj[prop]+"</"+prop+">"}).join("")+"</context></session>").documentElement,this.xml.adoptNode(session),instance.appendChild(session))},FormModel.prototype.getSecondaryInstance=function(id){var instanceEl;return[].slice.call(this.xml.querySelectorAll("model > instance")).some(function(el){return el.getAttribute("id")===id&&(instanceEl=el,!0)}),instanceEl},FormModel.prototype.node=function(selector,index,filter){return new Nodeset(selector,index,filter,this)},FormModel.prototype.importNode=function(node,allChildren){var i,il;switch(node.nodeType){case document.ELEMENT_NODE:var newNode=document.createElementNS(node.namespaceURI,node.nodeName);if(node.attributes&&0<node.attributes.length)for(i=0,il=node.attributes.length;i<il;i++){var attr=node.attributes[i];attr.namespaceURI?newNode.setAttributeNS(attr.namespaceURI,attr.nodeName,node.getAttributeNS(attr.namespaceURI,attr.localName)):newNode.setAttribute(attr.nodeName,node.getAttribute(attr.nodeName))}if(allChildren&&node.childNodes&&0<node.childNodes.length)for(i=0,il=node.childNodes.length;i<il;i++)newNode.appendChild(this.importNode(node.childNodes[i],allChildren));return newNode;case document.TEXT_NODE:case document.CDATA_SECTION_NODE:case document.COMMENT_NODE:return document.createTextNode(node.nodeValue)}},FormModel.prototype.mergeXml=function(recordStr){var modelInstanceChildStr,merger,modelInstanceEl,modelInstanceChildEl,mergeResultDoc,templateEls,record,$record,that=this;if(recordStr){if(modelInstanceEl=this.xml.querySelector("instance"),!(modelInstanceChildEl=this.xml.querySelector("instance > *")))throw new Error("Model is corrupt. It does not contain a childnode of instance");recordStr=(recordStr=recordStr.replace(/\s(xmlns=("|')[^\s>]+("|'))/g,"")).replace(/<!--[^>]*-->/g,""),record=$.parseXML(recordStr),$record=$(record),templateEls=record.querySelectorAll("[*|template]");for(var i=0;i<templateEls.length;i++)$(templateEls[i]).remove();if($record.find("*").each(function(){var path,positionedPath,repeatParts,repeatIndex=0;try{path=that.getXPath(this,"instance",!1),(void 0!==that.templates[path]||0<that.getRepeatIndex(this))&&(positionedPath=that.getXPath(this,"instance",!0),that.evaluate(positionedPath,"node",null,null,!0)||((repeatParts=positionedPath.match(/([^[]+)\[(\d+)\]\//g))&&0<repeatParts.length&&(repeatIndex=repeatParts[repeatParts.length-1].match(/\[(\d+)\]/)[1]-1),that.addRepeat(path,repeatIndex,!0)))}catch(e){console.log("Ignored error:",e)}}),$record.find("*").filter(function(){var val=this.textContent;return 0===this.childNodes.length&&0===val.trim().length}).each(function(){var path=that.getXPath(this,"instance",!0),instanceNode=that.node(path,0).get()[0];instanceNode&&(0===$(instanceNode).children().length?instanceNode.textContent="":that.evaluate(".//*[not(*)]","nodes",path,0,!0).forEach(function(node){node.textContent=""}))}),merger=new MergeXML({join:!1}),modelInstanceChildStr=(new XMLSerializer).serializeToString(modelInstanceChildEl),recordStr=(new XMLSerializer).serializeToString(record),merger.AddSource(modelInstanceChildStr),merger.AddSource(recordStr),merger.error.code)throw new Error(merger.error.text);mergeResultDoc=$.parseXML(merger.Get(1)),this.xml.querySelector("instance").removeChild(modelInstanceChildEl),modelInstanceChildEl=0<=global.navigator.userAgent.indexOf("Trident/")?this.importNode(mergeResultDoc.documentElement,!0):this.xml.adoptNode(mergeResultDoc.documentElement,!0),modelInstanceEl.appendChild(modelInstanceChildEl),this.rootElement=modelInstanceChildEl}},FormModel.prototype.getXPath=function(node,rootNodeName,includePosition){var index,steps=[],position="",nodeName=node.nodeName,parent=node.parentNode,parentName=parent.nodeName;for(rootNodeName=rootNodeName||"#document",(includePosition=includePosition||!1)&&0<(index=this.getRepeatIndex(node))&&(position="["+(index+1)+"]"),steps.push(nodeName+position);parent&&parentName!==rootNodeName&&"#document"!==parentName;)includePosition&&(position=0<(index=this.getRepeatIndex(parent))?"["+(index+1)+"]":""),steps.push(parentName+position),parentName=(parent=parent.parentNode).nodeName;return"/"+steps.reverse().join("/")},FormModel.prototype.getRepeatIndex=function(node){for(var index=0,nodeName=node.nodeName,prevSibling=node.previousSibling;prevSibling;)prevSibling.nodeName&&prevSibling.nodeName===nodeName&&index++,prevSibling=prevSibling.previousSibling;return index},FormModel.prototype.trimValues=function(){this.node(null,null,{noEmpty:!0}).get().each(function(){this.textContent=this.textContent.trim()})},FormModel.prototype.setInstanceIdAndDeprecatedId=function(){var instanceIdObj,instanceIdEl,deprecatedIdEl,instanceIdExistingVal;instanceIdEl=(instanceIdObj=this.getMetaNode("instanceID")).get().get(0),instanceIdExistingVal=instanceIdObj.getVal()[0],this.data.instanceStr&&this.data.submitted&&(deprecatedIdEl=this.getMetaNode("deprecatedID").get().get(0),instanceIdEl.textContent="",deprecatedIdEl||(deprecatedIdEl=$.parseXML("<deprecatedID/>").documentElement,this.xml.adoptNode(deprecatedIdEl),this.xml.querySelector("* > meta").appendChild(deprecatedIdEl))),instanceIdObj.getVal()[0]||instanceIdObj.setVal(this.evaluate('concat("uuid:", uuid())',"string")),deprecatedIdEl&&this.getMetaNode("deprecatedID").setVal(instanceIdExistingVal)},FormModel.prototype.bindJsEvaluator=__webpack_require__(418),FormModel.prototype.getMetaNode=function(localName){var orPrefix=this.getNamespacePrefix(OPENROSA_XFORMS_NS),n=this.node("/*/"+orPrefix+":meta/"+orPrefix+":"+localName);return 0===n.get().length&&(n=this.node("/*/meta/"+localName)),n},FormModel.prototype.getRepeatCommentText=function(path){return"repeat:/"+(path=path.trim())},FormModel.prototype.getRepeatCommentEl=function(repeatPath,repeatSeriesIndex){var xPath='//comment()[self::comment()="'+this.getRepeatCommentText(repeatPath)+'"]';return this.evaluate(xPath,"nodes",null,null,!0)[repeatSeriesIndex]},FormModel.prototype.addRepeat=function(repeatPath,repeatSeriesIndex,merge){var $insertAfterNode,$templateClone,repeatSeries,template,that=this;this.templates[repeatPath]||this.extractFakeTemplates([repeatPath]),template=this.templates[repeatPath],$insertAfterNode=(repeatSeries=this.getRepeatSeries(repeatPath,repeatSeriesIndex)).length?$(repeatSeries[repeatSeries.length-1]):$(this.getRepeatCommentEl(repeatPath,repeatSeriesIndex)),merge||repeatSeries.forEach(function(el){that.addOrdinalAttribute(el,repeatSeries[0])}),template&&1===$insertAfterNode.length?($templateClone=$(template).clone().insertAfter($insertAfterNode),this.removeOrdinalAttributes($templateClone[0]),merge||this.addOrdinalAttribute($templateClone[0],repeatSeries[0]),merge&&$templateClone.find("*").filter(function(){return 0===$(this).children().length}).text("")):console.error("Could not find template node and/or node to insert the clone after")},FormModel.prototype.addOrdinalAttribute=function(repeat,firstRepeatInSeries){var lastUsedOrdinal,newOrdinal,enkNs=this.getNamespacePrefix(ENKETO_XFORMS_NS);firstRepeatInSeries=firstRepeatInSeries||repeat,!0!==config.repeatOrdinals||repeat.getAttributeNS(ENKETO_XFORMS_NS,"ordinal")||(lastUsedOrdinal=firstRepeatInSeries.getAttributeNS(ENKETO_XFORMS_NS,"last-used-ordinal")||0,newOrdinal=Number(lastUsedOrdinal)+1,firstRepeatInSeries.setAttributeNS(ENKETO_XFORMS_NS,enkNs+":last-used-ordinal",newOrdinal),repeat.setAttributeNS(ENKETO_XFORMS_NS,enkNs+":ordinal",newOrdinal))},FormModel.prototype.removeOrdinalAttributes=function(el){if(!0===config.repeatOrdinals){var repeats=Array.prototype.slice.call(el.querySelectorAll("[*|ordinal]"));repeats.push(el);for(var i=0;i<repeats.length;i++)repeats[i].removeAttributeNS(ENKETO_XFORMS_NS,"last-used-ordinal"),repeats[i].removeAttributeNS(ENKETO_XFORMS_NS,"ordinal")}},FormModel.prototype.getRepeatSeries=function(repeatPath,repeatSeriesIndex){var pathSegments,nodeName,checkEl,repeatCommentEl=this.getRepeatCommentEl(repeatPath,repeatSeriesIndex),result=[];if(repeatCommentEl)for(nodeName=(pathSegments=repeatCommentEl.textContent.substr("repeat:/".length).split("/"))[pathSegments.length-1],checkEl=repeatCommentEl.nextSibling;checkEl;)checkEl.nodeName&&checkEl.nodeName===nodeName&&result.push(checkEl),checkEl=checkEl.nextSibling;return result},FormModel.prototype.hasPreviousSiblingElementSameName=function(el){var found=!1,nodeName=el.nodeName;for(el=el.previousSibling;el;){if(el.nodeName&&el.nodeName===nodeName){found=!0;break}el=el.previousSibling}return found},FormModel.prototype.hasPreviousCommentSiblingWithContent=function(node,content){var found=!1;for(node=node.previousSibling;node;){if(node.nodeType===Node.COMMENT_NODE&&node.textContent===content){found=!0;break}node=node.previousSibling}return found},FormModel.prototype.determineIndex=function($node){var nodeName,path,$family,that=this;return 1===$node.length?(nodeName=$node.prop("nodeName"),path=this.getXPath($node.get(0),"instance"),1===($family=this.$.find(nodeName.replace(/\./g,"\\.")).filter(function(){return path===that.getXPath(this,"instance")})).length?null:$family.index($node)):(console.error("no node, or multiple nodes, provided to determineIndex function"),-1)},FormModel.prototype.extractTemplates=function(){var that=this;this.getTemplateNodes().reverse().forEach(function(templateEl){var xPath=that.getXPath(templateEl,"instance");that.addTemplate(xPath,templateEl),$(templateEl).remove()})},FormModel.prototype.extractFakeTemplates=function(repeatPaths){var repeat,that=this;repeatPaths.forEach(function(repeatPath){(repeat=that.evaluate(repeatPath,"node",null,null,!0))&&that.addTemplate(repeatPath,repeat,!0)})},FormModel.prototype.addRepeatComments=function(repeatPath){var comment=this.getRepeatCommentText(repeatPath),that=this;this.evaluate(repeatPath,"nodes",null,null,!0).forEach(function(repeat){that.hasPreviousSiblingElementSameName(repeat)||that.hasPreviousCommentSiblingWithContent(repeat,comment)||$(repeat).before(document.createComment(comment))})},FormModel.prototype.addTemplate=function(repeatPath,repeat,empty){var $clone;this.addRepeatComments(repeatPath),this.templates[repeatPath]||($clone=$(repeat).clone().removeAttr("template").removeAttr("jr:template"),empty&&$clone.find("*").filter(function(){return 0===$(this).children().length}).text(""),this.templates[repeatPath]=$clone[0])},FormModel.prototype.getTemplateNodes=function(){var jrPrefix=this.getNamespacePrefix(JAVAROSA_XFORMS_NS);return this.evaluate("/model/instance[1]/*//*[@template] | /model/instance[1]/*//*[@"+jrPrefix+":template]","nodes",null,null,!1)},FormModel.prototype.getStr=function(){var dataStr=(new XMLSerializer).serializeToString(this.xml.querySelector("instance > *")||this.xml.documentElement,"text/xml");return dataStr=(dataStr=dataStr.replace(/\s(data-)(xmlns=("|')[^\s>]+("|'))/g," $2")).replace(new RegExp("\x3c!--repeat:/\\/[^>]+--\x3e","g"),""),-1===navigator.userAgent.indexOf("Trident/")&&(dataStr=this.removeDuplicateEnketoNsDeclarations(dataStr)),dataStr},FormModel.prototype.removeDuplicateEnketoNsDeclarations=function(xmlStr){var i=0,declarationExp=new RegExp("( xmlns:"+this.getNamespacePrefix(ENKETO_XFORMS_NS)+'="'+ENKETO_XFORMS_NS+'")',"g");return xmlStr.replace(declarationExp,function(match){return 1<++i?"":match})},FormModel.prototype.makeBugCompliant=function(expr,selector,index){var i,parentSelector,parentIndex,$target,$node,nodeName,$siblings,$parents;for(i=($parents=($target=this.node(selector,index).get()).parents().add($target)).length-1;0<=i;i--)nodeName=($node=$parents.eq(i)).prop("nodeName").replace(/\./g,"\\."),$siblings=$node.siblings(nodeName).not("[template]"),"instance"!==nodeName.toLowerCase()&&"model"!==nodeName.toLowerCase()&&0<$siblings.length&&(parentSelector=this.getXPath($node.get(0),"instance"),parentIndex=$siblings.add($node).index($node),expr=expr.replace(new RegExp(parentSelector+"/","g"),parentSelector+"["+(parentIndex+1)+"]/"));return expr},FormModel.prototype.setNamespaces=function(){var prefix,start=this.hasInstance?"/model/instance":"",nodes=this.evaluate(start+"/*","nodes",null,null,!0),that=this;nodes.forEach(function(node){if(node.hasAttributes())for(var i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];0===attribute.name.indexOf("xmlns:")&&(that.namespaces[attribute.name.substring(6)]=attribute.value)}[["orx",OPENROSA_XFORMS_NS,!1],["jr",JAVAROSA_XFORMS_NS,!1],["enk",ENKETO_XFORMS_NS,!0===config.repeatOrdinals]].forEach(function(arr){that.getNamespacePrefix(arr[1])||(prefix=that.namespaces[arr[0]]?"__"+arr[0]:arr[0],that.namespaces[prefix]=arr[1],arr[2]&&node.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:"+prefix,arr[1]))})})},FormModel.prototype.getNamespacePrefix=function(namespace){var p;for(var prefix in this.namespaces)if(this.namespaces.hasOwnProperty(prefix)&&this.namespaces[prefix]===namespace){p=prefix;break}return p},FormModel.prototype.getNsResolver=function(){var namespaces=void 0===this.namespaces?{}:this.namespaces;return{lookupNamespaceURI:function(prefix){return namespaces[prefix]||null}}},FormModel.prototype.shiftRoot=function(expr){var LITERALS=/"([^"]*)(")|'([^']*)(')/g;return this.hasInstance&&(expr=(expr=(expr=(expr=expr.replace(LITERALS,function(m,p1,p2,p3,p4){var quote=p2||p4;return quote+(void 0!==p1?encodeURIComponent(p1):encodeURIComponent(p3))+quote})).replace(/^(\/(?!model\/)[^/][^/\s,"']*\/)/g,"/model/instance[1]$1")).replace(/([^a-zA-Z0-9.\])/*_-])(\/(?!model\/)[^/][^/\s,"']*\/)/g,"$1/model/instance[1]$2")).replace(LITERALS,function(m,p1,p2,p3,p4){var quote=p2||p4;return quote+(void 0!==p1?decodeURIComponent(p1):decodeURIComponent(p3))+quote})),expr},FormModel.prototype.replaceInstanceFn=function(expr){var prefix,that=this;return expr.replace(INSTANCE,function(match,quote,id){if(prefix='/model/instance[@id="'+id+'"]',that.evaluate(prefix,"nodes",null,null,!0).length)return prefix;throw new FormLogicError('instance "'+id+'" does not exist in model')})},FormModel.prototype.replaceCurrentFn=function(expr,contextSelector){return expr=(expr=expr.replace("current()/.",contextSelector+"/.")).replace("current()/","/")},FormModel.prototype.replaceIndexedRepeatFn=function(expr,selector,index){var that=this,indexedRepeats=utils.parseFunctionFromExpression(expr,"indexed-repeat");return indexedRepeats.length&&indexedRepeats.forEach(function(indexedRepeat){var i,positionedPath,position,params=indexedRepeat[1];if(params.length%2!=1)throw new FormLogicError("indexed repeat with incorrect number of parameters found: "+indexedRepeat[0]);for(positionedPath=params[0],i=params.length-1;1<i;i-=2)position=isNaN(params[i])?that.evaluate(params[i],"number",selector,index,!0):params[i],positionedPath=positionedPath.replace(params[i-1],params[i-1]+"[position() = "+position+"]");expr=expr.replace(indexedRepeat[0],positionedPath)}),expr},FormModel.prototype.replacePullDataFn=function(expr,selector,index){var pullDataResult,replacements=this.convertPullDataFn(expr,selector,index);for(var pullData in replacements)replacements.hasOwnProperty(pullData)&&(pullDataResult=this.evaluate(replacements[pullData],"string",selector,index,!0),expr=expr.replace(pullData,'"'+pullDataResult+'"'));return expr},FormModel.prototype.convertPullDataFn=function(expr,selector,index){var that=this,pullDatas=utils.parseFunctionFromExpression(expr,"pulldata"),replacements={};return pullDatas.length&&pullDatas.forEach(function(pullData){var searchValue,searchXPath,params=pullData[1];if(4!==params.length)throw new FormLogicError("pulldata with incorrect number of parameters found: "+pullData[0]);params[1]=utils.stripQuotes(params[1]),params[2]=utils.stripQuotes(params[2]),searchValue=""===(searchValue=that.evaluate(params[3],"string",selector,index,!0))||isNaN(searchValue)?"'"+searchValue+"'":searchValue,searchXPath="instance("+params[0]+")/root/item["+params[2]+" = "+searchValue+"]/"+params[1],replacements[pullData[0]]=searchXPath}),replacements},FormModel.prototype.evaluate=function(expr,resTypeStr,selector,index,tryNative){var j,context,doc,resTypeNum,resultTypes,result,$collection,response,repeats,cacheKey,original,cacheable;for(resTypeNum in original=expr,tryNative=tryNative||!1,resTypeStr=resTypeStr||"any",index=index||0,doc=this.xml,repeats=null,context=selector?(repeats=($collection=this.node(selector).get()).length,$collection.eq(index)[0]):this.rootElement,cacheKey=[expr,selector,index,repeats].join("|"),expr=this.replaceIndexedRepeatFn(expr,selector,index),cacheable=original===(expr=this.replacePullDataFn(expr,selector,index)),this.convertedExpressions[cacheKey]?expr=this.convertedExpressions[cacheKey]:(expr=expr.trim(),expr=this.replaceInstanceFn(expr),expr=this.replaceCurrentFn(expr,this.getXPath(context,"instance",!0)),expr=this.shiftRoot(expr),repeats&&1<repeats&&(expr=this.makeBugCompliant(expr,selector,index)),expr=(expr=(expr=expr.replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"'),cacheable&&(this.convertedExpressions[cacheKey]=expr)),resultTypes={0:["any","ANY_TYPE"],1:["number","NUMBER_TYPE","numberValue"],2:["string","STRING_TYPE","stringValue"],3:["boolean","BOOLEAN_TYPE","booleanValue"],7:["nodes","ORDERED_NODE_SNAPSHOT_TYPE"],9:["node","FIRST_ORDERED_NODE_TYPE","singleNodeValue"]})if(resultTypes.hasOwnProperty(resTypeNum)){if(resultTypes[resTypeNum=Number(resTypeNum)][0]===resTypeStr)break;resTypeNum=0}if(tryNative&&void 0!==doc.evaluate&&!OPENROSA.test(expr))try{result=doc.evaluate(expr,context,this.getNsResolver(),resTypeNum,null)}catch(e){console.log("%cWell native XPath evaluation did not work... No worries, worth a shot, the expression probably contained unknown OpenRosa functions or errors:","color:orange",expr)}if(!result)try{void 0===doc.jsEvaluate&&this.bindJsEvaluator(),result=doc.jsEvaluate(expr,context,this.getNsResolver(),resTypeNum,null)}catch(e){throw new FormLogicError("Could not evaluate: "+expr+", message: "+e.message)}if(result){if(0===resTypeNum){for(resTypeNum in resultTypes)if(resultTypes.hasOwnProperty(resTypeNum)&&(resTypeNum=Number(resTypeNum))===Number(result.resultType)&&0<resTypeNum&&resTypeNum<4){response=result[resultTypes[resTypeNum][2]];break}console.error("Expression: "+expr+" did not return any boolean, string or number value as expected")}else if(7===resTypeNum)for(response=[],j=0;j<result.snapshotLength;j++)response.push(result.snapshotItem(j));else response=result[resultTypes[resTypeNum][2]];return response}},(Nodeset=function(selector,index,filter,model){var defaultSelector=model.hasInstance?"/model/instance[1]//*":"//*";this.model=model,this.originalSelector=selector,this.selector="string"==typeof selector&&0<selector.length?selector:defaultSelector,filter=null!=filter?filter:{},this.filter=filter,this.filter.onlyLeaf=void 0!==filter.onlyLeaf&&filter.onlyLeaf,this.filter.noEmpty=void 0!==filter.noEmpty&&filter.noEmpty,this.index=index}).prototype.get=function(){var $nodes,val;return this.nodes||(this.nodes=this.model.evaluate(this.selector,"nodes",null,null,!0)),$nodes=!0===this.filter.noEmpty?$(this.nodes).filter(function(){var $node=$(this);return val=$node.text(),0===$node.children().length&&0<val.trim().length}):!0===this.filter.onlyLeaf?$(this.nodes).filter(function(){return 0===$(this).children().length}):$(this.nodes),void 0!==this.index&&null!==this.index?$nodes.eq(this.index):$nodes},Nodeset.prototype.setIndex=function(index){this.index=index},Nodeset.prototype.setVal=function(newVals,constraintExpr,xmlDataType,requiredExpr,noValidate){var $target,curVal,newVal,updated,customData;return curVal=this.getVal()[0],newVal=null!=newVals?Array.isArray(newVals)?newVals.join(" "):newVals.toString():"",newVal=this.convert(newVal,xmlDataType),1===($target=this.get()).length&&newVal.toString().trim()!==curVal.toString().trim()?($target.text(newVal.toString()),(updated=this.getClosestRepeat()).nodes=[$target.prop("nodeName")],updated=(customData=this.model.getUpdateEventData($target.get(0),xmlDataType))?$.extend({},updated,customData):updated,this.model.$events.trigger("dataupdate",updated),config.validateContinuously&&!0!==noValidate&&this.validate(constraintExpr,requiredExpr,xmlDataType),"binary"===xmlDataType&&(0<newVal.length?$target.attr("type","file"):$target.removeAttr("type")),updated):(1<$target.length?console.error("nodeset.setVal expected nodeset with one node, but received multiple"):0===$target.length&&console.log("Data node: "+this.selector+" with null-based index: "+this.index+" not found. Ignored."),null)},Nodeset.prototype.getVal=function(){var vals=[];return this.get().each(function(){vals.push($(this).text())}),vals},Nodeset.prototype.getClosestRepeat=function(){for(var el=this.get().get(0),nodeName=el.nodeName;!("instance"===nodeName||el.nextSibling&&el.nextSibling.nodeName===nodeName||el.previousSibling&&el.previousSibling.nodeName===nodeName);)nodeName=(el=el.parentNode).nodeName;return"instance"===nodeName?{}:{repeatPath:this.model.getXPath(el,"instance"),repeatIndex:this.model.determineIndex($(el))}},Nodeset.prototype.remove=function(){var $dataNode,nodeName,repeatPath,repeatIndex,removalEventData,nextNode;if(0<($dataNode=this.get()).length){for(nodeName=$dataNode.prop("nodeName"),repeatPath=this.model.getXPath($dataNode.get(0),"instance"),repeatIndex=this.model.determineIndex($dataNode),removalEventData=this.model.getRemovalEventData($dataNode.get(0)),this.model.templates[repeatPath]||this.model.extractFakeTemplates([repeatPath]),nextNode=$dataNode.get(0).nextSibling,$dataNode.remove(),this.nodes=null,this.model.$events.trigger("dataupdate",{nodes:null,repeatPath:repeatPath,repeatIndex:repeatIndex});nextNode&&nextNode.nodeName==nodeName;)nextNode=nextNode.nextSibling,this.model.$events.trigger("dataupdate",{nodes:null,repeatPath:repeatPath,repeatIndex:repeatIndex++});this.model.$events.trigger("removed",removalEventData)}else console.error("could not find node "+this.selector+" with index "+this.index+" to remove ")},Nodeset.prototype.convert=function(x,xmlDataType){return""===x.toString()?x:null!=xmlDataType&&void 0!==types[xmlDataType.toLowerCase()]&&void 0!==types[xmlDataType.toLowerCase()].convert?types[xmlDataType.toLowerCase()].convert(x):x},Nodeset.prototype.validate=function(constraintExpr,requiredExpr,xmlDataType){var that=this,result={};return this.validateRequired(requiredExpr).then(function(passed){return!1===(result.requiredValid=passed)?null:that.validateConstraintAndType(constraintExpr,xmlDataType)}).then(function(passed){return result.constraintValid=passed,result})},Nodeset.prototype.validateConstraintAndType=function(expr,xmlDataType){var value,that=this;return xmlDataType&&void 0!==types[xmlDataType.toLowerCase()]||(xmlDataType="string"),expr||"string"!==xmlDataType&&"select"!==xmlDataType&&"select1"!==xmlDataType&&"binary"!==xmlDataType?""===(value=that.getVal()[0]).toString()?Promise.resolve(!0):Promise.resolve().then(function(){return types[xmlDataType.toLowerCase()].validate(value)}).then(function(typeValid){var exprValid=!(null!=expr&&0<expr.length)||that.model.evaluate(expr,"boolean",that.originalSelector,that.index);return typeValid&&exprValid}):Promise.resolve(!0)},Nodeset.prototype.isRequired=function(expr){return!(!expr||"false()"===expr.trim())&&("true()"===expr.trim()||this.model.evaluate(expr,"boolean",this.originalSelector,this.index))},Nodeset.prototype.validateRequired=function(expr){var that=this;return!expr||this.getVal()[0]?Promise.resolve(!0):Promise.resolve().then(function(){return!that.isRequired(expr)})},FormModel.prototype.getUpdateEventData=function(){},FormModel.prototype.getRemovalEventData=function(){},FormModel.prototype.types=types,(module.exports=FormModel).prototype.getVersion=function(){return console.warn("FormModel.getVersion() is deprecated, use model.version"),this.version},FormModel.prototype.get=function(){return console.warn("model.get() is deprecated, use model.$"),this.$||null},FormModel.prototype.getXML=function(){return console.warn("model.getXML() is deprecated, use model.xml"),this.xml||null},FormModel.prototype.getInstanceID=function(){return console.warn("model.getInstanceID() is deprecated, use model.instanceID"),this.instanceID},FormModel.prototype.getDeprecatedID=function(){return console.warn("model.getDeprecatedID() is deprecated, use model.deprecatedID"),this.deprecatedID},FormModel.prototype.getInstanceName=function(){return console.warn("model.getInstanceName() is deprecated, use model.instanceName"),this.instanceName}}).call(this,__webpack_require__(16))},function(module,exports){Date.prototype.toISOLocalString=function(){return"Invalid Date"===this.toString()?this.toString():new Date(this.getTime()-60*this.getTimezoneOffset()*1e3).toISOString().replace("Z",this.getTimezoneOffsetAsTime())},Date.prototype.getTimezoneOffsetAsTime=function(){function pad2(x){return x<10?"0"+x:x}var offsetMinutesTotal;return"Invalid Date"===this.toString()?this.toString():((offsetMinutesTotal=this.getTimezoneOffset())<0?"+":"-")+pad2(Math.abs(Math.floor(offsetMinutesTotal/60)))+":"+pad2(Math.abs(Math.floor(offsetMinutesTotal%60)))}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2);$.fn.clearInputs=function(ev1,ev2){return ev1=ev1||"edit",ev2=ev2||"",this.each(function(){$(this).find(".file-preview").remove(),$(this).find("input, select, textarea").not(".ignore").each(function(){var loadedFilename,$node=$(this),type=$node.attr("type");switch("SELECT"===$node.prop("nodeName").toUpperCase()&&(type="select"),"TEXTAREA"===$node.prop("nodeName").toUpperCase()&&(type="textarea"),type){case"file":loadedFilename=this.dataset.loadedFileName,delete this.dataset.loadedFileName;case"date":case"datetime":case"time":case"number":case"search":case"color":case"range":case"url":case"email":case"password":case"text":case"tel":case"hidden":case"textarea":""===$node.val()&&!loadedFilename||$node.val("").trigger(ev1).trigger(ev2);break;case"radio":case"checkbox":$node.prop("checked")&&($node.prop("checked",!1),$node.trigger(ev1).trigger(ev2));break;case"select":0<$node[0].selectedIndex&&($node[0].selectedIndex=0,$node.trigger(ev1).trigger(ev2));break;default:console.error("Unrecognized input type found when trying to reset",this)}})})},$.fn.reverse=[].reverse},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
 * Datepicker for Bootstrap v1.8.0 (https://github.com/uxsolutions/bootstrap-datepicker)
 *
 * Licensed under the Apache License v2.0 (http://www.apache.org/licenses/LICENSE-2.0)
 */__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function($,undefined){function UTCDate(){return new Date(Date.UTC.apply(Date,arguments))}function UTCToday(){var today=new Date;return UTCDate(today.getFullYear(),today.getMonth(),today.getDate())}function isUTCEquals(date1,date2){return date1.getUTCFullYear()===date2.getUTCFullYear()&&date1.getUTCMonth()===date2.getUTCMonth()&&date1.getUTCDate()===date2.getUTCDate()}function alias(method,deprecationMsg){return function(){return deprecationMsg!==undefined&&$.fn.datepicker.deprecated(deprecationMsg),this[method].apply(this,arguments)}}var DateArray=function(){var extras={get:function(i){return this.slice(i)[0]},contains:function(d){for(var val=d&&d.valueOf(),i=0,l=this.length;i<l;i++)if(0<=this[i].valueOf()-val&&this[i].valueOf()-val<864e5)return i;return-1},remove:function(i){this.splice(i,1)},replace:function(new_array){new_array&&($.isArray(new_array)||(new_array=[new_array]),this.clear(),this.push.apply(this,new_array))},clear:function(){this.length=0},copy:function(){var a=new DateArray;return a.replace(this),a}};return function(){var a=[];return a.push.apply(a,arguments),$.extend(a,extras),a}}(),Datepicker=function(element,options){$.data(element,"datepicker",this),this._process_options(options),this.dates=new DateArray,this.viewDate=this.o.defaultViewDate,this.focusDate=null,this.element=$(element),this.isInput=this.element.is("input"),this.inputField=this.isInput?this.element:this.element.find("input"),this.component=!!this.element.hasClass("date")&&this.element.find(".add-on, .input-group-addon, .btn"),this.component&&0===this.component.length&&(this.component=!1),this.isInline=!this.component&&this.element.is("div"),this.picker=$(DPGlobal.template),this._check_template(this.o.templates.leftArrow)&&this.picker.find(".prev").html(this.o.templates.leftArrow),this._check_template(this.o.templates.rightArrow)&&this.picker.find(".next").html(this.o.templates.rightArrow),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.o.calendarWeeks&&this.picker.find(".datepicker-days .datepicker-switch, thead .datepicker-title, tfoot .today, tfoot .clear").attr("colspan",function(i,val){return Number(val)+1}),this._process_options({startDate:this._o.startDate,endDate:this._o.endDate,daysOfWeekDisabled:this.o.daysOfWeekDisabled,daysOfWeekHighlighted:this.o.daysOfWeekHighlighted,datesDisabled:this.o.datesDisabled}),this._allow_update=!1,this.setViewMode(this.o.startView),this._allow_update=!0,this.fillDow(),this.fillMonths(),this.update(),this.isInline&&this.show()};Datepicker.prototype={constructor:Datepicker,_resolveViewName:function(view){return $.each(DPGlobal.viewModes,function(i,viewMode){if(view===i||-1!==$.inArray(view,viewMode.names))return view=i,!1}),view},_resolveDaysOfWeek:function(daysOfWeek){return $.isArray(daysOfWeek)||(daysOfWeek=daysOfWeek.split(/[,\s]*/)),$.map(daysOfWeek,Number)},_check_template:function(tmp){try{if(tmp===undefined||""===tmp)return!1;if((tmp.match(/[<>]/g)||[]).length<=0)return!0;var jDom=$(tmp);return 0<jDom.length}catch(ex){return!1}},_process_options:function(opts){this._o=$.extend({},this._o,opts);var o=this.o=$.extend({},this._o),lang=o.language;dates[lang]||(lang=lang.split("-")[0],dates[lang]||(lang=defaults.language)),o.language=lang,o.startView=this._resolveViewName(o.startView),o.minViewMode=this._resolveViewName(o.minViewMode),o.maxViewMode=this._resolveViewName(o.maxViewMode),o.startView=Math.max(this.o.minViewMode,Math.min(this.o.maxViewMode,o.startView)),!0!==o.multidate&&(o.multidate=Number(o.multidate)||!1,!1!==o.multidate&&(o.multidate=Math.max(0,o.multidate))),o.multidateSeparator=String(o.multidateSeparator),o.weekStart%=7,o.weekEnd=(o.weekStart+6)%7;var format=DPGlobal.parseFormat(o.format);o.startDate!==-1/0&&(o.startDate?o.startDate instanceof Date?o.startDate=this._local_to_utc(this._zero_time(o.startDate)):o.startDate=DPGlobal.parseDate(o.startDate,format,o.language,o.assumeNearbyYear):o.startDate=-1/0),o.endDate!==1/0&&(o.endDate?o.endDate instanceof Date?o.endDate=this._local_to_utc(this._zero_time(o.endDate)):o.endDate=DPGlobal.parseDate(o.endDate,format,o.language,o.assumeNearbyYear):o.endDate=1/0),o.daysOfWeekDisabled=this._resolveDaysOfWeek(o.daysOfWeekDisabled||[]),o.daysOfWeekHighlighted=this._resolveDaysOfWeek(o.daysOfWeekHighlighted||[]),o.datesDisabled=o.datesDisabled||[],$.isArray(o.datesDisabled)||(o.datesDisabled=o.datesDisabled.split(",")),o.datesDisabled=$.map(o.datesDisabled,function(d){return DPGlobal.parseDate(d,format,o.language,o.assumeNearbyYear)});var plc=String(o.orientation).toLowerCase().split(/\s+/g),_plc=o.orientation.toLowerCase();if(plc=$.grep(plc,function(word){return/^auto|left|right|top|bottom$/.test(word)}),o.orientation={x:"auto",y:"auto"},_plc&&"auto"!==_plc)if(1===plc.length)switch(plc[0]){case"top":case"bottom":o.orientation.y=plc[0];break;case"left":case"right":o.orientation.x=plc[0]}else _plc=$.grep(plc,function(word){return/^left|right$/.test(word)}),o.orientation.x=_plc[0]||"auto",_plc=$.grep(plc,function(word){return/^top|bottom$/.test(word)}),o.orientation.y=_plc[0]||"auto";else;if(o.defaultViewDate instanceof Date||"string"==typeof o.defaultViewDate)o.defaultViewDate=DPGlobal.parseDate(o.defaultViewDate,format,o.language,o.assumeNearbyYear);else if(o.defaultViewDate){var year=o.defaultViewDate.year||(new Date).getFullYear(),month=o.defaultViewDate.month||0,day=o.defaultViewDate.day||1;o.defaultViewDate=UTCDate(year,month,day)}else o.defaultViewDate=UTCToday()},_events:[],_secondaryEvents:[],_applyEvents:function(evs){for(var el,ch,ev,i=0;i<evs.length;i++)el=evs[i][0],2===evs[i].length?(ch=undefined,ev=evs[i][1]):3===evs[i].length&&(ch=evs[i][1],ev=evs[i][2]),el.on(ev,ch)},_unapplyEvents:function(evs){for(var el,ev,ch,i=0;i<evs.length;i++)el=evs[i][0],2===evs[i].length?(ch=undefined,ev=evs[i][1]):3===evs[i].length&&(ch=evs[i][1],ev=evs[i][2]),el.off(ev,ch)},_buildEvents:function(){var events={keyup:$.proxy(function(e){-1===$.inArray(e.keyCode,[27,37,39,38,40,32,13,9])&&this.update()},this),keydown:$.proxy(this.keydown,this),paste:$.proxy(this.paste,this)};!0===this.o.showOnFocus&&(events.focus=$.proxy(this.show,this)),this.isInput?this._events=[[this.element,events]]:this.component&&this.inputField.length?this._events=[[this.inputField,events],[this.component,{click:$.proxy(this.show,this)}]]:this._events=[[this.element,{click:$.proxy(this.show,this),keydown:$.proxy(this.keydown,this)}]],this._events.push([this.element,"*",{blur:$.proxy(function(e){this._focused_from=e.target},this)}],[this.element,{blur:$.proxy(function(e){this._focused_from=e.target},this)}]),this.o.immediateUpdates&&this._events.push([this.element,{"changeYear changeMonth":$.proxy(function(e){this.update(e.date)},this)}]),this._secondaryEvents=[[this.picker,{click:$.proxy(this.click,this)}],[this.picker,".prev, .next",{click:$.proxy(this.navArrowsClick,this)}],[this.picker,".day:not(.disabled)",{click:$.proxy(this.dayCellClick,this)}],[$(window),{resize:$.proxy(this.place,this)}],[$(document),{"mousedown touchstart":$.proxy(function(e){this.element.is(e.target)||this.element.find(e.target).length||this.picker.is(e.target)||this.picker.find(e.target).length||this.isInline||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(event,altdate){var date=altdate||this.dates.get(-1),local_date=this._utc_to_local(date);this.element.trigger({type:event,date:local_date,viewMode:this.viewMode,dates:$.map(this.dates,this._utc_to_local),format:$.proxy(function(ix,format){0===arguments.length?(ix=this.dates.length-1,format=this.o.format):"string"==typeof ix&&(format=ix,ix=this.dates.length-1),format=format||this.o.format;var date=this.dates.get(ix);return DPGlobal.formatDate(date,format,this.o.language)},this)})},show:function(){if(!(this.inputField.prop("disabled")||this.inputField.prop("readonly")&&!1===this.o.enableOnReadonly))return this.isInline||this.picker.appendTo(this.o.container),this.place(),this.picker.show(),this._attachSecondaryEvents(),this._trigger("show"),(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&this.o.disableTouchKeyboard&&$(this.element).blur(),this},hide:function(){return this.isInline||!this.picker.is(":visible")||(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.setViewMode(this.o.startView),this.o.forceParse&&this.inputField.val()&&this.setValue(),this._trigger("hide")),this},destroy:function(){return this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date,this},paste:function(e){var dateString;if(e.originalEvent.clipboardData&&e.originalEvent.clipboardData.types&&-1!==$.inArray("text/plain",e.originalEvent.clipboardData.types))dateString=e.originalEvent.clipboardData.getData("text/plain");else{if(!window.clipboardData)return;dateString=window.clipboardData.getData("Text")}this.setDate(dateString),this.update(),e.preventDefault()},_utc_to_local:function(utc){if(!utc)return utc;var local=new Date(utc.getTime()+6e4*utc.getTimezoneOffset());return local.getTimezoneOffset()!==utc.getTimezoneOffset()&&(local=new Date(utc.getTime()+6e4*local.getTimezoneOffset())),local},_local_to_utc:function(local){return local&&new Date(local.getTime()-6e4*local.getTimezoneOffset())},_zero_time:function(local){return local&&new Date(local.getFullYear(),local.getMonth(),local.getDate())},_zero_utc_time:function(utc){return utc&&UTCDate(utc.getUTCFullYear(),utc.getUTCMonth(),utc.getUTCDate())},getDates:function(){return $.map(this.dates,this._utc_to_local)},getUTCDates:function(){return $.map(this.dates,function(d){return new Date(d)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){var selected_date=this.dates.get(-1);return selected_date!==undefined?new Date(selected_date):null},clearDates:function(){this.inputField.val(""),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()},setDates:function(){var args=$.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,args),this._trigger("changeDate"),this.setValue(),this},setUTCDates:function(){var args=$.isArray(arguments[0])?arguments[0]:arguments;return this.setDates.apply(this,$.map(args,this._utc_to_local)),this},setDate:alias("setDates"),setUTCDate:alias("setUTCDates"),remove:alias("destroy","Method `remove` is deprecated and will be removed in version 2.0. Use `destroy` instead"),setValue:function(){var formatted=this.getFormattedDate();return this.inputField.val(formatted),this},getFormattedDate:function(format){format===undefined&&(format=this.o.format);var lang=this.o.language;return $.map(this.dates,function(d){return DPGlobal.formatDate(d,format,lang)}).join(this.o.multidateSeparator)},getStartDate:function(){return this.o.startDate},setStartDate:function(startDate){return this._process_options({startDate:startDate}),this.update(),this.updateNavArrows(),this},getEndDate:function(){return this.o.endDate},setEndDate:function(endDate){return this._process_options({endDate:endDate}),this.update(),this.updateNavArrows(),this},setDaysOfWeekDisabled:function(daysOfWeekDisabled){return this._process_options({daysOfWeekDisabled:daysOfWeekDisabled}),this.update(),this},setDaysOfWeekHighlighted:function(daysOfWeekHighlighted){return this._process_options({daysOfWeekHighlighted:daysOfWeekHighlighted}),this.update(),this},setDatesDisabled:function(datesDisabled){return this._process_options({datesDisabled:datesDisabled}),this.update(),this},place:function(){if(this.isInline)return this;var calendarWidth=this.picker.outerWidth(),calendarHeight=this.picker.outerHeight(),container=$(this.o.container),windowWidth=container.width(),scrollTop="body"===this.o.container?$(document).scrollTop():container.scrollTop(),appendOffset=container.offset(),parentsZindex=[0];this.element.parents().each(function(){var itemZIndex=$(this).css("z-index");"auto"!==itemZIndex&&0!==Number(itemZIndex)&&parentsZindex.push(Number(itemZIndex))});var zIndex=Math.max.apply(Math,parentsZindex)+this.o.zIndexOffset,offset=this.component?this.component.parent().offset():this.element.offset(),height=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),width=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),left=offset.left-appendOffset.left,top=offset.top-appendOffset.top;"body"!==this.o.container&&(top+=scrollTop),this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),"auto"!==this.o.orientation.x?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),"right"===this.o.orientation.x&&(left-=calendarWidth-width)):offset.left<0?(this.picker.addClass("datepicker-orient-left"),left-=offset.left-10):windowWidth<left+calendarWidth?(this.picker.addClass("datepicker-orient-right"),left+=width-calendarWidth):this.o.rtl?this.picker.addClass("datepicker-orient-right"):this.picker.addClass("datepicker-orient-left");var yorient=this.o.orientation.y;if("auto"===yorient&&(yorient=-scrollTop+top-calendarHeight<0?"bottom":"top"),this.picker.addClass("datepicker-orient-"+yorient),"top"===yorient?top-=calendarHeight+parseInt(this.picker.css("padding-top")):top+=height,this.o.rtl){var right=windowWidth-(left+width);this.picker.css({top:top,right:right,zIndex:zIndex})}else this.picker.css({top:top,left:left,zIndex:zIndex});return this},_allow_update:!0,update:function(){if(!this._allow_update)return this;var oldDates=this.dates.copy(),dates=[],fromArgs=!1;return arguments.length?($.each(arguments,$.proxy(function(i,date){date instanceof Date&&(date=this._local_to_utc(date)),dates.push(date)},this)),fromArgs=!0):(dates=(dates=this.isInput?this.element.val():this.element.data("date")||this.inputField.val())&&this.o.multidate?dates.split(this.o.multidateSeparator):[dates],delete this.element.data().date),dates=$.map(dates,$.proxy(function(date){return DPGlobal.parseDate(date,this.o.format,this.o.language,this.o.assumeNearbyYear)},this)),dates=$.grep(dates,$.proxy(function(date){return!this.dateWithinRange(date)||!date},this),!0),this.dates.replace(dates),this.o.updateViewDate&&(this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate?this.viewDate=new Date(this.o.endDate):this.viewDate=this.o.defaultViewDate),fromArgs?(this.setValue(),this.element.change()):this.dates.length&&String(oldDates)!==String(this.dates)&&fromArgs&&(this._trigger("changeDate"),this.element.change()),!this.dates.length&&oldDates.length&&(this._trigger("clearDate"),this.element.change()),this.fill(),this},fillDow:function(){if(this.o.showWeekDays){var dowCnt=this.o.weekStart,html="<tr>";for(this.o.calendarWeeks&&(html+='<th class="cw">&#160;</th>');dowCnt<this.o.weekStart+7;)html+='<th class="dow',-1!==$.inArray(dowCnt,this.o.daysOfWeekDisabled)&&(html+=" disabled"),html+='">'+dates[this.o.language].daysMin[dowCnt++%7]+"</th>";html+="</tr>",this.picker.find(".datepicker-days thead").append(html)}},fillMonths:function(){for(var focused,localDate=this._utc_to_local(this.viewDate),html="",i=0;i<12;i++)focused=localDate&&localDate.getMonth()===i?" focused":"",html+='<span class="month'+focused+'">'+dates[this.o.language].monthsShort[i]+"</span>";this.picker.find(".datepicker-months td").html(html)},setRange:function(range){range&&range.length?this.range=$.map(range,function(d){return d.valueOf()}):delete this.range,this.fill()},getClassNames:function(date){var cls=[],year=this.viewDate.getUTCFullYear(),month=this.viewDate.getUTCMonth(),today=UTCToday();return date.getUTCFullYear()<year||date.getUTCFullYear()===year&&date.getUTCMonth()<month?cls.push("old"):(date.getUTCFullYear()>year||date.getUTCFullYear()===year&&date.getUTCMonth()>month)&&cls.push("new"),this.focusDate&&date.valueOf()===this.focusDate.valueOf()&&cls.push("focused"),this.o.todayHighlight&&isUTCEquals(date,today)&&cls.push("today"),-1!==this.dates.contains(date)&&cls.push("active"),this.dateWithinRange(date)||cls.push("disabled"),this.dateIsDisabled(date)&&cls.push("disabled","disabled-date"),-1!==$.inArray(date.getUTCDay(),this.o.daysOfWeekHighlighted)&&cls.push("highlighted"),this.range&&(date>this.range[0]&&date<this.range[this.range.length-1]&&cls.push("range"),-1!==$.inArray(date.valueOf(),this.range)&&cls.push("selected"),date.valueOf()===this.range[0]&&cls.push("range-start"),date.valueOf()===this.range[this.range.length-1]&&cls.push("range-end")),cls},_fill_yearsView:function(selector,cssClass,factor,year,startYear,endYear,beforeFn){for(var classes,tooltip,before,html="",step=factor/10,view=this.picker.find(selector),startVal=Math.floor(year/factor)*factor,endVal=startVal+9*step,focusedVal=Math.floor(this.viewDate.getFullYear()/step)*step,selected=$.map(this.dates,function(d){return Math.floor(d.getUTCFullYear()/step)*step}),currVal=startVal-step;currVal<=endVal+step;currVal+=step)classes=[cssClass],tooltip=null,currVal===startVal-step?classes.push("old"):currVal===endVal+step&&classes.push("new"),-1!==$.inArray(currVal,selected)&&classes.push("active"),(currVal<startYear||endYear<currVal)&&classes.push("disabled"),currVal===focusedVal&&classes.push("focused"),beforeFn!==$.noop&&((before=beforeFn(new Date(currVal,0,1)))===undefined?before={}:"boolean"==typeof before?before={enabled:before}:"string"==typeof before&&(before={classes:before}),!1===before.enabled&&classes.push("disabled"),before.classes&&(classes=classes.concat(before.classes.split(/\s+/))),before.tooltip&&(tooltip=before.tooltip)),html+='<span class="'+classes.join(" ")+'"'+(tooltip?' title="'+tooltip+'"':"")+">"+currVal+"</span>";view.find(".datepicker-switch").text(startVal+"-"+endVal),view.find("td").html(html)},fill:function(){var tooltip,before,d=new Date(this.viewDate),year=d.getUTCFullYear(),month=d.getUTCMonth(),startYear=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,startMonth=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,endYear=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,endMonth=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,todaytxt=dates[this.o.language].today||dates.en.today||"",cleartxt=dates[this.o.language].clear||dates.en.clear||"",titleFormat=dates[this.o.language].titleFormat||dates.en.titleFormat;if(!isNaN(year)&&!isNaN(month)){this.picker.find(".datepicker-days .datepicker-switch").text(DPGlobal.formatDate(d,titleFormat,this.o.language)),this.picker.find("tfoot .today").text(todaytxt).css("display",!0===this.o.todayBtn||"linked"===this.o.todayBtn?"table-cell":"none"),this.picker.find("tfoot .clear").text(cleartxt).css("display",!0===this.o.clearBtn?"table-cell":"none"),this.picker.find("thead .datepicker-title").text(this.o.title).css("display","string"==typeof this.o.title&&""!==this.o.title?"table-cell":"none"),this.updateNavArrows(),this.fillMonths();var prevMonth=UTCDate(year,month,0),day=prevMonth.getUTCDate();prevMonth.setUTCDate(day-(prevMonth.getUTCDay()-this.o.weekStart+7)%7);var nextMonth=new Date(prevMonth);prevMonth.getUTCFullYear()<100&&nextMonth.setUTCFullYear(prevMonth.getUTCFullYear()),nextMonth.setUTCDate(nextMonth.getUTCDate()+42),nextMonth=nextMonth.valueOf();for(var weekDay,clsName,html=[];prevMonth.valueOf()<nextMonth;){if((weekDay=prevMonth.getUTCDay())===this.o.weekStart&&(html.push("<tr>"),this.o.calendarWeeks)){var ws=new Date(+prevMonth+(this.o.weekStart-weekDay-7)%7*864e5),th=new Date(Number(ws)+(11-ws.getUTCDay())%7*864e5),yth=new Date(Number(yth=UTCDate(th.getUTCFullYear(),0,1))+(11-yth.getUTCDay())%7*864e5),calWeek=(th-yth)/864e5/7+1;html.push('<td class="cw">'+calWeek+"</td>")}(clsName=this.getClassNames(prevMonth)).push("day");var content=prevMonth.getUTCDate();this.o.beforeShowDay!==$.noop&&((before=this.o.beforeShowDay(this._utc_to_local(prevMonth)))===undefined?before={}:"boolean"==typeof before?before={enabled:before}:"string"==typeof before&&(before={classes:before}),!1===before.enabled&&clsName.push("disabled"),before.classes&&(clsName=clsName.concat(before.classes.split(/\s+/))),before.tooltip&&(tooltip=before.tooltip),before.content&&(content=before.content)),clsName=$.isFunction($.uniqueSort)?$.uniqueSort(clsName):$.unique(clsName),html.push('<td class="'+clsName.join(" ")+'"'+(tooltip?' title="'+tooltip+'"':"")+' data-date="'+prevMonth.getTime().toString()+'">'+content+"</td>"),tooltip=null,weekDay===this.o.weekEnd&&html.push("</tr>"),prevMonth.setUTCDate(prevMonth.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").html(html.join(""));var monthsTitle=dates[this.o.language].monthsTitle||dates.en.monthsTitle||"Months",months=this.picker.find(".datepicker-months").find(".datepicker-switch").text(this.o.maxViewMode<2?monthsTitle:year).end().find("tbody span").removeClass("active");if($.each(this.dates,function(i,d){d.getUTCFullYear()===year&&months.eq(d.getUTCMonth()).addClass("active")}),(year<startYear||endYear<year)&&months.addClass("disabled"),year===startYear&&months.slice(0,startMonth).addClass("disabled"),year===endYear&&months.slice(endMonth+1).addClass("disabled"),this.o.beforeShowMonth!==$.noop){var that=this;$.each(months,function(i,month){var moDate=new Date(year,i,1),before=that.o.beforeShowMonth(moDate);before===undefined?before={}:"boolean"==typeof before?before={enabled:before}:"string"==typeof before&&(before={classes:before}),!1!==before.enabled||$(month).hasClass("disabled")||$(month).addClass("disabled"),before.classes&&$(month).addClass(before.classes),before.tooltip&&$(month).prop("title",before.tooltip)})}this._fill_yearsView(".datepicker-years","year",10,year,startYear,endYear,this.o.beforeShowYear),this._fill_yearsView(".datepicker-decades","decade",100,year,startYear,endYear,this.o.beforeShowDecade),this._fill_yearsView(".datepicker-centuries","century",1e3,year,startYear,endYear,this.o.beforeShowCentury)}},updateNavArrows:function(){if(this._allow_update){var prevIsDisabled,nextIsDisabled,d=new Date(this.viewDate),year=d.getUTCFullYear(),month=d.getUTCMonth(),startYear=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,startMonth=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,endYear=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,endMonth=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,factor=1;switch(this.viewMode){case 4:factor*=10;case 3:factor*=10;case 2:factor*=10;case 1:prevIsDisabled=Math.floor(year/factor)*factor<startYear,nextIsDisabled=Math.floor(year/factor)*factor+factor>endYear;break;case 0:prevIsDisabled=year<=startYear&&month<startMonth,nextIsDisabled=endYear<=year&&endMonth<month}this.picker.find(".prev").toggleClass("disabled",prevIsDisabled),this.picker.find(".next").toggleClass("disabled",nextIsDisabled)}},click:function(e){var target,year,month;e.preventDefault(),e.stopPropagation(),(target=$(e.target)).hasClass("datepicker-switch")&&this.viewMode!==this.o.maxViewMode&&this.setViewMode(this.viewMode+1),target.hasClass("today")&&!target.hasClass("day")&&(this.setViewMode(0),this._setDate(UTCToday(),"linked"===this.o.todayBtn?null:"view")),target.hasClass("clear")&&this.clearDates(),target.hasClass("disabled")||(target.hasClass("month")||target.hasClass("year")||target.hasClass("decade")||target.hasClass("century"))&&(this.viewDate.setUTCDate(1),1===this.viewMode?(month=target.parent().find("span").index(target),year=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(month)):(month=0,year=Number(target.text()),this.viewDate.setUTCFullYear(year)),this._trigger(DPGlobal.viewModes[this.viewMode-1].e,this.viewDate),this.viewMode===this.o.minViewMode?this._setDate(UTCDate(year,month,1)):(this.setViewMode(this.viewMode-1),this.fill())),this.picker.is(":visible")&&this._focused_from&&this._focused_from.focus(),delete this._focused_from},dayCellClick:function(e){var $target=$(e.currentTarget),timestamp=$target.data("date"),date=new Date(timestamp);this.o.updateViewDate&&(date.getUTCFullYear()!==this.viewDate.getUTCFullYear()&&this._trigger("changeYear",this.viewDate),date.getUTCMonth()!==this.viewDate.getUTCMonth()&&this._trigger("changeMonth",this.viewDate)),this._setDate(date)},navArrowsClick:function(e){var $target=$(e.currentTarget),dir=$target.hasClass("prev")?-1:1;0!==this.viewMode&&(dir*=12*DPGlobal.viewModes[this.viewMode].navStep),this.viewDate=this.moveMonth(this.viewDate,dir),this._trigger(DPGlobal.viewModes[this.viewMode].e,this.viewDate),this.fill()},_toggle_multidate:function(date){var ix=this.dates.contains(date);if(date||this.dates.clear(),-1!==ix?(!0===this.o.multidate||1<this.o.multidate||this.o.toggleActive)&&this.dates.remove(ix):(!1===this.o.multidate&&this.dates.clear(),this.dates.push(date)),"number"==typeof this.o.multidate)for(;this.dates.length>this.o.multidate;)this.dates.remove(0)},_setDate:function(date,which){which&&"date"!==which||this._toggle_multidate(date&&new Date(date)),(!which&&this.o.updateViewDate||"view"===which)&&(this.viewDate=date&&new Date(date)),this.fill(),this.setValue(),which&&"view"===which||this._trigger("changeDate"),this.inputField.trigger("change"),!this.o.autoclose||which&&"date"!==which||this.hide()},moveDay:function(date,dir){var newDate=new Date(date);return newDate.setUTCDate(date.getUTCDate()+dir),newDate},moveWeek:function(date,dir){return this.moveDay(date,7*dir)},moveMonth:function(date,dir){if(!function(d){return d&&!isNaN(d.getTime())}(date))return this.o.defaultViewDate;if(!dir)return date;var new_month,test,new_date=new Date(date.valueOf()),day=new_date.getUTCDate(),month=new_date.getUTCMonth(),mag=Math.abs(dir);if(dir=0<dir?1:-1,1===mag)test=-1===dir?function(){return new_date.getUTCMonth()===month}:function(){return new_date.getUTCMonth()!==new_month},new_month=month+dir,new_date.setUTCMonth(new_month),new_month=(new_month+12)%12;else{for(var i=0;i<mag;i++)new_date=this.moveMonth(new_date,dir);new_month=new_date.getUTCMonth(),new_date.setUTCDate(day),test=function(){return new_month!==new_date.getUTCMonth()}}for(;test();)new_date.setUTCDate(--day),new_date.setUTCMonth(new_month);return new_date},moveYear:function(date,dir){return this.moveMonth(date,12*dir)},moveAvailableDate:function(date,dir,fn){do{if(date=this[fn](date,dir),!this.dateWithinRange(date))return!1;fn="moveDay"}while(this.dateIsDisabled(date));return date},weekOfDateIsDisabled:function(date){return-1!==$.inArray(date.getUTCDay(),this.o.daysOfWeekDisabled)},dateIsDisabled:function(date){return this.weekOfDateIsDisabled(date)||0<$.grep(this.o.datesDisabled,function(d){return isUTCEquals(date,d)}).length},dateWithinRange:function(date){return date>=this.o.startDate&&date<=this.o.endDate},keydown:function(e){if(this.picker.is(":visible")){var dir,newViewDate,dateChanged=!1,focusDate=this.focusDate||this.viewDate;switch(e.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),e.preventDefault(),e.stopPropagation();break;case 37:case 38:case 39:case 40:if(!this.o.keyboardNavigation||7===this.o.daysOfWeekDisabled.length)break;dir=37===e.keyCode||38===e.keyCode?-1:1,0===this.viewMode?e.ctrlKey?(newViewDate=this.moveAvailableDate(focusDate,dir,"moveYear"))&&this._trigger("changeYear",this.viewDate):e.shiftKey?(newViewDate=this.moveAvailableDate(focusDate,dir,"moveMonth"))&&this._trigger("changeMonth",this.viewDate):37===e.keyCode||39===e.keyCode?newViewDate=this.moveAvailableDate(focusDate,dir,"moveDay"):this.weekOfDateIsDisabled(focusDate)||(newViewDate=this.moveAvailableDate(focusDate,dir,"moveWeek")):1===this.viewMode?(38!==e.keyCode&&40!==e.keyCode||(dir*=4),newViewDate=this.moveAvailableDate(focusDate,dir,"moveMonth")):2===this.viewMode&&(38!==e.keyCode&&40!==e.keyCode||(dir*=4),newViewDate=this.moveAvailableDate(focusDate,dir,"moveYear")),newViewDate&&(this.focusDate=this.viewDate=newViewDate,this.setValue(),this.fill(),e.preventDefault());break;case 13:if(!this.o.forceParse)break;focusDate=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(focusDate),dateChanged=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(e.preventDefault(),e.stopPropagation(),this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}dateChanged&&(this.dates.length?this._trigger("changeDate"):this._trigger("clearDate"),this.inputField.trigger("change"))}else 40!==e.keyCode&&27!==e.keyCode||(this.show(),e.stopPropagation())},setViewMode:function(viewMode){this.viewMode=viewMode,this.picker.children("div").hide().filter(".datepicker-"+DPGlobal.viewModes[this.viewMode].clsName).show(),this.updateNavArrows(),this._trigger("changeViewMode",new Date(this.viewDate))}};var DateRangePicker=function(element,options){$.data(element,"datepicker",this),this.element=$(element),this.inputs=$.map(options.inputs,function(i){return i.jquery?i[0]:i}),delete options.inputs,this.keepEmptyValues=options.keepEmptyValues,delete options.keepEmptyValues,datepickerPlugin.call($(this.inputs),options).on("changeDate",$.proxy(this.dateUpdated,this)),this.pickers=$.map(this.inputs,function(i){return $.data(i,"datepicker")}),this.updateDates()};DateRangePicker.prototype={updateDates:function(){this.dates=$.map(this.pickers,function(i){return i.getUTCDate()}),this.updateRanges()},updateRanges:function(){var range=$.map(this.dates,function(d){return d.valueOf()});$.each(this.pickers,function(i,p){p.setRange(range)})},clearDates:function(){$.each(this.pickers,function(i,p){p.clearDates()})},dateUpdated:function(e){if(!this.updating){this.updating=!0;var dp=$.data(e.target,"datepicker");if(dp!==undefined){var new_date=dp.getUTCDate(),keep_empty_values=this.keepEmptyValues,i=$.inArray(e.target,this.inputs),j=i-1,k=i+1,l=this.inputs.length;if(-1!==i){if($.each(this.pickers,function(i,p){p.getUTCDate()||p!==dp&&keep_empty_values||p.setUTCDate(new_date)}),new_date<this.dates[j])for(;0<=j&&new_date<this.dates[j];)this.pickers[j--].setUTCDate(new_date);else if(new_date>this.dates[k])for(;k<l&&new_date>this.dates[k];)this.pickers[k++].setUTCDate(new_date);this.updateDates(),delete this.updating}}}},destroy:function(){$.map(this.pickers,function(p){p.destroy()}),$(this.inputs).off("changeDate",this.dateUpdated),delete this.element.data().datepicker},remove:alias("destroy","Method `remove` is deprecated and will be removed in version 2.0. Use `destroy` instead")};var old=$.fn.datepicker,datepickerPlugin=function(option){var internal_return,args=Array.apply(null,arguments);if(args.shift(),this.each(function(){var $this=$(this),data=$this.data("datepicker"),options="object"==typeof option&&option;if(!data){var elopts=function(el,prefix){var inkey,data=$(el).data(),out={},replace=new RegExp("^"+prefix.toLowerCase()+"([A-Z])");function re_lower(_,a){return a.toLowerCase()}for(var key in prefix=new RegExp("^"+prefix.toLowerCase()),data)prefix.test(key)&&(inkey=key.replace(replace,re_lower),out[inkey]=data[key]);return out}(this,"date"),xopts=$.extend({},defaults,elopts,options),locopts=function(lang){var out={};if(!dates[lang]&&(lang=lang.split("-")[0],!dates[lang]))return;var d=dates[lang];return $.each(locale_opts,function(i,k){k in d&&(out[k]=d[k])}),out}(xopts.language),opts=$.extend({},defaults,locopts,elopts,options);data=$this.hasClass("input-daterange")||opts.inputs?($.extend(opts,{inputs:opts.inputs||$this.find("input").toArray()}),new DateRangePicker(this,opts)):new Datepicker(this,opts),$this.data("datepicker",data)}"string"==typeof option&&"function"==typeof data[option]&&(internal_return=data[option].apply(data,args))}),internal_return===undefined||internal_return instanceof Datepicker||internal_return instanceof DateRangePicker)return this;if(1<this.length)throw new Error("Using only allowed for the collection of a single element ("+option+" function)");return internal_return};$.fn.datepicker=datepickerPlugin;var defaults=$.fn.datepicker.defaults={assumeNearbyYear:!1,autoclose:!1,beforeShowDay:$.noop,beforeShowMonth:$.noop,beforeShowYear:$.noop,beforeShowDecade:$.noop,beforeShowCentury:$.noop,calendarWeeks:!1,clearBtn:!1,toggleActive:!1,daysOfWeekDisabled:[],daysOfWeekHighlighted:[],datesDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keepEmptyValues:!1,keyboardNavigation:!0,language:"en",minViewMode:0,maxViewMode:4,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-1/0,startView:0,todayBtn:!1,todayHighlight:!1,updateViewDate:!0,weekStart:0,disableTouchKeyboard:!1,enableOnReadonly:!0,showOnFocus:!0,zIndexOffset:10,container:"body",immediateUpdates:!1,title:"",templates:{leftArrow:"&#x00AB;",rightArrow:"&#x00BB;"},showWeekDays:!0},locale_opts=$.fn.datepicker.locale_opts=["format","rtl","weekStart"];$.fn.datepicker.Constructor=Datepicker;var dates=$.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM yyyy"}},DPGlobal={viewModes:[{names:["days","month"],clsName:"days",e:"changeMonth"},{names:["months","year"],clsName:"months",e:"changeYear",navStep:1},{names:["years","decade"],clsName:"years",e:"changeDecade",navStep:10},{names:["decades","century"],clsName:"decades",e:"changeCentury",navStep:100},{names:["centuries","millennium"],clsName:"centuries",e:"changeMillennium",navStep:1e3}],validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\u5e74\u6708\u65e5\[-`{-~\t\n\r]+/g,parseFormat:function(format){if("function"==typeof format.toValue&&"function"==typeof format.toDisplay)return format;var separators=format.replace(this.validParts,"\0").split("\0"),parts=format.match(this.validParts);if(!separators||!separators.length||!parts||0===parts.length)throw new Error("Invalid date format.");return{separators:separators,parts:parts}},parseDate:function(date,format,language,assumeNearby){if(!date)return undefined;if(date instanceof Date)return date;if("string"==typeof format&&(format=DPGlobal.parseFormat(format)),format.toValue)return format.toValue(date,format,language);var parts,part,dir,i,fn,fn_map={d:"moveDay",m:"moveMonth",w:"moveWeek",y:"moveYear"},dateAliases={yesterday:"-1d",today:"+0d",tomorrow:"+1d"};if(date in dateAliases&&(date=dateAliases[date]),/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/i.test(date)){for(parts=date.match(/([\-+]\d+)([dmwy])/gi),date=new Date,i=0;i<parts.length;i++)part=parts[i].match(/([\-+]\d+)([dmwy])/i),dir=Number(part[1]),fn=fn_map[part[2].toLowerCase()],date=Datepicker.prototype[fn](date,dir);return Datepicker.prototype._zero_utc_time(date)}parts=date&&date.match(this.nonpunctuation)||[];var val,filtered,parsed={},setters_order=["yyyy","yy","M","MM","m","mm","d","dd"],setters_map={yyyy:function(d,v){return d.setUTCFullYear(assumeNearby?function(year,threshold){!0===threshold&&(threshold=10);year<100&&(year+=2e3)>(new Date).getFullYear()+threshold&&(year-=100);return year}(v,assumeNearby):v)},m:function(d,v){if(isNaN(d))return d;for(v-=1;v<0;)v+=12;for(v%=12,d.setUTCMonth(v);d.getUTCMonth()!==v;)d.setUTCDate(d.getUTCDate()-1);return d},d:function(d,v){return d.setUTCDate(v)}};setters_map.yy=setters_map.yyyy,setters_map.M=setters_map.MM=setters_map.mm=setters_map.m,setters_map.dd=setters_map.d,date=UTCToday();var fparts=format.parts.slice();function match_part(){var m=this.slice(0,parts[i].length),p=parts[i].slice(0,m.length);return m.toLowerCase()===p.toLowerCase()}if(parts.length!==fparts.length&&(fparts=$(fparts).filter(function(i,p){return-1!==$.inArray(p,setters_order)}).toArray()),parts.length===fparts.length){var cnt,_date,s;for(i=0,cnt=fparts.length;i<cnt;i++){if(val=parseInt(parts[i],10),part=fparts[i],isNaN(val))switch(part){case"MM":filtered=$(dates[language].months).filter(match_part),val=$.inArray(filtered[0],dates[language].months)+1;break;case"M":filtered=$(dates[language].monthsShort).filter(match_part),val=$.inArray(filtered[0],dates[language].monthsShort)+1}parsed[part]=val}for(i=0;i<setters_order.length;i++)(s=setters_order[i])in parsed&&!isNaN(parsed[s])&&(_date=new Date(date),setters_map[s](_date,parsed[s]),isNaN(_date)||(date=_date))}return date},formatDate:function(date,format,language){if(!date)return"";if("string"==typeof format&&(format=DPGlobal.parseFormat(format)),format.toDisplay)return format.toDisplay(date,format,language);var val={d:date.getUTCDate(),D:dates[language].daysShort[date.getUTCDay()],DD:dates[language].days[date.getUTCDay()],m:date.getUTCMonth()+1,M:dates[language].monthsShort[date.getUTCMonth()],MM:dates[language].months[date.getUTCMonth()],yy:date.getUTCFullYear().toString().substring(2),yyyy:date.getUTCFullYear()};val.dd=(val.d<10?"0":"")+val.d,val.mm=(val.m<10?"0":"")+val.m,date=[];for(var seps=$.extend([],format.separators),i=0,cnt=format.parts.length;i<=cnt;i++)seps.length&&date.push(seps.shift()),date.push(val[format.parts[i]]);return date.join("")},headTemplate:'<thead><tr><th colspan="7" class="datepicker-title"></th></tr><tr><th class="prev">'+defaults.templates.leftArrow+'</th><th colspan="5" class="datepicker-switch"></th><th class="next">'+defaults.templates.rightArrow+"</th></tr></thead>",contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};DPGlobal.template='<div class="datepicker"><div class="datepicker-days"><table class="table-condensed">'+DPGlobal.headTemplate+"<tbody></tbody>"+DPGlobal.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+DPGlobal.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+DPGlobal.footTemplate+'</table></div><div class="datepicker-decades"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+DPGlobal.footTemplate+'</table></div><div class="datepicker-centuries"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+DPGlobal.footTemplate+"</table></div></div>",$.fn.datepicker.DPGlobal=DPGlobal,$.fn.datepicker.noConflict=function(){return $.fn.datepicker=old,this},$.fn.datepicker.version="1.8.0",$.fn.datepicker.deprecated=function(msg){var console=window.console;console&&console.warn&&console.warn("DEPRECATED: "+msg)},$(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(e){var $this=$(this);$this.data("datepicker")||(e.preventDefault(),datepickerPlugin.call($this,"show"))}),$(function(){datepickerPlugin.call($('[data-provide="datepicker-inline"]'))})})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(module,exports,__webpack_require__){
/*!
 * Timepicker
 *
 * Forked from https://github.com/jdewit/bootstrap-timepicker: 
 * 
 * Copyright 2013 Joris de Wit and timepicker contributors
 *
 * Contributors https://github.com/jdewit/bootstrap-timepicker/graphs/contributors
 * Contributors https://github.com/enketo/timepicker-basic/graphs/contributors
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
!function($,window,document){"use strict";function Timepicker(element,options){this.widget="",this.$element=$(element),this.defaultTime=options.defaultTime,this.disableFocus=options.disableFocus,this.disableMousewheel=options.disableMousewheel,this.isOpen=options.isOpen,this.minuteStep=options.minuteStep,this.orientation=options.orientation,this.secondStep=options.secondStep,this.snapToStep=options.snapToStep,this.showInputs=options.showInputs,this.showMeridian=options.showMeridian,this.showSeconds=options.showSeconds,this.template=options.template,this.appendWidgetTo=options.appendWidgetTo,this.showWidgetOnAddonClick=options.showWidgetOnAddonClick,this.icons=options.icons,this.maxHours=options.maxHours,this.explicitMode=options.explicitMode,this.handleDocumentClick=function(e){var self=e.data.scope;self.$element.parent().find(e.target).length||self.$widget.is(e.target)||self.$widget.find(e.target).length||self.hideWidget()},this._init()}Timepicker.prototype={constructor:Timepicker,_init:function(){var self=this;this.showWidgetOnAddonClick&&this.$element.parent().hasClass("input-group")&&this.$element.parent().hasClass("timepicker")?(this.$element.parent(".input-group.timepicker").find(".input-group-addon").on({"click.timepicker":$.proxy(this.showWidget,this)}),this.$element.on({"focus.timepicker":$.proxy(this.highlightUnit,this),"click.timepicker":$.proxy(this.highlightUnit,this),"keydown.timepicker":$.proxy(this.elementKeydown,this),"blur.timepicker":$.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":$.proxy(this.mousewheel,this)})):this.template?this.$element.on({"focus.timepicker":$.proxy(this.showWidget,this),"click.timepicker":$.proxy(this.showWidget,this),"blur.timepicker":$.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":$.proxy(this.mousewheel,this)}):this.$element.on({"focus.timepicker":$.proxy(this.highlightUnit,this),"click.timepicker":$.proxy(this.highlightUnit,this),"keydown.timepicker":$.proxy(this.elementKeydown,this),"blur.timepicker":$.proxy(this.blurElement,this),"mousewheel.timepicker DOMMouseScroll.timepicker":$.proxy(this.mousewheel,this)}),!1!==this.template?this.$widget=$(this.getTemplate()).on("click",$.proxy(this.widgetClick,this)):this.$widget=!1,this.showInputs&&!1!==this.$widget&&this.$widget.find("input").each(function(){$(this).on({"click.timepicker":function(){$(this).select()},"keydown.timepicker":$.proxy(self.widgetKeydown,self),"keyup.timepicker":$.proxy(self.widgetKeyup,self)})}),this.setDefaultTime(this.defaultTime)},blurElement:function(){this.highlightedUnit=null,this.updateFromElementVal()},clear:function(){this.hour="",this.minute="",this.second="",this.meridian="",this.$element.val("")},decrementHour:function(){if(""===this.hour&&(this.hour=this.getCurrentHour(),this.incrementHour()),this.showMeridian)if(1===this.hour)this.hour=12;else{if(12===this.hour)return this.hour--,this.toggleMeridian();if(0===this.hour)return this.hour=11,this.toggleMeridian();this.hour--}else this.hour<=0?this.hour=this.maxHours-1:this.hour--},decrementMinute:function(step){var newVal;""===this.minute&&(this.minute=this.getCurrentMinute(),this.incrementMinute()),(newVal=step?this.minute-step:this.minute-this.minuteStep)<0?(this.decrementHour(),this.minute=newVal+60):this.minute=newVal},decrementSecond:function(){var newVal=this.second-this.secondStep;newVal<0?(this.decrementMinute(!0),this.second=60+newVal):this.second=newVal},elementKeydown:function(e){switch(e.which){case 9:if(e.shiftKey){if("hour"===this.highlightedUnit){this.hideWidget();break}this.highlightPrevUnit()}else{if(this.showMeridian&&"meridian"===this.highlightedUnit||this.showSeconds&&"second"===this.highlightedUnit||!this.showMeridian&&!this.showSeconds&&"minute"===this.highlightedUnit){this.hideWidget();break}this.highlightNextUnit()}e.preventDefault(),this.updateFromElementVal();break;case 27:this.updateFromElementVal();break;case 37:e.preventDefault(),this.highlightPrevUnit(),this.updateFromElementVal();break;case 38:switch(e.preventDefault(),this.highlightedUnit){case"hour":this.incrementHour(),this.highlightHour();break;case"minute":this.incrementMinute(),this.highlightMinute();break;case"second":this.incrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update();break;case 39:e.preventDefault(),this.highlightNextUnit(),this.updateFromElementVal();break;case 40:switch(e.preventDefault(),this.highlightedUnit){case"hour":this.decrementHour(),this.highlightHour();break;case"minute":this.decrementMinute(),this.highlightMinute();break;case"second":this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update()}},getCursorPosition:function(){var input=this.$element.get(0);if("selectionStart"in input)return input.selectionStart;if(document.selection){input.focus();var sel=document.selection.createRange(),selLen=document.selection.createRange().text.length;return sel.moveStart("character",-input.value.length),sel.text.length-selLen}},getTemplate:function(){var template,hourTemplate,minuteTemplate,secondTemplate,meridianTemplate,templateContent;switch(meridianTemplate=this.showInputs?(hourTemplate='<input type="text" class="timepicker-hour" maxlength="2"/>',minuteTemplate='<input type="text" class="timepicker-minute" maxlength="2"/>',secondTemplate='<input type="text" class="timepicker-second" maxlength="2"/>','<input type="text" class="timepicker-meridian" maxlength="2"/>'):(hourTemplate='<span class="timepicker-hour"></span>',minuteTemplate='<span class="timepicker-minute"></span>',secondTemplate='<span class="timepicker-second"></span>','<span class="timepicker-meridian"></span>'),templateContent='<table><tr><td><a href="#" data-action="incrementHour"><span class="'+this.icons.up+'"></span></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><span class="'+this.icons.up+'"></span></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><span class="'+this.icons.up+'"></span></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><span class="'+this.icons.up+'"></span></a></td>':"")+"</tr><tr><td>"+hourTemplate+'</td> <td class="separator">:</td><td>'+minuteTemplate+"</td> "+(this.showSeconds?'<td class="separator">:</td><td>'+secondTemplate+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+meridianTemplate+"</td>":"")+'</tr><tr><td><a href="#" data-action="decrementHour"><span class="'+this.icons.down+'"></span></a></td><td class="separator"></td><td><a href="#" data-action="decrementMinute"><span class="'+this.icons.down+'"></span></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><span class="'+this.icons.down+'"></span></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><span class="'+this.icons.down+'"></span></a></td>':"")+"</tr></table>",this.template){case"dropdown":template='<div class="timepicker-widget dropdown-menu">'+templateContent+"</div>"}return template},getTime:function(){return""===this.hour?"":(1===this.hour.toString().length?"0"+this.hour:this.hour)+":"+(1===this.minute.toString().length?"0"+this.minute:this.minute)+(this.showSeconds?":"+(1===this.second.toString().length?"0"+this.second:this.second):"")+(this.showMeridian?" "+this.meridian:"")},hideWidget:function(){!1!==this.isOpen&&(this.$element.trigger({type:"hide.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}}),this.$widget.removeClass("open"),$(document).off("mousedown.timepicker, touchend.timepicker",this.handleDocumentClick),this.isOpen=!1,this.$widget.detach())},highlightUnit:function(){this.position=this.getCursorPosition(),0<=this.position&&this.position<=2?this.highlightHour():3<=this.position&&this.position<=5?this.highlightMinute():6<=this.position&&this.position<=8?this.showSeconds?this.highlightSecond():this.highlightMeridian():9<=this.position&&this.position<=11&&this.highlightMeridian()},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":this.showSeconds?this.highlightSecond():this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"second":this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"meridian":this.highlightHour()}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":this.showMeridian?this.highlightMeridian():this.showSeconds?this.highlightSecond():this.highlightMinute();break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":this.showSeconds?this.highlightSecond():this.highlightMinute()}},highlightHour:function(){var $element=this.$element.get(0),self=this;this.highlightedUnit="hour",$element.setSelectionRange&&setTimeout(function(){self.hour<10?$element.setSelectionRange(0,1):$element.setSelectionRange(0,2)},0)},highlightMinute:function(){var $element=this.$element.get(0),self=this;this.highlightedUnit="minute",$element.setSelectionRange&&setTimeout(function(){self.hour<10?$element.setSelectionRange(2,4):$element.setSelectionRange(3,5)},0)},highlightSecond:function(){var $element=this.$element.get(0),self=this;this.highlightedUnit="second",$element.setSelectionRange&&setTimeout(function(){self.hour<10?$element.setSelectionRange(5,7):$element.setSelectionRange(6,8)},0)},highlightMeridian:function(){var $element=this.$element.get(0),self=this;this.highlightedUnit="meridian",$element.setSelectionRange&&(this.showSeconds?setTimeout(function(){self.hour<10?$element.setSelectionRange(8,10):$element.setSelectionRange(9,11)},0):setTimeout(function(){self.hour<10?$element.setSelectionRange(5,7):$element.setSelectionRange(6,8)},0))},getCurrentHour:function(){var h24=(new Date).getHours();return this.showMeridian?h24%12:h24},getCurrentMinute:function(){return(new Date).getMinutes()},incrementHour:function(){if(""===this.hour&&(this.hour=this.getCurrentHour(),this.decrementHour()),this.showMeridian){if(11===this.hour)return this.hour++,this.toggleMeridian();12===this.hour&&(this.hour=0)}this.hour!==this.maxHours-1?this.hour++:this.hour=0},incrementMinute:function(step){var newVal;""===this.minute&&(this.minute=this.getCurrentMinute(),this.decrementMinute()),59<(newVal=step?this.minute+step:this.minute+this.minuteStep-this.minute%this.minuteStep)?(this.incrementHour(),this.minute=newVal-60):this.minute=newVal},incrementSecond:function(){var newVal=this.second+this.secondStep-this.second%this.secondStep;59<newVal?(this.incrementMinute(!0),this.second=newVal-60):this.second=newVal},mousewheel:function(e){if(!this.disableMousewheel){e.preventDefault(),e.stopPropagation();var delta=e.originalEvent.wheelDelta||-e.originalEvent.detail,scrollTo=null;switch("mousewheel"===e.type?scrollTo=-1*e.originalEvent.wheelDelta:"DOMMouseScroll"===e.type&&(scrollTo=40*e.originalEvent.detail),scrollTo&&(e.preventDefault(),$(this).scrollTop(scrollTo+$(this).scrollTop())),this.highlightedUnit){case"minute":0<delta?this.incrementMinute():this.decrementMinute(),this.highlightMinute();break;case"second":0<delta?this.incrementSecond():this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian();break;default:0<delta?this.incrementHour():this.decrementHour(),this.highlightHour()}return!1}},changeToNearestStep:function(segment,step){return segment%step==0?segment:Math.round(segment%step/step)?(segment+(step-segment%step))%60:segment-segment%step},place:function(){if(!this.isInline){var widgetWidth=this.$widget.outerWidth(),widgetHeight=this.$widget.outerHeight(),windowWidth=$(window).width(),windowHeight=$(window).height(),scrollTop=$(window).scrollTop(),zIndex=parseInt(this.$element.parents().filter(function(){return"auto"!==$(this).css("z-index")}).first().css("z-index"),10)+10,offset=this.component?this.component.parent().offset():this.$element.offset(),height=this.component?this.component.outerHeight(!0):this.$element.outerHeight(!1),width=this.component?this.component.outerWidth(!0):this.$element.outerWidth(!1),left=offset.left,top=offset.top;this.$widget.removeClass("timepicker-orient-top timepicker-orient-bottom timepicker-orient-right timepicker-orient-left"),"auto"!==this.orientation.x?(this.$widget.addClass("timepicker-orient-"+this.orientation.x),"right"===this.orientation.x&&(left-=widgetWidth-width)):(this.$widget.addClass("timepicker-orient-left"),offset.left<0?left-=offset.left-10:offset.left+widgetWidth>windowWidth&&(left=windowWidth-widgetWidth-10));var topOverflow,bottomOverflow,yorient=this.orientation.y;"auto"===yorient&&(topOverflow=-scrollTop+offset.top-widgetHeight,bottomOverflow=scrollTop+windowHeight-(offset.top+height+widgetHeight),yorient=Math.max(topOverflow,bottomOverflow)===bottomOverflow?"top":"bottom"),this.$widget.addClass("timepicker-orient-"+yorient),"top"===yorient?top+=height:top-=widgetHeight+parseInt(this.$widget.css("padding-top"),10),this.$widget.css({top:top,left:left,zIndex:zIndex})}},remove:function(){$("document").off(".timepicker"),this.$widget&&this.$widget.remove(),delete this.$element.data().timepicker},setDefaultTime:function(defaultTime){if(this.$element.val())this.updateFromElementVal();else if("current"===defaultTime){var dTime=new Date,hours=dTime.getHours(),minutes=dTime.getMinutes(),seconds=dTime.getSeconds(),meridian="AM";0!==seconds&&60===(seconds=Math.ceil(dTime.getSeconds()/this.secondStep)*this.secondStep)&&(minutes+=1,seconds=0),0!==minutes&&60===(minutes=Math.ceil(dTime.getMinutes()/this.minuteStep)*this.minuteStep)&&(hours+=1,minutes=0),this.showMeridian&&(0===hours?hours=12:meridian=12<=hours?(12<hours&&(hours-=12),"PM"):"AM"),this.hour=hours,this.minute=minutes,this.second=seconds,this.meridian=meridian,this.update()}else!1===defaultTime?(this.hour=0,this.minute=0,this.second=0,this.meridian="AM"):this.setTime(defaultTime)},setTime:function(time,ignoreWidget){if(time){var timeMode,timeArray,hour,minute,second,meridian;if("object"==typeof time&&time.getMonth)hour=time.getHours(),minute=time.getMinutes(),second=time.getSeconds(),this.showMeridian&&(meridian="AM",12<hour&&(meridian="PM",hour%=12),12===hour&&(meridian="PM"));else{if(2<(timeMode=(/a/i.test(time)?1:0)+(/p/i.test(time)?2:0)))return void this.clear();if(hour=(timeArray=time.replace(/[^0-9:]/g,"").split(":"))[0]?timeArray[0].toString():timeArray.toString(),this.explicitMode&&2<hour.length&&hour.length%2!=0)return void this.clear();minute=timeArray[1]?timeArray[1].toString():"",second=timeArray[2]?timeArray[2].toString():"",4<hour.length&&(second=hour.slice(-2),hour=hour.slice(0,-2)),2<hour.length&&(minute=hour.slice(-2),hour=hour.slice(0,-2)),2<minute.length&&(second=minute.slice(-2),minute=minute.slice(0,-2)),hour=parseInt(hour,10),minute=parseInt(minute,10),second=parseInt(second,10),isNaN(hour)&&(hour=0),isNaN(minute)&&(minute=0),isNaN(second)&&(second=0),59<second&&(second=59),59<minute&&(minute=59),hour>=this.maxHours&&(hour=this.maxHours-1),this.showMeridian?(12<hour&&(timeMode=2,hour-=12),0===hour&&(hour=12),meridian=1===(timeMode=timeMode||1)?"AM":"PM"):hour<12&&2===timeMode?hour+=12:hour>=this.maxHours?hour=this.maxHours-1:(hour<0||12===hour&&1===timeMode)&&(hour=0)}this.hour=hour,this.snapToStep?(this.minute=this.changeToNearestStep(minute,this.minuteStep),this.second=this.changeToNearestStep(second,this.secondStep)):(this.minute=minute,this.second=second),this.meridian=meridian,this.update(ignoreWidget)}else this.clear()},showWidget:function(){this.isOpen||this.$element.is(":disabled")||(this.setTime(this.$element.val()),this.updateWidget(),this.$widget.appendTo(this.appendWidgetTo),$(document).on("mousedown.timepicker, touchend.timepicker",{scope:this},this.handleDocumentClick),this.$element.trigger({type:"show.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}}),this.place(),this.disableFocus&&this.$element.blur(),""===this.hour&&this.defaultTime&&this.setDefaultTime(this.defaultTime),!1===this.isOpen&&this.$widget.addClass("open"),this.isOpen=!0)},toggleMeridian:function(){this.meridian="AM"===this.meridian?"PM":"AM"},update:function(ignoreWidget){this.updateElement(),ignoreWidget||this.updateWidget(),this.$element.trigger({type:"changeTime.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}})},updateElement:function(){this.$element.val(this.getTime()).change()},updateFromElementVal:function(){this.setTime(this.$element.val())},updateWidget:function(){if(!1!==this.$widget){var hour=this.hour,minute=1===this.minute.toString().length?"0"+this.minute:this.minute,second=1===this.second.toString().length?"0"+this.second:this.second;this.showInputs?(this.$widget.find("input.timepicker-hour").val(hour),this.$widget.find("input.timepicker-minute").val(minute),this.showSeconds&&this.$widget.find("input.timepicker-second").val(second),this.showMeridian&&this.$widget.find("input.timepicker-meridian").val(this.meridian)):(this.$widget.find("span.timepicker-hour").text(hour),this.$widget.find("span.timepicker-minute").text(minute),this.showSeconds&&this.$widget.find("span.timepicker-second").text(second),this.showMeridian&&this.$widget.find("span.timepicker-meridian").text(this.meridian))}},updateFromWidgetInputs:function(){if(!1!==this.$widget){var t=this.$widget.find("input.timepicker-hour").val()+":"+this.$widget.find("input.timepicker-minute").val()+(this.showSeconds?":"+this.$widget.find("input.timepicker-second").val():"")+(this.showMeridian?this.$widget.find("input.timepicker-meridian").val():"");this.setTime(t,!0)}},widgetClick:function(e){e.stopPropagation(),e.preventDefault();var $input=$(e.target),action=$input.closest("a").data("action");action&&this[action](),this.update(),$input.is("input")&&$input.get(0).setSelectionRange(0,2)},widgetKeydown:function(e){var $input=$(e.target),name=$input.attr("class").replace("timepicker-","");switch(e.which){case 9:if(e.shiftKey){if("hour"===name)return this.hideWidget()}else if(this.showMeridian&&"meridian"===name||this.showSeconds&&"second"===name||!this.showMeridian&&!this.showSeconds&&"minute"===name)return this.hideWidget();break;case 27:this.hideWidget();break;case 38:switch(e.preventDefault(),name){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),$input.get(0).setSelectionRange(0,2);break;case 40:switch(e.preventDefault(),name){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),$input.get(0).setSelectionRange(0,2)}},widgetKeyup:function(e){(65===e.which||77===e.which||80===e.which||46===e.which||8===e.which||48<=e.which&&e.which<=57||96<=e.which&&e.which<=105)&&this.updateFromWidgetInputs()}},$.fn.timepicker=function(option){var args=Array.apply(null,arguments);return args.shift(),this.each(function(){var $this=$(this),data=$this.data("timepicker"),options="object"==typeof option&&option;data||$this.data("timepicker",data=new Timepicker(this,$.extend({},$.fn.timepicker.defaults,options,$(this).data()))),"string"==typeof option&&data[option].apply(data,args)})},$.fn.timepicker.defaults={defaultTime:"current",disableFocus:!1,disableMousewheel:!1,isOpen:!1,minuteStep:15,orientation:{x:"auto",y:"auto"},secondStep:15,snapToStep:!1,showSeconds:!1,showInputs:!0,showMeridian:!0,template:"dropdown",appendWidgetTo:"body",showWidgetOnAddonClick:!0,icons:{up:"glyphicon glyphicon-chevron-up",down:"glyphicon glyphicon-chevron-down"},maxHours:24,explicitMode:!1},$.fn.timepicker.Constructor=Timepicker,$(document).on("focus.timepicker.data-api click.timepicker.data-api",'[data-provide="timepicker"]',function(e){var $this=$(this);$this.data("timepicker")||(e.preventDefault(),$this.timepicker())})}(__webpack_require__(2),window,document)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function($,undefined){var ErrorMsgs={formatInvalidInputErrorMsg:function(input){return"Invalid input value '"+input+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"},Slider=function(element,options){var el=this.element=$(element).hide(),origWidth=$(element)[0].style.width,updateSlider=!1,widget=this.element.next(".widget");switch(!0===widget.hasClass("slider")?(updateSlider=!0,this.widget=widget):this.widget=$('<div class="widget"><div class="slider"><div class="slider-track"><div class="slider-selection"></div><div class="slider-handle"></div><div class="slider-handle"></div></div></div></div>').insertAfter(this.element),this.picker=this.widget.find(".slider"),this.id=this.element.data("slider-id")||options.id,this.id&&(this.widget[0].id=this.id),("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)&&(this.touchCapable=!0),!0===updateSlider&&(this.widget.removeClass("slider-horizontal"),this.widget.removeClass("slider-vertical")),this.orientation=this.element.data("slider-orientation")||options.orientation,this.orientation){case"vertical":this.widget.addClass("slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight";break;default:this.widget.addClass("slider-horizontal").css("width",origWidth),this.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth"}var self=this;switch($.each(["min","max","step","precision","value","reversed","handle"],function(i,attr){void 0!==el.data("slider-"+attr)?self[attr]=el.data("slider-"+attr):void 0!==options[attr]?self[attr]=options[attr]:void 0!==el.prop(attr)?self[attr]=el.prop(attr):self[attr]=0}),this.value instanceof Array?updateSlider&&!this.range?this.value=this.value[0]:this.range=!0:this.range&&(this.value=[this.value,this.max]),this.selection=this.element.data("slider-selection")||options.selection,this.selectionEl=this.picker.find(".slider-selection"),"none"===this.selection&&this.selectionEl.addClass("hide"),this.selectionElStyle=this.selectionEl[0].style,this.handle1=this.picker.find(".slider-handle:first"),this.handle1Stype=this.handle1[0].style,this.handle2=this.picker.find(".slider-handle:last"),this.handle2Stype=this.handle2[0].style,!0===updateSlider&&(this.handle1.removeClass("round triangle"),this.handle2.removeClass("round triangle hide")),this.handle){case"round":this.handle1.addClass("round"),this.handle2.addClass("round");break;case"triangle":this.handle1.addClass("triangle"),this.handle2.addClass("triangle")}this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos],this.formater=options.formater,this.setValue(this.value),this.handle1.on({keydown:$.proxy(this.keydown,this,0)}),this.handle2.on({keydown:$.proxy(this.keydown,this,1)}),this.touchCapable&&this.picker.on({touchstart:$.proxy(this.mousedown,this)}),this.picker.on({mousedown:$.proxy(this.mousedown,this)}),this.enabled=options.enabled&&(this.element.data("slider-enabled")===undefined||!0===this.element.data("slider-enabled")),this.enabled?this.enable():this.disable(),this.natural_arrow_keys=this.element.data("slider-natural_arrow_keys")||options.natural_arrow_keys};Slider.prototype={constructor:Slider,over:!1,inDrag:!1,layout:function(){var positionPercentages;positionPercentages=this.reversed?[100-this.percentage[0],this.percentage[1]]:[this.percentage[0],this.percentage[1]],this.handle1Stype[this.stylePos]=positionPercentages[0]+"%",this.handle2Stype[this.stylePos]=positionPercentages[1]+"%","vertical"===this.orientation?(this.selectionElStyle.top=Math.min(positionPercentages[0],positionPercentages[1])+"%",this.selectionElStyle.height=Math.abs(positionPercentages[0]-positionPercentages[1])+"%"):(this.selectionElStyle.left=Math.min(positionPercentages[0],positionPercentages[1])+"%",this.selectionElStyle.width=Math.abs(positionPercentages[0]-positionPercentages[1])+"%")},mousedown:function(ev){if(!this.isEnabled())return!1;this.touchCapable&&"touchstart"===ev.type&&(ev=ev.originalEvent),this.triggerFocusOnHandle(),this.offset=this.picker.offset(),this.size=this.picker[0][this.sizePos];var percentage=this.getPercentage(ev);if(this.range){var diff1=Math.abs(this.percentage[0]-percentage),diff2=Math.abs(this.percentage[1]-percentage);this.dragged=diff1<diff2?0:1}else this.dragged=0;this.percentage[this.dragged]=this.reversed?100-percentage:percentage,this.layout(),this.touchCapable&&$(document).on({touchmove:$.proxy(this.mousemove,this),touchend:$.proxy(this.mouseup,this)}),$(document).on({mousemove:$.proxy(this.mousemove,this),mouseup:$.proxy(this.mouseup,this)}),this.inDrag=!0;var val=this.calculateValue();return this.element.trigger({type:"slideStart",value:val}).data("value",val).prop("value",val),this.setValue(val),!0},triggerFocusOnHandle:function(handleIdx){0===handleIdx&&this.handle1.focus(),1===handleIdx&&this.handle2.focus()},keydown:function(handleIdx,ev){if(!this.isEnabled())return!1;var dir;switch(ev.which){case 37:case 40:dir=-1;break;case 39:case 38:dir=1}if(dir){this.natural_arrow_keys&&("vertical"===this.orientation&&!this.reversed||"horizontal"===this.orientation&&this.reversed)&&(dir*=-1);var oneStepValuePercentageChange=dir*this.percentage[2],percentage=this.percentage[handleIdx]+oneStepValuePercentageChange;100<percentage?percentage=100:percentage<0&&(percentage=0),this.dragged=handleIdx,this.adjustPercentageForRangeSliders(percentage),this.percentage[this.dragged]=percentage,this.layout();var val=this.calculateValue();return this.element.trigger({type:"slideStart",value:val}).data("value",val).prop("value",val),this.setValue(val,!0),this.element.trigger({type:"slideStop",value:val}).data("value",val).prop("value",val),!1}},mousemove:function(ev){if(!this.isEnabled())return!1;this.touchCapable&&"touchmove"===ev.type&&(ev=ev.originalEvent);var percentage=this.getPercentage(ev);this.adjustPercentageForRangeSliders(percentage),this.percentage[this.dragged]=this.reversed?100-percentage:percentage,this.layout();var val=this.calculateValue();return this.setValue(val,!0),!1},adjustPercentageForRangeSliders:function(percentage){this.range&&(0===this.dragged&&this.percentage[1]<percentage?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>percentage&&(this.percentage[1]=this.percentage[0],this.dragged=0))},mouseup:function(){if(!this.isEnabled())return!1;this.touchCapable&&$(document).off({touchmove:this.mousemove,touchend:this.mouseup}),$(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),this.inDrag=!1;var val=this.calculateValue();return this.layout(),this.element.data("value",val).prop("value",val).trigger({type:"slideStop",value:val}),!1},calculateValue:function(){var val;return this.range?(val=[this.min,this.max],0!==this.percentage[0]&&(val[0]=Math.max(this.min,this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step),val[0]=this.applyPrecision(val[0])),100!==this.percentage[1]&&(val[1]=Math.min(this.max,this.min+Math.round(this.diff*this.percentage[1]/100/this.step)*this.step),val[1]=this.applyPrecision(val[1])),this.value=val):((val=this.min+Math.round(this.diff*this.percentage[0]/100/this.step)*this.step)<this.min?val=this.min:val>this.max&&(val=this.max),val=parseFloat(val),val=this.applyPrecision(val),this.value=[val,this.value[1]]),val},applyPrecision:function(val){var precision=this.precision||this.getNumDigitsAfterDecimalPlace(this.step);return this.applyToFixedAndParseFloat(val,precision)},getNumDigitsAfterDecimalPlace:function(num){var match=(""+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return match?Math.max(0,(match[1]?match[1].length:0)-(match[2]?+match[2]:0)):0},applyToFixedAndParseFloat:function(num,toFixedInput){var truncatedNum=num.toFixed(toFixedInput);return parseFloat(truncatedNum)},getPercentage:function(ev){!this.touchCapable||"touchstart"!==ev.type&&"touchmove"!==ev.type||(ev=ev.touches[0]);var percentage=100*(ev[this.mousePos]-this.offset[this.stylePos])/this.size;return percentage=Math.round(percentage/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,percentage))},getValue:function(){return this.range?this.value:this.value[0]},setValue:function(val,triggerSlideEvent){if(val=val||0,this.value=this.validateInputValue(val),this.range?(this.value[0]=this.applyPrecision(this.value[0]),this.value[1]=this.applyPrecision(this.value[1]),this.value[0]=Math.max(this.min,Math.min(this.max,this.value[0])),this.value[1]=Math.max(this.min,Math.min(this.max,this.value[1]))):(this.value=this.applyPrecision(this.value),this.value=[Math.max(this.min,Math.min(this.max,this.value))],this.handle2.addClass("hide"),"after"===this.selection?this.value[1]=this.max:this.value[1]=this.min),this.diff=this.max-this.min,0<this.diff?this.percentage=[100*(this.value[0]-this.min)/this.diff,100*(this.value[1]-this.min)/this.diff,100*this.step/this.diff]:this.percentage=[0,0,100],this.layout(),!0===triggerSlideEvent){var slideEventValue=this.range?this.value:this.value[0];this.element.trigger({type:"slide",value:slideEventValue}).data("value",slideEventValue).prop("value",slideEventValue)}},validateInputValue:function(val){if("number"==typeof val)return val;if(val instanceof Array)return $.each(val,function(i,input){if("number"!=typeof input)throw new Error(ErrorMsgs.formatInvalidInputErrorMsg(input))}),val;throw new Error(ErrorMsgs.formatInvalidInputErrorMsg(val))},destroy:function(){this.handle1.off(),this.handle2.off(),this.element.off().show(),this.picker.off().remove(),$(this.element).removeData("slider")},disable:function(){this.enabled=!1,this.handle1.removeAttr("tabindex"),this.handle2.removeAttr("tabindex"),this.picker.addClass("slider-disabled"),this.element.trigger("slideDisabled")},enable:function(){this.enabled=!0,this.handle1.attr("tabindex",0),this.handle2.attr("tabindex",0),this.picker.removeClass("slider-disabled"),this.element.trigger("slideEnabled")},toggle:function(){this.enabled?this.disable():this.enable()},isEnabled:function(){return this.enabled},setAttribute:function(attribute,value){this[attribute]=value},getAttribute:function(attribute){return this[attribute]}};var publicMethods={getValue:Slider.prototype.getValue,setValue:Slider.prototype.setValue,setAttribute:Slider.prototype.setAttribute,getAttribute:Slider.prototype.getAttribute,destroy:Slider.prototype.destroy,disable:Slider.prototype.disable,enable:Slider.prototype.enable,toggle:Slider.prototype.toggle,isEnabled:Slider.prototype.isEnabled};function invokePublicMethod(methodName,args){if(publicMethods[methodName]){var sliderObject=function(element){var sliderObject=$(element).data("slider");{if(sliderObject&&sliderObject instanceof Slider)return sliderObject;throw new Error(ErrorMsgs.callingContextNotSliderInstance)}}(this),result=publicMethods[methodName].apply(sliderObject,args);return void 0===result?$(this):result}throw new Error("method '"+methodName+"()' does not exist for slider.")}$.fn.slider=function(option){if("string"!=typeof option||"refresh"===option)return function(opts){var $this=$(this);return $this.each(function(){var $this=$(this),slider=$this.data("slider"),options="object"==typeof opts&&opts;slider&&!options&&(options={},$.each($.fn.slider.defaults,function(key){options[key]=slider[key]})),$this.data("slider",new Slider(this,$.extend({},$.fn.slider.defaults,options)))}),$this}.call(this,option);var args=Array.prototype.slice.call(arguments,1);return invokePublicMethod.call(this,option,args)},$.fn.slider.defaults={min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",natural_arrow_keys:!1,handle:"round",reversed:!1,enabled:!0,formater:function(value){return value}},$.fn.slider.Constructor=Slider})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(module,exports,__webpack_require__){var TaskQueue=__webpack_require__(423),compressImage=__webpack_require__(424);__webpack_require__(14).default;function Optimizer(session,onProgressCb){session.data._id;var attachments=session.data._attachments;function optimize(name,file){return function(name,file){return Promise.resolve(file.data)}(0,file).then(function(blob){return compressImage(blob,600)}).then(function(result){session.data._attachments[name]={content_type:file.content_type,data:result}})}this.process=function(){var queue=new TaskQueue;return onProgressCb&&queue.onProgress(onProgressCb),Object.keys(attachments).forEach(function(key){var fileName=key,file=attachments[key];!function(attachment){return-1!==attachment.content_type.indexOf("image/")&&!(attachment.length<3e5)}(file)||queue.add(function(){return optimize(fileName,file)})}),queue.isEmpty()?Promise.resolve(session):queue.run().then(function(){return session})}}module.exports=function(session,onProgressCb){return new Optimizer(session,onProgressCb).process()}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){},function(module,exports){var $body;$body=$("body"),$.fn.overlay=$.fn.overlay=function(action){switch(action){case"show":!function($el){$(window).scrollTop(0),setTimeout(function(){$body.addClass("noScroll"),$el.show()})}(this);break;case"hide":!function($el){$body.removeClass("noScroll"),$el.hide()}(this);break;default:throw new Exception("Unknown action. Either use show or hide.")}return this}},function(module,exports,__webpack_require__){__webpack_require__(413),module.exports="vAccordion"},function(module,exports){
/**
 * vAccordion - AngularJS multi-level accordion component
 * @version v1.6.0
 * @link http://lukaszwatroba.github.io/v-accordion
 * @author Åukasz WÄtroba <l@lukaszwatroba.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(angular){"use strict";function vAccordionDirective($timeout){return{restrict:"E",transclude:!0,controller:vAccordionController,scope:{control:"=?",expandCb:"&?onexpand",collapseCb:"&?oncollapse",id:"@?"},link:{pre:function(scope,iElement,iAttrs){scope.allowMultiple=angular.isDefined(iAttrs.multiple)&&(""===iAttrs.multiple||"true"===iAttrs.multiple)},post:function(scope,iElement,iAttrs,ctrl,transclude){if(transclude(scope.$parent.$new(),function(clone,transclusionScope){transclusionScope.$accordion=scope.internalControl,scope.id&&(transclusionScope.$accordion.id=scope.id),iElement.append(clone)}),iAttrs.$set("role","tablist"),scope.allowMultiple&&iAttrs.$set("aria-multiselectable","true"),angular.isDefined(scope.control)){angular.forEach(["toggle","expand","collapse","expandAll","collapseAll","hasExpandedPane"],function(iteratedMethodName){if(scope.control[iteratedMethodName])throw new Error("The `"+iteratedMethodName+"` method can not be overwritten")});var mergedControl=angular.extend({},scope.internalControl,scope.control);scope.control=scope.internalControl=mergedControl}else scope.control=scope.internalControl;$timeout(function(){var eventName=angular.isDefined(ctrl.getAccordionId())?ctrl.getAccordionId()+":onReady":"vAccordion:onReady";scope.$emit(eventName)},0)}}}}function vAccordionController($scope){var ctrl=this,isDisabled=!1;$scope.panes=[],$scope.expandCb=angular.isFunction($scope.expandCb)?$scope.expandCb:angular.noop,$scope.collapseCb=angular.isFunction($scope.collapseCb)?$scope.collapseCb:angular.noop,ctrl.hasExpandedPane=function(){for(var bool=!1,i=0,length=$scope.panes.length;i<length;i++){if($scope.panes[i].isExpanded){bool=!0;break}}return bool},ctrl.getPaneByIndex=function(index){var thePane;return angular.forEach($scope.panes,function(iteratedPane){iteratedPane.$parent&&angular.isDefined(iteratedPane.$parent.$index)&&iteratedPane.$parent.$index===index&&(thePane=iteratedPane)}),thePane||$scope.panes[index]},ctrl.getPaneIndex=function(pane){var theIndex;return angular.forEach($scope.panes,function(iteratedPane){iteratedPane.$parent&&angular.isDefined(iteratedPane.$parent.$index)&&iteratedPane===pane&&(theIndex=iteratedPane.$parent.$index)}),angular.isDefined(theIndex)?theIndex:$scope.panes.indexOf(pane)},ctrl.getPaneById=function(id){var thePane;return angular.forEach($scope.panes,function(iteratedPane){iteratedPane.id&&iteratedPane.id===id&&(thePane=iteratedPane)}),thePane},ctrl.getPaneId=function(pane){return pane.id},ctrl.getAccordionId=function(){return $scope.id},ctrl.disable=function(){isDisabled=!0},ctrl.enable=function(){isDisabled=!1},ctrl.addPane=function(paneToAdd){if(!$scope.allowMultiple&&ctrl.hasExpandedPane()&&paneToAdd.isExpanded)throw new Error("The `multiple` attribute can't be found");$scope.panes.push(paneToAdd),paneToAdd.isExpanded&&$scope.expandCb({index:ctrl.getPaneIndex(paneToAdd),id:paneToAdd.id,pane:paneToAdd})},ctrl.focusNext=function(){for(var length=$scope.panes.length,i=0;i<length;i++){if($scope.panes[i].isFocused){var paneToFocusIndex=i+1;paneToFocusIndex>$scope.panes.length-1&&(paneToFocusIndex=0),$scope.panes[paneToFocusIndex].paneElement.find("v-pane-header")[0].focus();break}}},ctrl.focusPrevious=function(){for(var length=$scope.panes.length,i=0;i<length;i++){if($scope.panes[i].isFocused){var paneToFocusIndex=i-1;paneToFocusIndex<0&&(paneToFocusIndex=$scope.panes.length-1),$scope.panes[paneToFocusIndex].paneElement.find("v-pane-header")[0].focus();break}}},ctrl.toggle=function(paneToToggle){!isDisabled&&paneToToggle&&($scope.allowMultiple||ctrl.collapseAll(paneToToggle),paneToToggle.isExpanded=!paneToToggle.isExpanded,paneToToggle.isExpanded?$scope.expandCb({index:ctrl.getPaneIndex(paneToToggle),id:paneToToggle.id,pane:paneToToggle}):$scope.collapseCb({index:ctrl.getPaneIndex(paneToToggle),id:paneToToggle.id,pane:paneToToggle}))},ctrl.expand=function(paneToExpand){!isDisabled&&paneToExpand&&($scope.allowMultiple||ctrl.collapseAll(paneToExpand),paneToExpand.isExpanded||(paneToExpand.isExpanded=!0,$scope.expandCb({index:ctrl.getPaneIndex(paneToExpand),id:paneToExpand.id,pane:paneToExpand})))},ctrl.collapse=function(paneToCollapse){!isDisabled&&paneToCollapse&&paneToCollapse.isExpanded&&(paneToCollapse.isExpanded=!1,$scope.collapseCb({index:ctrl.getPaneIndex(paneToCollapse),id:paneToCollapse.id,pane:paneToCollapse}))},ctrl.expandAll=function(){if(!isDisabled){if(!$scope.allowMultiple)throw new Error("The `multiple` attribute can't be found");angular.forEach($scope.panes,function(iteratedPane){ctrl.expand(iteratedPane)})}},ctrl.collapseAll=function(exceptionalPane){isDisabled||angular.forEach($scope.panes,function(iteratedPane){iteratedPane!==exceptionalPane&&ctrl.collapse(iteratedPane)})},$scope.internalControl={toggle:function(indexOrId){angular.isString(indexOrId)?ctrl.toggle(ctrl.getPaneById(indexOrId)):ctrl.toggle(ctrl.getPaneByIndex(indexOrId))},expand:function(indexOrId){angular.isString(indexOrId)?ctrl.expand(ctrl.getPaneById(indexOrId)):ctrl.expand(ctrl.getPaneByIndex(indexOrId))},collapse:function(indexOrId){angular.isString(indexOrId)?ctrl.collapse(ctrl.getPaneById(indexOrId)):ctrl.collapse(ctrl.getPaneByIndex(indexOrId))},expandAll:ctrl.expandAll,collapseAll:ctrl.collapseAll,hasExpandedPane:ctrl.hasExpandedPane}}function vPaneDirective($timeout,$animate,accordionConfig){return{restrict:"E",require:"^vAccordion",transclude:!0,controller:vPaneController,scope:{isExpanded:"=?expanded",isDisabled:"=?ngDisabled",id:"@?"},link:function(scope,iElement,iAttrs,accordionCtrl,transclude){transclude(scope.$parent.$new(),function(clone,transclusionScope){transclusionScope.$pane=scope.internalControl,scope.id&&(transclusionScope.$pane.id=scope.id),iElement.append(clone)}),angular.isDefined(scope.isExpanded)||(scope.isExpanded=angular.isDefined(iAttrs.expanded)&&""===iAttrs.expanded),angular.isDefined(iAttrs.disabled)&&(scope.isDisabled=!0);var states=accordionConfig.states,paneHeader=iElement.find("v-pane-header"),paneContent=iElement.find("v-pane-content"),paneInner=paneContent.find("div"),accordionId=accordionCtrl.getAccordionId();if(!paneHeader[0])throw new Error("The `v-pane-header` directive can't be found");if(!paneContent[0])throw new Error("The `v-pane-content` directive can't be found");function emitEvent(eventName){eventName=angular.isDefined(accordionId)?accordionId+":"+eventName:"vAccordion:"+eventName,scope.$emit(eventName)}scope.paneElement=iElement,scope.paneContentElement=paneContent,scope.paneInnerElement=paneInner,(scope.accordionCtrl=accordionCtrl).addPane(scope),scope.$evalAsync(function(){scope.isExpanded?(iElement.addClass(states.expanded),paneContent.css("max-height","none").attr("aria-hidden","false"),paneHeader.attr({"aria-selected":"true","aria-expanded":"true"})):(paneContent.css("max-height","0px").attr("aria-hidden","true"),paneHeader.attr({"aria-selected":"false","aria-expanded":"false"}))}),scope.$watch("isExpanded",function(newValue,oldValue){if(newValue===oldValue)return!0;newValue?(accordionCtrl.disable(),paneContent.attr("aria-hidden","false"),paneHeader.attr({"aria-selected":"true","aria-expanded":"true"}),emitEvent("onExpand"),$animate.addClass(iElement,states.expanded).then(function(){accordionCtrl.enable(),emitEvent("onExpandAnimationEnd")})):(accordionCtrl.disable(),paneContent.attr("aria-hidden","true"),paneHeader.attr({"aria-selected":"false","aria-expanded":"false"}),emitEvent("onCollapse"),$animate.removeClass(iElement,states.expanded).then(function(){accordionCtrl.enable(),emitEvent("onCollapseAnimationEnd")}))})}}}function vPaneController($scope){this.isExpanded=function(){return $scope.isExpanded},this.toggle=function(){$scope.isAnimating||$scope.isDisabled||$scope.accordionCtrl.toggle($scope)},this.expand=function(){$scope.isAnimating||$scope.isDisabled||$scope.accordionCtrl.expand($scope)},this.collapse=function(){$scope.isAnimating||$scope.isDisabled||$scope.accordionCtrl.collapse($scope)},this.focusPane=function(){$scope.isFocused=!0},this.blurPane=function(){$scope.isFocused=!1},$scope.internalControl={toggle:this.toggle,expand:this.expand,collapse:this.collapse,isExpanded:this.isExpanded}}angular.module("vAccordion.config",[]).constant("accordionConfig",{states:{expanded:"is-expanded"},expandAnimationDuration:.5}).animation(".is-expanded",["$animateCss","accordionConfig",function($animateCss,accordionConfig){return{addClass:function(element,className,done){var paneContent=angular.element(element[0].querySelector("v-pane-content")),height=angular.element(paneContent[0].querySelector("div"))[0].offsetHeight;return $animateCss(paneContent,{easing:"ease",from:{maxHeight:"0px"},to:{maxHeight:height+"px"},duration:accordionConfig.expandAnimationDuration}).start().done(function(){paneContent.css("max-height","none"),done()}),function(isCancelled){isCancelled&&paneContent.css("max-height","none")}},removeClass:function(element,className,done){var paneContent=angular.element(element[0].querySelector("v-pane-content")),height=angular.element(paneContent[0].querySelector("div"))[0].offsetHeight;return $animateCss(paneContent,{easing:"ease",from:{maxHeight:height+"px"},to:{maxHeight:"0px"},duration:accordionConfig.expandAnimationDuration}).start().done(done),function(isCancelled){isCancelled&&paneContent.css("max-height","0px")}}}}]),angular.module("vAccordion.directives",[]),angular.module("vAccordion",["vAccordion.config","vAccordion.directives"]),angular.module("vAccordion.directives").directive("vAccordion",vAccordionDirective),vAccordionDirective.$inject=["$timeout"],vAccordionController.$inject=["$scope"],angular.module("vAccordion.directives").directive("vPane",vPaneDirective),vPaneDirective.$inject=["$timeout","$animate","accordionConfig"],vPaneController.$inject=["$scope"],angular.module("vAccordion.directives").directive("vPaneContent",function(){return{restrict:"E",require:"^vPane",transclude:!0,template:"<div ng-transclude></div>",scope:{},link:function(scope,iElement,iAttrs){iAttrs.$set("role","tabpanel"),iAttrs.$set("aria-hidden","true")}}}),angular.module("vAccordion.directives").directive("vPaneHeader",function(){return{restrict:"E",require:["^vPane","^vAccordion"],transclude:!0,template:"<div ng-transclude></div>",scope:{},link:function(scope,iElement,iAttrs,ctrls){iAttrs.$set("role","tab"),iAttrs.$set("tabindex","0");var paneCtrl=ctrls[0],accordionCtrl=ctrls[1],isInactive=angular.isDefined(iAttrs.inactive);function onClick(){if(isInactive)return!1;scope.$apply(function(){paneCtrl.toggle()})}function onKeydown(event){32===event.keyCode||13===event.keyCode?(scope.$apply(function(){paneCtrl.toggle()}),event.preventDefault()):39===event.keyCode||40===event.keyCode?(scope.$apply(function(){accordionCtrl.focusNext()}),event.preventDefault()):37!==event.keyCode&&38!==event.keyCode||(scope.$apply(function(){accordionCtrl.focusPrevious()}),event.preventDefault())}iElement[0].onfocus=function(){paneCtrl.focusPane()},iElement[0].onblur=function(){paneCtrl.blurPane()},iElement.bind("click",onClick),iElement.bind("keydown",onKeydown),scope.$on("$destroy",function(){iElement.unbind("click",onClick),iElement.unbind("keydown",onKeydown),iElement[0].onfocus=null,iElement[0].onblur=null})}}})}(angular)},function(module,exports){function E(){}E.prototype={on:function(name,callback,ctx){var e=this.e||(this.e={});return(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx}),this},once:function(name,callback,ctx){var self=this;function listener(){self.off(name,listener),callback.apply(ctx,arguments)}return listener._=callback,this.on(name,listener,ctx)},emit:function(name){for(var data=[].slice.call(arguments,1),evtArr=((this.e||(this.e={}))[name]||[]).slice(),i=0,len=evtArr.length;i<len;i++)evtArr[i].fn.apply(evtArr[i].ctx,data);return this},off:function(name,callback){var e=this.e||(this.e={}),evts=e[name],liveEvents=[];if(evts&&callback)for(var i=0,len=evts.length;i<len;i++)evts[i].fn!==callback&&evts[i].fn._!==callback&&liveEvents.push(evts[i]);return liveEvents.length?e[name]=liveEvents:delete e[name],this}},module.exports=E,module.exports.TinyEmitter=E},function(module,exports,__webpack_require__){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}var FormModel=__webpack_require__(201),parser=new DOMParser;FormModel.prototype.createSession=function(id,sessObj){var instance,session,model=this.xml.querySelector("model");model&&(sessObj="object"===_typeof(sessObj)?sessObj:{},(instance=model.querySelector('instance[id="'+id+'"]'))||(instance=parser.parseFromString('<instance id="'+id+'"/>',"text/xml").documentElement,this.xml.adoptNode(instance),model.appendChild(instance)),Object.keys(sessObj).forEach(function(prop){sessObj[prop]=sessObj[prop]||utils.readCookie("__enketo_meta_"+prop)||prop+" not found"}),session=parser.parseFromString("<session><context>"+Object.keys(sessObj).map(function(prop){return"<"+prop+">"+sessObj[prop]+"</"+prop+">"}).join("")+"</context></session>","text/xml").documentElement,this.xml.adoptNode(session),instance.appendChild(session))},module.exports=FormModel},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(){"use strict";__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){return function(opts){var mde;var msv;var psr;var nse;var xpe;var nsr;var nsd="_";var stay;var join;var updn;var XML_ELEMENT_NODE=1;var XML_TEXT_NODE=3;var XML_COMMENT_NODE=8;var XML_PI_NODE=7;var that=this;that.Init=function(){that.dom=null;that.nsp={};that.count=0;join[1]=false;if(mde>0){that.error={code:"",text:""}}return mde>0};that.AddFile=function(file){var rlt;if(!file||!file.target){rlt=Error("nof")}else if(!file.target.result){rlt=Error("emf")}else{rlt=that.AddSource(file.target.result)}return rlt};that.AddSource=function(xml){var rlt,doc;if(typeof xml==="object"){doc=that.Get(1,xml)?xml:false;if(doc&&(mde===1&&!window.DOMParser||mde===2&&!doc.selectSingleNode("/"))){doc=null}}else{try{doc=Load(xml)}catch(e){doc=false}}if(doc===null){rlt=Error("nos")}else if(doc===false){rlt=Error("inv")}else if(doc===true){that.nsp=NameSpaces(that.dom.documentElement);that.count=1;rlt=that.dom}else if(CheckSource(doc)){Merge(doc,"/");if(join[1]===true){var tmp=that.dom.createTextNode("\r\n");that.dom.documentElement.appendChild(tmp)}that.count++;rlt=that.dom}else{rlt=false}return rlt};var Load=function(src){var rlt,doc;if(mde===1){if(that.dom){doc=psr.parseFromString(src,"text/xml");rlt=ParseError(doc)?doc:false}else{that.dom=psr.parseFromString(src,"text/xml");rlt=ParseError(that.dom)?true:false}}else if(that.dom){doc=new ActiveXObject(msv);doc.async=false;rlt=doc.loadXML(src)?doc:false}else{that.dom=new ActiveXObject(msv);that.dom.async=false;that.dom.setProperty("SelectionLanguage","XPath");rlt=that.dom.loadXML(src)?true:false}return rlt};var ParseError=function(doc){return doc.getElementsByTagNameNS(nse,"parsererror").length===0};var CheckSource=function(doc){var rlt=true;var charSet1=that.dom.characterSet||that.dom.inputEncoding||that.dom.xmlEncoding;var charSet2=doc.characterSet||doc.inputEncoding||doc.xmlEncoding;if(charSet2!==charSet1){rlt=Error("enc")}else if(doc.documentElement.namespaceURI!==that.dom.documentElement.namespaceURI){rlt=Error("nse")}else if(doc.documentElement.nodeName!==that.dom.documentElement.nodeName){if(!join[0]){rlt=Error("dif")}else if(!join[1]){var enc=typeof charSet1!=="undefined"?charSet1:"UTF-8";var ver=that.dom.xmlVersion?that.dom.xmlVersion:"1.0";var xml='<?xml version="'+ver+'" encoding="'+enc+'"?>\r\n<'+join[0]+">\r\n</"+join[0]+">";var d=Load(xml);if(d){var tmp=that.dom.documentElement.cloneNode(true);d.documentElement.appendChild(tmp);tmp=d.createTextNode("\r\n");d.documentElement.appendChild(tmp);that.dom=d;join[1]=true}else{rlt=Error("jne");join[1]=null}}}if(rlt){var a=NameSpaces(doc.documentElement);for(var c in a){if(!that.nsp[c]){if(typeof that.dom.documentElement.setAttributeNS!=="undefined"){that.dom.documentElement.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:"+c,a[c])}else{that.dom.documentElement.setAttribute("xmlns:"+c,a[c])}that.nsp[c]=a[c]}}if(!updn){nsr=null}else if(mde===1){nsr=Resolver}else{ResolverIE()}}return rlt};var Merge=function(src,pth){for(var i=0;i<src.childNodes.length;i++){var tmp;var node=src.childNodes[i];var path=GetNodePath(src.childNodes,node,pth,i);var obj=that.Query(path);if(node.nodeType===XML_ELEMENT_NODE){var flg=true;if(obj===null||obj.namespaceURI!==node.namespaceURI){tmp=node.cloneNode(true);obj=that.Query(pth);obj.appendChild(tmp)}else{if(ArraySearch(obj.getAttribute("stay"),stay)!==false){flg=false}if(flg){try{for(var j=0;j<node.attributes.length;j++){if(node.attributes[j].namespaceURI&&typeof node.setAttributeNS!=="undefined"){obj.setAttributeNS(node.attributes[j].namespaceURI,node.attributes[j].nodeName,node.attributes[j].nodeValue)}else{obj.setAttribute(node.attributes[j].nodeName,node.attributes[j].nodeValue)}}}catch(e){}}}if(node.hasChildNodes()&&flg){Merge(node,path)}}else if(node.nodeType===XML_TEXT_NODE||node.nodeType===XML_COMMENT_NODE){if(obj===null||obj.nodeType!==node.nodeType){obj=that.Query(pth);if(node.nodeType===XML_TEXT_NODE){tmp=that.dom.createTextNode(node.nodeValue)}else{tmp=that.dom.createComment(node.nodeValue)}obj.appendChild(tmp)}else{obj.nodeValue=node.nodeValue}}}};var GetNodePath=function(nodes,node,pth,eln){var p,i;var j=0;if(node.nodeType===XML_ELEMENT_NODE){for(i=0;i<=eln;i++){if(updn&&nodes[i].nodeType===node.nodeType&&nodes[i].nodeName===node.nodeName||!updn&&nodes[i].nodeType!==XML_PI_NODE){j++}}if(updn){var f=false;var a=NameSpaces(node);for(var c in a){if(c!==nsd){that.nsp[c]=a[c];f=mde===2}}if(f){ResolverIE()}if(node.prefix){p=node.prefix+":"}else if(that.nsp[nsd]){p=nsd+":"}else{p=""}p+=node.localName?node.localName:node.baseName}else{p="node()"}}else if(node.nodeType===XML_TEXT_NODE||node.nodeType===XML_COMMENT_NODE){for(i=0;i<=eln;i++){if(nodes[i].nodeType===node.nodeType){j++}}p=node.nodeType===XML_TEXT_NODE?"text()":"comment()"}else{p=pth}if(j){p=pth+(pth.slice(-1)==="/"?"":"/")+p+"["+j+"]"}return p};var NameSpaces=function(node){var rlt={};var attrs=node.attributes;for(var i=0;i<attrs.length;++i){var a=attrs[i].name.split(":");if(a[0]==="xmlns"){var c=a[1]?a[1]:nsd;rlt[c]=attrs[i].value}}return rlt};that.Query=function(qry){var rlt;if(join[1]){qry="/"+that.dom.documentElement.nodeName+(qry==="/"?"":qry)}try{if(mde===1){rlt=xpe.evaluate(qry,that.dom,nsr,XPathResult.FIRST_ORDERED_NODE_TYPE,null);rlt=rlt.singleNodeValue}else{rlt=that.dom.selectSingleNode(qry)}}catch(e){rlt=null}return rlt};var Resolver=function(pfx){return that.nsp[pfx]||null};var ResolverIE=function(){var p="";for(var c in that.nsp){p+=" xmlns:"+c+"="+"'"+that.nsp[c]+"'"}if(p){that.dom.setProperty("SelectionNamespaces",p.substr(1))}};var ArraySearch=function(val,arr){var rlt=false;for(var key in arr){if(arr[key]===val){rlt=key;break}}return rlt};that.Get=function(flg,doc){var rlt;if(flg&&!doc){doc=that.dom}if(!flg){rlt=that.dom}else if(!doc){rlt=""}else if(doc.xml){rlt=doc.xml}else{try{rlt=(new XMLSerializer).serializeToString(doc)}catch(e){rlt=null}}if(rlt&&flg===2){if(join[1]){var k=rlt.indexOf("<"+join[0]);rlt=rlt.substr(0,k)+"\r\n"+rlt.substr(k)}rlt=rlt.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/ |\t/g,"&nbsp;");rlt=rlt.replace(/(\r\n|\n|\r)/g,"<br>")}return rlt};var Error=function(err){var errs={nod:"XML DOM is not supported in this browser",nox:"xPath is not supported in this browser",nos:"Incompatible source object",nof:"File not found",emf:"File is empty",inv:"Invalid XML source",enc:"Different encoding",dif:"Different root nodes",jne:"Invalid join parameter",nse:"Namespace incompatibility",und:"Undefined error"};that.error.code=errs[err]?err:"und";that.error.text=errs[that.error.code];return false};var GetMode=function(){var m;var f=false;var vers=["MSXML2.DOMDocument.6.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","Microsoft.XmlDom"];var n=vers.length;for(var i=0;i<n;i++){try{var d=new ActiveXObject(vers[i]);d.async=false;f=true;if(d.loadXML("<x></x>")&&d.selectSingleNode("/")){break}}catch(e){}}if(f){if(i<n){msv=vers[i];m=2}else{m="nox"}}else if(!window.DOMParser){m="nod"}else if(!window.XPathEvaluator){m="nox"}else{psr=new DOMParser;var e=psr.parseFromString("Invalid","text/xml");nse=e.getElementsByTagName("parsererror")[0].namespaceURI;xpe=new XPathEvaluator;m=1}return m};if(typeof opts!=="object"){opts={}}if(typeof opts.stay==="undefined"){stay=["all"]}else if(!opts.stay){stay=[]}else if(typeof opts.stay==="object"&&opts.stay instanceof Array){stay=opts.stay}else{stay=[opts.stay]}if(typeof opts.join==="undefined"){join=["root"]}else{join=[opts.join?String(opts.join):false]}if(typeof opts.updn==="undefined"){updn=true}else{updn=opts.updn}mde=GetMode();if(typeof mde==="string"){that.error={};Error(mde);mde=0}that.Init()}})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()},function(module,exports,__webpack_require__){"use strict";function FormLogicError(message){this.message=message||"unknown",this.name="FormLogicError",this.stack=(new Error).stack}(FormLogicError.prototype=Object.create(Error.prototype)).constructor=FormLogicError,module.exports=FormLogicError},function(module,exports,__webpack_require__){var XPathJS=__webpack_require__(419);module.exports=function(addExtensions){var evaluator=new XPathJS.XPathEvaluator;"function"==typeof addExtensions&&addExtensions(XPathJS),XPathJS.bindDomLevel3XPath(this.xml,{window:{JsXPathException:!0,JsXPathExpression:!0,JsXPathNSResolver:!0,JsXPathResult:!0,JsXPathNamespace:!0},document:{jsCreateExpression:function(){return evaluator.createExpression.apply(evaluator,arguments)},jsCreateNSResolver:function(){return evaluator.createNSResolver.apply(evaluator,arguments)},jsEvaluate:function(){return evaluator.evaluate.apply(evaluator,arguments)}}})}},function(module,exports,__webpack_require__){var parser=__webpack_require__(420),shuffle=__webpack_require__(421),geo=__webpack_require__(422);__webpack_require__(202),module.exports=function(){function nodeChildren(node){function filterSupportedNodeTypes(nodes,types){var item,i,filteredNodes=[];for(i=0;i<nodes.length;i++)item=nodes.item(i),!1!==arrayIndexOf(item.nodeType,types)&&filteredNodes.push(item);return filteredNodes}var nodes=[];switch(node.nodeType){case 1:nodes=filterSupportedNodeTypes(node.childNodes,supportedChildNodeTypes=[1,3,4,7,8]);break;case 9:nodes=filterSupportedNodeTypes(node.childNodes,supportedChildNodeTypes=[1,7,8]);break;case 2:case 3:case 4:case 7:case 8:case 13:break;default:throw new Error("Internal Error: nodeChildren - unsupported node type: "+node.nodeType)}return nodes}function nodeParent(node){switch(node.nodeType){case 1:case 3:case 4:case 7:case 8:case 9:return node.parentNode;case 2:return node.ownerElement?node.ownerElement:nodeAttributeSearch(node.ownerDocument,!0,function(element,attribute){if(attribute===node)return!0});case 13:return node.ownerElement;default:throw new Error("Internal Error: nodeParent - node type not supported: "+node.type)}}function nodeAncestor(node){for(var parent,nodes=[];parent=nodeParent(node);)nodes.push(parent),node=parent;return nodes}function nodeFollowingSibling(node){return nodeXSibling(node,"nextSibling")}function nodePrecedingSibling(node){return nodeXSibling(node,"previousSibling")}function nodeOwnerDocument(node){switch(node.nodeType){case 9:return node;default:return node.ownerDocument}}function nodeGetAttributes(node){var i,nodes=[];if(1===node.nodeType)for(i=0;i<node.attributes.length;i++)node.attributes[i].specified&&nodes.push(node.attributes[i]);return 1<nodes.length&&nodes[0].compareDocumentPosition&&nodes.sort(function(a,b){var position=a.compareDocumentPosition(b);return 2==(2&position)?1:4==(4&position)?-1:0}),nodes}function nodeAttribute(node){var i,allAttributeNodes=nodeGetAttributes(node),nodes=[];for(i=0;i<allAttributeNodes.length;i++)!1===isNamespaceAttributeNode(allAttributeNodes[i])&&nodes.push(allAttributeNodes[i]);return nodes}function nodeIdAttribute(node,attribute){var i,j,attributes,namespaces,ns,name;if(1===node.nodeType)for(attributes=attribute?[attribute]:nodeAttribute(node),namespaces=nodeNamespace.call(this,node),i=0;i<attributes.length;i++){for(1===(name=attributes[i].nodeName.split(":")).length&&(name[1]=name[0],name[0]=""),ns=null,j=0;j<namespaces.length;j++)if(namespaces[j].prefix===name[0]){ns=namespaces[j].namespaceURI;break}if(null===ns&&(ns=""),this.opts["unique-ids"][ns]===name[1])return attributes[i]}return null}function nodeExpandedName(node){var name,namespaces,i,qname;switch(node.nodeType){case 1:for(qname=void 0===node.scopeName||document.addEventListener?1==(name=node.nodeName.split(":")).length?{prefix:"",name:name[0]}:{prefix:name[0],name:name[1]}:{prefix:"HTML"==node.scopeName?"":node.scopeName,name:node.nodeName},this.opts["case-sensitive"]||(qname.prefix=qname.prefix.toLowerCase(),qname.name=qname.name.toLowerCase()),namespaces=nodeNamespace.call(this,node),i=0;i<namespaces.length;i++)if(namespaces[i].prefix===qname.prefix)return qname.ns=namespaces[i].namespaceURI,qname;if(""===qname.prefix)return qname.ns=null,qname;throw new Error('Internal Error: nodeExpandedName - Failed to expand namespace prefix "'+qname.prefix+'" on element: '+node.nodeName);case 2:if(1==(name=node.nodeName.split(":")).length)return{prefix:"",ns:null,name:name[0]};for(qname={prefix:name[0],name:name[1]},this.opts["case-sensitive"]||(qname.prefix=qname.prefix.toLowerCase(),qname.name=qname.name.toLowerCase()),namespaces=nodeNamespace.call(this,nodeParent(node)),i=0;i<namespaces.length;i++)if(namespaces[i].prefix===qname.prefix)return qname.ns=namespaces[i].namespaceURI,qname;throw new Error('Internal Error: nodeExpandedName - Failed to expand namespace prefix "'+qname.prefix+'" on attribute: '+node.nodeName);case 13:return{prefix:null,ns:null,name:this.opts["case-sensitive"]?node.prefix.toLowerCase():node.prefix};case 7:return{prefix:null,ns:null,name:this.opts["case-sensitive"]?node.target.toLowerCase():node.target};default:return!1}}function nodeStringValue(node){var i,nodeset,value="";switch(node.nodeType){case 9:case 1:for((nodeset=evaluateExpressionTree(new Context(node,1,1,{},{},{}),{type:"step",args:["descendant",{type:"nodeType",args:["text",[]]}]})).sortDocumentOrder(),i=0;i<nodeset.value.length;i++)value+=nodeset.value[i].data;return value;case 2:return node.nodeValue;case 13:return node.namespaceURI;case 7:case 8:case 3:case 4:return node.data;default:throw new Error("Internal Error: nodeStringValue does not support node type: "+node.nodeType)}}function createError(code,name,message){var err=new Error(message);return err.name=name,err.code=code,err}function getComparableNode(node){switch(node.nodeType){case 2:case 3:case 4:case 7:case 8:return nodeParent(node);case 1:case 9:return node;case 13:default:throw new Error("Internal Error: getComparableNode - Node type not supported: "+node.nodeType)}}function compareDocumentPosition(a,b){var result,nodes,i;if(13==a.nodeType&&13==b.nodeType&&a.ownerElement==b.ownerElement){if(a===b)return 0;for(nodes=nodeNamespace.call(currentExpression,a.ownerElement),i=0;i<nodes.length;i++){if(nodes[i]===a){result=4;break}if(nodes[i]===b){result=2;break}}}else 13==a.nodeType&&(a=a.ownerElement),13==b.nodeType&&(b=b.ownerElement),result=compareDocumentPositionNoNamespace(a,b);return result}function nodeSupported(contextNode){if(!contextNode)throw createError(9,"NOT_SUPPORTED_ERR","Context node was not supplied.");if(9!=contextNode.nodeType&&1!=contextNode.nodeType&&2!=contextNode.nodeType&&3!=contextNode.nodeType&&4!=contextNode.nodeType&&8!=contextNode.nodeType&&7!=contextNode.nodeType&&13!=contextNode.nodeType)throw createError(9,"NOT_SUPPORTED_ERR","The supplied node type is not supported. (nodeType: "+contextNode.nodeType+")");if(2==contextNode.nodeType&&!contextNode.specified)throw createError(9,"NOT_SUPPORTED_ERR","The supplied node is a non-specified attribute node. Only specified attribute nodes are supported.")}var XPathException,XPathEvaluator,XPathExpression,XPathNSResolver,XPathResult,XPathNamespace,module,evaluateExpressionTree,expressions,functions,Context,BaseType,BooleanType,StringType,NumberType,NodeSetType,currentExpression,namespaceCache=[],NAMESPACE_URI_XML="http://www.w3.org/XML/1998/namespace",nodeDescendant=function(node){var nodes,i,nodes2=[];for(nodes=nodeChildren(node),i=0;i<nodes.length;i++)nodes2.push(nodes[i]),nodes2.push.apply(nodes2,nodeDescendant(nodes[i]));return nodes2},nodeXSibling=function(node,type){for(var sibling,nodes=[];sibling=node[type];){switch(sibling.nodeType){case 1:case 3:case 4:case 7:case 8:case 9:nodes.push(sibling)}node=sibling}return nodes},nodeNamespace=function(node,nsNodes){var allAttributeNodes,i,name,item,nodes=nsNodes||[];if(1===node.nodeType){if(node.ownerDocument.documentElement===node&&"object"==typeof node.ownerDocument.namespaces)for(i=node.ownerDocument.namespaces.length-1;0<=i;i--)item=node.ownerDocument.namespaces.item(i),insertNamespaceIfNotDeclared.call(this,nodes,item.name,item.urn,node);for(i=(allAttributeNodes=nodeGetAttributes(node)).length-1;0<=i;i--)!1!==(name=isNamespaceAttributeNode(allAttributeNodes[i]))&&(1!==name.length?insertNamespaceIfNotDeclared.call(this,nodes,name[1],allAttributeNodes[i].nodeValue,node):insertNamespaceIfNotDeclared.call(this,nodes,"",allAttributeNodes[i].nodeValue,node));if(nodeNamespace.call(this,node.parentNode,nodes),void 0===nsNodes&&(insertNamespaceIfNotDeclared.call(this,nodes,"xml",NAMESPACE_URI_XML,node),nodes[0]&&""===nodes[0].prefix&&""===nodes[0].namespaceURI&&nodes.shift()),void 0===nsNodes)for(i=0;i<nodes.length;i++)nodes[i].ownerElement!==node&&(nodes[i]=createNamespaceNode(nodes[i].prefix,nodes[i].nodeValue,node))}return nodes},insertNamespaceIfNotDeclared=function(namespaces,prefix,ns,parent){var i,namespace;for(this.opts["case-sensitive"]||(prefix=prefix.toLowerCase()),i=0;i<namespaces.length;i++)if(namespaces[i].prefix===prefix)return!1;return namespace=createNamespaceNode(prefix,ns,parent),""===prefix&&null!==ns?namespaces.unshift(namespace):namespaces.push(namespace),!0},isNamespaceAttributeNode=function(node){var name=node.nodeName.split(":");return"xmlns"===name[0]&&name},nodeAttributeSearch=function(startNode,stopAfterFirstMatch,fn){var i,j,elements,element,matches=[];for(elements=startNode.getElementsByTagName("*"),i=0;i<elements.length;i++)if(1==(element=elements.item(i)).nodeType)for(j=0;j<element.attributes.length;j++)if(element.attributes[j].specified&&!0===fn(element,element.attributes[j])){if(stopAfterFirstMatch)return element;matches.push(element);break}return stopAfterFirstMatch?null:matches},arrayIndexOf=function(needle,haystack){for(var i=haystack.length;i--;)if(haystack[i]===needle)return i;return!1},compareOperator=function(left,right,operator,compareFunction){var i,j,leftValues,rightValues,result;if(left instanceof NodeSetType)if(right instanceof NodeSetType){for(rightValues=right.stringValues(),leftValues=left.stringValues(),i=0;i<leftValues.length;i++)for(j=0;j<rightValues.length;j++)if((result=compareOperator(leftValues[i],rightValues[j],operator,compareFunction)).toBoolean())return result}else if(right instanceof NumberType){for(leftValues=left.stringValues(),i=0;i<leftValues.length;i++)if((result=compareOperator(new NumberType(leftValues[i].toNumber()),right,operator,compareFunction)).toBoolean())return result}else if(right instanceof DateType||right instanceof StringType&&right.isDateString()){for(right instanceof StringType&&(right=new DateType(right)),leftValues=left.stringValues(),i=0;i<leftValues.length;i++)if((result=compareOperator(new DateType(leftValues[i].toDate()),right,operator,compareFunction)).toBoolean())return result}else{if(!(right instanceof StringType))return compareOperator(new BooleanType(left.toBoolean()),right,operator,compareFunction);for(leftValues=left.stringValues(),i=0;i<leftValues.length;i++)if((result=compareOperator(leftValues[i],right,operator,compareFunction)).toBoolean())return result}else if(right instanceof NodeSetType)if(left instanceof NumberType){for(rightValues=right.stringValues(),i=0;i<rightValues.length;i++)if((result=compareOperator(left,new NumberType(rightValues[i].toNumber()),operator,compareFunction)).toBoolean())return result}else if(left instanceof DateType||left instanceof StringType&&left.isDateString()){for(left instanceof StringType&&(left=new DateType(left)),rightValues=right.stringValues(),i=0;i<rightValues.length;i++)if((result=compareOperator(left,new DateType(rightValues[i].toDate()),operator,compareFunction)).toBoolean())return result}else{if(!(left instanceof StringType))return compareOperator(left,new BooleanType(right.toBoolean()),operator,compareFunction);for(rightValues=right.stringValues(),i=0;i<rightValues.length;i++)if((result=compareOperator(left,rightValues[i],operator,compareFunction)).toBoolean())return result}else switch(operator){case"=":case"!=":return new BooleanType(left instanceof BooleanType||right instanceof BooleanType?compareFunction(left.toBoolean(),right.toBoolean()):left instanceof NumberType||right instanceof NumberType?compareFunction(left.toNumber(),right.toNumber()):compareFunction(left.toString(),right.toString()));default:return new BooleanType(compareFunction(left.toNumber(),right.toNumber()))}return new BooleanType(!1)},compareDocumentPositionNoNamespace=function(a,b){function compareOriginalVsComparableNode(a,a2,b,b2,result,v16,v8,v4,v2){return 0===result||(result&v16)===v16?v4+v16:(result&v8)===v8?v2:result}var a2,b2,result,i,item;if(a.compareDocumentPosition)return a.compareDocumentPosition(b);if(a===b)return 0;if(a2=getComparableNode(a),b2=getComparableNode(b),9===a2.nodeType)if(9===b2.nodeType){if(a2!==b2)return 1;result=0}else{if(a2!==b2.ownerDocument)return 1;result=20}else if(9===b2.nodeType){if(b2!==a2.ownerDocument)return 1;result=10}else{if(a2.ownerDocument!==b2.ownerDocument)return 1;if(!a2.contains||void 0===a2.sourceIndex||!b2.contains||void 0===b2.sourceIndex)throw new Error('Cannot compare elements. Neither "compareDocumentPosition" nor "contains" available.');result=(a2!=b2&&a2.contains(b2)&&16)+(a2!=b2&&b2.contains(a2)&&8)+(0<=a2.sourceIndex&&0<=b2.sourceIndex?(a2.sourceIndex<b2.sourceIndex&&4)+(a2.sourceIndex>b2.sourceIndex&&2):1)+0}if(a===a2&&b===b2)return result;if(a===a2)return compareOriginalVsComparableNode(0,0,0,0,result,16,8,4,2);if(b===b2)return compareOriginalVsComparableNode(0,0,0,0,result,8,16,2,4);if(16==(16&result))return 4;if(8==(8&result))return 2;if(0!==result)return result;for(i=0;i<a2.attributes.length;i++)if((item=a2.attributes[i]).specified){if(item===b)return 2;if(item===a)return 4}throw new Error("Internal Error: compareDocumentPosition failed to sort attributes.")},createNamespaceNode=function(prefix,ns,parent){var i,namespaceNode;for(i=0;i<namespaceCache.length;i++)if((namespaceNode=namespaceCache[i]).prefix===prefix&&namespaceNode.nodeValue===ns&&namespaceNode.ownerElement===parent)return namespaceNode;return namespaceNode=new XPathNamespace(prefix,ns,parent),namespaceCache.push(namespaceNode),namespaceNode};return(BaseType=function(value,type,supports){this.value=value,this.type=type,this.supports=supports}).prototype={value:null,type:null,supports:[],toBoolean:function(){throw new Error('Unable to convert "'+this.type+'" to "boolean".')},toString:function(){throw new Error('Unable to convert "'+this.type+'" to "string".')},toNumber:function(){throw new Error('Unable to convert "'+this.type+'" to "number".')},toNodeSet:function(){throw new Error('Unable to convert "'+this.type+'" to "node-set".')},toDate:function(){throw new Error('Unable to convert "'+this.type+'" to "date".')},canConvertTo:function(type){return!1!==arrayIndexOf(type,this.supports)}},(BooleanType=function(value){BaseType.call(this,value,"boolean",["boolean","string","number","date"])}).prototype=new BaseType,(BooleanType.constructor=BooleanType).prototype.toBoolean=function(){return this.value},BooleanType.prototype.toString=function(){return!0===this.value?"true":"false"},BooleanType.prototype.toNumber=function(){return this.value?1:0},BooleanType.prototype.toDate=function(){return null},(NodeSetType=function(value,documentOrder){BaseType.call(this,value,"node-set",["boolean","string","number","node-set","date"]),this.docOrder=documentOrder||"unsorted"}).prototype=new BaseType,(NodeSetType.constructor=NodeSetType).prototype.toBoolean=function(){return 0<this.value.length},NodeSetType.prototype.toString=function(){return this.value.length<1?"":(this.sortDocumentOrder(),nodeStringValue(this.value[0]))},NodeSetType.prototype.toNumber=function(){return new StringType(this.toString()).toNumber()},NodeSetType.prototype.toNodeSet=function(){return this.value},NodeSetType.prototype.toDate=function(){return new StringType(this.toString()).toDate()},NodeSetType.prototype.sortDocumentOrder=function(){switch(this.docOrder){case"document-order":break;case"reverse-document-order":this.value.reverse();break;default:this.value.sort(function(a,b){var result=compareDocumentPosition(a,b);if(4==(4&result))return-1;if(2==(2&result))return 1;throw new Error("NodeSetType.sortDocumentOrder - unexpected compare result: "+result)})}this.docOrder="document-order"},NodeSetType.prototype.sortReverseDocumentOrder=function(){switch(this.docOrder){case"document-order":this.value.reverse();break;case"reverse-document-order":break;default:this.sortDocumentOrder(),this.value.reverse()}this.docOrder="reverse-document-order"},NodeSetType.prototype.append=function(nodeset){var result,i=0,j=0;if(!nodeset instanceof NodeSetType)throw new Error("NodeSetType can be passed into NodeSetType.append method");for(this.sortDocumentOrder(),nodeset.sortDocumentOrder();i<this.value.length&&j<nodeset.value.length;)if(0==(result=compareDocumentPosition(this.value[i],nodeset.value[j])))j++;else if(4==(4&result))i++;else{if(2!=(2&result))throw new Error("Internal Error: NodeSetType.append - unable to sort nodes. (result: "+result+")");this.value.splice(i,0,nodeset.value[j]),i++,j++}for(;j<nodeset.value.length;j++)this.value.push(nodeset.value[j]);this.docOrder="document-order"},NodeSetType.prototype.stringValues=function(){var i,obj,values=[];for(i=0;i<this.value.length;i++)(obj=new StringType(nodeStringValue(this.value[i]))).isDateString()&&(obj=new DateType(obj.value)),values.push(obj);return values},(StringType=function(value){BaseType.call(this,value,"string",["boolean","string","number","date"])}).prototype=new BaseType,(StringType.constructor=StringType).prototype.toBoolean=function(){return 0<this.value.length},StringType.prototype.toString=function(){return this.value},StringType.prototype.toNumber=function(){var result;return this.isDateString(this.value)?new DateType(this.value).toNumber():null!==(result=this.value.match(/^[ \t\r\n]*(-?[0-9]+(?:[.][0-9]*)?)[ \t\r\n]*$/))?parseFloat(result[1]):null!==(result=this.value.match(/^[ \t\r\n]*(-?[.][0-9]+)[ \t\r\n]*$/))?parseFloat(result[1]):Number.NaN},StringType.prototype.toDate=function(){return new Date(this.value)},StringType.prototype.isDateString=function(){return!!isNaN(this.value)&&(!isNaN(Date.parse(this.value))&&!!/('|")?[0-9]{4}(-|\/)[0-9]{2}(-|\/)[0-9]{2}('|")?/.test(this.value))},(NumberType=function(value){BaseType.call(this,value,"number",["boolean","string","number","date"])}).prototype=new BaseType,(NumberType.constructor=NumberType).prototype.toBoolean=function(){return 0!==this.value&&!isNaN(this.value)},NumberType.prototype.toString=function(){return this.value.toString()},NumberType.prototype.toNumber=function(){return this.value},NumberType.prototype.toDate=function(){return new Date(864e5*this.value)},DateType=function(value){BaseType.call(this,value,"date",["date","string","number","boolean"])},DateType.prototype=new BaseType,DateType.constructor=DateType,DateType.prototype.toDate=function(){return new Date(this.value)},DateType.prototype.toString=function(){return new Date(this.value).toISOLocalString()},DateType.prototype.toNumber=function(){return new Date(this.value).getTime()/864e5},DateType.prototype.toBoolean=function(){return!isNaN(new Date(this.value).getTime())},(XPathException=function(code,message){var err;switch(this.code=code,this.code){case XPathException.INVALID_EXPRESSION_ERR:this.name="INVALID_EXPRESSION_ERR";break;case XPathException.TYPE_ERR:this.name="TYPE_ERR";break;default:throw(err=new Error("Unsupported XPathException code: "+this.code)).name="XPathExceptionInternalError",err}this.message=message||""}).prototype.toString=function(){return'XPathException: "'+this.message+'", code: "'+this.code+'", name: "'+this.name+'"'},XPathException.INVALID_EXPRESSION_ERR=51,XPathException.TYPE_ERR=52,(XPathEvaluator=function(options){var option,defaultOption,found;for(option in options){for(defaultOption in found=!1,this.opts)if(option===defaultOption){this.opts[option]=options[option],found=!0;break}if(!found)throw new Error("Unsupported option: "+option)}this.opts["unique-ids"][NAMESPACE_URI_XML]="id",this.opts["unique-ids"]["http://www.w3.org/1999/xhtml"]="id"}).prototype={opts:{"unique-ids":{},"case-sensitive":!1},createExpression:function(expression,resolver){var tree,message,i,prefix,nsMapping={};try{tree=parser.parse(expression)}catch(err){throw message="The expression is not a legal expression.",err instanceof parser.SyntaxError?message+=" (line: "+err.line+", character: "+err.column+")":message+=" ("+err.message+")",new XPathException(XPathException.INVALID_EXPRESSION_ERR,message)}if(0<tree.nsPrefixes.length){if("object"!=typeof resolver||void 0===resolver.lookupNamespaceURI)throw new XPathException(XPathException.INVALID_EXPRESSION_ERR,"No namespace resolver provided or lookupNamespaceURI function not supported.");for(i=0;i<tree.nsPrefixes.length;i++)if(nsMapping[prefix=tree.nsPrefixes[i]]=resolver.lookupNamespaceURI(prefix),null===nsMapping[prefix])throw createError(14,"NAMESPACE_ERR",'Undefined namespace prefix "'+prefix+'" in the context of the given resolver.')}return new XPathExpression(tree,nsMapping,this.opts)},createNSResolver:function(nodeResolver){return new XPathNSResolver(nodeResolver)},evaluate:function(expression,contextNode,resolver,type,result){return(expression=this.createExpression(expression,resolver)).evaluate(contextNode,type,result)}},(XPathExpression=function(parsedExpression,namespaceMapping,options){this.parsedExpression=parsedExpression,this.namespaceMapping=namespaceMapping,this.opts=options||{}}).prototype={parsedExpression:null,namespaceMapping:null,opts:{},evaluate:function(contextNode,type,result){var context;return currentExpression=this,nodeSupported(contextNode),context=new Context(contextNode,1,1,{},functions,this.namespaceMapping,this.opts),XPathResult.factory(context,type,evaluateExpressionTree(context,this.parsedExpression.tree))}},(Context=function(node,position,size,vars,functions,namespaceMap,options){this.node=node,this.pos=position,this.size=size,this.vars=vars,this.fns=functions,this.nsMap=namespaceMap,this.opts=options||{}}).prototype={node:null,pos:null,size:null,vars:null,fns:null,nsMap:null,opts:null,clone:function(node,position,size){return new Context(node||this.node,void 0!==position?position:this.pos,void 0!==size?size:this.size,this.vars,this.fns,this.nsMap,this.opts)}},(XPathNSResolver=function(nodeResolver){nodeSupported(nodeResolver),this.node=nodeResolver}).prototype={node:null,lookupNamespaceURI:function(prefix){var i,namespace,tmpNode,node=this.node;switch(prefix){case"xml":return NAMESPACE_URI_XML;case"xmlns":return"http://www.w3.org/2000/xmlns/";default:switch(this.node.nodeType){case 9:node=node.documentElement;break;case 1:break;default:node=nodeParent(node)}if(null!=node&&1==node.nodeType){if(""==prefix){if(null!==(namespace=node.getAttribute("xmlns")))return namespace}else{if(node.ownerDocument.documentElement===node&&"object"==typeof node.ownerDocument.namespaces)for(i=0;i<node.ownerDocument.namespaces.length;i++)if((namespace=node.ownerDocument.namespaces.item(i)).name==prefix)return namespace.urn;for(i=0;i<node.attributes.length;i++)if(node.attributes[i].specified&&"xmlns:"+prefix==node.attributes[i].nodeName)return node.attributes[i].nodeValue}if(node.ownerDocument.documentElement!==node&&node.parentNode)return tmpNode=this.node,this.node=node.parentNode,namespace=this.lookupNamespaceURI(prefix),this.node=tmpNode,namespace}return null}}},(functions={"":{last:{fn:function(){return new NumberType(this.size)},ret:"number"},count:{fn:function(nodeset){return new NumberType(nodeset.toNodeSet().length)},args:[{t:"node-set"}],ret:"number"},id:{fn:function(object){function splitStringByWhitespace(str){var i,chunks=str.split(/[\u0020\u0009\u000D\u000A]+/);for(i=chunks.length-1;0<=i;i--)0==chunks[i].length&&chunks.splice(i,1);return chunks}var i,j,node,context=this,ids=[],nodes=[];if(object instanceof NodeSetType)for(i=0;i<object.value.length;i++)ids.push.apply(ids,splitStringByWhitespace(nodeStringValue(object.value[i])));else object=object.toString(),ids=splitStringByWhitespace(object);for(i=ids.length-1;0<=i;i--)for(j=i-1;0<=j;j--)if(ids[i]==ids[j]&&i!=j){ids.splice(i,1);break}for(i=0;i<ids.length;i++)(node=nodeOwnerDocument(this.node).getElementById(ids[i]))&&nodeIdAttribute.call(this,node)?nodes.push(node):nodeAttributeSearch(nodeOwnerDocument(this.node),!0,function(element,attribute){var idAttribute=nodeIdAttribute.call(context,element,attribute);if(idAttribute&&idAttribute.nodeValue==ids[i])return nodes.push(element),!0});return new NodeSetType(nodes)},args:[{}],ret:"node-set"},"local-name":{fn:function(nodeset){var qname,localName="";return 0==arguments.length&&(nodeset=new NodeSetType([this.node])),0<nodeset.toNodeSet().length&&(nodeset.sortDocumentOrder(),!1!==(qname=nodeExpandedName.call(this,nodeset.value[0]))&&(localName=qname.name)),new StringType(localName)},args:[{t:"node-set",r:!(expressions={"/":function(left,right){var i,nodeset,nodeset2,resultNodeset,newContext;if(null===left)nodeset=new NodeSetType([nodeOwnerDocument(this.node)],"document-order");else if(!(nodeset=evaluateExpressionTree(this,left))instanceof NodeSetType)throw new Error("Left side of path separator (/) must be of node-set type. (type: "+nodeset.type+")");if(null===right)resultNodeset=nodeset;else for(resultNodeset=new NodeSetType([],"document-order"),i=0;i<nodeset.value.length;i++){if(newContext=this.clone(nodeset.value[i]),!(nodeset2=evaluateExpressionTree(newContext,right))instanceof NodeSetType)throw new Error("Right side of path separator (/) must be of node-set type. (type: "+nodeset2.type+")");resultNodeset.append(nodeset2)}return resultNodeset},step:function(axis,nodeTest){var nodeset,i,node,nodes,qname,nodeType,expandedName;switch(axis){case"child":nodeset=new NodeSetType(nodeChildren(this.node),"document-order");break;case"descendant":nodeset=new NodeSetType(nodeDescendant(this.node),"document-order");break;case"parent":node=nodeParent(this.node),nodeset=new NodeSetType(node?[node]:[],"document-order");break;case"ancestor":nodeset=new NodeSetType(nodeAncestor(this.node),"reverse-document-order");break;case"following-sibling":nodeset=new NodeSetType(nodeFollowingSibling(this.node),"document-order");break;case"preceding-sibling":nodeset=new NodeSetType(nodePrecedingSibling(this.node),"reverse-document-order");break;case"following":nodeset=new NodeSetType(function(node){var parents,i,siblings,j,nodes=[];for((parents=nodeAncestor(node)).unshift(node),i=0;i<parents.length;i++)for(siblings=nodeFollowingSibling(parents[i]),j=0;j<siblings.length;j++)nodes.push(siblings[j]),nodes.push.apply(nodes,nodeDescendant(siblings[j]));return nodes}(this.node),"document-order");break;case"preceding":nodeset=new NodeSetType(function(node){var parents,i,siblings,j,nodes=[];for((parents=nodeAncestor(node)).unshift(node),i=0;i<parents.length;i++)for(siblings=nodePrecedingSibling(parents[i]),j=0;j<siblings.length;j++)nodes.push.apply(nodes,nodeDescendant(siblings[j]).reverse()),nodes.push(siblings[j]);return nodes}(this.node),"reverse-document-order");break;case"attribute":nodeset=new NodeSetType(nodeAttribute(this.node),"document-order");break;case"namespace":nodeset=new NodeSetType(nodeNamespace.call(this,this.node),"document-order");break;case"self":nodeset=new NodeSetType([this.node],"document-order");break;case"descendant-or-self":(nodes=nodeDescendant(this.node)).unshift(this.node),nodeset=new NodeSetType(nodes,"document-order");break;case"ancestor-or-self":(nodes=nodeAncestor(this.node)).unshift(this.node),nodeset=new NodeSetType(nodes,"reverse-document-order");break;default:throw new Error("Axis type not supported: "+axis)}switch(nodeTest.type){case"nodeType":if("node"==nodeTest.args[0])break;for(i=nodeset.value.length-1;0<=i;i--)switch(nodeTest.args[0]){case"text":3!=nodeset.value[i].nodeType&&4!=nodeset.value[i].nodeType&&nodeset.value.splice(i,1);break;case"comment":8!=nodeset.value[i].nodeType&&nodeset.value.splice(i,1);break;case"processing-instruction":(7!=nodeset.value[i].nodeType||0<nodeTest.args[1].length&&evaluateExpressionTree(this,nodeTest.args[1][0])!=nodeset.value[i].nodeName)&&nodeset.value.splice(i,1)}break;case"name":switch(qname=evaluateExpressionTree(this,nodeTest),axis){case"attribute":nodeType=2;break;case"namespace":nodeType=13;break;default:nodeType=1}for(i=nodeset.value.length-1;0<=i;i--)nodeset.value[i].nodeType==nodeType?null===qname.ns&&null===qname.name||(!1!==(expandedName=nodeExpandedName.call(this,nodeset.value[i]))&&expandedName.ns===qname.ns?null!==qname.name&&expandedName.name.toLowerCase()!=qname.name.toLowerCase()&&nodeset.value.splice(i,1):nodeset.value.splice(i,1)):nodeset.value.splice(i,1);break;default:throw new Error("NodeTest type not supported in step: "+nodeTest.type)}return nodeset},predicate:function(axis,expr,predicateExprs){var nodeset,i,result,j,k,length;if(!(nodeset=evaluateExpressionTree(this,expr))instanceof NodeSetType)throw new Error('Expected "node-set", got: '+nodeset.type);switch(axis){case"ancestor":case"ancestor-or-self":case"preceding":case"preceding-sibling":nodeset.sortReverseDocumentOrder();break;default:nodeset.sortDocumentOrder()}for(j=0;j<predicateExprs.length;j++)for(i=0,k=1,length=nodeset.value.length;i<nodeset.value.length;k++){if((result=evaluateExpressionTree(this.clone(nodeset.value[i],k,length),predicateExprs[j]))instanceof NumberType){if(result.value!=k){nodeset.value.splice(i,1);continue}}else if(!result.toBoolean()){nodeset.value.splice(i,1);continue}i++}return nodeset},function:function(name,args){function formatName(qname){return(null!==qname.ns?"{"+qname.ns+"}":"{}")+qname.name}function formatFnArgs(args){var i,type,types=[];for(i=0;i<args.length;i++)type=void 0===args[i].t?"object":args[i].t,!1!==args[i].r?!0===args[i].rep&&(type+="+"):!0===args[i].rep?type+="*":type+="?",types.push(type);return"("+types.join(", ")+")"}var qname,fnInfo,i,val,argVals=[],j=0,argTypes=[];if(null===(qname=evaluateExpressionTree(this,name)).ns&&(qname.ns=""),!this.fns[qname.ns]||!this.fns[qname.ns][qname.name])throw new Error('Function "'+formatName(qname)+'" does not exist.');for((fnInfo=this.fns[qname.ns][qname.name]).args||(fnInfo.args=[]),j=i=0;i<fnInfo.args.length;j++,i++){if(void 0===args[j]){if(!1!==fnInfo.args[i].r)throw new Error('Function "'+formatName(qname)+'" expects '+formatFnArgs(fnInfo.args)+".")}else argTypes.push(void 0===fnInfo.args[i].t?"object":fnInfo.args[i].t);if(!0===fnInfo.args[i].rep){for(;j<args.length;j++)argTypes.push(void 0===fnInfo.args[i].t?"object":fnInfo.args[i].t);break}}if(argTypes.length<args.length)throw new Error('Function "'+formatName(qname)+'" expects '+formatFnArgs(fnInfo.args)+".");for(i=0;i<args.length;i++){if(val=evaluateExpressionTree(this,args[i]),"object"!==argTypes[i]&&!val.canConvertTo(argTypes[i]))throw new Error('Function "'+formatName(qname)+'" expects '+formatFnArgs(fnInfo.args)+'.Cannot convert "'+val.type+'" to "'+argTypes[i]+'".');argVals.push(val)}if(result=fnInfo.fn.apply(this,argVals),!result instanceof BaseType)throw new Error('Function "'+formatName(qname)+'" did not return a value that inherits from BaseType.');if("object"!==fnInfo.ret&&!result.canConvertTo(fnInfo.ret))throw new Error('Function "'+formatName(qname)+'" return "'+result.type+'" type that cannot be converted to "'+fnInfo.ret+'".');return result},"|":function(left,right){if(left=evaluateExpressionTree(this,left),right=evaluateExpressionTree(this,right),void 0===left||void 0===right||!left instanceof NodeSetType||!right instanceof NodeSetType)throw new Error('Unable to perform union on non-"node-set" types.');return left.append(right),left},or:function(left,right){return evaluateExpressionTree(this,left).toBoolean()?new BooleanType(!0):new BooleanType(evaluateExpressionTree(this,right).toBoolean())},and:function(left,right){return evaluateExpressionTree(this,left).toBoolean()?new BooleanType(evaluateExpressionTree(this,right).toBoolean()):new BooleanType(!1)},"=":function(left,right){return compareOperator.call(this,evaluateExpressionTree(this,left),evaluateExpressionTree(this,right),"=",function(left,right){return left==right})},"!=":function(left,right){return compareOperator.call(this,evaluateExpressionTree(this,left),evaluateExpressionTree(this,right),"!=",function(left,right){return left!=right})},"<=":function(left,right){return compareOperator.call(this,evaluateExpressionTree(this,left),evaluateExpressionTree(this,right),"<=",function(left,right){return left<=right})},"<":function(left,right){return compareOperator.call(this,evaluateExpressionTree(this,left),evaluateExpressionTree(this,right),"<",function(left,right){return left<right})},">=":function(left,right){return compareOperator.call(this,evaluateExpressionTree(this,left),evaluateExpressionTree(this,right),">=",function(left,right){return right<=left})},">":function(left,right){return compareOperator.call(this,evaluateExpressionTree(this,left),evaluateExpressionTree(this,right),">",function(left,right){return right<left})},"+":function(left,right){return new NumberType(evaluateExpressionTree(this,left).toNumber()+evaluateExpressionTree(this,right).toNumber())},"-":function(left,right){return new NumberType(evaluateExpressionTree(this,left).toNumber()-evaluateExpressionTree(this,right).toNumber())},div:function(left,right){return new NumberType(evaluateExpressionTree(this,left).toNumber()/evaluateExpressionTree(this,right).toNumber())},mod:function(left,right){return new NumberType(evaluateExpressionTree(this,left).toNumber()%evaluateExpressionTree(this,right).toNumber())},"*":function(left,right){return new NumberType(evaluateExpressionTree(this,left).toNumber()*evaluateExpressionTree(this,right).toNumber())},string:function(string){return new StringType(string)},number:function(number){return new NumberType(number)},$:function(name){throw new Error("TODO: Not implemented.16")},name:function(prefix,name){var ns=null;if(null!==prefix&&!(ns=this.nsMap[prefix]))throw new Error('Namespace prefix "'+prefix+'" is not mapped to a namespace.');return{ns:ns,name:name}}})}],ret:"string"},"namespace-uri":{fn:function(nodeset){var qname,namespaceURI="";return 0==arguments.length&&(nodeset=new NodeSetType([this.node])),0<nodeset.toNodeSet().length&&(nodeset.sortDocumentOrder(),!1!==(qname=nodeExpandedName.call(this,nodeset.value[0]))&&null!==qname.ns&&(namespaceURI=qname.ns)),new StringType(namespaceURI)},args:[{t:"node-set",r:!1}],ret:"string"},name:{fn:function(nodeset){var qname,name="";return 0==arguments.length&&(nodeset=new NodeSetType([this.node])),0<nodeset.toNodeSet().length&&(nodeset.sortDocumentOrder(),!1!==(qname=nodeExpandedName.call(this,nodeset.value[0]))&&(name=qname.prefix&&0<qname.prefix.length?qname.prefix+":"+qname.name:qname.name)),new StringType(name)},args:[{t:"node-set",r:!1}],ret:"string"},string:{fn:function(object){return 0==arguments.length&&(object=new NodeSetType([this.node],"document-order")),new StringType(object.toString())},args:[{t:"object",r:!1}],ret:"string"},"starts-with":{fn:function(haystack,needle){return new BooleanType(haystack.toString().substr(0,(needle=needle.toString()).length)==needle)},args:[{t:"string"},{t:"string"}],ret:"string"},contains:{fn:function(haystack,needle){return new BooleanType(-1!=haystack.toString().indexOf(needle=needle.toString()))},args:[{t:"string"},{t:"string"}],ret:"string"},"substring-before":{fn:function(haystack,needle){return needle=(haystack=haystack.toString()).indexOf(needle.toString()),new StringType(-1==needle?"":haystack.substr(0,needle))},args:[{t:"string"},{t:"string"}],ret:"string"},"substring-after":{fn:function(haystack,needle){var pos;return haystack=haystack.toString(),needle=needle.toString(),pos=haystack.indexOf(needle),new StringType(-1==pos?"":haystack.substr(pos+needle.length))},args:[{t:"string"},{t:"string"}],ret:"string"},substring:{fn:function(str,start,length){return str=str.toString(),start=Math.round(start.toNumber())-1,new StringType(isNaN(start)?"":2==arguments.length?str.substring(start<0?0:start):str.substring(start<0?0:start,start+Math.round(length.toNumber())))},args:[{t:"string"},{t:"number"},{t:"number",r:!1}],ret:"string"},"string-length":{fn:function(str){return str=0==arguments.length?nodeStringValue(this.node):str.toString(),new NumberType(str.length)},args:[{t:"string",r:!1}],ret:"number"},"normalize-space":{fn:function(str){return str=0==arguments.length?nodeStringValue(this.node):str.toString(),new StringType(str.replace(/^[\u0020\u0009\u000D\u000A]+/,"").replace(/[\u0020\u0009\u000D\u000A]+$/,"").replace(/[\u0020\u0009\u000D\u000A]+/g," "))},args:[{t:"string",r:!1}],ret:"string"},translate:{fn:function(haystack,search,replace){var i,j,x,result="";for(haystack=haystack.toString(),search=search.toString(),replace=replace.toString(),i=0;i<haystack.length;i++)-1!=(j=search.indexOf(x=haystack.charAt(i)))&&!(x=replace.charAt(j))||(result+=x);return new StringType(result)},args:[{t:"string"},{t:"string"},{t:"string"}],ret:"string"},boolean:{fn:function(object){return new BooleanType(object.toBoolean())},args:[{r:!0}],ret:"boolean"},not:{fn:function(bool){return new BooleanType(!bool.toBoolean())},args:[{t:"boolean"}],ret:"boolean"},true:{fn:function(){return new BooleanType(!0)},ret:"boolean"},false:{fn:function(){return new BooleanType(!1)},ret:"boolean"},lang:{fn:function(string){for(var attributes,attributeName,attributeValueParts,namespaceNodes,i,j,partsEqual,node=this.node,langParts=string.toString().toLowerCase().split("-");9!=node.nodeType;node=nodeParent(node))for(attributes=nodeAttribute(node),i=0;i<attributes.length;i++)if(1===(attributeName=attributes[i].nodeName.split(":")).length&&(attributeName[1]=attributeName[0],attributeName[0]=""),"lang"==attributeName[1]){if((attributeValueParts=attributes[i].nodeValue.toLowerCase().split("-")).length<langParts.length)continue;for(partsEqual=!0,j=0;j<langParts.length;j++)if(langParts[j]!=attributeValueParts[j]){partsEqual=!1;break}if(partsEqual)for(namespaceNodes=nodeNamespace.call(this,node),j=0;j<namespaceNodes.length;j++)if(namespaceNodes[j].prefix==attributeName[0]&&namespaceNodes[j].nodeValue==NAMESPACE_URI_XML)return new BooleanType(!0)}return new BooleanType(!1)},args:[{t:"string"}],ret:"boolean"},number:{fn:function(object){return 0==arguments.length&&(object=new NodeSetType([this.node],"document-order")),new NumberType(object.toNumber())},args:[{t:"object",r:!1}],ret:"number"},sum:{fn:function(nodeset){var i,sum=0;for(nodeset=nodeset.toNodeSet(),i=0;i<nodeset.length;i++)sum+=new StringType(nodeStringValue(nodeset[i])).toNumber();return new NumberType(sum)},args:[{t:"node-set"}],ret:"number"},floor:{fn:function(number){return new NumberType(Math.floor(number))},args:[{t:"number"}],ret:"number"},ceiling:{fn:function(number){return new NumberType(Math.ceil(number))},args:[{t:"number"}],ret:"number"},"count-non-empty":{fn:function(nodeset){var i,count=0;for(nodeset=nodeset.toNodeSet(),i=0;i<nodeset.length;i++)0<new StringType(nodeStringValue(nodeset[i])).toString().length&&count++;return new NumberType(count)},args:[{t:"node-set"}],ret:"number"},position:{fn:function(nodeset){if(nodeset){var node,nodeName,position;if(1!==(nodeset=nodeset.toNodeSet()).length)throw new Error("nodeset provided to position() contained multiple nodes");for(position=1,nodeName=(node=nodeset[0]).tagName;node.previousElementSibling&&node.previousElementSibling.tagName===nodeName;)node=node.previousElementSibling,position++;return new NumberType(position)}return new NumberType(this.pos)},args:[{t:"node-set",r:!1}],ret:"number"},concat:{fn:function(o1){var i,value="";for(i=0;i<arguments.length;i++)value+=arguments[i]instanceof NodeSetType?arguments[i].stringValues().join(""):arguments[i].toString();return new StringType(value)},args:[{t:"object",r:!1,rep:!0}],ret:"string"},round:{fn:function(number,decimals){return decimals=Math.round(decimals)||0,new NumberType(Math.round(number*Math.pow(10,decimals))/Math.pow(10,decimals))},args:[{t:"number"},{t:"number",r:!1}],ret:"number"},selected:{fn:function(node,value){var values;return value=value.toString().trim(),values=node.toString(),new BooleanType(-1!=(" "+values+" ").indexOf(" "+value+" "))},args:[{t:"object"},{t:"string"}],ret:"boolean"},"selected-at":{fn:function(node,position){var values,selectValue;return position=Math.round(position.toNumber()),values=node.toString().split(" "),selectValue=0<=position&&position<values.length?values[position]:"",new StringType(selectValue)},args:[{t:"object"},{t:"number"}],ret:"string"},"count-selected":{fn:function(nodeset){var values=[];return 0<(nodeset=nodeset.toNodeSet()).length?1==(values=nodeStringValue(nodeset[0]).trim().split(" ")).length&&""===values[0]?new NumberType(0):new NumberType(values.length):new NumberType(0)},args:[{t:"node-set"}],ret:"number"},checklist:{fn:function(min,max,oA){var i,j,trues=0;for(min=min.toNumber(),max=max.toNumber(),i=2;i<arguments.length;i++)if(arguments[i]instanceof NodeSetType)for(j=0;j<arguments[i].stringValues().length;j++)!0===arguments[i].stringValues()[j].toBoolean()&&trues++;else!0===arguments[i].toBoolean()&&trues++;return new BooleanType((min<0||min<=trues)&&(max<0||trues<=max))},args:[{t:"number"},{t:"number"},{t:"object"},{t:"object",r:!1,rep:!0}],ret:"boolean"},"weighted-checklist":{fn:function(min,max,vA,wA){var i,values=[],weights=[],weightedTrues=0;for(min=min.toNumber(),max=max.toNumber(),i=2;i<arguments.length;i+=2)v=arguments[i],w=arguments[i+1],v&&w&&(v instanceof NodeSetType?values=values.concat(v.stringValues()):values.push(v),w instanceof NodeSetType?weights=weights.concat(w.stringValues()):weights.push(w));for(i=0;i<values.length;i++)!0===values[i].toBoolean()&&(weightedTrues+=weights[i].toNumber());return new BooleanType((min<0||min<=weightedTrues)&&(max<0||weightedTrues<=max))},args:[{t:"number"},{t:"number"},{t:"object"},{t:"object"},{t:"object",r:!1,rep:!0}],ret:"boolean"},"boolean-from-string":{fn:function(str){return new BooleanType("true"===str.toString().toLowerCase()||"1"===String(str))},args:[{t:"string"}],ret:"boolean"},if:{fn:function(cond,a,b){return cond.toBoolean()?a:b},args:[{t:"object"},{t:"object"},{t:"object"}],ret:"object"},date:{fn:function(obj){return new DateType(obj.toDate())},args:[{t:"object"}],ret:"string"},"date-time":{fn:function(obj){return new DateType(obj.toDate())},args:[{t:"object"}],ret:"string"},"decimal-date-time":{fn:function(dt){var dec,d=dt.toDate();return dec="Invalid Date"!==d.toString()?Math.round(1e3*d.getTime()/864e5)/1e3:Number.NaN,new NumberType(dec)},args:[{t:"object"}],ret:"number"},"decimal-time":{fn:function(time){var dec,m=time.toString().match(/^(\d\d):(\d\d):(\d\d)(\.\d\d?\d?)?(\+|-)(\d\d):(\d\d)$/);new Error("Invalid time format provided.");if(m&&m[1]<24&&0<=m[1]&&m[2]<60&&0<=m[2]&&m[3]<60&&0<=m[3]&&m[6]<24&&0<=m[6]&&m[7]<60&&0<=m[7]){function pad2(x){return x<10?"0"+x:x}var today=new Date,d=new Date(today.getFullYear()+"-"+pad2(today.getMonth()+1)+"-"+pad2(today.getDate())+"T"+time);dec="Invalid Date"===d.toString()?Number.NaN:Math.round(1e3*(d.getSeconds()/3600+d.getMinutes()/60+d.getHours())/24)/1e3}else dec=Number.NaN;return new NumberType(dec)},args:[{t:"string"}],ret:"number"},today:{fn:function(){var today=new Date;return new DateType(new Date(today.getFullYear(),today.getMonth(),today.getDate()))},ret:"string"},now:{fn:function(){return new DateType(new Date)},ret:"string"},regex:{fn:function(obj,expr){var value,patt;return value=obj.toString(),patt=new RegExp(expr),new BooleanType(patt.test(value))},args:[{t:"object"},{t:"string"}],ret:"boolean"},uuid:{fn:function(){var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)});return new StringType(uuid)},ret:"string"},int:{fn:function(str){return new NumberType(0<=str.toNumber()?Math.floor(str.toNumber()):-Math.floor(Math.abs(str.toNumber())))},args:[{t:"string"}],ret:"number"},substr:{fn:function(str,start,end){return str=str.toString(),length=str.length,start=Math.round(start.toNumber()),end=end?Math.round(end.toNumber()):length,new StringType(isNaN(start)?"":str.substring(start<0?length+start:start,end<0?length+end:end))},args:[{t:"string"},{t:"number"},{t:"number",r:!1}],ret:"string"},random:{fn:function(){return new NumberType(Math.random().toFixed(15))},ret:"number"},min:{fn:function(object1,object2){var i,j,min,val,nodeset;for(i=0;i<arguments.length;i++)if(arguments[i]instanceof NodeSetType){for(nodeset=arguments[i].toNodeSet(),j=0;j<nodeset.length;j++)(val=new StringType(nodeStringValue(nodeset[j])))&&(min=void 0!==min?Math.min(min,val.toNumber()):val.toNumber());0===nodeset.length&&(min=NaN)}else(val=new StringType(arguments[i].toString()))&&(min=void 0!==min?Math.min(min,val.toNumber()):val.toNumber());return new NumberType(min)},args:[{t:"object"},{t:"object",r:!1,rep:!0}],ret:"number"},max:{fn:function(object1,object2){var i,j,max,val,nodeset;for(i=0;i<arguments.length;i++)if(arguments[i]instanceof NodeSetType){for(nodeset=arguments[i].toNodeSet(),j=0;j<nodeset.length;j++)(val=new StringType(nodeStringValue(nodeset[j])))&&(max=void 0!==max?Math.max(max,val.toNumber()):val.toNumber());0===nodeset.length&&(max=NaN)}else(val=new StringType(arguments[i].toString()))&&(max=void 0!==max?Math.max(max,val.toNumber()):val.toNumber());return new NumberType(max)},args:[{t:"object"},{t:"object",r:!1,rep:!0}],ret:"number"},join:{fn:function(str1,obj1){var i,values=[];for(i=1;i<arguments.length;i++)arguments[i]instanceof NodeSetType?values=values.concat(arguments[i].stringValues()):values.push(arguments[i].toString());for(value=values[0]||"",i=1;i<values.length;i++)value+=str1.toString()+values[i];return new StringType(value)},args:[{t:"string"},{t:"object",r:!1,rep:!0}],ret:"string"},coalesce:{fn:function(a,b){return 0<a.toString().length?a:b},args:[{t:"object"},{t:"object"}],ret:"string"},"format-date":{fn:function(dateO,format){function intPad(num,l){var str=num.toString(),zeros=l-str.length;for(j=0;j<zeros;j++)str="0"+str;return str}var j,date=(dateO=new DateType(dateO)).toDate(),result=format.toString(),locale=window?window.enketoFormLocale:void 0;if(!dateO.toBoolean())return new StringType(date.toString());for(prop in props={Y:date.getFullYear(),y:date.getFullYear().toString().substring(2,4),m:intPad(date.getMonth()+1,2),n:date.getMonth()+1,b:date.toLocaleDateString(locale,{month:"short"}),d:intPad(date.getDate(),2),e:date.getDate(),H:intPad(date.getHours(),2),h:date.getHours(),M:intPad(date.getMinutes(),2),S:intPad(date.getSeconds(),2),3:intPad(date.getMilliseconds(),3),a:date.toLocaleDateString(locale,{weekday:"short"})},props)result=result.replace("%"+prop,props[prop]);return new StringType(result)},args:[{t:"date"},{t:"string"}],ret:"string"},pow:{fn:function(a,b){return new NumberType(Math.pow(a,b))},args:[{t:"number"},{t:"number"}],ret:"number"},sin:{fn:function(a){return new NumberType(Math.sin(a))},args:[{t:"number"}],ret:"number"},cos:{fn:function(a){return new NumberType(Math.cos(a))},args:[{t:"number"}],ret:"number"},tan:{fn:function(a){return new NumberType(Math.tan(a))},args:[{t:"number"}],ret:"number"},acos:{fn:function(a){return new NumberType(Math.acos(a))},args:[{t:"number"}],ret:"number"},asin:{fn:function(a){return new NumberType(Math.asin(a))},args:[{t:"number"}],ret:"number"},atan:{fn:function(a){return new NumberType(Math.atan(a))},args:[{t:"number"}],ret:"number"},atan2:{fn:function(a,b){return new NumberType(Math.atan2(a,b))},args:[{t:"number"},{t:"number"}],ret:"number"},log10:{fn:function(a){return void 0!==Math.log10?new NumberType(Math.log10(a)):new NumberType(Math.log(a)/Math.LN10)},args:[{t:"number"}],ret:"number"},log:{fn:function(a){return new NumberType(Math.log(a))},args:[{t:"number"}],ret:"number"},pi:{fn:function(){return new NumberType(Math.PI)},args:[],ret:"number"},exp:{fn:function(a){return new NumberType(Math.exp(a))},args:[{t:"number"}],ret:"number"},exp10:{fn:function(a){return new NumberType(Math.pow(10,a))},args:[{t:"number"}],ret:"number"},sqrt:{fn:function(a){return new NumberType(Math.sqrt(a))},args:[{t:"number"}],ret:"number"},once:{fn:function(a){var curValue=nodeStringValue(this.node),newValue=a.toString();return newValue="NaN"===newValue?"":newValue,new StringType(""!==curValue?curValue:newValue)},args:[{t:"string"}],ret:"string"},area:{fn:function(a){var geopoints=[];return a instanceof NodeSetType&&1<a.value.length?a.value.forEach(function(node){geopoints.push(nodeStringValue(node))}):a instanceof NodeSetType?geopoints=nodeStringValue(a.value[0]).split(";"):a instanceof StringType&&(geopoints=a.value.split(";")),new NumberType(geo.area(geopoints))},args:[{t:"string"}],ret:"number"},distance:{fn:function(a){var geopoints=[];return a instanceof NodeSetType&&1<a.value.length?a.value.forEach(function(node){geopoints.push(nodeStringValue(node))}):a instanceof NodeSetType?geopoints=nodeStringValue(a.value[0]).split(";"):a instanceof StringType&&(geopoints=a.value.split(";")),new NumberType(geo.distance(geopoints))},args:[{t:"string"}],ret:"number"},"ends-with":{fn:function(haystack,needle){return new BooleanType(haystack.toString().substr(haystack.toString().length-needle.toString().length)===needle.toString())},args:[{t:"string"},{t:"string"}],ret:"string"},abs:{fn:function(number){return new NumberType(Math.abs(number))},args:[{t:"number"}],ret:"number"},randomize:{fn:function(nodeset,seed){var seedValue=seed?seed.toNumber():void 0;return new NodeSetType(shuffle(nodeset.toNodeSet(),seedValue),"document-order")},args:[{t:"node-set"},{t:"number",r:!1}],ret:"node-set"}}})[""]["format-date-time"]=functions[""]["format-date"],evaluateExpressionTree=function(context,tree){if("function"!=typeof expressions[tree.type])throw new Error("Internal Error: Expression type does not exist: "+tree.type);return expressions[tree.type].apply(context,tree.args)},(XPathResult=function(context,type,value){switch(type){case XPathResult.NUMBER_TYPE:this.resultType=XPathResult.NUMBER_TYPE,this.numberValue=value.toNumber();break;case XPathResult.STRING_TYPE:this.resultType=XPathResult.STRING_TYPE,this.stringValue=value.toString();break;case XPathResult.BOOLEAN_TYPE:this.resultType=XPathResult.BOOLEAN_TYPE,this.booleanValue=value.toBoolean();break;case XPathResult.UNORDERED_NODE_ITERATOR_TYPE:case XPathResult.ORDERED_NODE_ITERATOR_TYPE:case XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE:case XPathResult.ORDERED_NODE_SNAPSHOT_TYPE:case XPathResult.ANY_UNORDERED_NODE_TYPE:case XPathResult.FIRST_ORDERED_NODE_TYPE:if(!value instanceof NodeSetType)throw new Error('Expected result of type "node-set", got: "'+value.type+'"');switch(this.resultType=type){case XPathResult.UNORDERED_NODE_ITERATOR_TYPE:case XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE:this._value=value.toNodeSet(),this.snapshotLength=this._value.length;break;case XPathResult.ORDERED_NODE_ITERATOR_TYPE:case XPathResult.ORDERED_NODE_SNAPSHOT_TYPE:value.sortDocumentOrder(),this._value=value.toNodeSet(),this.snapshotLength=this._value.length;break;case XPathResult.ANY_UNORDERED_NODE_TYPE:value=value.toNodeSet(),this.singleNodeValue=value.length?value[0]:null;break;case XPathResult.FIRST_ORDERED_NODE_TYPE:value.sortDocumentOrder(),value=value.toNodeSet(),this.singleNodeValue=value.length?value[0]:null;break;default:throw new XPathException(XPathException.TYPE_ERR,"XPath result type not supported. (type: "+type+")")}break;default:throw new XPathException(XPathException.TYPE_ERR,"XPath result type not supported. (type: "+type+")")}}).factory=function(context,type,value){var result;if(type!==XPathResult.ANY_TYPE)return new XPathResult(context,type,value);if(value instanceof NodeSetType)result=new XPathResult(context,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,value);else if(value instanceof NumberType)result=new XPathResult(context,XPathResult.NUMBER_TYPE,value);else if(value instanceof BooleanType)result=new XPathResult(context,XPathResult.BOOLEAN_TYPE,value);else{if(!(value instanceof StringType))throw new XPathException(XPathException.TYPE_ERR,"Internal Error: Unsupported value type: "+typeof value);result=new XPathResult(context,XPathResult.STRING_TYPE,value)}return result},XPathResult.prototype={resultType:null,numberValue:null,stringValue:null,booleanValue:null,singleNodeValue:null,invalidIteratorState:null,snapshotLength:null,_iteratorIndex:0,iterateNext:function(){if(this.resultType!=XPathResult.UNORDERED_NODE_ITERATOR_TYPE&&this.resultType!=XPathResult.ORDERED_NODE_ITERATOR_TYPE)throw new XPathException(XPathException.TYPE_ERR,"iterateNext() method may only be used with results of type UNORDERED_NODE_ITERATOR_TYPE or ORDERED_NODE_ITERATOR_TYPE");return this._iteratorIndex<this._value.length?this._value[this._iteratorIndex++]:null},snapshotItem:function(index){if(this.resultType!=XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE&&this.resultType!=XPathResult.ORDERED_NODE_SNAPSHOT_TYPE)throw new XPathException(XPathException.TYPE_ERR,"snapshotItem() method may only be used with results of type UNORDERED_NODE_SNAPSHOT_TYPE or ORDERED_NODE_SNAPSHOT_TYPE");return this._value[index]}},XPathResult.ANY_TYPE=0,XPathResult.NUMBER_TYPE=1,XPathResult.STRING_TYPE=2,XPathResult.BOOLEAN_TYPE=3,XPathResult.UNORDERED_NODE_ITERATOR_TYPE=4,XPathResult.ORDERED_NODE_ITERATOR_TYPE=5,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE=6,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE=7,XPathResult.ANY_UNORDERED_NODE_TYPE=8,XPathResult.FIRST_ORDERED_NODE_TYPE=9,(XPathNamespace=function(prefix,namespaceURI,ownerElement){if(1!=ownerElement.nodeType)throw new Error("Internal Error: XPathNamespace owner element must be an Element node.");this.ownerElement=ownerElement,this.ownerDocument=ownerElement.ownerDocument,this.nodeName="#namespace",this.prefix=prefix,this.localName=prefix,this.nodeType=XPathNamespace.XPATH_NAMESPACE_NODE,this.namespaceURI=namespaceURI,this.nodeValue=namespaceURI}).XPATH_NAMESPACE_NODE=13,module={XPathException:XPathException,XPathEvaluator:XPathEvaluator,XPathNSResolver:XPathNSResolver,XPathExpression:XPathExpression,XPathResult:XPathResult,XPathNamespace:XPathNamespace,customXPathFunction:{type:{StringType:StringType,NumberType:NumberType,NodeSetType:NodeSetType,BooleanType:BooleanType},add:function(name,fnObj){functions[""][name]=fnObj},remove:function(name){delete functions[""][name]}},getCurrentDomLevel3XPathBindings:function(){return{window:{XPathException:window.XPathException,XPathExpression:window.XPathExpression,XPathNSResolver:window.XPathNSResolver,XPathResult:window.XPathResult,XPathNamespace:window.XPathNamespace},document:{createExpression:document.createExpression,createNSResolver:document.createNSResolver,evaluate:document.evaluate}}},createDomLevel3XPathBindings:function(options){var evaluator=new XPathEvaluator(options);return{window:{XPathException:XPathException,XPathExpression:XPathExpression,XPathNSResolver:XPathNSResolver,XPathResult:XPathResult,XPathNamespace:XPathNamespace},document:{createExpression:function(){return evaluator.createExpression.apply(evaluator,arguments)},createNSResolver:function(){return evaluator.createNSResolver.apply(evaluator,arguments)},evaluate:function(){return evaluator.evaluate.apply(evaluator,arguments)}}}},bindDomLevel3XPath:function(doc,bindings){var i,newBindings=bindings||module.createDomLevel3XPathBindings(),currentBindings=module.getCurrentDomLevel3XPathBindings();doc=doc||document;for(i in newBindings.window)window[i]=newBindings.window[i];for(i in newBindings.document)doc[i]=newBindings.document[i];return currentBindings}}}()},function(module,exports){module.exports=function(){"use strict";function peg$SyntaxError(message,expected,found,location){this.message=message,this.expected=expected,this.found=found,this.location=location,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function ctor(){this.constructor=child}var child,parent;return child=peg$SyntaxError,parent=Error,ctor.prototype=parent.prototype,child.prototype=new ctor,{SyntaxError:peg$SyntaxError,parse:function(input){var peg$result,options=1<arguments.length?arguments[1]:{},peg$FAILED={},peg$startRuleFunctions={XPath:peg$parseXPath},peg$startRuleFunction=peg$parseXPath,peg$c0=function(expr){return{tree:expr,nsPrefixes:nsPrefixes}},peg$c1="/",peg$c2={type:"literal",value:"/",description:'"/"'},peg$c3=function(path){return{type:"/",args:[null,path?path[1]:null]}},peg$c4="//",peg$c5={type:"literal",value:"//",description:'"//"'},peg$c6=function(expr,repeatedExpr){var i;for(i=0;i<repeatedExpr.length;i++)expr=expandSlashAbbrev(repeatedExpr[i][1],expr,repeatedExpr[i][3]);return expr},peg$c7=function(axis,node,predicate){return predicateExpression({type:"step",args:[axis,node]},axis,predicate,1)},peg$c8="::",peg$c9={type:"literal",value:"::",description:'"::"'},peg$c10=function(axis){return axis},peg$c11=function(aas){return aas.length?aas:"child"},peg$c12="ancestor-or-self",peg$c13={type:"literal",value:"ancestor-or-self",description:'"ancestor-or-self"'},peg$c14="ancestor",peg$c15={type:"literal",value:"ancestor",description:'"ancestor"'},peg$c16="attribute",peg$c17={type:"literal",value:"attribute",description:'"attribute"'},peg$c18="child",peg$c19={type:"literal",value:"child",description:'"child"'},peg$c20="descendant-or-self",peg$c21={type:"literal",value:"descendant-or-self",description:'"descendant-or-self"'},peg$c22="descendant",peg$c23={type:"literal",value:"descendant",description:'"descendant"'},peg$c24="following-sibling",peg$c25={type:"literal",value:"following-sibling",description:'"following-sibling"'},peg$c26="following",peg$c27={type:"literal",value:"following",description:'"following"'},peg$c28="namespace",peg$c29={type:"literal",value:"namespace",description:'"namespace"'},peg$c30="parent",peg$c31={type:"literal",value:"parent",description:'"parent"'},peg$c32="preceding-sibling",peg$c33={type:"literal",value:"preceding-sibling",description:'"preceding-sibling"'},peg$c34="preceding",peg$c35={type:"literal",value:"preceding",description:'"preceding"'},peg$c36="self",peg$c37={type:"literal",value:"self",description:'"self"'},peg$c38="(",peg$c39={type:"literal",value:"(",description:'"("'},peg$c40=")",peg$c41={type:"literal",value:")",description:'")"'},peg$c42=function(nodeType){return{type:"nodeType",args:[nodeType,[]]}},peg$c43="processing-instruction",peg$c44={type:"literal",value:"processing-instruction",description:'"processing-instruction"'},peg$c45=function(pi,arg){return{type:"nodeType",args:[pi,[arg]]}},peg$c46=function(nt){return nt},peg$c47="[",peg$c48={type:"literal",value:"[",description:'"["'},peg$c49="]",peg$c50={type:"literal",value:"]",description:'"]"'},peg$c51=function(expr){return expr},peg$c52=function(path){return expandSlashAbbrev("//",null,path)},peg$c53="..",peg$c54={type:"literal",value:"..",description:'".."'},peg$c55=".",peg$c56={type:"literal",value:".",description:'"."'},peg$c57=function(abbrev){var result={type:"step",args:["self",{type:"nodeType",args:["node",[]]}]};return".."==abbrev&&(result.args[0]="parent"),result},peg$c58="@",peg$c59={type:"literal",value:"@",description:'"@"'},peg$c60=function(attribute){return attribute?"attribute":""},peg$c61=function(vr){return vr},peg$c62=function(l){return l},peg$c63=function(n){return n},peg$c64=",",peg$c65={type:"literal",value:",",description:'","'},peg$c66=function(name,arg){var i,args=[];if(arg)for(args.push(arg[1]),i=0;i<arg[2].length;i++)args.push(arg[2][i][3]);return{type:"function",args:[name,args]}},peg$c67="|",peg$c68={type:"literal",value:"|",description:'"|"'},peg$c69=function(expr,repeatedExpr){return expressionSimplifier(expr,repeatedExpr,1,3)},peg$c70=function(expr,path){return path?expandSlashAbbrev(path[1],expr,path[3]):expr},peg$c71=function(path){return path},peg$c72=function(expr,repeatedExpr){return predicateExpression(expr,"child",repeatedExpr,1)},peg$c73="or",peg$c74={type:"literal",value:"or",description:'"or"'},peg$c75="and",peg$c76={type:"literal",value:"and",description:'"and"'},peg$c77="=",peg$c78={type:"literal",value:"=",description:'"="'},peg$c79="!=",peg$c80={type:"literal",value:"!=",description:'"!="'},peg$c81="<=",peg$c82={type:"literal",value:"<=",description:'"<="'},peg$c83="<",peg$c84={type:"literal",value:"<",description:'"<"'},peg$c85=">=",peg$c86={type:"literal",value:">=",description:'">="'},peg$c87=">",peg$c88={type:"literal",value:">",description:'">"'},peg$c89="+",peg$c90={type:"literal",value:"+",description:'"+"'},peg$c91="-",peg$c92={type:"literal",value:"-",description:'"-"'},peg$c93="div",peg$c94={type:"literal",value:"div",description:'"div"'},peg$c95="mod",peg$c96={type:"literal",value:"mod",description:'"mod"'},peg$c97=function(expr){return{type:"*",args:[{type:"number",args:[-1]},expr]}},peg$c98='"',peg$c99={type:"literal",value:'"',description:'"\\""'},peg$c100=/^[^"]/,peg$c101={type:"class",value:'[^"]',description:'[^"]'},peg$c102=function(literals){return{type:"string",args:[literals.join("")]}},peg$c103="'",peg$c104={type:"literal",value:"'",description:'"\'"'},peg$c105=/^[^']/,peg$c106={type:"class",value:"[^']",description:"[^']"},peg$c107=function(digits,decimals){return{type:"number",args:[decimals?parseFloat(digits+"."+decimals[1]):parseInt(digits)]}},peg$c108=function(digits){return{type:"number",args:[parseFloat("."+digits)]}},peg$c109=/^[0-9]/,peg$c110={type:"class",value:"[0-9]",description:"[0-9]"},peg$c111=function(digits){return digits.join("")},peg$c112="*",peg$c113={type:"literal",value:"*",description:'"*"'},peg$c114=function(name){var i;if(null===lastQNameParsed.args[0])for(i=0;i<nodeTypeNames.length;i++)if(lastQNameParsed.args[1]==nodeTypeNames[i])return!1;return!0},peg$c115=function(name){return""===name.args[0]?name={type:name.type,args:[null,name.args[1]]}:trackNsPrefix(name.args[0]),name},peg$c116="$",peg$c117={type:"literal",value:"$",description:'"$"'},peg$c118=function(name){return trackNsPrefix(name.args[0]),{type:"$",args:[name]}},peg$c119=function(){return{type:"name",args:[null,null]}},peg$c120=":",peg$c121={type:"literal",value:":",description:'":"'},peg$c122=function(ns){return trackNsPrefix(ns),{type:"name",args:[ns,null]}},peg$c123=function(name){return trackNsPrefix(name.args[0]),name},peg$c124="comment",peg$c125={type:"literal",value:"comment",description:'"comment"'},peg$c126="text",peg$c127={type:"literal",value:"text",description:'"text"'},peg$c128="node",peg$c129={type:"literal",value:"node",description:'"node"'},peg$c130=/^[ \t\r\n]/,peg$c131={type:"class",value:"[\\u0020\\u0009\\u000D\\u000A]",description:"[\\u0020\\u0009\\u000D\\u000A]"},peg$c132=function(name){return lastQNameParsed=name},peg$c133=function(ns,name){return{type:"name",args:[ns,name]}},peg$c134=function(name){return{type:"name",args:[null,name]}},peg$c135=/^[A-Z]/,peg$c136={type:"class",value:"[A-Z]",description:"[A-Z]"},peg$c137="_",peg$c138={type:"literal",value:"_",description:'"_"'},peg$c139=/^[a-z]/,peg$c140={type:"class",value:"[a-z]",description:"[a-z]"},peg$c141=/^[\xC0-\xD6]/,peg$c142={type:"class",value:"[\\u00C0-\\u00D6]",description:"[\\u00C0-\\u00D6]"},peg$c143=/^[\xD8-\xF6]/,peg$c144={type:"class",value:"[\\u00D8-\\u00F6]",description:"[\\u00D8-\\u00F6]"},peg$c145=/^[\xF8-\u02FF]/,peg$c146={type:"class",value:"[\\u00F8-\\u02FF]",description:"[\\u00F8-\\u02FF]"},peg$c147=/^[\u0370-\u037D]/,peg$c148={type:"class",value:"[\\u0370-\\u037D]",description:"[\\u0370-\\u037D]"},peg$c149=/^[\u037F-\u1FFF]/,peg$c150={type:"class",value:"[\\u037F-\\u1FFF]",description:"[\\u037F-\\u1FFF]"},peg$c151=/^[\u200C-\u200D]/,peg$c152={type:"class",value:"[\\u200C-\\u200D]",description:"[\\u200C-\\u200D]"},peg$c153=/^[\u2070-\u218F]/,peg$c154={type:"class",value:"[\\u2070-\\u218F]",description:"[\\u2070-\\u218F]"},peg$c155=/^[\u2C00-\u2FEF]/,peg$c156={type:"class",value:"[\\u2C00-\\u2FEF]",description:"[\\u2C00-\\u2FEF]"},peg$c157=/^[\u3001-\uD7FF]/,peg$c158={type:"class",value:"[\\u3001-\\uD7FF]",description:"[\\u3001-\\uD7FF]"},peg$c159=/^[\uF900-\uFDCF]/,peg$c160={type:"class",value:"[\\uF900-\\uFDCF]",description:"[\\uF900-\\uFDCF]"},peg$c161=/^[\uFDF0-\uFFFD]/,peg$c162={type:"class",value:"[\\uFDF0-\\uFFFD]",description:"[\\uFDF0-\\uFFFD]"},peg$c163=/^[\xB7]/,peg$c164={type:"class",value:"[\\u00B7]",description:"[\\u00B7]"},peg$c165=/^[\u0300-\u036F]/,peg$c166={type:"class",value:"[\\u0300-\\u036F]",description:"[\\u0300-\\u036F]"},peg$c167=/^[\u203F-\u2040]/,peg$c168={type:"class",value:"[\\u203F-\\u2040]",description:"[\\u203F-\\u2040]"},peg$c169=function(startchar,chars){return startchar+chars.join("")},peg$currPos=0,peg$posDetailsCache=[{line:1,column:1,seenCR:!1}],peg$maxFailPos=0,peg$maxFailExpected=[],peg$silentFails=0;if("startRule"in options){if(!(options.startRule in peg$startRuleFunctions))throw new Error("Can't start parsing from rule \""+options.startRule+'".');peg$startRuleFunction=peg$startRuleFunctions[options.startRule]}function peg$computePosDetails(pos){var p,ch,details=peg$posDetailsCache[pos];if(details)return details;for(p=pos-1;!peg$posDetailsCache[p];)p--;for(details={line:(details=peg$posDetailsCache[p]).line,column:details.column,seenCR:details.seenCR};p<pos;)"\n"===(ch=input.charAt(p))?(details.seenCR||details.line++,details.column=1,details.seenCR=!1):"\r"===ch||"\u2028"===ch||"\u2029"===ch?(details.line++,details.column=1,details.seenCR=!0):(details.column++,details.seenCR=!1),p++;return peg$posDetailsCache[pos]=details}function peg$computeLocation(startPos,endPos){var startPosDetails=peg$computePosDetails(startPos),endPosDetails=peg$computePosDetails(endPos);return{start:{offset:startPos,line:startPosDetails.line,column:startPosDetails.column},end:{offset:endPos,line:endPosDetails.line,column:endPosDetails.column}}}function peg$fail(expected){peg$currPos<peg$maxFailPos||(peg$maxFailPos<peg$currPos&&(peg$maxFailPos=peg$currPos,peg$maxFailExpected=[]),peg$maxFailExpected.push(expected))}function peg$buildException(message,expected,found,location){return null!==expected&&function(expected){var i=1;for(expected.sort(function(a,b){return a.description<b.description?-1:a.description>b.description?1:0});i<expected.length;)expected[i-1]===expected[i]?expected.splice(i,1):i++}(expected),new peg$SyntaxError(null!==message?message:function(expected,found){var i,expectedDescs=new Array(expected.length);for(i=0;i<expected.length;i++)expectedDescs[i]=expected[i].description;function hex(ch){return ch.charCodeAt(0).toString(16).toUpperCase()}return"Expected "+(1<expected.length?expectedDescs.slice(0,-1).join(", ")+" or "+expectedDescs[expected.length-1]:expectedDescs[0])+" but "+(found?'"'+found.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(ch){return"\\x0"+hex(ch)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(ch){return"\\x"+hex(ch)}).replace(/[\u0100-\u0FFF]/g,function(ch){return"\\u0"+hex(ch)}).replace(/[\u1000-\uFFFF]/g,function(ch){return"\\u"+hex(ch)})+'"':"end of input")+" found."}(expected,found),expected,found,location)}function peg$parseXPath(){var s0,s2;return s0=peg$currPos,s0=peg$parse_()!==peg$FAILED&&(s2=peg$parseExpr())!==peg$FAILED&&peg$parse_()!==peg$FAILED?(s0,peg$c0(s2)):(peg$currPos=s0,peg$FAILED)}function peg$parseLocationPath(){var s0;return(s0=peg$parseRelativeLocationPath())===peg$FAILED&&(s0=function(){var s0,s1,s2,s3,s4;(s0=function(){var s0,s1,s2,s3;s0=peg$currPos,input.substr(peg$currPos,2)===peg$c4?(s1=peg$c4,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c5));s0=s1!==peg$FAILED?(s2=peg$parse_(),s2!==peg$FAILED?(s3=peg$parseRelativeLocationPath())!==peg$FAILED?(s0,s1=peg$c52(s3)):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED);return s0}())===peg$FAILED&&(s0=peg$currPos,47===input.charCodeAt(peg$currPos)?(s1=peg$c1,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c2)),s0=s1!==peg$FAILED?(s2=peg$currPos,s3=peg$parse_(),(s2=s3!==peg$FAILED?(s4=peg$parseRelativeLocationPath())!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED):(peg$currPos=s2,peg$FAILED))===peg$FAILED&&(s2=null),s2!==peg$FAILED?(s0,s1=peg$c3(s2)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED));return s0}()),s0}function peg$parseRelativeLocationPath(){var s0,s1,s2,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=peg$parseStep())!==peg$FAILED){for(s2=[],s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(input.substr(peg$currPos,2)===peg$c4?(s5=peg$c4,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c5)),s5===peg$FAILED&&(47===input.charCodeAt(peg$currPos)?(s5=peg$c1,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c2))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseStep())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(input.substr(peg$currPos,2)===peg$c4?(s5=peg$c4,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c5)),s5===peg$FAILED&&(47===input.charCodeAt(peg$currPos)?(s5=peg$c1,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c2))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseStep())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c6(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseStep(){var s0,s1,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=function(){var s0,s1,s2,s3;s0=peg$currPos,s0=(s1=function(){var s0;input.substr(peg$currPos,16)===peg$c12?(s0=peg$c12,peg$currPos+=16):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c13));s0===peg$FAILED&&(input.substr(peg$currPos,8)===peg$c14?(s0=peg$c14,peg$currPos+=8):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c15)),s0===peg$FAILED&&(input.substr(peg$currPos,9)===peg$c16?(s0=peg$c16,peg$currPos+=9):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c17)),s0===peg$FAILED&&(input.substr(peg$currPos,5)===peg$c18?(s0=peg$c18,peg$currPos+=5):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c19)),s0===peg$FAILED&&(input.substr(peg$currPos,18)===peg$c20?(s0=peg$c20,peg$currPos+=18):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c21)),s0===peg$FAILED&&(input.substr(peg$currPos,10)===peg$c22?(s0=peg$c22,peg$currPos+=10):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c23)),s0===peg$FAILED&&(input.substr(peg$currPos,17)===peg$c24?(s0=peg$c24,peg$currPos+=17):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c25)),s0===peg$FAILED&&(input.substr(peg$currPos,9)===peg$c26?(s0=peg$c26,peg$currPos+=9):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c27)),s0===peg$FAILED&&(input.substr(peg$currPos,9)===peg$c28?(s0=peg$c28,peg$currPos+=9):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c29)),s0===peg$FAILED&&(input.substr(peg$currPos,6)===peg$c30?(s0=peg$c30,peg$currPos+=6):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c31)),s0===peg$FAILED&&(input.substr(peg$currPos,17)===peg$c32?(s0=peg$c32,peg$currPos+=17):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c33)),s0===peg$FAILED&&(input.substr(peg$currPos,9)===peg$c34?(s0=peg$c34,peg$currPos+=9):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c35)),s0===peg$FAILED&&(input.substr(peg$currPos,4)===peg$c36?(s0=peg$c36,peg$currPos+=4):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c37))))))))))))));return s0}())!==peg$FAILED?(s2=peg$parse_(),s2!==peg$FAILED?(input.substr(peg$currPos,2)===peg$c8?(s3=peg$c8,peg$currPos+=2):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c9)),s3!==peg$FAILED?(s0,s1=peg$c10(s1)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED);s0===peg$FAILED&&(s0=peg$currPos,(s1=function(){var s0,s1;s0=peg$currPos,64===input.charCodeAt(peg$currPos)?(s1=peg$c58,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c59));s1===peg$FAILED&&(s1=null);s1!==peg$FAILED&&(s0,s1=peg$c60(s1));return s0=s1}())!==peg$FAILED&&(s0,s1=peg$c11(s1)),s0=s1);return s0}())!==peg$FAILED)if(peg$parse_()!==peg$FAILED)if((s3=function(){var s0,s1,s2,s3,s5,s7;s0=peg$currPos,s0=(s1=function(){var s0;input.substr(peg$currPos,7)===peg$c124?(s0=peg$c124,peg$currPos+=7):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c125));s0===peg$FAILED&&(input.substr(peg$currPos,4)===peg$c126?(s0=peg$c126,peg$currPos+=4):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c127)),s0===peg$FAILED&&(input.substr(peg$currPos,22)===peg$c43?(s0=peg$c43,peg$currPos+=22):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c44)),s0===peg$FAILED&&(input.substr(peg$currPos,4)===peg$c128?(s0=peg$c128,peg$currPos+=4):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c129)))));return s0}())!==peg$FAILED?(s2=peg$parse_(),s2!==peg$FAILED?(40===input.charCodeAt(peg$currPos)?(s3=peg$c38,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c39)),s3!==peg$FAILED?peg$parse_()!==peg$FAILED?(41===input.charCodeAt(peg$currPos)?(s5=peg$c40,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c41)),s5!==peg$FAILED?(s0,s1=peg$c42(s1)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED);s0===peg$FAILED&&(s0=peg$currPos,input.substr(peg$currPos,22)===peg$c43?(s1=peg$c43,peg$currPos+=22):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c44)),(s0=s1!==peg$FAILED?(s2=peg$parse_())!==peg$FAILED?(40===input.charCodeAt(peg$currPos)?(s3=peg$c38,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c39)),s3!==peg$FAILED?peg$parse_()!==peg$FAILED?(s5=peg$parseLiteral())!==peg$FAILED?peg$parse_()!==peg$FAILED?(41===input.charCodeAt(peg$currPos)?(s7=peg$c40,peg$currPos++):(s7=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c41)),s7!==peg$FAILED?(s0,s1=peg$c45(s1,s5)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s0=peg$currPos,(s1=function(){var s0,s1,s2,s3;s0=peg$currPos,42===input.charCodeAt(peg$currPos)?(s1=peg$c112,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c113));s1!==peg$FAILED&&(s0,s1=peg$c119());(s0=s1)===peg$FAILED&&(s0=peg$currPos,s1=peg$parseNCName(),(s0=s1!==peg$FAILED?(58===input.charCodeAt(peg$currPos)?(s2=peg$c120,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c121)),s2!==peg$FAILED?(42===input.charCodeAt(peg$currPos)?(s3=peg$c112,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c113)),s3!==peg$FAILED?(s0,s1=peg$c122(s1)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s0=peg$currPos,(s1=peg$parseQName())!==peg$FAILED&&(s0,s1=peg$c123(s1)),s0=s1));return s0}())!==peg$FAILED&&(s0,s1=peg$c46(s1)),s0=s1));return s0}())!==peg$FAILED){for(s4=[],s5=peg$currPos,s5=(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parsePredicate())!==peg$FAILED?s6=[s6,s7]:(peg$currPos=s5,peg$FAILED);s5!==peg$FAILED;)s4.push(s5),s5=peg$currPos,s5=(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parsePredicate())!==peg$FAILED?s6=[s6,s7]:(peg$currPos=s5,peg$FAILED);s0=s4!==peg$FAILED?(s0,s1=peg$c7(s1,s3,s4)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return s0===peg$FAILED&&(s0=function(){var s0,s1;s0=peg$currPos,input.substr(peg$currPos,2)===peg$c53?(s1=peg$c53,peg$currPos+=2):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c54));s1===peg$FAILED&&(46===input.charCodeAt(peg$currPos)?(s1=peg$c55,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c56)));s1!==peg$FAILED&&(s0,s1=peg$c57(s1));return s0=s1}()),s0}function peg$parsePredicate(){var s0,s1,s3,s5;return s0=peg$currPos,91===input.charCodeAt(peg$currPos)?(s1=peg$c47,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c48)),s0=s1!==peg$FAILED&&peg$parse_()!==peg$FAILED&&(s3=peg$parseExpr())!==peg$FAILED&&peg$parse_()!==peg$FAILED?(93===input.charCodeAt(peg$currPos)?(s5=peg$c49,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c50)),s5!==peg$FAILED?(s0,s1=peg$c51(s3)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED)}function peg$parseExpr(){var s0,s1;return s0=peg$currPos,(s1=function(){var s0,s1,s2,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=peg$parseAndExpr())!==peg$FAILED){for(s2=[],s3=peg$currPos,s4=peg$parse_(),s3=s4!==peg$FAILED?(input.substr(peg$currPos,2)===peg$c73?(s5=peg$c73,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s5!==peg$FAILED?(s6=peg$parse_())!==peg$FAILED?(s7=peg$parseAndExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED):(peg$currPos=s3,peg$FAILED):(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s4=peg$parse_(),s3=s4!==peg$FAILED?(input.substr(peg$currPos,2)===peg$c73?(s5=peg$c73,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c74)),s5!==peg$FAILED?(s6=peg$parse_())!==peg$FAILED?(s7=peg$parseAndExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED):(peg$currPos=s3,peg$FAILED):(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c69(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}())!==peg$FAILED&&(s0,s1=peg$c51(s1)),s0=s1}function peg$parsePrimaryExpr(){var s0,s1,s3,s5;return s0=peg$currPos,(s1=function(){var s0,s1,s2;s0=peg$currPos,36===input.charCodeAt(peg$currPos)?(s1=peg$c116,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c117));s0=s1!==peg$FAILED?(s2=peg$parseQName(),s2!==peg$FAILED?(s0,s1=peg$c118(s2)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED);return s0}())!==peg$FAILED&&(s0,s1=peg$c61(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,40===input.charCodeAt(peg$currPos)?(s1=peg$c38,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c39)),(s0=s1!==peg$FAILED&&peg$parse_()!==peg$FAILED&&(s3=peg$parseExpr())!==peg$FAILED&&peg$parse_()!==peg$FAILED?(41===input.charCodeAt(peg$currPos)?(s5=peg$c40,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c41)),s5!==peg$FAILED?(s0,s1=peg$c51(s3)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s0=peg$currPos,(s1=peg$parseLiteral())!==peg$FAILED&&(s0,s1=peg$c62(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,(s1=function(){var s0,s1,s2,s3,s4;s0=peg$currPos,s0=(s1=peg$parseDigits())!==peg$FAILED?(s2=peg$currPos,46===input.charCodeAt(peg$currPos)?(s3=peg$c55,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c56)),(s2=s3!==peg$FAILED?((s4=peg$parseDigits())===peg$FAILED&&(s4=null),s4!==peg$FAILED?s3=[s3,s4]:(peg$currPos=s2,peg$FAILED)):(peg$currPos=s2,peg$FAILED))===peg$FAILED&&(s2=null),s2!==peg$FAILED?(s0,s1=peg$c107(s1,s2)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED);s0===peg$FAILED&&(s0=peg$currPos,46===input.charCodeAt(peg$currPos)?(s1=peg$c55,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c56)),s0=s1!==peg$FAILED?(s2=peg$parseDigits())!==peg$FAILED?(s0,s1=peg$c108(s2)):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED));return s0}())!==peg$FAILED&&(s0,s1=peg$c63(s1)),(s0=s1)===peg$FAILED&&(s0=function(){var s0,s1,s3,s4,s5,s6,s7,s8,s9,s10,s11,s12;if(s0=peg$currPos,(s1=function(){var s0,s1,s2;s0=peg$currPos,s0=(s1=peg$parseQName())!==peg$FAILED?(peg$currPos,s2=peg$c114(s1),(s2=s2?void 0:peg$FAILED)!==peg$FAILED?(s0,s1=peg$c115(s1)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED);return s0}())!==peg$FAILED)if(peg$parse_()!==peg$FAILED)if(40===input.charCodeAt(peg$currPos)?(s3=peg$c38,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c39)),s3!==peg$FAILED){if(s4=peg$currPos,(s5=peg$parse_())!==peg$FAILED)if((s6=peg$parseExpr())!==peg$FAILED){for(s7=[],s8=peg$currPos,s9=peg$parse_(),s8=s9!==peg$FAILED?(44===input.charCodeAt(peg$currPos)?(s10=peg$c64,peg$currPos++):(s10=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c65)),s10!==peg$FAILED?(s11=peg$parse_())!==peg$FAILED?(s12=peg$parseExpr())!==peg$FAILED?s9=[s9,s10,s11,s12]:(peg$currPos=s8,peg$FAILED):(peg$currPos=s8,peg$FAILED):(peg$currPos=s8,peg$FAILED)):(peg$currPos=s8,peg$FAILED);s8!==peg$FAILED;)s7.push(s8),s8=peg$currPos,s9=peg$parse_(),s8=s9!==peg$FAILED?(44===input.charCodeAt(peg$currPos)?(s10=peg$c64,peg$currPos++):(s10=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c65)),s10!==peg$FAILED?(s11=peg$parse_())!==peg$FAILED?(s12=peg$parseExpr())!==peg$FAILED?s9=[s9,s10,s11,s12]:(peg$currPos=s8,peg$FAILED):(peg$currPos=s8,peg$FAILED):(peg$currPos=s8,peg$FAILED)):(peg$currPos=s8,peg$FAILED);s4=s7!==peg$FAILED?s5=[s5,s6,s7]:(peg$currPos=s4,peg$FAILED)}else peg$currPos=s4,s4=peg$FAILED;else peg$currPos=s4,s4=peg$FAILED;s4===peg$FAILED&&(s4=null),s0=s4!==peg$FAILED?(s5=peg$parse_())!==peg$FAILED?(41===input.charCodeAt(peg$currPos)?(s6=peg$c40,peg$currPos++):(s6=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c41)),s6!==peg$FAILED?(s0,s1=peg$c66(s1,s4)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;else peg$currPos=s0,s0=peg$FAILED;return s0}())))),s0}function peg$parsePathExpr(){var s0,s1,s2,s3,s4,s5,s6;return s0=peg$currPos,(s0=(s1=function(){var s0,s1,s2,s3,s4,s5;if(s0=peg$currPos,(s1=peg$parsePrimaryExpr())!==peg$FAILED){for(s2=[],s3=peg$currPos,s4=peg$parse_(),s3=s4!==peg$FAILED?(s5=peg$parsePredicate())!==peg$FAILED?s4=[s4,s5]:(peg$currPos=s3,peg$FAILED):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s4=peg$parse_(),s3=s4!==peg$FAILED?(s5=peg$parsePredicate())!==peg$FAILED?s4=[s4,s5]:(peg$currPos=s3,peg$FAILED):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c72(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}())!==peg$FAILED?(s2=peg$currPos,(s2=(s3=peg$parse_())!==peg$FAILED?(input.substr(peg$currPos,2)===peg$c4?(s4=peg$c4,peg$currPos+=2):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c5)),s4===peg$FAILED&&(47===input.charCodeAt(peg$currPos)?(s4=peg$c1,peg$currPos++):(s4=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c2))),s4!==peg$FAILED&&(s5=peg$parse_())!==peg$FAILED&&(s6=peg$parseRelativeLocationPath())!==peg$FAILED?s3=[s3,s4,s5,s6]:(peg$currPos=s2,peg$FAILED)):(peg$currPos=s2,peg$FAILED))===peg$FAILED&&(s2=null),s2!==peg$FAILED?(s0,s1=peg$c70(s1,s2)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED))===peg$FAILED&&(s0=peg$currPos,(s1=peg$parseLocationPath())!==peg$FAILED&&(s0,s1=peg$c71(s1)),s0=s1),s0}function peg$parseAndExpr(){var s0,s1,s2,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=peg$parseEqualityExpr())!==peg$FAILED){for(s2=[],s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(input.substr(peg$currPos,3)===peg$c75?(s5=peg$c75,peg$currPos+=3):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c76)),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseEqualityExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(input.substr(peg$currPos,3)===peg$c75?(s5=peg$c75,peg$currPos+=3):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c76)),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseEqualityExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c69(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseEqualityExpr(){var s0,s1,s2,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=peg$parseRelationalExpr())!==peg$FAILED){for(s2=[],s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(61===input.charCodeAt(peg$currPos)?(s5=peg$c77,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s5===peg$FAILED&&(input.substr(peg$currPos,2)===peg$c79?(s5=peg$c79,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c80))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseRelationalExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(61===input.charCodeAt(peg$currPos)?(s5=peg$c77,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c78)),s5===peg$FAILED&&(input.substr(peg$currPos,2)===peg$c79?(s5=peg$c79,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c80))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseRelationalExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c69(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseRelationalExpr(){var s0,s1,s2,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=peg$parseAdditiveExpr())!==peg$FAILED){for(s2=[],s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(input.substr(peg$currPos,2)===peg$c81?(s5=peg$c81,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c82)),s5===peg$FAILED&&(60===input.charCodeAt(peg$currPos)?(s5=peg$c83,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84)),s5===peg$FAILED&&(input.substr(peg$currPos,2)===peg$c85?(s5=peg$c85,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c86)),s5===peg$FAILED&&(62===input.charCodeAt(peg$currPos)?(s5=peg$c87,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c88))))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseAdditiveExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(input.substr(peg$currPos,2)===peg$c81?(s5=peg$c81,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c82)),s5===peg$FAILED&&(60===input.charCodeAt(peg$currPos)?(s5=peg$c83,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c84)),s5===peg$FAILED&&(input.substr(peg$currPos,2)===peg$c85?(s5=peg$c85,peg$currPos+=2):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c86)),s5===peg$FAILED&&(62===input.charCodeAt(peg$currPos)?(s5=peg$c87,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c88))))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseAdditiveExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c69(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseAdditiveExpr(){var s0,s1,s2,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=peg$parseMultiplicativeExpr())!==peg$FAILED){for(s2=[],s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(43===input.charCodeAt(peg$currPos)?(s5=peg$c89,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c90)),s5===peg$FAILED&&(45===input.charCodeAt(peg$currPos)?(s5=peg$c91,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c92))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseMultiplicativeExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(43===input.charCodeAt(peg$currPos)?(s5=peg$c89,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c90)),s5===peg$FAILED&&(45===input.charCodeAt(peg$currPos)?(s5=peg$c91,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c92))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseMultiplicativeExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c69(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseMultiplicativeExpr(){var s0,s1,s2,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=peg$parseUnaryExpr())!==peg$FAILED){for(s2=[],s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?((s5=peg$parseMultiplyOperator())===peg$FAILED&&(input.substr(peg$currPos,3)===peg$c93?(s5=peg$c93,peg$currPos+=3):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c94)),s5===peg$FAILED&&(input.substr(peg$currPos,3)===peg$c95?(s5=peg$c95,peg$currPos+=3):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c96)))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseUnaryExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?((s5=peg$parseMultiplyOperator())===peg$FAILED&&(input.substr(peg$currPos,3)===peg$c93?(s5=peg$c93,peg$currPos+=3):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c94)),s5===peg$FAILED&&(input.substr(peg$currPos,3)===peg$c95?(s5=peg$c95,peg$currPos+=3):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c96)))),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parseUnaryExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c69(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseUnaryExpr(){var s0,s1,s3;return s0=peg$currPos,(s1=function(){var s0,s1,s2,s3,s4,s5,s6,s7;if(s0=peg$currPos,(s1=peg$parsePathExpr())!==peg$FAILED){for(s2=[],s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(124===input.charCodeAt(peg$currPos)?(s5=peg$c67,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c68)),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parsePathExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s3!==peg$FAILED;)s2.push(s3),s3=peg$currPos,s3=(s4=peg$parse_())!==peg$FAILED?(124===input.charCodeAt(peg$currPos)?(s5=peg$c67,peg$currPos++):(s5=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c68)),s5!==peg$FAILED&&(s6=peg$parse_())!==peg$FAILED&&(s7=peg$parsePathExpr())!==peg$FAILED?s4=[s4,s5,s6,s7]:(peg$currPos=s3,peg$FAILED)):(peg$currPos=s3,peg$FAILED);s0=s2!==peg$FAILED?(s0,s1=peg$c69(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}())!==peg$FAILED&&(s0,s1=peg$c51(s1)),(s0=s1)===peg$FAILED&&(s0=peg$currPos,45===input.charCodeAt(peg$currPos)?(s1=peg$c91,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c92)),s0=s1!==peg$FAILED&&peg$parse_()!==peg$FAILED&&(s3=peg$parseUnaryExpr())!==peg$FAILED?(s0,s1=peg$c97(s3)):(peg$currPos=s0,peg$FAILED)),s0}function peg$parseLiteral(){var s0,s1,s2,s3;if(s0=peg$currPos,34===input.charCodeAt(peg$currPos)?(s1=peg$c98,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c99)),s1!==peg$FAILED){for(s2=[],peg$c100.test(input.charAt(peg$currPos))?(s3=input.charAt(peg$currPos),peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c101));s3!==peg$FAILED;)s2.push(s3),peg$c100.test(input.charAt(peg$currPos))?(s3=input.charAt(peg$currPos),peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c101));s0=s2!==peg$FAILED?(34===input.charCodeAt(peg$currPos)?(s3=peg$c98,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c99)),s3!==peg$FAILED?(s0,s1=peg$c102(s2)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;if(s0===peg$FAILED)if(s0=peg$currPos,39===input.charCodeAt(peg$currPos)?(s1=peg$c103,peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c104)),s1!==peg$FAILED){for(s2=[],peg$c105.test(input.charAt(peg$currPos))?(s3=input.charAt(peg$currPos),peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c106));s3!==peg$FAILED;)s2.push(s3),peg$c105.test(input.charAt(peg$currPos))?(s3=input.charAt(peg$currPos),peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c106));s0=s2!==peg$FAILED?(39===input.charCodeAt(peg$currPos)?(s3=peg$c103,peg$currPos++):(s3=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c104)),s3!==peg$FAILED?(s0,s1=peg$c102(s2)):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}function peg$parseDigits(){var s0,s1,s2;if(s0=peg$currPos,s1=[],peg$c109.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c110)),s2!==peg$FAILED)for(;s2!==peg$FAILED;)s1.push(s2),peg$c109.test(input.charAt(peg$currPos))?(s2=input.charAt(peg$currPos),peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c110));else s1=peg$FAILED;return s1!==peg$FAILED&&(s0,s1=peg$c111(s1)),s0=s1}function peg$parseMultiplyOperator(){var s0;return 42===input.charCodeAt(peg$currPos)?(s0=peg$c112,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c113)),s0}function peg$parse_(){var s0;return(s0=function(){var s0,s1;if(s0=[],peg$c130.test(input.charAt(peg$currPos))?(s1=input.charAt(peg$currPos),peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c131)),s1!==peg$FAILED)for(;s1!==peg$FAILED;)s0.push(s1),peg$c130.test(input.charAt(peg$currPos))?(s1=input.charAt(peg$currPos),peg$currPos++):(s1=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c131));else s0=peg$FAILED;return s0}())===peg$FAILED&&(s0=null),s0}function peg$parseQName(){var s0,s1;return s0=peg$currPos,(s1=function(){var s0,s1,s2,s3;s0=peg$currPos,s0=(s1=peg$parseNCName())!==peg$FAILED?(58===input.charCodeAt(peg$currPos)?(s2=peg$c120,peg$currPos++):(s2=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c121)),s2!==peg$FAILED?(s3=peg$parseNCName())!==peg$FAILED?(s0,s1=peg$c133(s1,s3)):(peg$currPos=s0,peg$FAILED):(peg$currPos=s0,peg$FAILED)):(peg$currPos=s0,peg$FAILED);return s0}())===peg$FAILED&&(s1=function(){var s0,s1;s0=peg$currPos,(s1=peg$parseNCName())!==peg$FAILED&&(s0,s1=peg$c134(s1));return s0=s1}()),s1!==peg$FAILED&&(s0,s1=peg$c132(s1)),s0=s1}function peg$parseNCName(){return function(){var s0,s1,s2,s3;if(s0=peg$currPos,(s1=peg$parseNameStartChar())!==peg$FAILED){for(s2=[],s3=peg$parseNameChar();s3!==peg$FAILED;)s2.push(s3),s3=peg$parseNameChar();s0=s2!==peg$FAILED?(s0,s1=peg$c169(s1,s2)):(peg$currPos=s0,peg$FAILED)}else peg$currPos=s0,s0=peg$FAILED;return s0}()}function peg$parseNameStartChar(){var s0;return peg$c135.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c136)),s0===peg$FAILED&&(95===input.charCodeAt(peg$currPos)?(s0=peg$c137,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c138)),s0===peg$FAILED&&(peg$c139.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c140)),s0===peg$FAILED&&(peg$c141.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c142)),s0===peg$FAILED&&(peg$c143.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c144)),s0===peg$FAILED&&(peg$c145.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c146)),s0===peg$FAILED&&(peg$c147.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c148)),s0===peg$FAILED&&(peg$c149.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c150)),s0===peg$FAILED&&(peg$c151.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c152)),s0===peg$FAILED&&(peg$c153.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c154)),s0===peg$FAILED&&(peg$c155.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c156)),s0===peg$FAILED&&(peg$c157.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c158)),s0===peg$FAILED&&(peg$c159.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c160)),s0===peg$FAILED&&(peg$c161.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c162))))))))))))))),s0}function peg$parseNameChar(){var s0;return(s0=peg$parseNameStartChar())===peg$FAILED&&(45===input.charCodeAt(peg$currPos)?(s0=peg$c91,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c92)),s0===peg$FAILED&&(46===input.charCodeAt(peg$currPos)?(s0=peg$c55,peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c56)),s0===peg$FAILED&&(peg$c109.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c110)),s0===peg$FAILED&&(peg$c163.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c164)),s0===peg$FAILED&&(peg$c165.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c166)),s0===peg$FAILED&&(peg$c167.test(input.charAt(peg$currPos))?(s0=input.charAt(peg$currPos),peg$currPos++):(s0=peg$FAILED,0===peg$silentFails&&peg$fail(peg$c168)))))))),s0}var lastQNameParsed,expressionSimplifier=function(left,right,rightTypeIndex,rightPartIndex){var i,j,result={type:"",args:[]};for(result.args.push(left),i=0;i<right.length;i++){switch(typeof rightTypeIndex){case"string":result.type=rightTypeIndex;break;case"object":for(result.type=right[i][rightTypeIndex[0]],j=1;j<rightTypeIndex.length;j++)result.type=result.type[rightTypeIndex[j]];break;default:result.type=right[i][rightTypeIndex]}result.args.push(void 0===rightPartIndex?right[i]:right[i][rightPartIndex]),result={type:"",args:[result]}}return result.args[0]},predicateExpression=function(expr,axis,predicate,predicateIndex){var i,predicates=[];if(predicate.length<1)return expr;for(i=0;i<predicate.length;i++)predicates.push(predicate[i][predicateIndex]);return{type:"predicate",args:[axis,expr,predicates]}},nsPrefixes=[],trackNsPrefix=function(ns){var i,nsPrefixExists=!1;if(null!==ns){for(i=0;i<nsPrefixes.length;i++)if(nsPrefixes[i]===ns){nsPrefixExists=!0;break}nsPrefixExists||nsPrefixes.push(ns)}},nodeTypeNames=["comment","text","processing-instruction","node"],expandSlashAbbrev=function(slash,left,right){return"/"==slash?{type:"/",args:[left,right]}:{type:"/",args:[{type:"/",args:[left,{type:"step",args:["descendant-or-self",{type:"nodeType",args:["node",[]]}]}]},right]}};if((peg$result=peg$startRuleFunction())!==peg$FAILED&&peg$currPos===input.length)return peg$result;throw peg$result!==peg$FAILED&&peg$currPos<input.length&&peg$fail({type:"end",description:"end of input"}),peg$buildException(null,peg$maxFailExpected,peg$maxFailPos<input.length?input.charAt(peg$maxFailPos):null,peg$maxFailPos<input.length?peg$computeLocation(peg$maxFailPos,peg$maxFailPos+1):peg$computeLocation(peg$maxFailPos,peg$maxFailPos))}}}()},function(module,exports){var MAX_INT32=2147483647;function Random(seed){this._seed=seed%MAX_INT32,this._seed<=0&&(this._seed+=MAX_INT32-1)}Number.isInteger=Number.isInteger||function(value){return"number"==typeof value&&isFinite(value)&&Math.floor(value)===value},Random.prototype.next=function(){return this._seed=16807*this._seed%MAX_INT32},Random.prototype.nextFloat=function(){return(this.next()-1)/(MAX_INT32-1)},module.exports=function(array,seed){var rng,result=[];if(void 0!==seed){if(!Number.isInteger(seed))throw new Error("Invalid seed argument. Integer required.");var rnd=new Random(seed);rng=rnd.nextFloat.bind(rnd)}else rng=Math.random;for(var i=0;i<array.length;++i){var j=Math.floor(rng()*(i+1));j!==i&&(result[i]=result[j]),result[j]=array[i]}return result}},function(module,exports){var D2R=Math.PI/180;function _toLatLngs(geopoints){return geopoints.map(function(geopoint){return geopoint.trim().split(" ")})}function _latLngsValid(latLngs){return latLngs.every(function(coords){return""!==coords[0]&&-90<=coords[0]&&coords[0]<=90&&""!==coords[1]&&-180<=coords[1]&&coords[1]<=180&&(void 0===coords[2]||!isNaN(coords[2]))&&(void 0===coords[3]||!isNaN(coords[3])&&0<=coords[3])})}module.exports={area:function(geopoints){var latLngs=_toLatLngs(geopoints);if(!_latLngsValid(latLngs))return Number.NaN;var pointsCount=latLngs.length,area=0;if(2<pointsCount){for(var i=0;i<pointsCount;i++){var p1_lat=latLngs[i][0],p1_lng=latLngs[i][1],p2_lat=latLngs[(i+1)%pointsCount][0];area+=(latLngs[(i+1)%pointsCount][1]-p1_lng)*D2R*(2+Math.sin(p1_lat*D2R)+Math.sin(p2_lat*D2R))}area=6378100*area*6378100/2}return Math.abs(Math.round(100*area))/100},distance:function(geopoints){var latLngs=_toLatLngs(geopoints);if(!_latLngsValid(latLngs))return Number.NaN;var pointsCount=latLngs.length,distance=0;if(1<pointsCount)for(var i=1;i<pointsCount;i++){var p1_lat=latLngs[i-1][0],p1_lng=latLngs[i-1][1],p2_lat=latLngs[i][0],p2_lng=latLngs[i][1],Ï1=p1_lat*D2R,Ï2=p2_lat*D2R,ÎÏ=(p2_lat-p1_lat)*D2R,ÎÎ»=(p2_lng-p1_lng)*D2R,a=Math.sin(ÎÏ/2)*Math.sin(ÎÏ/2)+Math.cos(Ï1)*Math.cos(Ï2)*Math.sin(ÎÎ»/2)*Math.sin(ÎÎ»/2);distance+=6378100*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}return Math.abs(Math.round(100*distance))/100}}},function(module,exports){module.exports=function(){var tasks=[],_this=this,progressDelegate=null;this.progress={total:0,done:0},this.onProgress=function(callback){progressDelegate=callback},this.add=function(taskFactory){tasks.push(taskFactory),_this.progress.total+=1},this.isEmpty=function(){return!tasks.length},this.run=function(){return tasks.reduce(function(previous,taskFactory){return previous.then(function(){return taskFactory().then(function(){_this.progress.done+=1,null!==progressDelegate&&progressDelegate(_this.progress)})})},Promise.resolve())}}},function(module,exports,__webpack_require__){function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var Compressor=__webpack_require__(425);module.exports=function(file,maxWidth){return new Promise(function(resolve,reject){new Compressor(file,function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(source,!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}({},{maxWidth:maxWidth,quality:.6,convertSize:1/0},{success:resolve,error:reject}))})}},function(module,exports,__webpack_require__){"use strict";
/*!
 * Compressor.js v1.0.5
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2019-01-23T10:53:08.724Z
 */function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}var canvasToBlob=function(fn,module){return fn(module={exports:{}},module.exports),module.exports}(function(module){"undefined"!=typeof window&&function(window){var CanvasPrototype=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype,hasBlobConstructor=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,dataURIPattern=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,dataURLtoBlob=(hasBlobConstructor||BlobBuilder)&&window.atob&&window.ArrayBuffer&&window.Uint8Array&&function(dataURI){var matches,mediaType,isBase64,dataString,byteString,arrayBuffer,intArray,i,bb;if(!(matches=dataURI.match(dataURIPattern)))throw new Error("invalid data URI");for(mediaType=matches[2]?matches[1]:"text/plain"+(matches[3]||";charset=US-ASCII"),isBase64=!!matches[4],dataString=dataURI.slice(matches[0].length),byteString=isBase64?atob(dataString):decodeURIComponent(dataString),arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),i=0;i<byteString.length;i+=1)intArray[i]=byteString.charCodeAt(i);return hasBlobConstructor?new Blob([hasArrayBufferViewSupport?intArray:arrayBuffer],{type:mediaType}):((bb=new BlobBuilder).append(arrayBuffer),bb.getBlob(mediaType))};window.HTMLCanvasElement&&!CanvasPrototype.toBlob&&(CanvasPrototype.mozGetAsFile?CanvasPrototype.toBlob=function(callback,type,quality){var self=this;setTimeout(function(){quality&&CanvasPrototype.toDataURL&&dataURLtoBlob?callback(dataURLtoBlob(self.toDataURL(type,quality))):callback(self.mozGetAsFile("blob",type))})}:CanvasPrototype.toDataURL&&dataURLtoBlob&&(CanvasPrototype.toBlob=function(callback,type,quality){var self=this;setTimeout(function(){callback(dataURLtoBlob(self.toDataURL(type,quality)))})})),module.exports?module.exports=dataURLtoBlob:window.dataURLtoBlob=dataURLtoBlob}(window)}),DEFAULTS={strict:!0,checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,quality:.8,mimeType:"auto",convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},WINDOW="undefined"!=typeof window?window:{},slice=Array.prototype.slice;var REGEXP_IMAGE_TYPE=/^image\/.+$/;function isImageType(value){return REGEXP_IMAGE_TYPE.test(value)}var fromCharCode=String.fromCharCode;var btoa=WINDOW.btoa;function resetAndGetOrientation(arrayBuffer){var orientation,dataView=new DataView(arrayBuffer);try{var littleEndian,app1Start,ifdStart;if(255===dataView.getUint8(0)&&216===dataView.getUint8(1))for(var length=dataView.byteLength,offset=2;offset+1<length;){if(255===dataView.getUint8(offset)&&225===dataView.getUint8(offset+1)){app1Start=offset;break}offset+=1}if(app1Start){var tiffOffset=app1Start+10;if("Exif"===function(dataView,start,length){var i,str="";for(length+=start,i=start;i<length;i+=1)str+=fromCharCode(dataView.getUint8(i));return str}(dataView,app1Start+4,4)){var endianness=dataView.getUint16(tiffOffset);if(((littleEndian=18761===endianness)||19789===endianness)&&42===dataView.getUint16(tiffOffset+2,littleEndian)){var firstIFDOffset=dataView.getUint32(tiffOffset+4,littleEndian);8<=firstIFDOffset&&(ifdStart=tiffOffset+firstIFDOffset)}}}if(ifdStart){var _offset,i,_length=dataView.getUint16(ifdStart,littleEndian);for(i=0;i<_length;i+=1)if(_offset=ifdStart+12*i+2,274===dataView.getUint16(_offset,littleEndian)){_offset+=8,orientation=dataView.getUint16(_offset,littleEndian),dataView.setUint16(_offset,1,littleEndian);break}}}catch(e){orientation=1}return orientation}var REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/;function normalizeDecimalNumber(value,argument_1){var times=1<arguments.length&&void 0!==argument_1?argument_1:1e11;return REGEXP_DECIMALS.test(value)?Math.round(value*times)/times:value}var ArrayBuffer$1=WINDOW.ArrayBuffer,FileReader=WINDOW.FileReader,URL=WINDOW.URL||WINDOW.webkitURL,REGEXP_EXTENSION=/\.\w+$/,AnotherCompressor=WINDOW.Compressor,Compressor=function(){function Compressor(file,options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Compressor),this.file=file,this.image=new Image,this.options=_objectSpread({},DEFAULTS,options),this.aborted=!1,this.result=null,this.init()}return function(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}(Compressor,[{key:"init",value:function(){var _this=this,file=this.file,options=this.options;if(function(input){return"undefined"!=typeof Blob&&(input instanceof Blob||"[object Blob]"===Object.prototype.toString.call(input))}(file)){var mimeType=file.type;if(isImageType(mimeType))if(URL&&FileReader)if(ArrayBuffer$1||(options.checkOrientation=!1),URL&&!options.checkOrientation)this.load({url:URL.createObjectURL(file)});else{var reader=new FileReader,checkOrientation=options.checkOrientation&&"image/jpeg"===mimeType;(this.reader=reader).onload=function(_ref){var result=_ref.target.result,data={};if(checkOrientation){var orientation=resetAndGetOrientation(result);1<orientation||!URL?(data.url=function(arrayBuffer,mimeType){for(var value,chunks=[],uint8=new Uint8Array(arrayBuffer);0<uint8.length;)chunks.push(fromCharCode.apply(null,(value=uint8.subarray(0,8192),Array.from?Array.from(value):slice.call(value)))),uint8=uint8.subarray(8192);return"data:".concat(mimeType,";base64,").concat(btoa(chunks.join("")))}(result,mimeType),1<orientation&&_extends(data,function(orientation){var rotate=0,scaleX=1,scaleY=1;switch(orientation){case 2:scaleX=-1;break;case 3:rotate=-180;break;case 4:scaleY=-1;break;case 5:rotate=90,scaleY=-1;break;case 6:rotate=90;break;case 7:rotate=90,scaleX=-1;break;case 8:rotate=-90}return{rotate:rotate,scaleX:scaleX,scaleY:scaleY}}(orientation))):data.url=URL.createObjectURL(file)}else data.url=result;_this.load(data)},reader.onabort=function(){_this.fail(new Error("Aborted to read the image with FileReader."))},reader.onerror=function(){_this.fail(new Error("Failed to read the image with FileReader."))},reader.onloadend=function(){_this.reader=null},checkOrientation?reader.readAsArrayBuffer(file):reader.readAsDataURL(file)}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(data){var _this2=this,file=this.file,image=this.image;image.onload=function(){_this2.draw(_objectSpread({},data,{naturalWidth:image.naturalWidth,naturalHeight:image.naturalHeight}))},image.onabort=function(){_this2.fail(new Error("Aborted to load the image."))},image.onerror=function(){_this2.fail(new Error("Failed to load the image."))},image.alt=file.name,image.src=data.url}},{key:"draw",value:function(_ref2){var _this3=this,naturalWidth=_ref2.naturalWidth,naturalHeight=_ref2.naturalHeight,_ref2$rotate=_ref2.rotate,rotate=void 0===_ref2$rotate?0:_ref2$rotate,_ref2$scaleX=_ref2.scaleX,scaleX=void 0===_ref2$scaleX?1:_ref2$scaleX,_ref2$scaleY=_ref2.scaleY,scaleY=void 0===_ref2$scaleY?1:_ref2$scaleY,file=this.file,image=this.image,options=this.options,canvas=document.createElement("canvas"),context=canvas.getContext("2d"),aspectRatio=naturalWidth/naturalHeight,is90DegreesRotated=Math.abs(rotate)%180==90,maxWidth=Math.max(options.maxWidth,0)||1/0,maxHeight=Math.max(options.maxHeight,0)||1/0,minWidth=Math.max(options.minWidth,0)||0,minHeight=Math.max(options.minHeight,0)||0,width=Math.max(options.width,0)||naturalWidth,height=Math.max(options.height,0)||naturalHeight;if(is90DegreesRotated){var _ref3=[maxHeight,maxWidth];maxWidth=_ref3[0],maxHeight=_ref3[1];var _ref4=[minHeight,minWidth];minWidth=_ref4[0],minHeight=_ref4[1];var _ref5=[height,width];width=_ref5[0],height=_ref5[1]}maxWidth<1/0&&maxHeight<1/0?maxWidth<maxHeight*aspectRatio?maxHeight=maxWidth/aspectRatio:maxWidth=maxHeight*aspectRatio:maxWidth<1/0?maxHeight=maxWidth/aspectRatio:maxHeight<1/0&&(maxWidth=maxHeight*aspectRatio),0<minWidth&&0<minHeight?minWidth<minHeight*aspectRatio?minHeight=minWidth/aspectRatio:minWidth=minHeight*aspectRatio:0<minWidth?minHeight=minWidth/aspectRatio:0<minHeight&&(minWidth=minHeight*aspectRatio),width<height*aspectRatio?height=width/aspectRatio:width=height*aspectRatio;var destX=-(width=Math.floor(normalizeDecimalNumber(Math.min(Math.max(width,minWidth),maxWidth))))/2,destY=-(height=Math.floor(normalizeDecimalNumber(Math.min(Math.max(height,minHeight),maxHeight))))/2,destWidth=width,destHeight=height;if(is90DegreesRotated){var _ref6=[height,width];width=_ref6[0],height=_ref6[1]}canvas.width=width,canvas.height=height,isImageType(options.mimeType)||(options.mimeType=file.type);var fillStyle="transparent";if(file.size>options.convertSize&&"image/png"===options.mimeType&&(fillStyle="#fff",options.mimeType="image/jpeg"),context.fillStyle=fillStyle,context.fillRect(0,0,width,height),options.beforeDraw&&options.beforeDraw.call(this,context,canvas),!this.aborted&&(context.save(),context.translate(width/2,height/2),context.rotate(rotate*Math.PI/180),context.scale(scaleX,scaleY),context.drawImage(image,destX,destY,destWidth,destHeight),context.restore(),options.drew&&options.drew.call(this,context,canvas),!this.aborted)){var done=function(result){_this3.aborted||_this3.done({naturalWidth:naturalWidth,naturalHeight:naturalHeight,result:result})};canvas.toBlob?canvas.toBlob(done,options.mimeType,options.quality):done(canvasToBlob(canvas.toDataURL(options.mimeType,options.quality)))}}},{key:"done",value:function(_ref7){var naturalWidth=_ref7.naturalWidth,naturalHeight=_ref7.naturalHeight,result=_ref7.result,file=this.file,image=this.image,options=this.options;if(URL&&!options.checkOrientation&&URL.revokeObjectURL(image.src),result)if(options.strict&&result.size>file.size&&options.mimeType===file.type&&!(options.width>naturalWidth||options.height>naturalHeight||options.minWidth>naturalWidth||options.minHeight>naturalHeight))result=file;else{var date=new Date;result.lastModified=date.getTime(),result.lastModifiedDate=date,result.name=file.name,result.name&&result.type!==file.type&&(result.name=result.name.replace(REGEXP_EXTENSION,function(value){var extension=isImageType(value)?value.substr(6):"";return"jpeg"===extension&&(extension="jpg"),".".concat(extension)}(result.type)))}else result=file;this.result=result,options.success&&options.success.call(this,result)}},{key:"fail",value:function(err){var options=this.options;if(!options.error)throw err;options.error.call(this,err)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=AnotherCompressor,Compressor}},{key:"setDefaults",value:function(options){_extends(DEFAULTS,options)}}]),Compressor}();module.exports=Compressor},function(module,exports,__webpack_require__){"use strict";var FormModel=__webpack_require__(201),$=__webpack_require__(2),Promise=__webpack_require__(58),utils=__webpack_require__(38),t=__webpack_require__(46).t,config=__webpack_require__(71),inputHelper=__webpack_require__(427),repeatModule=__webpack_require__(428),pageModule=__webpack_require__(429),branchModule=__webpack_require__(432),itemsetModule=__webpack_require__(433),progressModule=__webpack_require__(434),widgetModule=__webpack_require__(435),languageModule=__webpack_require__(467),preloadModule=__webpack_require__(468),outputModule=__webpack_require__(469),calculationModule=__webpack_require__(470),maskModule=__webpack_require__(471);function Form(formSelector,data,options){var $form=$(formSelector);this.$nonRepeats={},this.$all={},this.options="object"!=typeof options?{}:options,void 0===this.options.clearIrrelevantImmediately&&(this.options.clearIrrelevantImmediately=!0),this.view={$:$form,html:$form[0],$clone:$form.clone()},this.model=new FormModel(data),this.repeatsPresent=0<this.view.$.find(".or-repeat").length,this.widgetsInitialized=!1,this.pageNavigationBlocked=!1}__webpack_require__(203),__webpack_require__(133),(Form.prototype={evaluationCascadeAdditions:[],get evaluationCascade(){return[this.calc.update.bind(this.calc),this.repeats.countUpdate.bind(this.repeats),this.branch.update.bind(this.branch),this.output.update.bind(this.output),this.itemset.update.bind(this.itemset),this.validationUpdate].concat(this.evaluationCascadeAdditions)},get recordName(){return this.view.$.attr("name")},set recordName(name){this.view.$.attr("name",name)},get editStatus(){return!!this.view.$.data("edited")},set editStatus(status){status&&status!==this.view.$.data("edited")&&this.view.$.trigger("edited.enketo"),this.view.$.data("edited",status)},get surveyName(){return this.view.$.find("#form-title").text()},get instanceID(){return this.model.instanceID},get deprecatedID(){return this.model.deprecatedID},get instanceName(){return this.model.instanceName},get version(){return this.model.version},get encryptionKey(){return this.view.$.data("base64rsapublickey")},get action(){return this.view.$.attr("action")},get method(){return this.view.$.attr("method")}}).addModule=function(module){return Object.create(module,{form:{value:this}})},Form.prototype.init=function(){var loadErrors=[],that=this;if(loadErrors=loadErrors.concat(this.model.init()),void 0===this.model||!(this.model instanceof FormModel))return loadErrors.push("Form could not be initialized without a model."),loadErrors;this.model.$events.on("dataupdate",function(event,updated){that.view.$.trigger("dataupdate.enketo",updated)}),this.model.$events.on("removed",function(event,updated){that.view.$.trigger("removed.enketo",updated)}),this.pages=this.addModule(pageModule),this.langs=this.addModule(languageModule),this.progress=this.addModule(progressModule),this.widgets=this.addModule(widgetModule),this.preloads=this.addModule(preloadModule),this.branch=this.addModule(branchModule),this.repeats=this.addModule(repeatModule),this.input=this.addModule(inputHelper),this.output=this.addModule(outputModule),this.itemset=this.addModule(itemsetModule),this.calc=this.addModule(calculationModule),this.mask=this.addModule(maskModule);try{return this.preloads.init(),this.view.$.data({instanceID:this.model.instanceID}),this.grosslyViolateStandardComplianceByIgnoringCertainCalcs(),this.calc.update(),this.langs.init(),this.pages.init(),this.repeats.init(),this.itemset.update(),this.setAllVals(),this.options.input=this.input,this.options.pathToAbsolute=this.pathToAbsolute.bind(this),this.options.evaluate=this.model.evaluate.bind(this.model),this.options.formClasses=utils.toArray(this.view.html.classList),this.widgetsInitialized=this.widgets.init(null,this.options),this.branch.update(),this.output.update(),this.setEventHandlers(),this.calc.update(),this.pages.init(),this.mask.init(),(this.editStatus=!1)!==this.options.printRelevantOnly&&this.view.$.addClass("print-relevant-only"),setTimeout(function(){that.progress.update()},0),loadErrors}catch(e){console.error(e),loadErrors.push(e.name+": "+e.message)}return document.querySelector("body").scrollIntoView(),console.debug("loadErrors",loadErrors),loadErrors},Form.prototype.goTo=function(xpath){var errors=[];return this.goToTarget(this.getGoToTarget(xpath))||errors.push(t("alert.gotonotfound.msg",{path:location.hash.substring(1)})),errors},Form.prototype.getDataStr=function(include){return!1===(include="object"!=typeof include||null===include?{}:include).irrelevant?this.getDataStrWithoutIrrelevantNodes():this.model.getStr()},Form.prototype.resetView=function(){$("#form-languages").remove(),this.view.$.replaceWith(this.view.$clone)},Form.prototype.replaceChoiceNameFn=function(expr,resTypeStr,selector,index,tryNative){var value,name,$input,label="",matches=expr.match(new RegExp("jr:choice-name\\(([^,]+),\\s*(?:\"([^\"]*)\"|'([^']*)')\\s*\\)"));return matches?(value=this.model.evaluate(matches[1],resTypeStr,selector,index,tryNative),name=(matches[2]||matches[3]||"").trim(),0<($input=this.view.$.find('[name="'+name+'"]')).length&&"select"===$input.prop("nodeName").toLowerCase()?label=$input.find('[value="'+value+'"]').text():0<$input.length&&"input"===$input.prop("nodeName").toLowerCase()&&(label=$input.filter(function(){return $(this).attr("value")===value}).siblings(".option-label.active").text()),expr.replace(matches[0],'"'+label+'"')):expr},Form.prototype.setAllVals=function($group,groupIndex){var index,name,value,that=this,selector=$group&&$group.attr("name")?$group.attr("name"):null;groupIndex=void 0!==groupIndex?groupIndex:null,this.model.node(selector,groupIndex).get().find("*").filter(function(){var $node=$(this);return 0===$node.children().length&&$node.text()}).each(function(){var $node=$(this);try{value=$node.text(),name=that.model.getXPath($node.get(0),"instance"),index=that.model.node(name).get().index(this),that.input.setVal(name,index,value)}catch(e){throw console.error(e),new Error("Could not load input field value with name: "+name+" and value: "+value)}})},Form.prototype.getRelatedNodes=function(attr,filter,updated){var $collection,$controls,$repeatControls=null,selector=[],that=this;updated=updated||{},filter=filter||"",this.$nonRepeats[attr]||($controls=this.view.$.find(":not(.or-repeat-info)["+attr+"]").filter(function(){return 0===$(this).closest(".or-repeat").length}),this.$nonRepeats[attr]=this.filterRadioCheckSiblings($controls)),void 0!==updated.repeatPath&&0<=updated.repeatIndex&&($controls=this.view.$.find('.or-repeat[name="'+updated.repeatPath+'"]').eq(updated.repeatIndex).find("["+attr+"]"),$repeatControls=this.filterRadioCheckSiblings($controls)),!this.$all[attr]||updated.repeatPath&&!updated.cloned?this.$all[attr]=this.filterRadioCheckSiblings(this.view.$.find("["+attr+"]")):updated.cloned&&$repeatControls&&(this.$all[attr]=this.$all[attr].add($repeatControls)),$collection=$repeatControls?this.$nonRepeats[attr].add($repeatControls):this.$all[attr];var selectorStr=(selector=updated.nodes&&0!==updated.nodes.length?(updated.nodes.forEach(function(node){selector=selector.concat(that.getQuerySelectorsForLogic(filter,attr,node))}),selector.concat(that.getQuerySelectorsForLogic(filter,attr,"*"))):selector.concat([filter])).join(", ");return $collection=selectorStr?$collection.filter(selectorStr):$collection},Form.prototype.filterRadioCheckSiblings=function($controls){var wrappers=[];return $controls.filter(function(){var wrapper="radio"===this.type||"checkbox"===this.type?$(this.parentNode).parent(".option-wrapper")[0]:null;if(wrapper){if(-1!==wrappers.indexOf(wrapper))return!1;wrappers.push(wrapper)}return!0})},Form.prototype.getQuerySelectorsForLogic=function(filter,attr,nodeName){return[filter+"["+attr+'*="/'+nodeName+' "]',filter+"["+attr+'*="/'+nodeName+')"]',filter+"["+attr+'*="/'+nodeName+',"]',filter+"["+attr+'$="/'+nodeName+'"]',filter+"["+attr+'*="/'+nodeName+']"]']},Form.prototype.getDataStrWithoutIrrelevantNodes=function(){var that=this,modelClone=new FormModel(this.model.getStr());return modelClone.init(),this.getRelatedNodes("data-relevant").reverse().each(function(){var context,$node=$(this),relevant=that.input.getRelevant($node),index=that.input.getIndex($node),path=that.input.getName($node);(context=$node.children('.or-repeat-info[data-name="'+path+'"]').length&&!$node.children('.or-repeat[name="'+path+'"]').length?null:path)&&!that.model.evaluate(relevant,"boolean",context,index)&&modelClone.node(context,index).remove()}),modelClone.getStr()},Form.prototype.grosslyViolateStandardComplianceByIgnoringCertainCalcs=function(){var $culprit=this.view.$.find('[name$="instanceID"][data-calculate]');0<$culprit.length&&$culprit.removeAttr("data-calculate")},Form.prototype.validationUpdate=function(updated){var upd,that=this;!0===config.validateContinuously&&(upd=updated||{},updated.cloned&&(upd={nodes:updated.repeatPath.split("/").reverse().slice(0,1)}),this.getRelatedNodes("data-constraint","",upd).add(this.getRelatedNodes("data-required","",upd)).each(function(){that.validateInput($(this))}))},Form.prototype.setEventHandlers=function(){var that=this;this.view.$.attr("onsubmit","return false;"),this.view.$.on("change.file","input:not(.ignore), select:not(.ignore), textarea:not(.ignore)",function(){var requiredExpr,$input=$(this),n={path:that.input.getName($input),inputType:that.input.getInputType($input),xmlType:that.input.getXmlType($input),enabled:that.input.isEnabled($input),constraint:that.input.getConstraint($input),val:that.input.getVal($input),required:that.input.getRequired($input),index:that.input.getIndex($input)};n.enabled&&"hidden"!==n.inputType&&n.required&&(requiredExpr=n.required),0<n.val.length&&"file"===n.inputType&&$input[0].files[0]&&0<$input[0].files[0].size&&(n.val=utils.getFilename($input[0].files[0],$input[0].dataset.filenamePostfix)),0<n.val.length&&"drawing"===n.inputType&&(n.val=utils.getFilename({name:n.val},$input[0].dataset.filenamePostfix)),that.model.node(n.path,n.index).setVal(n.val,n.constraint,n.xmlType,requiredExpr,!0),that.validateInput($input).then(function(valid){$input.trigger("valuechange.enketo",valid)})}),this.view.$.on("focus fakefocus","input:not(.ignore), select:not(.ignore), textarea:not(.ignore)",function(event){that.progress.update(event.target)}),this.model.$events.on("dataupdate",function(event,updated){that.evaluationCascade.forEach(function(fn){fn.call(that,updated)}),that.editStatus=!0}),this.view.$.on("addrepeat",function(event,index){var $clone=$(event.target),updated={repeatPath:$clone.attr("name"),repeatIndex:index,cloned:!0};that.setAllVals($clone,index),that.evaluationCascade.forEach(function(fn){fn.call(that,updated)}),that.progress.update()}),this.view.$.on("removerepeat",function(){that.progress.update()}),this.view.$.on("changelanguage",function(){that.output.update()}),this.view.$.find(".or-group > h4").on("click",function(){$(this).closest(".or-group").toggleClass("or-appearance-compact")})},Form.prototype.setValid=function($node,type){var classes=type?"invalid-"+type:"invalid-constraint invalid-required invalid-relevant";this.input.getWrapNodes($node).removeClass(classes)},Form.prototype.setInvalid=function($node,type){type=type||"constraint",!1===config.validatePage&&this.isValid($node)&&this.blockPageNavigation(),this.input.getWrapNodes($node).addClass("invalid-"+type)},Form.prototype.blockPageNavigation=function(){var that=this;this.pageNavigationBlocked=!0,window.clearTimeout(this.blockPageNavigationTimeout),this.blockPageNavigationTimeout=window.setTimeout(function(){that.pageNavigationBlocked=!1},600)},Form.prototype.isValid=function($node){var $question;return $node?!($question=this.input.getWrapNodes($node)).hasClass("invalid-required")&&!$question.hasClass("invalid-constraint")&&!$question.hasClass("invalid-relevant"):0===this.view.$.find(".invalid-required, .invalid-constraint, .invalid-relevant").length},Form.prototype.clearIrrelevant=function(){this.branch.update(null,!0)},Form.prototype.validate=Form.prototype.validateAll=function(){var that=this;return!1===this.options.clearIrrelevantImmediately&&this.clearIrrelevant(),this.validateContent(this.view.$).then(function(valid){return that.view.$.trigger("validationcomplete.enketo"),valid})},Form.prototype.validateContent=function($container){var $firstError,that=this;$container.find("fieldset:disabled input, fieldset:disabled select, fieldset:disabled textarea, input:disabled, select:disabled, textarea:disabled").each(function(){that.setValid($(this))});var validations=$container.find(".question").addBack(".question").map(function(){var $elem=$(this).find("input:not(.ignore):not(:disabled), select:not(.ignore):not(:disabled), textarea:not(.ignore):not(:disabled)");return 0===$elem.length?Promise.resolve():that.validateInput($elem.eq(0))}).toArray();return Promise.all(validations).then(function(){return 0<($firstError=$container.find(".invalid-required, .invalid-constraint, .invalid-relevant").addBack(".invalid-required, .invalid-constraint, .invalid-relevant").eq(0)).length&&that.goToTarget($firstError[0]),0===$firstError.length}).catch(function(){return!1})},Form.prototype.pathToAbsolute=function(targetPath,contextPath){var target;return 0===targetPath.indexOf("/")?targetPath:(target=this.model.evaluate(targetPath,"node",contextPath,0,!0),this.model.getXPath(target,"instance",!1))},Form.prototype.validateInput=function($input){var that=this,n={path:this.input.getName($input),inputType:this.input.getInputType($input),xmlType:this.input.getXmlType($input),enabled:this.input.isEnabled($input),constraint:this.input.getConstraint($input),calculation:this.input.getCalculation($input),required:this.input.getRequired($input),readonly:this.input.getReadonly($input),val:this.input.getVal($input)};return!n.readonly||n.val||n.required||n.constraint||n.calculation?(n.enabled&&"hidden"!==n.inputType?(n.ind=this.input.getIndex($input),this.model.node(n.path,n.ind).validate(n.constraint,n.required,n.xmlType)):Promise.resolve({requiredValid:!0,constraintValid:!0})).then(function(result){var previouslyInvalid=!1,passed=!1!==result.requiredValid&&!1!==result.constraintValid;return"hidden"!==n.inputType&&(n.$q=that.input.getWrapNodes($input),n.$required=n.$q.find(".required"),previouslyInvalid=n.$q.hasClass("invalid-required")||n.$q.hasClass("invalid-constraint"),!1===result.requiredValid?(that.setValid($input,"constraint"),that.setInvalid($input,"required"),n.$required.removeClass("hide")):(that.updateRequiredVisibility(n),!1===result.constraintValid?(that.setValid($input,"required"),that.setInvalid($input,"constraint")):(that.setValid($input,"constraint"),that.setValid($input,"required")))),passed||previouslyInvalid||$input.trigger("invalidated.enketo"),passed}).catch(function(e){throw console.error("validation error",e),that.setInvalid($input,"constraint"),e}):Promise.resolve()},Form.prototype.updateRequiredVisibility=function(n){n.required&&n.$required.toggleClass("hide",!this.model.node(n.path,n.ind).isRequired(n.required))},Form.prototype.getGoToTarget=function(path){var hits,modelNode,target,intermediateTarget,selector="",repeatRegEx=/([^[]+)\[(\d+)\]([^[]*$)?/g;if(path&&(modelNode=this.model.node(path).get().get(0))){if(path=this.model.getXPath(modelNode,"instance",!0),!(target=this.view.html.querySelector('[name="'+path+'"]')))for(intermediateTarget=this.view.html;null!==(hits=repeatRegEx.exec(path))&&intermediateTarget;)selector+=hits[1],(intermediateTarget=intermediateTarget.querySelectorAll('[name="'+selector+'"], [data-name="'+selector+'"]')[hits[2]])&&hits[3]&&(selector+=hits[3],intermediateTarget=intermediateTarget.querySelector('[name="'+selector+'"],[data-name="'+selector+'"]')),target=intermediateTarget;return target?this.input.getWrapNodes($(target)).get(0):target}},Form.prototype.goToTarget=function(target){return target&&(this.pages.active&&this.pages.flipToPageContaining($(target)),$(target).closest(".or-branch.disabled").length&&$(target).trigger("gotohidden.enketo"),target.scrollIntoView(),$(target.querySelector("input:not(.ignore), textarea:not(.ignore), select:not(.ignore)")).trigger("focus").trigger("applyfocus")),!!target},Form.getRequiredTransformerVersion=function(){return console.deprecate("Form.getRequiredTransformerVersion()","Form.requiredTransformerVersion"),Form.requiredTransformerVersion},Form.requiredTransformerVersion="1.25.2",(module.exports=Form).prototype.getInstanceID=function(){return console.deprecate("form.getInstanceID()","form.instanceID"),this.instanceID},Form.prototype.getDeprecatedID=function(){return console.deprecate("form.getDeprecatedID()","form.deprecatedID"),this.deprecatedID},Form.prototype.getInstanceName=function(){return console.deprecate("form.getModel()","form.instanceName"),this.instanceName},Form.prototype.getVersion=function(){return console.deprecate("form.getVersion()","form.version"),this.version},Form.prototype.getEncryptionKey=function(){return console.deprecate("form.getEncryptionKey()","form.encryptionKey"),this.encryptionKey},Form.prototype.getAction=function(){return console.deprecate("form.getAction()","form.action"),this.action},Form.prototype.getMethod=function(){return console.deprecate("form.getMethod()","form.method "),this.method},Form.prototype.getModel=function(){return console.deprecate("form.getModel()","form.model"),this.model},Form.prototype.getView=function(){return console.deprecate("form.getView()","form.view"),this.view},Form.prototype.getRecordName=function(){return console.deprecate("form.getRecordName()","form.recordName"),this.recordName},Form.prototype.setRecordName=function(name){console.deprecate("form.setRecordName()",'form.recordName="val"'),this.recordName=name},Form.prototype.setEditStatus=function(status){console.deprecate("form.setEditStatus()",'form.editStatus="val"'),this.editStatus=status},Form.prototype.getEditStatus=function(){return console.deprecate("form.getEditStatus()","form.editStatus"),this.editStatus},Form.prototype.getSurveyName=function(){return console.deprecate("form.getSurveyName()","form.editStatus"),this.surveyName}},function(module,exports,__webpack_require__){"use strict";module.exports={getWrapNodes:function($inputNodes){return"fieldset"===this.getInputType($inputNodes.eq(0))?$inputNodes:$inputNodes.closest(".question, .calculation")},getProps:function($node){return 1!==$node.length?console.error("getProps(): no input node provided or multiple"):{path:this.getName($node),ind:this.getIndex($node),inputType:this.getInputType($node),xmlType:this.getXmlType($node),constraint:this.getConstraint($node),calculation:this.getCalculation($node),relevant:this.getRelevant($node),readonly:this.getReadonly($node),val:this.getVal($node),required:this.getRequired($node),enabled:this.isEnabled($node),multiple:this.isMultiple($node)}},getInputType:function($node){var nodeName;return 1!==$node.length?"":"input"===(nodeName=$node.prop("nodeName").toLowerCase())?$node.data("drawing")?"drawing":0<$node.attr("type").length?$node.attr("type").toLowerCase():console.error("<input> node has no type"):"select"===nodeName?"select":"textarea"===nodeName?"textarea":"fieldset"===nodeName||"section"===nodeName?"fieldset":console.error("unexpected input node type provided")},getConstraint:function($node){return $node.attr("data-constraint")},getRequired:function($node){if(0===$node.parentsUntil(".or",".or-appearance-label").length)return $node.attr("data-required")},getRelevant:function($node){return $node.attr("data-relevant")},getReadonly:function($node){return $node.is("[readonly]")},getCalculation:function($node){return $node.attr("data-calculate")},getXmlType:function($node){return 1!==$node.length?console.error("getXMLType(): no input node provided or multiple"):$node.attr("data-type-xml")},getName:function($node){return 1!==$node.length?console.error("getName(): no input node provided or multiple"):$node.attr("data-name")||$node.attr("name")||console.error("input node has no name")},getIndex:function($node){var inputType,name,$wrapNode;return 1!==$node.length?console.error("getIndex(): no input node provided or multiple"):(inputType=this.getInputType($node),name=this.getName($node),$wrapNode=this.getWrapNodes($node),("radio"===inputType&&name!==$node.attr("name")?this.getWrapNodes(this.form.view.$.find('[data-name="'+name+'"]')):"fieldset"===inputType&&$node.hasClass("or-repeat")?this.getWrapNodes(this.form.view.$.find('.or-repeat[name="'+name+'"]')):"fieldset"===inputType&&$node.hasClass("or-group")?this.getWrapNodes(this.form.view.$.find('.or-group[name="'+name+'"]')):this.getWrapNodes(this.form.view.$.find('[name="'+name+'"]'))).index($wrapNode))},isMultiple:function($node){return"checkbox"===this.getInputType($node)||void 0!==$node.attr("multiple")},isEnabled:function($node){return!($node.prop("disabled")||0<$node.parentsUntil(".or",".disabled").length)},getVal:function($node){var inputType,name,values=[];return 1!==$node.length?console.error("getVal(): no inputNode provided or multiple"):(inputType=this.getInputType($node),name=this.getName($node),"radio"===inputType?this.getWrapNodes($node).find("input:checked").val()||"":"checkbox"===inputType?(this.getWrapNodes($node).find('input[name="'+name+'"]:checked').each(function(){values.push(this.value)}),values):$node.val()||"")},setVal:function(name,index,value){var $inputNodes,type,curVal,d,ds;if(index=index||0,"radio"===this.getInputType(this.form.view.$.find('[data-name="'+name+'"]').eq(0)))type="radio",$inputNodes=this.getWrapNodes(this.form.view.$.find('[data-name="'+name+'"]')).eq(index).find('[data-name="'+name+'"]');else{if($inputNodes=this.getWrapNodes(this.form.view.$.find('[name="'+name+'"]')).eq(index).find('[name="'+name+'"]'),"file"===(type=this.getInputType($inputNodes.eq(0))))return $inputNodes.eq(0).attr("data-loaded-file-name",value),!1;"date"!==type&&"datetime"!==type||(value=this.form.model.node(name,index).convert(value,type)),"time"===type&&/(\+|-)/.test(value)&&(ds=(new Date).toLocaleDateString("en",{month:"short",day:"numeric",year:"numeric"}).replace(/\u200E/g,"")+" "+value.replace(/(\d\d:\d\d:\d\d)(\.\d{1,3})(\s?((\+|-)\d\d))(:)?(\d\d)?/,"$1 GMT$3$7"),"Invalid Date"!==(d=new Date(ds)).toString()?value=d.getHours().toString().pad(2)+":"+d.getMinutes().toString().pad(2):console.error("could not parse time:",value))}!0===this.isMultiple($inputNodes.eq(0))?value=value.split(" "):"radio"===type&&(value=[value]),$inputNodes.length&&(void 0!==(curVal=this.getVal($inputNodes.eq(0)))&&curVal.toString()===value.toString()||($inputNodes.val(value),$inputNodes.eq(0).trigger("inputupdate.enketo")))},validate:function($input){return this.form.validateInput($input)}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),disableFirstRepeatRemoval=!0===__webpack_require__(71).repeatOrdinals;module.exports={init:function(){var $repeatInfos,that=this;if(!this.form)throw new Error("Repeat module not correctly instantiated with form property.");$repeatInfos=this.form.view.$.find(".or-repeat-info"),this.templates={},$repeatInfos.siblings(".or-repeat").filter(function(){return this.firstChild&&3===this.firstChild.nodeType&&(this.firstChild.textContent=""),!!this.querySelector(".question")}).prepend('<span class="repeat-number"></span>'),$repeatInfos.filter("*:not([data-repeat-fixed]):not([data-repeat-count])").append('<button type="button" class="btn btn-default add-repeat-btn"><i class="icon icon-plus"> </i></button>').siblings(".or-repeat").append('<div class="repeat-buttons"><button type="button" '+(disableFirstRepeatRemoval?" disabled ":" ")+'class="btn btn-default remove"><i class="icon icon-minus"> </i></button></div>'),this.form.model.extractFakeTemplates($repeatInfos.map(function(){return this.dataset.name}).get()),$repeatInfos.siblings(".or-repeat").reverse().each(function(){var $templateEl=$(this).remove(),xPath=$templateEl.attr("name");that.templates[xPath]=$templateEl[0]}),$repeatInfos.filter("*:not([data-repeat-count])").reverse().each(function(){$(this).closest(".or-repeat").length||that.updateDefaultFirstRepeatInstance(null,this)}).each(that.updateViewInstancesFromModel.bind(this)),this.form.view.$.on("click","button.add-repeat-btn:enabled",function(){return that.add($(this).closest(".or-repeat-info")[0]),!1}),this.form.view.$.on("click","button.remove:enabled",function(){return that.remove($(this).closest(".or-repeat")),!1}),this.countUpdate()},updateViewInstancesFromModel:function(idx,repeatInfo){var that=this,$repeatInfo=$(repeatInfo),repeatPath=repeatInfo.dataset.name,repeatSeriesIndex=this.form.view.$.find('.or-repeat-info[data-name="'+repeatPath+'"]').index(repeatInfo),repInModelSeries=this.form.model.getRepeatSeries(repeatPath,repeatSeriesIndex),repInViewSeries=$repeatInfo.siblings(".or-repeat");return repInModelSeries.length>repInViewSeries.length&&(this.add(repeatInfo,repInModelSeries.length-repInViewSeries.length),$repeatInfo.siblings(".or-repeat").find(".or-repeat-info:not([data-repeat-count])").each(function(){that.updateViewInstancesFromModel(null,this)})),repInModelSeries.length},updateDefaultFirstRepeatInstance:function(idx,repeatInfo){var repeatSeriesIndex,$repeatInfo=$(repeatInfo),repeatPath=repeatInfo.dataset.name;this.form.model.data.instanceStr||this.templates[repeatPath].classList.contains("or-appearance-minimal")||(repeatSeriesIndex=this.form.view.$.find('.or-repeat-info[data-name="'+repeatPath+'"]').index(repeatInfo),0===this.form.model.getRepeatSeries(repeatPath,repeatSeriesIndex).length&&this.add(repeatInfo),$repeatInfo.siblings(".or-repeat").find(".or-repeat-info:not([data-repeat-count])").each(this.updateDefaultFirstRepeatInstance.bind(this)))},updateRepeatInstancesFromCount:function(idx,repeatInfo){var $last,repCountNodes,numRepsInCount,numRepsInView,toCreate,repPath,repIndex,$repeatInfo=$(repeatInfo),repCountPath=repeatInfo.dataset.repeatCount||"";if(repCountPath){if(repPath=repeatInfo.dataset.name,repIndex=this.form.view.$.find('.or-repeat-info[data-name="'+repPath+'"]').index(repeatInfo),(repCountNodes=this.form.model.evaluate(repCountPath,"nodes",null,null,!0)).length&&repCountNodes[repIndex]?numRepsInCount=Number(repCountNodes[repIndex].textContent):console.error("Unexpectedly, could not obtain repeat count node"),0<(toCreate=(numRepsInCount=isNaN(numRepsInCount)?0:numRepsInCount)-(numRepsInView=$repeatInfo.siblings('.or-repeat[name="'+repPath+'"]').length)))this.add(repeatInfo,toCreate);else if(toCreate<0)for(toCreate=Math.abs(toCreate)>=numRepsInView?(disableFirstRepeatRemoval?1:0)-numRepsInView:toCreate;toCreate<0;toCreate++)$last=$repeatInfo.siblings(".or-repeat").last(),this.remove($last,0);$repeatInfo.siblings(".or-repeat").children(".or-group, .or-group-data").children(".or-repeat-info[data-repeat-count]").each(this.updateRepeatInstancesFromCount.bind(this))}},countUpdate:function(updated){updated=updated||{},this.form.getRelatedNodes("data-repeat-count",".or-repeat-info",updated).each(this.updateRepeatInstancesFromCount.bind(this))},add:function(repeatInfo,count){var $repeats,$clone,repeatIndex,repeatSeriesIndex,repeatPath,i,modelRepeatSeriesLength,$repeatInfo=$(repeatInfo),byCountUpdate=!!count;if(count=count||1,!repeatInfo)return console.error("Nothing to clone"),!1;for(repeatPath=repeatInfo.dataset.name,$repeats=$repeatInfo.siblings(".or-repeat"),$clone=$(this.templates[repeatPath]).clone(),repeatSeriesIndex=this.form.view.$.find('.or-repeat-info[data-name="'+repeatPath+'"]').index(repeatInfo),modelRepeatSeriesLength=this.form.model.getRepeatSeries(repeatPath,repeatSeriesIndex).length,i=0;i<count;i++)$clone.find(".option-wrapper").each(this.fixRadioNames),$clone.insertBefore(repeatInfo),$clone.prev(".or-repeat").length&&$clone.addClass("clone"),($repeats=$repeats.add($clone)).length>modelRepeatSeriesLength&&(this.form.model.addRepeat(repeatPath,repeatSeriesIndex),modelRepeatSeriesLength++),repeatIndex=repeatIndex||this.form.view.$.find('.or-repeat[name="'+repeatPath+'"]').index($clone),$clone.trigger("addrepeat",[repeatIndex,byCountUpdate]),this.form.widgetsInitialized?this.form.widgets.init($clone):this.form.calc.update({repeatPath:repeatPath,repeatIndex:repeatIndex}),$clone.find(".or-repeat-info:not([data-repeat-count])").each(this.updateDefaultFirstRepeatInstance.bind(this)),$clone=$(this.templates[repeatPath]).clone(),repeatIndex++;return this.numberRepeats(repeatInfo),this.toggleButtons(repeatInfo),!0},remove:function($repeat,delay){var that=this,$next=$repeat.next(".or-repeat, .or-repeat-info"),repeatPath=$repeat.attr("name"),repeatIndex=this.form.view.$.find('.or-repeat[name="'+repeatPath+'"]').index($repeat),repeatInfo=$repeat.siblings(".or-repeat-info")[0];delay=void 0!==delay?delay:600,$repeat.hide(delay,function(){$repeat.remove(),that.numberRepeats(repeatInfo),that.toggleButtons(repeatInfo),$next.trigger("removerepeat"),that.form.model.node(repeatPath,repeatIndex).remove()})},fixRadioNames:function(index,element){$(element).find('input[type="radio"]').attr("name",Math.floor(1e7*Math.random()+1))},toggleButtons:function(repeatInfo){$(repeatInfo).siblings(".or-repeat").children(".repeat-buttons").find("button.remove").prop("disabled",!1).first().prop("disabled",disableFirstRepeatRemoval)},numberRepeats:function(repeatInfo){$(repeatInfo).siblings(".or-repeat").each(function(idx,repeat){$(repeat).children(".repeat-number").text(idx+1)})}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),Promise=__webpack_require__(58),config=__webpack_require__(71);__webpack_require__(430),module.exports={active:!1,$current:[],$activePages:$(),init:function(){if(!this.form)throw new Error("Repeats module not correclty instantiated with form property.");if(this.form.view.$.hasClass("pages")){var $allPages=this.form.view.$.find(' .question:not([role="comment"]), .or-appearance-field-list').add(".or-repeat.or-appearance-field-list + .or-repeat-info").filter(function(){return 0===$(this).parent().closest(".or-appearance-field-list").length}).attr("role","page");(0<$allPages.length||$allPages.eq(0).hasClass("or-repeat"))&&(this.$formFooter=$(".form-footer"),this.$btnFirst=this.$formFooter.find(".first-page"),this.$btnPrev=this.$formFooter.find(".previous-page"),this.$btnNext=this.$formFooter.find(".next-page"),this.$btnLast=this.$formFooter.find(".last-page"),this.updateAllActive($allPages),this.toggleButtons(0),this.setButtonHandlers(),this.setRepeatHandlers(),this.setBranchHandlers(),this.setSwipeHandlers(),this.active=!0,this.flipToFirst())}},setButtonHandlers:function(){var that=this;this.$btnFirst.off(".pagemode").on("click.pagemode",function(){return that.form.pageNavigationBlocked||that.flipToFirst(),!1}),this.$btnPrev.off(".pagemode").on("click.pagemode",function(){return that.form.pageNavigationBlocked||that.prev(),!1}),this.$btnNext.off(".pagemode").on("click.pagemode",function(){return that.form.pageNavigationBlocked||that.next(),!1}),this.$btnLast.off(".pagemode").on("click.pagemode",function(){return that.form.pageNavigationBlocked||that.flipToLast(),!1})},setSwipeHandlers:function(){if(!1!==config.swipePage){var that=this,$main=$(".main");$main.swipe("destroy"),$main.swipe({allowPageScroll:"vertical",threshold:250,preventDefaultEvents:!1,swipeLeft:function(){that.$btnNext.click()},swipeRight:function(){that.$btnPrev.click()},swipeStatus:function(evt,phase){"start"===phase&&that.getCurrent().find(":focus").blur()}})}},setRepeatHandlers:function(){var that=this;this.form.view.$.off("addrepeat.pagemode").on("addrepeat.pagemode",function(event,index,byCountUpdate){that.updateAllActive(),$(event.target).removeClass("current contains-current").find(".current").removeClass("current"),byCountUpdate||that.flipToPageContaining($(event.target))}).off("removerepeat.pagemode").on("removerepeat.pagemode",function(event){if(0===that.$current.closest("html").length){that.updateAllActive();var $target=$(event.target).prev();0===$target.length&&($target=$(event.target)),that.flipToPageContaining($target)}})},setBranchHandlers:function(){var that=this;this.form.view.$.off("changebranch.pagemode").on("changebranch.pagemode",function(){that.updateAllActive(),that.toggleButtons()})},getCurrent:function(){return this.$current},updateAllActive:function($all){$all=$all||$('.or [role="page"]'),this.$activePages=$all.filter(function(){var $this=$(this);return 0===$this.closest(".disabled").length&&($this.is(".question")||0<$this.find(".question:not(.disabled)").length||$this.is(".or-repeat-info")&&0===$this.siblings(".or-repeat").length)})},getAllActive:function(){return this.$activePages},getPrev:function(currentIndex){return this.$activePages[currentIndex-1]},getNext:function(currentIndex){return this.$activePages[currentIndex+1]},getCurrentIndex:function(){return this.$activePages.index(this.$current)},next:function(){var currentIndex,that=this;return currentIndex=this.getCurrentIndex(),(!1===config.validatePage?Promise.resolve(!0):this.form.validateContent(this.$current)).then(function(valid){var next,newIndex;return!!valid&&(!(next=that.getNext(currentIndex))||(newIndex=currentIndex+1,that.flipTo(next,newIndex),newIndex))})},prev:function(){var prev,currentIndex;currentIndex=this.getCurrentIndex(),(prev=this.getPrev(currentIndex))&&this.flipTo(prev,currentIndex-1)},setToCurrent:function(pageEl){var $n=$(pageEl);$n.addClass("current hidden"),this.$current=$n.removeClass("hidden").parentsUntil(".or",".or-group, .or-group-data, .or-repeat").addClass("contains-current").end()},flipTo:function(pageEl,newIndex){0<this.$current.length&&1===this.$current.closest("html").length?this.$current[0]!==pageEl&&(this.$current.removeClass("current fade-out").parentsUntil(".or",".or-group, .or-group-data, .or-repeat").removeClass("contains-current"),this.setToCurrent(pageEl),this.focusOnFirstQuestion(pageEl),this.toggleButtons(newIndex),$(pageEl).trigger("pageflip.enketo")):(this.setToCurrent(pageEl),this.focusOnFirstQuestion(pageEl),this.toggleButtons(newIndex),$(pageEl).trigger("pageflip.enketo"))},flipToFirst:function(){this.flipTo(this.$activePages[0])},flipToLast:function(){this.flipTo(this.$activePages.last()[0])},flipToPageContaining:function($e){var $closest;($closest=0===($closest=$e.closest('[role="page"]')).length?$e.find('[role="page"]'):$closest).length&&this.flipTo($closest[0])},focusOnFirstQuestion:function(pageEl){$(pageEl).find(".question:not(.disabled)").addBack(".question:not(.disabled)").filter(function(){return 0===$(this).parentsUntil(".or",".disabled").length}).eq(0).find("input, select, textarea").eq(0).trigger("fakefocus"),pageEl.scrollIntoView()},toggleButtons:function(index){var i=index||this.getCurrentIndex(),next=this.getNext(i),prev=this.getPrev(i);this.$btnNext.add(this.$btnLast).toggleClass("disabled",!next),this.$btnPrev.add(this.$btnFirst).toggleClass("disabled",!prev),this.$formFooter.toggleClass("end",!next)}}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,factory;
/*!
 * @fileOverview TouchSwipe - jQuery Plugin
 * @version 1.6.18
 *
 * @author Matt Bryson http://www.github.com/mattbryson
 * @see https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
 * @see http://labs.rampinteractive.co.uk/touchSwipe/
 * @see http://plugins.jquery.com/project/touchSwipe
 * @license
 * Copyright (c) 2010-2015 Matt Bryson
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 */factory=function($){"use strict";function TouchSwipe(element,options){function touchStart(jqEvent){if(!(!0===$element.data(PLUGIN_NS+"_intouch")||0<$(jqEvent.target).closest(options.excludedElements,$element).length)){var event=jqEvent.originalEvent?jqEvent.originalEvent:jqEvent;if(!event.pointerType||"mouse"!=event.pointerType||0!=options.fallbackToMouseEvents){var ret,touches=event.touches,evt=touches?touches[0]:event;return phase=PHASE_START,touches?fingerCount=touches.length:!1!==options.preventDefaultEvents&&jqEvent.preventDefault(),pinchDirection=currentDirection=direction=null,pinchZoom=1,pinchDistance=endTouchesDistance=startTouchesDistance=duration=distance=0,maximumsMap=function(){var maxData={};return maxData[LEFT]=createMaximumVO(LEFT),maxData[RIGHT]=createMaximumVO(RIGHT),maxData[UP]=createMaximumVO(UP),maxData[DOWN]=createMaximumVO(DOWN),maxData}(),cancelMultiFingerRelease(),createFingerData(0,evt),!touches||fingerCount===options.fingers||options.fingers===ALL_FINGERS||hasPinches()?(startTime=getTimeStamp(),2==fingerCount&&(createFingerData(1,touches[1]),startTouchesDistance=endTouchesDistance=calculateTouchesDistance(fingerData[0].start,fingerData[1].start)),(options.swipeStatus||options.pinchStatus)&&(ret=triggerHandler(event,phase))):ret=!1,!1===ret?(triggerHandler(event,phase=PHASE_CANCEL),ret):(options.hold&&(holdTimeout=setTimeout($.proxy(function(){$element.trigger("hold",[event.target]),options.hold&&(ret=options.hold.call($element,event,event.target))},this),options.longTapThreshold)),setTouchInProgress(!0),null)}}}function touchMove(jqEvent){var event=jqEvent.originalEvent?jqEvent.originalEvent:jqEvent;if(phase!==PHASE_END&&phase!==PHASE_CANCEL&&!inMultiFingerRelease()){var ret,touches=event.touches,currentFinger=updateFingerData(touches?touches[0]:event);if(endTime=getTimeStamp(),touches&&(fingerCount=touches.length),options.hold&&clearTimeout(holdTimeout),phase=PHASE_MOVE,2==fingerCount&&(0==startTouchesDistance?(createFingerData(1,touches[1]),startTouchesDistance=endTouchesDistance=calculateTouchesDistance(fingerData[0].start,fingerData[1].start)):(updateFingerData(touches[1]),endTouchesDistance=calculateTouchesDistance(fingerData[0].end,fingerData[1].end),fingerData[0].end,fingerData[1].end,pinchDirection=pinchZoom<1?OUT:IN),pinchZoom=function(startDistance,endDistance){return(endDistance/startDistance*1).toFixed(2)}(startTouchesDistance,endTouchesDistance),pinchDistance=Math.abs(startTouchesDistance-endTouchesDistance)),fingerCount===options.fingers||options.fingers===ALL_FINGERS||!touches||hasPinches()){if(direction=calculateDirection(currentFinger.start,currentFinger.end),function(jqEvent,direction){if(!1!==options.preventDefaultEvents)if(options.allowPageScroll===NONE)jqEvent.preventDefault();else{var auto=options.allowPageScroll===AUTO;switch(direction){case LEFT:(options.swipeLeft&&auto||!auto&&options.allowPageScroll!=HORIZONTAL)&&jqEvent.preventDefault();break;case RIGHT:(options.swipeRight&&auto||!auto&&options.allowPageScroll!=HORIZONTAL)&&jqEvent.preventDefault();break;case UP:(options.swipeUp&&auto||!auto&&options.allowPageScroll!=VERTICAL)&&jqEvent.preventDefault();break;case DOWN:(options.swipeDown&&auto||!auto&&options.allowPageScroll!=VERTICAL)&&jqEvent.preventDefault()}}}(jqEvent,currentDirection=calculateDirection(currentFinger.last,currentFinger.end)),distance=function(startPoint,endPoint){return Math.round(Math.sqrt(Math.pow(endPoint.x-startPoint.x,2)+Math.pow(endPoint.y-startPoint.y,2)))}(currentFinger.start,currentFinger.end),duration=calculateDuration(),function(direction,distance){direction!=NONE&&(distance=Math.max(distance,getMaxDistance(direction)),maximumsMap[direction].distance=distance)}(direction,distance),ret=triggerHandler(event,phase),!options.triggerOnTouchEnd||options.triggerOnTouchLeave){var inBounds=!0;if(options.triggerOnTouchLeave){var bounds=function(el){var offset=(el=$(el)).offset();return{left:offset.left,right:offset.left+el.outerWidth(),top:offset.top,bottom:offset.top+el.outerHeight()}}(this);inBounds=function(point,bounds){return point.x>bounds.left&&point.x<bounds.right&&point.y>bounds.top&&point.y<bounds.bottom}(currentFinger.end,bounds)}!options.triggerOnTouchEnd&&inBounds?phase=getNextPhase(PHASE_MOVE):options.triggerOnTouchLeave&&!inBounds&&(phase=getNextPhase(PHASE_END)),phase!=PHASE_CANCEL&&phase!=PHASE_END||triggerHandler(event,phase)}}else triggerHandler(event,phase=PHASE_CANCEL);!1===ret&&triggerHandler(event,phase=PHASE_CANCEL)}}function touchEnd(jqEvent){var event=jqEvent.originalEvent?jqEvent.originalEvent:jqEvent,touches=event.touches;if(touches){if(touches.length&&!inMultiFingerRelease())return function(event){previousTouchEndTime=getTimeStamp(),fingerCountAtRelease=event.touches.length+1}(event),!0;if(touches.length&&inMultiFingerRelease())return!0}return inMultiFingerRelease()&&(fingerCount=fingerCountAtRelease),endTime=getTimeStamp(),duration=calculateDuration(),didSwipeBackToCancel()||!validateSwipeDistance()?triggerHandler(event,phase=PHASE_CANCEL):options.triggerOnTouchEnd||!1===options.triggerOnTouchEnd&&phase===PHASE_MOVE?(!1!==options.preventDefaultEvents&&!1!==jqEvent.cancelable&&jqEvent.preventDefault(),triggerHandler(event,phase=PHASE_END)):!options.triggerOnTouchEnd&&hasTap()?triggerHandlerForGesture(event,phase=PHASE_END,TAP):phase===PHASE_MOVE&&triggerHandler(event,phase=PHASE_CANCEL),setTouchInProgress(!1),null}function touchCancel(){endTouchesDistance=startTouchesDistance=startTime=endTime=fingerCount=0,pinchZoom=1,cancelMultiFingerRelease(),setTouchInProgress(!1)}function touchLeave(jqEvent){var event=jqEvent.originalEvent?jqEvent.originalEvent:jqEvent;options.triggerOnTouchLeave&&triggerHandler(event,phase=getNextPhase(PHASE_END))}function removeListeners(){$element.off(START_EV,touchStart),$element.off(CANCEL_EV,touchCancel),$element.off(MOVE_EV,touchMove),$element.off(END_EV,touchEnd),LEAVE_EV&&$element.off(LEAVE_EV,touchLeave),setTouchInProgress(!1)}function getNextPhase(currentPhase){var nextPhase=currentPhase,validTime=validateSwipeTime(),validDistance=validateSwipeDistance(),didCancel=didSwipeBackToCancel();return!validTime||didCancel?nextPhase=PHASE_CANCEL:!validDistance||currentPhase!=PHASE_MOVE||options.triggerOnTouchEnd&&!options.triggerOnTouchLeave?!validDistance&&currentPhase==PHASE_END&&options.triggerOnTouchLeave&&(nextPhase=PHASE_CANCEL):nextPhase=PHASE_END,nextPhase}function triggerHandler(event,phase){var ret,touches=event.touches;return(!validateSwipe()||!hasSwipes())&&!hasSwipes()||(ret=triggerHandlerForGesture(event,phase,SWIPE)),(!validatePinch()||!hasPinches())&&!hasPinches()||!1===ret||(ret=triggerHandlerForGesture(event,phase,PINCH)),validateDoubleTap()&&hasDoubleTap()&&!1!==ret?ret=triggerHandlerForGesture(event,phase,DOUBLE_TAP):duration>options.longTapThreshold&&distance<DOUBLE_TAP_THRESHOLD&&options.longTap&&!1!==ret?ret=triggerHandlerForGesture(event,phase,LONG_TAP):1!==fingerCount&&SUPPORTS_TOUCH||!(isNaN(distance)||distance<options.threshold)||!hasTap()||!1===ret||(ret=triggerHandlerForGesture(event,phase,TAP)),phase===PHASE_CANCEL&&touchCancel(),phase===PHASE_END&&(touches&&touches.length||touchCancel()),ret}function triggerHandlerForGesture(event,phase,gesture){var ret;if(gesture==SWIPE){if($element.trigger("swipeStatus",[phase,direction||null,distance||0,duration||0,fingerCount,fingerData,currentDirection]),options.swipeStatus&&!1===(ret=options.swipeStatus.call($element,event,phase,direction||null,distance||0,duration||0,fingerCount,fingerData,currentDirection)))return!1;if(phase==PHASE_END&&validateSwipe()){if(clearTimeout(singleTapTimeout),clearTimeout(holdTimeout),$element.trigger("swipe",[direction,distance,duration,fingerCount,fingerData,currentDirection]),options.swipe&&!1===(ret=options.swipe.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection)))return!1;switch(direction){case LEFT:$element.trigger("swipeLeft",[direction,distance,duration,fingerCount,fingerData,currentDirection]),options.swipeLeft&&(ret=options.swipeLeft.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection));break;case RIGHT:$element.trigger("swipeRight",[direction,distance,duration,fingerCount,fingerData,currentDirection]),options.swipeRight&&(ret=options.swipeRight.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection));break;case UP:$element.trigger("swipeUp",[direction,distance,duration,fingerCount,fingerData,currentDirection]),options.swipeUp&&(ret=options.swipeUp.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection));break;case DOWN:$element.trigger("swipeDown",[direction,distance,duration,fingerCount,fingerData,currentDirection]),options.swipeDown&&(ret=options.swipeDown.call($element,event,direction,distance,duration,fingerCount,fingerData,currentDirection))}}}if(gesture==PINCH){if($element.trigger("pinchStatus",[phase,pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData]),options.pinchStatus&&!1===(ret=options.pinchStatus.call($element,event,phase,pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData)))return!1;if(phase==PHASE_END&&validatePinch())switch(pinchDirection){case IN:$element.trigger("pinchIn",[pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData]),options.pinchIn&&(ret=options.pinchIn.call($element,event,pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData));break;case OUT:$element.trigger("pinchOut",[pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData]),options.pinchOut&&(ret=options.pinchOut.call($element,event,pinchDirection||null,pinchDistance||0,duration||0,fingerCount,pinchZoom,fingerData))}}return gesture==TAP?phase!==PHASE_CANCEL&&phase!==PHASE_END||(clearTimeout(singleTapTimeout),clearTimeout(holdTimeout),hasDoubleTap()&&!validateDoubleTap()?(doubleTapStartTime=getTimeStamp(),singleTapTimeout=setTimeout($.proxy(function(){doubleTapStartTime=null,$element.trigger("tap",[event.target]),options.tap&&(ret=options.tap.call($element,event,event.target))},this),options.doubleTapThreshold)):(doubleTapStartTime=null,$element.trigger("tap",[event.target]),options.tap&&(ret=options.tap.call($element,event,event.target)))):gesture==DOUBLE_TAP?phase!==PHASE_CANCEL&&phase!==PHASE_END||(clearTimeout(singleTapTimeout),clearTimeout(holdTimeout),doubleTapStartTime=null,$element.trigger("doubletap",[event.target]),options.doubleTap&&(ret=options.doubleTap.call($element,event,event.target))):gesture==LONG_TAP&&(phase!==PHASE_CANCEL&&phase!==PHASE_END||(clearTimeout(singleTapTimeout),doubleTapStartTime=null,$element.trigger("longtap",[event.target]),options.longTap&&(ret=options.longTap.call($element,event,event.target)))),ret}function validateSwipeDistance(){var valid=!0;return null!==options.threshold&&(valid=distance>=options.threshold),valid}function didSwipeBackToCancel(){var cancelled=!1;return null!==options.cancelThreshold&&null!==direction&&(cancelled=getMaxDistance(direction)-distance>=options.cancelThreshold),cancelled}function validateSwipeTime(){return!options.maxTimeThreshold||!(duration>=options.maxTimeThreshold)}function validatePinch(){var hasCorrectFingerCount=validateFingers(),hasEndPoint=validateEndPoint(),hasCorrectDistance=null===options.pinchThreshold||pinchDistance>=options.pinchThreshold;return hasCorrectFingerCount&&hasEndPoint&&hasCorrectDistance}function hasPinches(){return!!(options.pinchStatus||options.pinchIn||options.pinchOut)}function validateSwipe(){var hasValidTime=validateSwipeTime(),hasValidDistance=validateSwipeDistance(),hasCorrectFingerCount=validateFingers(),hasEndPoint=validateEndPoint();return!didSwipeBackToCancel()&&hasEndPoint&&hasCorrectFingerCount&&hasValidDistance&&hasValidTime}function hasSwipes(){return!!(options.swipe||options.swipeStatus||options.swipeLeft||options.swipeRight||options.swipeUp||options.swipeDown)}function validateFingers(){return fingerCount===options.fingers||options.fingers===ALL_FINGERS||!SUPPORTS_TOUCH}function validateEndPoint(){return 0!==fingerData[0].end.x}function hasTap(){return!!options.tap}function hasDoubleTap(){return!!options.doubleTap}function validateDoubleTap(){if(null==doubleTapStartTime)return!1;var now=getTimeStamp();return hasDoubleTap()&&now-doubleTapStartTime<=options.doubleTapThreshold}function cancelMultiFingerRelease(){fingerCountAtRelease=previousTouchEndTime=0}function inMultiFingerRelease(){var withinThreshold=!1;previousTouchEndTime&&getTimeStamp()-previousTouchEndTime<=options.fingerReleaseThreshold&&(withinThreshold=!0);return withinThreshold}function setTouchInProgress(val){$element&&(!0===val?($element.on(MOVE_EV,touchMove),$element.on(END_EV,touchEnd),LEAVE_EV&&$element.on(LEAVE_EV,touchLeave)):($element.off(MOVE_EV,touchMove,!1),$element.off(END_EV,touchEnd,!1),LEAVE_EV&&$element.off(LEAVE_EV,touchLeave,!1)),$element.data(PLUGIN_NS+"_intouch",!0===val))}function createFingerData(id,evt){var f={start:{x:0,y:0},last:{x:0,y:0},end:{x:0,y:0}};return f.start.x=f.last.x=f.end.x=evt.pageX||evt.clientX,f.start.y=f.last.y=f.end.y=evt.pageY||evt.clientY,fingerData[id]=f}function updateFingerData(evt){var id=void 0!==evt.identifier?evt.identifier:0,f=function(id){return fingerData[id]||null}(id);return null===f&&(f=createFingerData(id,evt)),f.last.x=f.end.x,f.last.y=f.end.y,f.end.x=evt.pageX||evt.clientX,f.end.y=evt.pageY||evt.clientY,f}function getMaxDistance(direction){return maximumsMap[direction]?maximumsMap[direction].distance:void 0}function createMaximumVO(dir){return{direction:dir,distance:0}}function calculateDuration(){return endTime-startTime}function calculateTouchesDistance(startPoint,endPoint){var diffX=Math.abs(startPoint.x-endPoint.x),diffY=Math.abs(startPoint.y-endPoint.y);return Math.round(Math.sqrt(diffX*diffX+diffY*diffY))}function calculateDirection(startPoint,endPoint){if(function(pointA,pointB){return pointA.x==pointB.x&&pointA.y==pointB.y}(startPoint,endPoint))return NONE;var angle=function(startPoint,endPoint){var x=startPoint.x-endPoint.x,y=endPoint.y-startPoint.y,r=Math.atan2(y,x),angle=Math.round(180*r/Math.PI);return angle<0&&(angle=360-Math.abs(angle)),angle}(startPoint,endPoint);return angle<=45&&0<=angle?LEFT:angle<=360&&315<=angle?LEFT:135<=angle&&angle<=225?RIGHT:45<angle&&angle<135?DOWN:UP}function getTimeStamp(){return(new Date).getTime()}options=$.extend({},options);var useTouchEvents=SUPPORTS_TOUCH||SUPPORTS_POINTER||!options.fallbackToMouseEvents,START_EV=useTouchEvents?SUPPORTS_POINTER?SUPPORTS_POINTER_IE10?"MSPointerDown":"pointerdown":"touchstart":"mousedown",MOVE_EV=useTouchEvents?SUPPORTS_POINTER?SUPPORTS_POINTER_IE10?"MSPointerMove":"pointermove":"touchmove":"mousemove",END_EV=useTouchEvents?SUPPORTS_POINTER?SUPPORTS_POINTER_IE10?"MSPointerUp":"pointerup":"touchend":"mouseup",LEAVE_EV=useTouchEvents?SUPPORTS_POINTER?"mouseleave":null:"mouseleave",CANCEL_EV=SUPPORTS_POINTER?SUPPORTS_POINTER_IE10?"MSPointerCancel":"pointercancel":"touchcancel",distance=0,direction=null,currentDirection=null,duration=0,startTouchesDistance=0,endTouchesDistance=0,pinchZoom=1,pinchDistance=0,pinchDirection=0,maximumsMap=null,$element=$(element),phase="start",fingerCount=0,fingerData={},startTime=0,endTime=0,previousTouchEndTime=0,fingerCountAtRelease=0,doubleTapStartTime=0,singleTapTimeout=null,holdTimeout=null;try{$element.on(START_EV,touchStart),$element.on(CANCEL_EV,touchCancel)}catch(e){$.error("events not supported "+START_EV+","+CANCEL_EV+" on jQuery.swipe")}this.enable=function(){return this.disable(),$element.on(START_EV,touchStart),$element.on(CANCEL_EV,touchCancel),$element},this.disable=function(){return removeListeners(),$element},this.destroy=function(){removeListeners(),$element.data(PLUGIN_NS,null),$element=null},this.option=function(property,value){if("object"==typeof property)options=$.extend(options,property);else if(void 0!==options[property]){if(void 0===value)return options[property];options[property]=value}else{if(!property)return options;$.error("Option "+property+" does not exist on jQuery.swipe.options")}return null}}var LEFT="left",RIGHT="right",UP="up",DOWN="down",IN="in",OUT="out",NONE="none",AUTO="auto",SWIPE="swipe",PINCH="pinch",TAP="tap",DOUBLE_TAP="doubletap",LONG_TAP="longtap",HORIZONTAL="horizontal",VERTICAL="vertical",ALL_FINGERS="all",DOUBLE_TAP_THRESHOLD=10,PHASE_START="start",PHASE_MOVE="move",PHASE_END="end",PHASE_CANCEL="cancel",SUPPORTS_TOUCH="ontouchstart"in window,SUPPORTS_POINTER_IE10=window.navigator.msPointerEnabled&&!window.PointerEvent&&!SUPPORTS_TOUCH,SUPPORTS_POINTER=(window.PointerEvent||window.navigator.msPointerEnabled)&&!SUPPORTS_TOUCH,PLUGIN_NS="TouchSwipe";$.fn.swipe=function(method){var $this=$(this),plugin=$this.data(PLUGIN_NS);if(plugin&&"string"==typeof method){if(plugin[method])return plugin[method].apply(plugin,Array.prototype.slice.call(arguments,1));$.error("Method "+method+" does not exist on jQuery.swipe")}else if(plugin&&"object"==typeof method)plugin.option.apply(plugin,arguments);else if(!(plugin||"object"!=typeof method&&method))return function(options){return!options||void 0!==options.allowPageScroll||void 0===options.swipe&&void 0===options.swipeStatus||(options.allowPageScroll=NONE),void 0!==options.click&&void 0===options.tap&&(options.tap=options.click),options=options||{},options=$.extend({},$.fn.swipe.defaults,options),this.each(function(){var $this=$(this),plugin=$this.data(PLUGIN_NS);plugin||(plugin=new TouchSwipe(this,options),$this.data(PLUGIN_NS,plugin))})}.apply(this,arguments);return $this},$.fn.swipe.version="1.6.18",$.fn.swipe.defaults={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,hold:null,triggerOnTouchEnd:!0,triggerOnTouchLeave:!1,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:".noSwipe",preventDefaultEvents:!0},$.fn.swipe.phases={PHASE_START:PHASE_START,PHASE_MOVE:PHASE_MOVE,PHASE_END:PHASE_END,PHASE_CANCEL:PHASE_CANCEL},$.fn.swipe.directions={LEFT:LEFT,RIGHT:RIGHT,UP:UP,DOWN:DOWN,IN:IN,OUT:OUT},$.fn.swipe.pageScroll={NONE:NONE,HORIZONTAL:HORIZONTAL,VERTICAL:VERTICAL,AUTO:AUTO},$.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,ALL:ALL_FINGERS}},__webpack_require__(431).jQuery?(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=factory)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)):factory(module.exports?__webpack_require__(2):jQuery)},function(module,exports){(function(__webpack_amd_options__){module.exports=__webpack_amd_options__}).call(this,{})},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2);module.exports={update:function(updated,forceClearIrrelevant){var $nodes;if(!this.form)throw new Error("Branch module not correctly instantiated with form property.");$nodes=this.form.getRelatedNodes("data-relevant","",updated),this.updateNodes($nodes,forceClearIrrelevant)},updateNodes:function($nodes,forceClearIrrelevant){var p,$branchNode,result,insideRepeat,insideRepeatClone,cacheIndex,clonedRepeatsPresent,relevantCache={},alreadyCovered=[],branchChange=!1,that=this;clonedRepeatsPresent=!!(this.form.repeatsPresent&&0<this.form.view.$.find(".or-repeat.clone").length),$nodes.each(function(){var context,pathParts,parentPath,$node=$(this);-1===$.inArray($node.attr("name"),alreadyCovered)&&($branchNode=$node.closest(".or-branch"),cacheIndex=null,(p={}).relevant=that.form.input.getRelevant($node),p.path=that.form.input.getName($node),1===$branchNode.length?3<(pathParts=p.path.split("/")).length&&(parentPath=pathParts.splice(0,pathParts.length-1).join("/"),0===that.form.view.$.find('.or-group[name="'+parentPath+'"],.or-group-data[name="'+parentPath+'"]').filter(function(){var $g=$(this);return 0<$g.children(".or-repeat").length||0===$g.children(".or-repeat-info").length}).length)||(insideRepeat=clonedRepeatsPresent&&0<$branchNode.parentsUntil(".or",".or-repeat").length,insideRepeatClone=clonedRepeatsPresent&&0<$branchNode.parentsUntil(".or",".or-repeat.clone").length,context=$node.children('.or-repeat-info[data-name="'+p.path+'"]').length&&!$node.children('.or-repeat[name="'+p.path+'"]').length?null:p.path,p.ind=context&&insideRepeatClone?that.form.input.getIndex($node):0,-1===p.relevant.indexOf("..")&&(cacheIndex=insideRepeat?p.relevant+"__"+p.path.substring(0,p.path.lastIndexOf("/"))+"__"+p.ind:p.relevant),cacheIndex&&void 0!==relevantCache[cacheIndex]?result=relevantCache[cacheIndex]:(result=that.evaluate(p.relevant,context,p.ind),relevantCache[cacheIndex]=result),insideRepeat||alreadyCovered.push($(this).attr("name")),!0===that.process($branchNode,p.path,result,forceClearIrrelevant)&&(branchChange=!0)):0===$node.parentsUntil(".or","#or-calculated-items").length&&console.error("could not find branch node for ",$(this)))}),branchChange&&this.form.view.$.trigger("changebranch")},evaluate:function(expr,contextPath,index){return this.form.model.evaluate(expr,"boolean",contextPath,index)},process:function($branchNode,path,result,forceClearIrrelevant){return!0===result?this.enable($branchNode,path):this.disable($branchNode,path,forceClearIrrelevant)},selfRelevant:function($branchNode){return!$branchNode.hasClass("disabled")&&!$branchNode.hasClass("pre-init")},enable:function($branchNode,path){var change=!1;return this.selfRelevant($branchNode)||(change=!0,$branchNode.removeClass("disabled pre-init"),this.form.calc.update({relevantPath:path}),this.form.widgets.enable($branchNode),this.activate($branchNode)),change},disable:function($branchNode,path,forceClearIrrelevant){var virgin=$branchNode.hasClass("pre-init"),change=!1;return(virgin||this.selfRelevant($branchNode)||forceClearIrrelevant)&&(change=!0,virgin?$branchNode.removeClass("pre-init"):(this.form.options.clearIrrelevantImmediately||forceClearIrrelevant)&&this.clear($branchNode,path),this.deactivate($branchNode)),change},clear:function($branchNode,path){$branchNode.clearInputs("change","inputupdate.enketo"),$branchNode.is(".or-group, .or-group-data")&&this.form.calc.update({relevantPath:path})},setDisabledProperty:function($branchNode,bool){var type=$branchNode.prop("nodeName").toLowerCase();"label"===type?$branchNode.children("input, select, textarea").prop("disabled",bool):"fieldset"===type||"section"===type?$branchNode.prop("disabled",bool):$branchNode.find("fieldset, input, select, textarea").prop("disabled",bool)},activate:function($branchNode){this.setDisabledProperty($branchNode,!1)},deactivate:function($branchNode){$branchNode.addClass("disabled"),this.form.widgets.disable($branchNode),this.setDisabledProperty($branchNode,!0)}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),utils=__webpack_require__(38);module.exports={update:function(updated){var clonedRepeatsPresent,insideRepeat,$nodes,that=this,itemsCache={};if(!this.form)throw new Error("Output module not correctly instantiated with form property.");$nodes=this.form.getRelatedNodes("data-items-path",".itemset-template",updated),clonedRepeatsPresent=!!(this.form.repeatsPresent&&0<this.form.view.$.find(".or-repeat.clone").length),$nodes.each(function(){var $htmlItem,$htmlItemLabels,value,currentValue,$instanceItems,index,context,$template,newItems,prevItems,templateNodeName,$input,$labels,itemsXpath,labelType,labelRef,valueRef,$list;if(!($template=$(this)).parentsUntil(".or",".or-branch").parentsUntil(".or",".disabled").length){if(newItems={},prevItems=$template.data(),templateNodeName=$template.prop("nodeName").toLowerCase(),$list=$template.parent("select, datalist"),"label"===templateNodeName?$input=$template.children("input").eq(0):"select"===$list.prop("nodeName").toLowerCase()?$input=$list:"datalist"===$list.prop("nodeName").toLowerCase()&&($input=$list.siblings("input:not(.widget)")),$labels=$template.closest("label, select, datalist").siblings(".itemset-labels"),itemsXpath=$template.attr("data-items-path"),labelType=$labels.attr("data-label-type"),labelRef=$labels.attr("data-label-ref"),valueRef=$labels.attr("data-value-ref"),context=that.form.input.getName($input),insideRepeat=clonedRepeatsPresent&&0<$input.parentsUntil(".or",".or-repeat").length,index=clonedRepeatsPresent&&0<$input.parentsUntil(".or",".or-repeat.clone").length?that.form.input.getIndex($input):0,void 0!==itemsCache[itemsXpath])$instanceItems=itemsCache[itemsXpath];else{$instanceItems=$(that.form.model.evaluate(itemsXpath,"nodes",context,index,!0)),insideRepeat||(itemsCache[itemsXpath]=$instanceItems)}newItems.length=$instanceItems.length,newItems.text=$instanceItems.text(),newItems.length===prevItems.length&&newItems.text===prevItems.text||($template.data(newItems),$template.closest(".question").find(templateNodeName).not($template).remove(),$template.parent("select").siblings(".or-option-translations").empty(),$instanceItems.each(function(){var $labelRefs,labelRefNodename,matches,$item=$(this);switch($htmlItem=$("<root/>"),$template.clone().appendTo($htmlItem).removeClass("itemset-template").addClass("itemset").removeAttr("data-items-path"),labelRefNodename=(matches=utils.parseFunctionFromExpression(labelRef,"translate")).length?matches[0][1][0]:labelRef+":eq(0)",$labelRefs=$item.children(labelRefNodename),"itext"!==labelType&&0<$labelRefs.length&&(labelType="langs"),labelType){case"itext":$htmlItemLabels=$labels.find('[data-itext-id="'+$labelRefs.eq(0).text()+'"]').clone();break;case"langs":$htmlItemLabels=$(),$labelRefs.each(function(){var lang=this.getAttribute("lang"),langAttr=lang?' lang="'+this.getAttribute("lang")+'"':"",span='<span class="option-label'+(lang&&lang!==that.form.langs.getCurrentLang()?"":" active")+'"'+langAttr+">"+this.textContent+"</span>";$htmlItemLabels=$htmlItemLabels.add(span)});break;default:$htmlItemLabels=$('<span class="option-label active" lang="">'+$labelRefs.eq(0).text()+"</span>")}value=$item.children(valueRef).text(),$htmlItem.find("[value]").attr("value",value),"label"===templateNodeName?($htmlItem.find("input").after($htmlItemLabels),$labels.before($htmlItem.find(":first"))):"option"===templateNodeName&&($htmlItem.find("option").text($htmlItemLabels.filter(".active").eq(0).text()),$htmlItemLabels.attr("data-option-value",value).attr("data-itext-id","").appendTo($labels.siblings(".or-option-translations")),$template.siblings().addBack().last().after($htmlItem.find(":first")))}),""!==(currentValue=that.form.model.node(context,index).getVal()[0])&&(that.form.input.setVal(context,index,currentValue),$input.trigger("change")),0<$list.length&&$input.trigger("changeoption"))}})}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2);module.exports={status:0,lastChanged:null,$all:null,updateTotal:function(){this.$all=this.form.view.$.find(".question").not(".disabled, .or-appearance-comment, .or-appearance-dn").filter(function(){return 0===$(this).parentsUntil(".or",".disabled").length})},update:function(el){var status;this.$all&&el||this.updateTotal(),this.lastChanged=el||this.lastChanged,0<(status=Math.round(100*(this.$all.index($(this.lastChanged).closest(".question"))+1)/this.$all.length))&&status!==this.status&&(this.status=status,this.form.view.$.trigger("progressupdate.enketo",status))},get:function(){return this.status}}},function(module,exports,__webpack_require__){"use strict";var options,$form,init,enable,disable,_getElements,_instantiate,_setLangChangeListener,_setOptionChangeListener,_setValChangeListener,$=__webpack_require__(2),widgets=__webpack_require__(436).filter(function(widget){return widget.selector});init=function($group,opts){if(!this.form)throw new Error("Widgets module not correctly instantiated with form property.");return $form=this.form.view.$,$group=$group||$form,options=options||opts,widgets.forEach(function(widget){_instantiate(widget,$group)}),!0},enable=function($group){for(var widget,i=0;i<widgets.length;i++)(widget=widgets[i]).name&&_getElements($group,widget.selector)[widget.name]("enable")},disable=function($group){for(var widget,i=0;i<widgets.length;i++)(widget=widgets[i]).name&&_getElements($group,widget.selector)[widget.name]("disable")},_getElements=function($group,selector){return selector?"form"===selector?$form:$group.is(".question")?$group.find("input:not(.ignore), select:not(.ignore), textarea:not(.ignore)").filter(selector):$group.find(selector):$()},_instantiate=function(widget,$group){var $elements;if(widget.options=widget.options||{},!widget.name)return console.error("widget doesn't have a name");widget.helpersRequired&&0<widget.helpersRequired.length&&(widget.options.helpers={},widget.helpersRequired.forEach(function(helper){widget.options.helpers[helper]=options[helper]})),($elements=_getElements($group,widget.selector)).length&&($elements[widget.name](widget.options),_setLangChangeListener(widget,$elements),_setOptionChangeListener(widget,$elements),_setValChangeListener(widget,$elements))},_setLangChangeListener=function(widget,$els){0<$els.length&&$form.on("changelanguage",function(){$els[widget.name]("update")})},_setOptionChangeListener=function(widget,$els){0<$els.length&&widget.list&&$els.on("changeoption",function(){$(this)[widget.name]("update")})},_setValChangeListener=function(widget,$els){var nodeName=$els.prop("nodeName").toLowerCase();0<$els.length&&("input"===nodeName||"select"===nodeName||"textarea"===nodeName)&&$els.on("inputupdate.enketo",function(){$(this)[widget.name]("update")})},module.exports={init:init,enable:enable,disable:disable}},function(module,exports,__webpack_require__){"use strict";module.exports=[__webpack_require__(437),__webpack_require__(438),__webpack_require__(440),__webpack_require__(441),__webpack_require__(443),__webpack_require__(447),__webpack_require__(448),__webpack_require__(449),__webpack_require__(450),__webpack_require__(451),__webpack_require__(452),__webpack_require__(453),__webpack_require__(454),__webpack_require__(455),__webpack_require__(456),__webpack_require__(458),__webpack_require__(460),__webpack_require__(461),__webpack_require__(462),__webpack_require__(463),__webpack_require__(464),__webpack_require__(465),__webpack_require__(466)]},function(module,exports,__webpack_require__){"use strict";module.exports={name:"notewidget"}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),Widget=__webpack_require__(13),support=__webpack_require__(34),t=__webpack_require__(46).t,pluginName="desktopSelectpicker";function DesktopSelectpicker(element,options,e){this.namespace=pluginName,Widget.call(this,element,options),e&&(e.stopPropagation(),e.preventDefault()),this.$picker=null,this.noneSelectedText=t("selectpicker.noneselected"),this.multiple=void 0!==$(element).attr("multiple")&&!1!==$(element).attr("multiple"),this._init()}__webpack_require__(95),((DesktopSelectpicker.prototype=Object.create(Widget.prototype)).constructor=DesktopSelectpicker).prototype._init=function(){var $template=this._getTemplate(),$select=$(this.element);this.readonly=!!$select.attr("readonly"),$select.css("display","none"),$template=this._createLi($template),this.$picker=$template.insertAfter($select),this.$picker.find("> a").addClass(this.selectClass),this._clickListener(),this._focusListener()},DesktopSelectpicker.prototype._getTemplate=function(){return'<div class="btn-group bootstrap-select widget clearfix"><button type="button" class="btn btn-default dropdown-toggle clearfix" data-toggle="dropdown"><span class="selected">__SELECTED_OPTIONS</span><span class="caret"></span></button><ul class="dropdown-menu" role="menu">__ADD_LI</ul></div>'},DesktopSelectpicker.prototype._createLi=function(template){var checkedInputAttr,li=[],liHtml="",inputAttr=this.multiple?'type="checkbox"':'type="radio" name="'+1e5*Math.random()+'"',readonlyAttr=this.readonly?' readonly="readonly"':"",disabledAttr=this.readonly?' disabled="disabled"':"",disabledClass=this.readonly?' class="disabled"':"";if($(this.element).find("option").each(function(){li.push({label:$(this).text(),selected:$(this).is(":selected"),value:$(this).attr("value")})}),0<li.length){template=template.replace("__SELECTED_OPTIONS",this._createSelectedStr());for(var i=0;i<li.length;i++)li[i].value&&(checkedInputAttr=li[i].selected?' checked="checked"':"",liHtml+="<li "+disabledClass+(li[i].selected?'class="active"':"")+'><a class="option-wrapper" tabindex="-1" href="#"><label><input class="ignore" '+inputAttr+checkedInputAttr+readonlyAttr+disabledAttr+' value="'+li[i].value+'" /><span class="option-label">'+li[i].label+"</span></label></a></li>")}return template=template.replace("__ADD_LI",liHtml),$(template)},DesktopSelectpicker.prototype._createSelectedStr=function(){var selectedLabels=[];return $(this.element).find("option:selected").each(function(){0<$(this).attr("value").length&&selectedLabels.push($(this).text())}),0===selectedLabels.length?this.noneSelectedText:1===selectedLabels.length?selectedLabels[0]:t("selectpicker.numberselected",{number:selectedLabels.length})},DesktopSelectpicker.prototype._clickListener=function(){var _this=this;this.$picker.on("click","li:not(.disabled)",function(e){var $li=$(this),$input=$li.find("input"),$select=$(_this.element),$option=$select.find('option[value="'+$input.val()+'"]'),selectedBefore=$option.is(":selected");"input"!==e.target.nodeName.toLowerCase()&&e.preventDefault(),_this.multiple?e.stopPropagation():(_this.$picker.find("li").removeClass("active"),$option.siblings("option").prop("selected",!1),_this.$picker.find("input").prop("checked",!1)),selectedBefore?($li.removeClass("active"),$input.prop("checked",!1),$option.prop("selected",!1)):($li.addClass("active"),$input.prop("checked",!0),$option.prop("selected",!0)),_this.$picker.find(".selected").html(_this._createSelectedStr()),$select.trigger("change")}).on("keydown","li:not(.disabled)",function(e){if(/(13|32)/.test(e.keyCode.toString(10))){/(32)/.test(e.keyCode.toString(10))||e.preventDefault();var elem=$(":focus");elem.click(),elem.focus(),e.preventDefault()}}).on("click","li.disabled",function(e){return e.stopPropagation(),!1})},DesktopSelectpicker.prototype._focusListener=function(){var _this=this;$(this.element).on("applyfocus",function(){_this.$picker.find(".dropdown-toggle").focus()}),this.$picker.on("shown.bs.dropdown",function(){return $(_this.element).trigger("fakefocus"),!0})},DesktopSelectpicker.prototype.disable=function(){this.$picker.find("li").addClass("disabled")},DesktopSelectpicker.prototype.enable=function(){this.readonly||this.$picker.find("li").removeClass("disabled")},DesktopSelectpicker.prototype.update=function(){this.$picker.remove(),this._init()},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data(pluginName);data||"object"!=typeof options||support.touch?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,data=new DesktopSelectpicker(this,options,event))})},module.exports={name:pluginName,list:!0,selector:"select:not(#form-languages)"}},function(module,exports,__webpack_require__){"use strict";var ua=navigator.userAgent;module.exports={os:{get ios(){return/iPad|iPhone|iPod/i.test(ua)},get android(){return/android/i.test(ua)}}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),Widget=__webpack_require__(13),support=__webpack_require__(34),pluginName="mobileSelectpicker";function MobileSelectpicker(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}((MobileSelectpicker.prototype=Object.create(Widget.prototype)).constructor=MobileSelectpicker).prototype._init=function(){var that=this;$(this.element).on("change."+pluginName,function(){return that._showSelectedValues(),!0}),this._showSelectedValues()},MobileSelectpicker.prototype._showSelectedValues=function(){var i,valueText=[],$select=$(this.element),$widget=0<$select.next(".widget").length?$select.next(".widget"):$('<span class="widget mobileselect"></span>').insertAfter($select),values=$.isArray($select.val())?$select.val():[$select.val()];for(i=0;i<values.length;i++)valueText.push($(this).find('option[value="'+values[i]+'"]').text());$widget.text(values.join(", "))},MobileSelectpicker.prototype.update=function(){this._showSelectedValues()},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data(pluginName);!data&&"object"==typeof options&&support.touch&&$this.data(pluginName,new MobileSelectpicker(this,options,event)),data&&"string"==typeof options&&data[options](this)})},module.exports={name:pluginName,selector:"select[multiple]"}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),Widget=__webpack_require__(13),sadExcuseForABrowser=!("list"in document.createElement("input")&&"options"in document.createElement("datalist")&&void 0!==window.HTMLDataListElement);function Selectpicker(element,options,e){this.namespace="autocomplete",Widget.call(this,element,options),e&&(e.stopPropagation(),e.preventDefault()),this._init()}__webpack_require__(442),((Selectpicker.prototype=Object.create(Widget.prototype)).constructor=Selectpicker).prototype._init=function(){var $input=$(this.element),listId=$input.attr("list");this.props=this._getProps(),this.$options=$input.closest(".question").find("datalist#"+listId+" > option"),this.$options.each(function(index,item){var value=item.getAttribute("value");item.classList.contains("itemset-template")||null==value||(item.dataset.value=value,item.setAttribute("value",item.textContent),item.textContent="")}),this.$fakeInput=$('<input type="text" class="ignore widget autocomplete" list="'+listId+'" />'),this.props.readonly&&this.$fakeInput.attr("readonly","readonly"),this.props.disabled&&this.$fakeInput.attr("disabled","disabled"),$input.hide().after(this.$fakeInput),sadExcuseForABrowser&&(console.debug("Polyfill required"),this.$fakeInput.relevantDropdown()),this._setFakeInputListener(),this._setFocusListener(),this._showCurrentLabel()},Selectpicker.prototype._getProps=function(){return{readonly:this.element.readOnly,disabled:this.element.disabled}},Selectpicker.prototype._showCurrentLabel=function(){var value=this.element.value,label=this._findLabel(value);this.$fakeInput.val(label),value&&!label&&this.$fakeInput.trigger("input")},Selectpicker.prototype._setFakeInputListener=function(){var that=this;this.$fakeInput.on("input."+this.namespace,function(e){var input=e.target,label=input.value,value=that._findValue(label)||"";that.element.value!==value&&$(that.element).val(value).trigger("change"),$(input).toggleClass("notfound",label&&!value)})},Selectpicker.prototype._findValue=function(label){var value="";return label?(this.$options.each(function(i,option){if(option.value===label)return value=option.getAttribute("data-value"),!1}),value):""},Selectpicker.prototype._findLabel=function(value){var label="";return value?(this.$options.each(function(i,option){if(option.dataset.value===value)return label=option.value,!1}),label):""},Selectpicker.prototype._setFocusListener=function(){var _this=this;this.$fakeInput.on("focus",function(){return $(_this.element).trigger("fakefocus"),!0}),$(this.element).on("applyfocus",function(){$(_this.$fakeInput).focus()})},Selectpicker.prototype.disable=function(){this.$fakeInput.find("li").addClass("disabled")},Selectpicker.prototype.enable=function(){this.$fakeInput.find("li").removeClass("disabled")},Selectpicker.prototype.update=function(){$(this.element).siblings(".widget").remove(),this._init()},$.fn.autocomplete=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data("autocomplete");data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data("autocomplete",data=new Selectpicker(this,options,event))})},module.exports={name:"autocomplete",list:!0,selector:"input[list]"}},function(module,exports,__webpack_require__){var $=__webpack_require__(2),pluginName="relevantDropdown";function RelevantDropdown(element,options,e){this.namespace=pluginName,this.element=element,this.options=$.extend({fadeOutSpeed:"normal",change:null},options),e&&(e.stopPropagation(),e.preventDefault()),this._init()}$.expr[":"].RD_contains=$.expr.createPseudo(function(arg){return function(elem){return 0<=$(elem).text().toUpperCase().indexOf(arg.toUpperCase())}}),RelevantDropdown.prototype._init=function(){var $input=$(this.element);this.listId=$input.attr("list"),this.$fakeDatalist=$("<ul />",{class:"datalist widget",id:this.listId}).appendTo($input.parent()),this._updateFakeDatalist(),this._setEventListeners()},RelevantDropdown.prototype._updateFakeDatalist=function(){var $datalist=$("#"+this.listId),tempItems=document.createDocumentFragment();this.$fakeDatalist.empty(),$datalist.find("option").each(function(){tempItem=$("<li />",{text:$(this).val()})[0],tempItems.appendChild(tempItem)}),this.$fakeDatalist.append(tempItems),this.$fakeDatalistItems=this.$fakeDatalist.find("li")},RelevantDropdown.prototype._setEventListeners=function(){var searchPosition,that=this,$input=$(this.element),scrollValue=0;$input.on("focus",function(){that.$fakeDatalist.scrollTop(0),scrollValue=0}).on("blur",function(){setTimeout(function(){that.$fakeDatalist.fadeOut(that.options.fadeOutSpeed),that.$fakeDatalistItems.removeClass("active")},500)}).on("keyup",function(e){searchPosition=$input.position(),that.$fakeDatalist.show().css({top:searchPosition.top+$(this).outerHeight(),left:searchPosition.left,width:$input.outerWidth()}),that.$fakeDatalistItems.hide(),that.$fakeDatalist.find('li:RD_contains("'+$input.val()+'")').show()}),this.$fakeDatalist.on("mouseenter","li",function(){$(this).addClass("active").siblings().removeClass("active")}).on("mouseleave","li",function(){$(this).removeClass("active")}),$(window).resize(function(){searchPosition=$input.position(),that.$fakeDatalist.css({top:searchPosition.top+$(this).outerHeight(),left:searchPosition.left,width:$input.outerWidth()})}),$input.on("keydown",function(e){var active=that.$fakeDatalist.find("li.active"),datalistHeight=that.$fakeDatalist.outerHeight(),datalistItemsHeight=that.$fakeDatalistItems.outerHeight();if(38==e.keyCode&&active.length&&(prevAll=active.prevAll("li:visible"),0<prevAll.length&&(active.removeClass("active"),prevAll.eq(0).addClass("active")),prevAll.length&&prevAll.position().top<0&&0<scrollValue&&that.$fakeDatalist.scrollTop(scrollValue-=datalistItemsHeight)),40==e.keyCode)if(active.length){var nextAll=active.nextAll("li:visible");0<nextAll.length&&(active.removeClass("active"),nextAll.eq(0).addClass("active")),nextAll.length&&nextAll.position().top+datalistItemsHeight>=datalistHeight&&that.$fakeDatalist.stop().animate({scrollTop:scrollValue+=datalistItemsHeight},200)}else that.$fakeDatalistItems.removeClass("active"),that.$fakeDatalist.find("li:visible:first").addClass("active");13!=e.keyCode&&9!=e.keyCode||(active.length&&$input.val(active.text()).trigger("input"),that.$fakeDatalist.fadeOut(that.options.fadeOutSpeed),that.$fakeDatalistItems.removeClass("active")),13!=e.keyCode&&38!=e.keyCode&&40!=e.keyCode&&(that.$fakeDatalistItems.removeClass("active"),that.$fakeDatalist.find("li:visible:first").addClass("active"),that.$fakeDatalist.scrollTop(0),scrollValue=0)}),this.$fakeDatalist.on("click","li",function(){$("li.active").length&&$input.val($(this).text()).trigger("input"),that.$fakeDatalist.fadeOut(that.options.fadeOutSpeed),that.$fakeDatalistItems.removeClass("active")})},RelevantDropdown.prototype.update=function(){this._updateFakeDatalist()},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data(pluginName);data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,data=new RelevantDropdown(this,options,event))})}},function(module,exports,__webpack_require__){"use strict";var googleMapsScriptRequest,$=__webpack_require__(2),Widget=__webpack_require__(13),config=__webpack_require__(71),L=__webpack_require__(444),Promise=__webpack_require__(58),t=__webpack_require__(46).t,support=__webpack_require__(34),dialog=__webpack_require__(164),maps=config&&config.maps&&0<config.maps.length?config.maps:[{name:"streets",maxzoom:24,tiles:["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"],attribution:'Â© <a href="http://openstreetmap.org">OpenStreetMap</a> | <a href="www.openstreetmap.org/copyright">Terms</a>'}],searchSource="https://maps.googleapis.com/maps/api/geocode/json?address={address}&sensor=true&key={api_key}",googleApiKey=config.googleApiKey||config.google_api_key,iconSingle=L.divIcon({iconSize:24,className:"enketo-geopoint-marker"}),iconMulti=L.divIcon({iconSize:16,className:"enketo-geopoint-circle-marker"}),iconMultiActive=L.divIcon({iconSize:16,className:"enketo-geopoint-circle-marker-active"});function Geopicker(element,options){this.namespace="geopicker",Widget.call(this,element,options),this._init()}__webpack_require__(445),__webpack_require__(446),((Geopicker.prototype=Object.create(Widget.prototype)).constructor=Geopicker).prototype._init=function(){var loadedVal=$(this.element).val().trim(),that=this;this.$form=$(this.element).closest("form.or"),this.$question=$(this.element).closest(".question"),this.mapId=Math.round(1e7*Math.random()),this.props=this._getProps(),this._addDomElements(),this.currentIndex=0,this.points=[],loadedVal&&$(this.element).val().trim().split(";").forEach(function(el,i){that.points[i]=el.trim().split(" "),that.points[i].forEach(function(str,i,arr){arr[i]=Number(str)})}),this.$widget.find('[name="lat"], [name="long"], [name="alt"], [name="acc"]').on("change change.bymap change.bysearch",function(event){var lat=that.$lat.val()?Number(that.$lat.val()):"",lng=that.$lng.val()?Number(that.$lng.val()):"",alt=that.$alt.val()?Number(that.$alt.val()):"",acc=that.$acc.val()?Number(that.$acc.val()):"",latLng={lat:lat,lng:lng};event.stopImmediatePropagation(),"bymap"!==event.namespace&&"bysearch"!==event.namespace&&that.polyline&&!that.containsEmptyPoints(that.points,that.currentIndex)&&that.updatedPolylineWouldIntersect(latLng,that.currentIndex)?(that._showIntersectError(),that._updateInputs(that.points[that.currentIndex],"nochange")):(that._editPoint([lat,lng,alt,acc]),"bysearch"!==event.namespace&&that.$search&&that.$search.val(""))}),this.$kmlInput.on("change",function(event){var $addPointBtn=that.$points.find(".addpoint"),$progress=$(this).prev(".paste-progress").removeClass("hide"),value=event.target.value,coords=that._convertKmlCoordinatesToLeafletCoordinates(value);event.target.value="",setTimeout(function(){coords.forEach(function(latLng,index){that._updateInputs(latLng),index<coords.length-1&&$addPointBtn.click()}),$progress.remove(),that._switchInputType("points")},10)}),this.$widget.find(".toggle-input-type-btn").on("click",function(){var type=that.$inputGroup.hasClass("kml-input-mode")?"points":"kml";return that._switchInputType(type),!1}),$(this.element).on("change",function(){that.$kmlInput.prop("disabled",!!this.value)}).on("applyfocus",function(){that.$widget[0].querySelector("input").focus()}),this.$points.on("click",".point",function(){return that._setCurrent(that.$points.find(".point").index($(this))),that._switchInputType("points"),!1}),this.$points.find(".addpoint").on("click",function(){return that._addPoint(),!1}),this.$widget.find(".close-chain-btn").on("click",function(){return that._closePolygon(),!1}),this.$widget.find(".btn-remove").on("click",function(){that.points.length<2?that._updateInputs([]):dialog.confirm(t("geopicker.removePoint")).then(function(){that._removePoint()})}),this.$map.find(".show-map-btn").on("click",function(){return that.$widget.find(".search-bar").removeClass("hide-search"),that.$widget.addClass("full-screen"),that._updateMap(),!1}),this.$form.on("pageflip.enketo.map"+this.mapId,function(event){that.map&&$.contains(event.target,that.element)&&(that.map.invalidateSize(),that.$form.off("pageflip.enketo.map"+that.mapId))}),this.props.wide&&this.$widget.addClass("wide"),this.$widget.toggleClass("hide-input",this.$question.hasClass("or-appearance-hide-input")).find(".toggle-input-visibility-btn").on("click",function(){that.$widget.toggleClass("hide-input"),$(this).toggleClass("open",that.$widget.hasClass("hide-input")),that.map&&that.map.invalidateSize(!1)}).toggleClass("open",that.$widget.hasClass("hide-input")),this.$widget.find(".hide-map-btn").on("click",function(){return that.$widget.find(".search-bar").addClass("hide-search"),that.$widget.removeClass("full-screen").find(".map-canvas").removeClass("leaflet-container").find(".leaflet-google-layer").remove(),that.map&&(that.map.remove(),that.map=null,that.polygon=null,that.polyline=null),!1}),this.$widget.on("focus","input",function(){$(that.element).trigger("fakefocus")}),this.props.search&&this._enableSearch(),this.props.detect&&this._enableDetection(),this.props.readonly&&this.disable(this.element),loadedVal?this.points.forEach(function(){that._addPointBtn()}):this._addPoint(),loadedVal?(this._updateMap(),this._setCurrent(this.currentIndex)):(this._updateMap([0,0],1),this.props.detect&&navigator.geolocation.getCurrentPosition(function(position){that._updateMap([position.coords.latitude,position.coords.longitude],15)}))},Geopicker.prototype._switchInputType=function(type){"kml"===type?this.$inputGroup.addClass("kml-input-mode"):"points"===type&&this.$inputGroup.removeClass("kml-input-mode")},Geopicker.prototype._getProps=function(){var appearances=[],map=!0!==support.touch||!0===support.touch&&0<$(this.element).closest(".or-appearance-maps").length;return map&&(appearances=$(this.element).closest(".question").attr("class").split(" ").filter(function(item){return"or-appearance-maps"!==item&&/or-appearance-/.test(item)})).forEach(function(appearance,index){appearances[index]=appearance.substring(14)}),{detect:!!navigator.geolocation,map:map,search:map,appearances:appearances,type:this.element.attributes["data-type-xml"].value,touch:support.touch,wide:.8<this.$question.width()/this.$question.closest("form.or").width(),readonly:this.element.readOnly}},Geopicker.prototype._addPointBtn=function(){this.$points.find(".addpoint").before('<a href="#" class="point" aria-label="point"> </a>')},Geopicker.prototype._addDomElements=function(){var map='<div class="map-canvas-wrapper"><div class=map-canvas id="map'+this.mapId+'"></div></div>',kmlPstTxt=t("geopicker.kmlpaste"),kmlCrdsTxt=t("geopicker.kmlcoords"),kml='<a href="#" class="toggle-input-type-btn"><span class="kml-input">KML</span><span class="points-input">'+t("geopicker.points")+'</span></a><label class="geo kml">'+kmlCrdsTxt+'<progress class="paste-progress hide"></progress><textarea class="ignore" name="kml" placeholder="'+kmlPstTxt+'"></textarea><span class="disabled-msg">remove all points to enable</span></label>',close='<button type="button" class="close-chain-btn btn btn-default btn-xs">'+t("geopicker.closepolygon")+"</button>",latTxt=t("geopicker.latitude"),lngTxt=t("geopicker.longitude"),altTxt=t("geopicker.altitude"),accTxt=t("geopicker.accuracy"),srchTxt=t("geopicker.searchPlaceholder");if(this.$widget=$('<div class="geopicker widget"><div class="search-bar hide-search no-map no-detect"><button type="button" class="hide-map-btn btn btn-default"><span class="icon icon-arrow-left"> </span></button><button name="geodetect" type="button" class="btn btn-default" title="detect current location" data-placement="top"><span class="icon icon-crosshairs"> </span></button><div class="input-group"><input class="geo ignore" name="search" type="text" placeholder="'+srchTxt+'" disabled="disabled"/><button type="button" class="btn btn-default search-btn"><i class="icon icon-search"> </i></button></div></div><div class="geo-inputs"><label class="geo lat">'+latTxt+'<input class="ignore" name="lat" type="number" step="0.000001" min="-90" max="90"/></label><label class="geo long">'+lngTxt+'<input class="ignore" name="long" type="number" step="0.000001" min="-180" max="180"/></label><label class="geo alt">'+altTxt+'<input class="ignore" name="alt" type="number" step="0.1" /></label><label class="geo acc">'+accTxt+'<input class="ignore" name="acc" type="number" step="0.1" /></label><button type="button" class="btn-icon-only btn-remove" aria-label="remove"><span class="icon icon-trash"> </span></button></div></div>'),this.props.detect&&(this.$widget.find(".search-bar").removeClass("no-detect"),this.$detect=this.$widget.find('button[name="geodetect"]')),this.$search=this.$widget.find('[name="search"]'),this.$inputGroup=this.$widget.find(".geo-inputs"),this.props.map?(this.$widget.find(".search-bar").removeClass("no-map").after(map),this.$map=this.$widget.find(".map-canvas"),this.$map.parent().append('<button type="button" class="toggle-input-visibility-btn" aria-label="toggle input"> </button>')):this.$map=$(),this.props.touch&&this.props.map&&this.$map.append('<button type="button" class="show-map-btn btn btn-default">Map</button>'),this.props.touch||this.$widget.find(".search-bar").removeClass("hide-search"),"geopoint"!==this.props.type){this.$points=$('<div class="points"><button type="button" class="addpoint">+</button></div>'),this.$widget.prepend(this.$points),"geoshape"===this.props.type&&this.$inputGroup.append(close);var $kml=$(kml);this.$kmlInput=$kml.find('[name="kml"]'),this.$inputGroup.prepend($kml)}else this.$points=$(),this.$kmlInput=$();this.$lat=this.$widget.find('[name="lat"]'),this.$lng=this.$widget.find('[name="long"]'),this.$alt=this.$widget.find('[name="alt"]'),this.$acc=this.$widget.find('[name="acc"]'),$(this.element).hide().after(this.$widget).parent().addClass("clearfix")},Geopicker.prototype._updateValue=function(){var oldValue=$(this.element).val(),newValue="",that=this;return this._markAsValid(),this.points.forEach(function(point,index,array){var geopoint,lat="number"==typeof point[0]?point[0]:"number"==typeof point.lat?point.lat:null,lng="number"==typeof point[1]?point[1]:"number"==typeof point.lng?point.lng:null,alt="number"==typeof point[2]?point[2]:0,acc="number"==typeof point[3]?point[3]:0;geopoint=lat&&lng?lat+" "+lng+" "+alt+" "+acc:"",that._isValidGeopoint(geopoint)||!geopoint&&index===array.length-1||that._markAsInvalid(index),geopoint||index!==array.length-1?(newValue+=geopoint,index!==array.length-1&&(newValue+=";")):newValue=newValue.substring(0,newValue.lastIndexOf(";"))}),oldValue!==newValue&&($(this.element).val(newValue).trigger("change"),!0)},Geopicker.prototype._isValidGeopoint=function(geopoint){var coords;return!!geopoint&&(""!==(coords=geopoint.toString().split(" "))[0]&&-90<=coords[0]&&coords[0]<=90&&""!==coords[1]&&-180<=coords[1]&&coords[1]<=180&&(void 0===coords[2]||!isNaN(coords[2]))&&(void 0===coords[3]||!isNaN(coords[3])&&0<=coords[3]))},Geopicker.prototype._isValidLatLngList=function(latLngs){var that=this;return latLngs.every(function(latLng,index,array){return that._isValidLatLng(latLng)||""===latLng.join()&&index===array.length-1})},Geopicker.prototype._cleanLatLng=function(latLng){return Array.isArray(latLng)?[latLng[0],latLng[1]]:latLng},Geopicker.prototype._isValidLatLng=function(latLng){var lat,lng;return lat="number"==typeof latLng[0]?latLng[0]:"number"==typeof latLng.lat?latLng.lat:null,lng="number"==typeof latLng[1]?latLng[1]:"number"==typeof latLng.lng?latLng.lng:null,null!==lat&&null!==lng&&-90<=lat&&lat<=90&&-180<=lng&&lng<=180},Geopicker.prototype._markAsInvalid=function(index){this.$points.find(".point").eq(index).addClass("has-error")},Geopicker.prototype._markAsValid=function(){this.$points.find(".point").removeClass("has-error")},Geopicker.prototype._setCurrent=function(index){this.currentIndex=index,this.$points.find(".point").removeClass("active").eq(index).addClass("active"),this._updateInputs(this.points[index],""),!this.map||this.props.touch&&!this._inFullScreenMode()||this._updateMarkers()},Geopicker.prototype._enableDetection=function(){var that=this,options={enableHighAccuracy:!0,maximumAge:0};this.$detect.click(function(event){return event.preventDefault(),navigator.geolocation.getCurrentPosition(function(position){var latLng={lat:Math.round(1e6*position.coords.latitude)/1e6,lng:Math.round(1e6*position.coords.longitude)/1e6};that.polyline&&that.updatedPolylineWouldIntersect(latLng,that.currentIndex)?that._showIntersectError():(that._updateInputs([latLng.lat,latLng.lng,position.coords.altitude,position.coords.accuracy]),that.currentIndex===that.points.length-1&&"geopoint"!==that.props.type&&that._addPoint())},function(){console.error("error occurred trying to obtain position")},options),!1})},Geopicker.prototype._enableSearch=function(){var that=this;searchSource=googleApiKey?searchSource.replace("{api_key}",googleApiKey):searchSource.replace("&key={api_key}",""),this.$search.prop("disabled",!1).on("change",function(event){var address=$(this).val();event.stopImmediatePropagation(),address&&(address=address.split(/\s+/).join("+"),$.get(searchSource.replace("{address}",address),function(response){var latLng;response.results&&0<response.results.length&&response.results[0].geometry&&response.results[0].geometry.location?(latLng=response.results[0].geometry.location,that._updateMap([latLng.lat,latLng.lng],15),that.$search.closest(".input-group").removeClass("has-error")):(that.$search.closest(".input-group").addClass("has-error"),console.log('Location "'+address+'" not found'))},"json").fail(function(){that.$search.closest(".input-group").addClass("has-error"),console.log("Error. Geocoding service may not be available or app is offline")}).always(function(){}))})},Geopicker.prototype._dynamicMapAvailable=function(){return!!this.map},Geopicker.prototype._inFullScreenMode=function(){return this.$widget.hasClass("full-screen")},Geopicker.prototype._updateMap=function(latLng,zoom){var that=this;this.props.map&&(zoom=zoom||(this.map&&this.map.getZoom()||15),latLng&&(this.lastLatLng=latLng,this.lastZoom=zoom),this.props.touch&&!this._inFullScreenMode()||(this.map?that._updateDynamicMapView(latLng,zoom):this._addDynamicMap().then(function(){that._updateDynamicMapView(latLng,zoom)})))},Geopicker.prototype._addDynamicMap=function(){var that=this;return this._getLayers().then(function(layers){var options={layers:that._getDefaultLayer(layers)};that.map=L.map("map"+that.mapId,options).on("click",function(e){var latLng,indexToPlacePoint;if(that.props.readonly)return!1;latLng=e.latlng,indexToPlacePoint=that.$lat.val()&&that.$lng.val()?that.points.length:that.currentIndex,latLng.lat=Math.round(1e6*latLng.lat)/1e6,latLng.lng=Math.round(1e6*latLng.lng)/1e6,"geopoint"!==that.props.type&&!that.containsEmptyPoints(that.points,indexToPlacePoint)&&that.updatedPolylineWouldIntersect(latLng,indexToPlacePoint)?that._showIntersectError():that.$lat.val()&&that.$lng.val()&&"geopoint"!==that.props.type?that.$lat.val()&&that.$lng.val()&&(that._addPoint(),that._updateInputs(latLng,"change.bymap")):that._updateInputs(latLng,"change.bymap")}),that.map.attributionControl.setPrefix(""),1<layers.length&&L.control.layers(that._getBaseLayers(layers),null).addTo(that.map),that.$widget.find(".leaflet-control-layers-toggle").append('<span class="icon icon-globe"></span>'),that.map.on("baselayerchange",function(){that.$widget.find(".leaflet-control-container input").addClass("ignore no-unselect").next("span").addClass("option-label")})})},Geopicker.prototype._updateDynamicMapView=function(latLng,zoom){latLng?this.map.setView(latLng,zoom||15):(this._updatePolyline(),this._updateMarkers(),1===this.points.length&&""===this.points[0].toString()&&(this.lastLatLng?this.map.setView(this.lastLatLng,this.lastZoom||15):this.map.setView(L.latLng(0,0),zoom||15)))},Geopicker.prototype._showIntersectError=function(){dialog.alert("Borders cannot intersect!")},Geopicker.prototype._getLayers=function(){var that=this,tasks=[];return maps.forEach(function(map,index){"string"==typeof map.tiles&&/^GOOGLE_(SATELLITE|ROADMAP|HYBRID|TERRAIN)/.test(map.tiles)?tasks.push(that._getGoogleTileLayer(map,index)):map.tiles?tasks.push(that._getLeafletTileLayer(map,index)):console.error("Configuration error for map tiles. Not a valid tile layer: ",map)}),Promise.all(tasks)},Geopicker.prototype._getLeafletTileLayer=function(map,index){var url,options=this._getTileOptions(map,index);return map.tileIndex=void 0===map.tileIndex?Math.round(100*Math.random())%map.tiles.length:map.tileIndex,url=map.tiles[map.tileIndex],Promise.resolve(L.tileLayer(url,options))},Geopicker.prototype._getGoogleTileLayer=function(map,index){var options=this._getTileOptions(map,index);return options.type=map.tiles.substring(7).toLowerCase(),this._loadGoogleMapsScript().then(function(){return L.gridLayer.googleMutant(options)})},Geopicker.prototype._getTileOptions=function(map,index){var name=map.name||"map-"+(index+1);return{id:map.id||name,maxZoom:map.maxzoom||18,minZoom:map.minzoom||0,name:name,attribution:map.attribution||""}},Geopicker.prototype._loadGoogleMapsScript=function(){return googleMapsScriptRequest=googleMapsScriptRequest||new Promise(function(resolve){var loadUrl;window.gmapsLoaded=function(){delete window.gmapsLoaded,resolve()},loadUrl="https://maps.google.com/maps/api/js?v=3.exp"+(googleApiKey?"&key="+googleApiKey:"")+"&libraries=places&callback=gmapsLoaded",$.getScript(loadUrl)})},Geopicker.prototype._getDefaultLayer=function(layers){var defaultLayer,that=this;return layers.reverse().some(function(layer){return defaultLayer=layer,that.props.appearances.some(function(appearance){return appearance===layer.options.name})}),defaultLayer},Geopicker.prototype._getBaseLayers=function(layers){var baseLayers={};return layers.forEach(function(layer){baseLayers[layer.options.name]=layer}),baseLayers},Geopicker.prototype._updateMarkers=function(){var coords=[],markers=[],that=this;this.markerLayer&&this.markerLayer.clearLayers(),this.points.length<2&&""===this.points[0].join()||(this.points.forEach(function(latLng,index){var icon="geopoint"===that.props.type?iconSingle:index===that.currentIndex?iconMultiActive:iconMulti;that._isValidLatLng(latLng)?(coords.push(that._cleanLatLng(latLng)),markers.push(L.marker(that._cleanLatLng(latLng),{icon:icon,clickable:!that.props.readonly,draggable:!that.props.readonly,alt:index,opacity:.9}).on("click",function(e){0===e.target.options.alt&&"geoshape"===that.props.type?that._closePolygon():that._setCurrent(e.target.options.alt)}).on("dragend",function(e){var latLng=e.target.getLatLng(),index=e.target.options.alt;latLng.lat=Math.round(1e6*latLng.lat)/1e6,latLng.lng=Math.round(1e6*latLng.lng)/1e6,that.polyline&&that.updatedPolylineWouldIntersect(latLng,index)?(that._showIntersectError(),that._updateMarkers()):(that._setCurrent(index),that._updateInputs(latLng,"change.bymap"),that._updateMap())}))):console.debug("this latLng was not considered valid",latLng)}),0<markers.length&&(this.markerLayer=L.layerGroup(markers).addTo(this.map),1!==this.points.length&&this._isValidLatLngList(this.points)||this.map.setView(coords[0],this.lastZoom||15)))},Geopicker.prototype._updatePolyline=function(){var polylinePoints,that=this;if("geopoint"!==this.props.type){if(this.points.length<2||!this._isValidLatLngList(this.points))return this.map&&(this.polyline&&this.map.removeLayer(this.polyline),this.polygon&&this.map.removeLayer(this.polygon)),this.polyline=null,void(this.polygon=null);"geoshape"===this.props.type&&this._updatePolygon(),polylinePoints=(polylinePoints=""!==this.points[this.points.length-1].join("")?this.points:this.points.slice(0,this.points.length-1)).map(function(point){return that._cleanLatLng(point)}),this.polyline?this.polyline.setLatLngs(polylinePoints):(this.polyline=L.polyline(polylinePoints,{color:"red"}),this.map.addLayer(this.polyline)),setTimeout(function(){that.map.fitBounds(that.polyline.getBounds())},0)}},Geopicker.prototype._updatePolygon=function(){var polygonPoints,that=this;"geopoint"!==this.props.type&&"geotrace"!==this.props.type&&(polygonPoints=(polygonPoints=""!==this.points[this.points.length-1].join("")?this.points:this.points.slice(0,this.points.length-1)).map(function(point){return that._cleanLatLng(point)}),this.polygon?this.polygon.setLatLngs(polygonPoints):(this.polygon=L.polygon(polygonPoints,{color:"red",stroke:!1}),this.map.addLayer(this.polygon)),this._updateArea(polygonPoints))},Geopicker.prototype._updateArea=function(points){var area,readableArea;if(2<points.length){var latLngs=points.map(function(point){return{lat:point[0],lng:point[1]}});area=L.GeometryUtil.geodesicArea(latLngs),readableArea=L.GeometryUtil.readableArea(area,!0),L.popup({className:"enketo-area-popup"}).setLatLng(this.polygon.getBounds().getCenter()).setContent(readableArea).openOn(this.map)}else this.map.closePopup()},Geopicker.prototype._addPoint=function(){this._addPointBtn(),this.points.push([]),this._setCurrent(this.points.length-1),this._updateValue()},Geopicker.prototype._editPoint=function(latLng){var changed;return this.points[this.currentIndex]=latLng,(changed=this._updateValue())&&this._updateMap(),changed},Geopicker.prototype._removePoint=function(){var newIndex=this.currentIndex;this.points.splice(this.currentIndex,1),this._updateValue(),this.$points.find(".point").eq(this.currentIndex).remove(),void 0===this.points[this.currentIndex]&&(newIndex=this.currentIndex-1),this._setCurrent(newIndex),this._updateMap()},Geopicker.prototype._closePolygon=function(){var lastPoint=this.points[this.points.length-1];if(!(this.points.length<3||3===this.points.length&&!this._isValidLatLng(this.points[2])||JSON.stringify(this.points[0])===JSON.stringify(lastPoint))){if(this._isValidLatLng(lastPoint)?(console.log("current last point is valid, so will create a new one to use to close"),this._addPoint()):(console.log("current last point is not a valid point, so will use this as closing point"),this.currentIndex=this.points.length-1),this.polyline&&!this.containsEmptyPoints(this.points,this.points.length)&&this.updatedPolylineWouldIntersect(this.points[0],this.currentIndex))return this._showIntersectError();this._updateInputs(this.points[0])}},Geopicker.prototype._updateInputs=function(coords,ev){var lat=coords[0]||coords.lat||"",lng=coords[1]||coords.lng||"",alt=coords[2]||coords.alt||"",acc=coords[3]||coords.acc||"";ev=void 0!==ev?ev:"change",this.$lat.val(lat||""),this.$lng.val(lng||""),this.$alt.val(alt||""),this.$acc.val(acc||"").trigger(ev)},Geopicker.prototype._convertKmlCoordinatesToLeafletCoordinates=function(kmlCoordinates){var coordinates=[],reg=/<\s?coordinates>(([^<]|\n)*)<\/\s?coordinates\s?>/;return(kmlCoordinates=reg.test(kmlCoordinates)?kmlCoordinates.match(reg)[1]:kmlCoordinates).trim().split(/\s+/).forEach(function(item){var coordinate=[];item.split(",").forEach(function(c,index){var value=Number(c);0===index?coordinate[1]=value:1===index?coordinate[0]=value:2===index&&(coordinate[2]=value)}),coordinates.push(coordinate)}),coordinates},Geopicker.prototype.updatedPolylineWouldIntersect=function(latLng,index){var polylinePoints,polylineToTest,intersects,pointsToTest=[],that=this;return!(this.points<3)&&($.extend(!0,pointsToTest,this.points),pointsToTest[index]=[latLng[0]||latLng.lat,latLng[1]||latLng.lng],(polylinePoints=""!==pointsToTest[pointsToTest.length-1].join("")?pointsToTest:pointsToTest.slice(0,pointsToTest.length-1))[0][0]===polylinePoints[polylinePoints.length-1][0]&&polylinePoints[0][1]===polylinePoints[polylinePoints.length-1][1]&&(polylinePoints=polylinePoints.slice(0,polylinePoints.length-1)),polylinePoints=polylinePoints.map(function(point){return that._cleanLatLng(point)}),polylineToTest=L.polyline(polylinePoints,{color:"white"}),this.map.addLayer(polylineToTest),intersects=polylineToTest.intersects(),this.map.removeLayer(polylineToTest),intersects)},Geopicker.prototype.containsEmptyPoints=function(points,allowedIndex){return points.some(function(point,index){return!(index===allowedIndex||point[0]&&point[1])})},Geopicker.prototype.disable=function(element){$(element).next(".widget").addClass("readonly").find("input, select, textarea").prop("disabled",!0).end().find(".btn:not(.show-map-btn):not(.hide-map-btn), .btn-icon-only, .addpoint").prop("disabled",!0)},Geopicker.prototype.enable=function(element){$(element).next(".widget").removeClass("readonly").find("input, select, textarea").prop("disabled",!1).end().find(".btn:not(.show-map-btn):not(.hide-map-btn), .btn-icon-only, .addpoint").prop("disabled",!1),this.map&&this.map.invalidateSize()},Geopicker.prototype.update=function(element){this.destroy(element),$(element).data("geopicker",new Geopicker(element,this.options,this.event))},$.fn.geopicker=function(options,event){return this.each(function(){try{var $this=$(this),data=$(this).data("geopicker");options=options||{},data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data("geopicker",new Geopicker(this,options,event))}catch(e){console.log("Failed to initialise geopicker for "+this+": "+e)}})},module.exports={name:"geopicker",selector:'input[data-type-xml="geopoint"], input[data-type-xml="geotrace"], input[data-type-xml="geoshape"]'}},function(module,exports,__webpack_require__){
/* @preserve
 * Leaflet 1.3.4, a JS library for interactive maps. http://leafletjs.com
 * (c) 2010-2018 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */
!function(exports){"use strict";var freeze=Object.freeze;function extend(dest){var i,j,len,src;for(j=1,len=arguments.length;j<len;j++)for(i in src=arguments[j])dest[i]=src[i];return dest}Object.freeze=function(obj){return obj};var create=Object.create||function(){function F(){}return function(proto){return F.prototype=proto,new F}}();function bind(fn,obj){var slice=Array.prototype.slice;if(fn.bind)return fn.bind.apply(fn,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.length?args.concat(slice.call(arguments)):arguments)}}var lastId=0;function stamp(obj){return obj._leaflet_id=obj._leaflet_id||++lastId,obj._leaflet_id}function throttle(fn,time,context){var lock,args,wrapperFn,later;return later=function(){lock=!1,args&&(wrapperFn.apply(context,args),args=!1)},wrapperFn=function(){lock?args=arguments:(fn.apply(context,arguments),setTimeout(later,time),lock=!0)}}function wrapNum(x,range,includeMax){var max=range[1],min=range[0],d=max-min;return x===max&&includeMax?x:((x-min)%d+d)%d+min}function falseFn(){return!1}function formatNum(num,digits){var pow=Math.pow(10,void 0===digits?6:digits);return Math.round(num*pow)/pow}function trim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function splitWords(str){return trim(str).split(/\s+/)}function setOptions(obj,options){for(var i in obj.hasOwnProperty("options")||(obj.options=obj.options?create(obj.options):{}),options)obj.options[i]=options[i];return obj.options}function getParamString(obj,existingUrl,uppercase){var params=[];for(var i in obj)params.push(encodeURIComponent(uppercase?i.toUpperCase():i)+"="+encodeURIComponent(obj[i]));return(existingUrl&&-1!==existingUrl.indexOf("?")?"&":"?")+params.join("&")}var templateRe=/\{ *([\w_-]+) *\}/g;function template(str,data){return str.replace(templateRe,function(str,key){var value=data[key];if(void 0===value)throw new Error("No value provided for variable "+str);return"function"==typeof value&&(value=value(data)),value})}var isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)};function indexOf(array,el){for(var i=0;i<array.length;i++)if(array[i]===el)return i;return-1}var emptyImageUrl="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function getPrefixed(name){return window["webkit"+name]||window["moz"+name]||window["ms"+name]}var lastTime=0;function timeoutDefer(fn){var time=+new Date,timeToCall=Math.max(0,16-(time-lastTime));return lastTime=time+timeToCall,window.setTimeout(fn,timeToCall)}var requestFn=window.requestAnimationFrame||getPrefixed("RequestAnimationFrame")||timeoutDefer,cancelFn=window.cancelAnimationFrame||getPrefixed("CancelAnimationFrame")||getPrefixed("CancelRequestAnimationFrame")||function(id){window.clearTimeout(id)};function requestAnimFrame(fn,context,immediate){if(!immediate||requestFn!==timeoutDefer)return requestFn.call(window,bind(fn,context));fn.call(context)}function cancelAnimFrame(id){id&&cancelFn.call(window,id)}var Util=(Object.freeze||Object)({freeze:freeze,extend:extend,create:create,bind:bind,lastId:lastId,stamp:stamp,throttle:throttle,wrapNum:wrapNum,falseFn:falseFn,formatNum:formatNum,trim:trim,splitWords:splitWords,setOptions:setOptions,getParamString:getParamString,template:template,isArray:isArray,indexOf:indexOf,emptyImageUrl:emptyImageUrl,requestFn:requestFn,cancelFn:cancelFn,requestAnimFrame:requestAnimFrame,cancelAnimFrame:cancelAnimFrame});function Class(){}Class.extend=function(props){var NewClass=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},parentProto=NewClass.__super__=this.prototype,proto=create(parentProto);for(var i in(proto.constructor=NewClass).prototype=proto,this)this.hasOwnProperty(i)&&"prototype"!==i&&"__super__"!==i&&(NewClass[i]=this[i]);return props.statics&&(extend(NewClass,props.statics),delete props.statics),props.includes&&(function(includes){if("undefined"==typeof L||!L||!L.Mixin)return;includes=isArray(includes)?includes:[includes];for(var i=0;i<includes.length;i++)includes[i]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}(props.includes),extend.apply(null,[proto].concat(props.includes)),delete props.includes),proto.options&&(props.options=extend(create(proto.options),props.options)),extend(proto,props),proto._initHooks=[],proto.callInitHooks=function(){if(!this._initHooksCalled){parentProto.callInitHooks&&parentProto.callInitHooks.call(this),this._initHooksCalled=!0;for(var i=0,len=proto._initHooks.length;i<len;i++)proto._initHooks[i].call(this)}},NewClass},Class.include=function(props){return extend(this.prototype,props),this},Class.mergeOptions=function(options){return extend(this.prototype.options,options),this},Class.addInitHook=function(fn){var args=Array.prototype.slice.call(arguments,1),init="function"==typeof fn?fn:function(){this[fn].apply(this,args)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(init),this};var Events={on:function(types,fn,context){if("object"==typeof types)for(var type in types)this._on(type,types[type],fn);else{types=splitWords(types);for(var i=0,len=types.length;i<len;i++)this._on(types[i],fn,context)}return this},off:function(types,fn,context){if(types)if("object"==typeof types)for(var type in types)this._off(type,types[type],fn);else{types=splitWords(types);for(var i=0,len=types.length;i<len;i++)this._off(types[i],fn,context)}else delete this._events;return this},_on:function(type,fn,context){this._events=this._events||{};var typeListeners=this._events[type];typeListeners||(typeListeners=[],this._events[type]=typeListeners),context===this&&(context=void 0);for(var newListener={fn:fn,ctx:context},listeners=typeListeners,i=0,len=listeners.length;i<len;i++)if(listeners[i].fn===fn&&listeners[i].ctx===context)return;listeners.push(newListener)},_off:function(type,fn,context){var listeners,i,len;if(this._events&&(listeners=this._events[type]))if(fn){if(context===this&&(context=void 0),listeners)for(i=0,len=listeners.length;i<len;i++){var l=listeners[i];if(l.ctx===context&&l.fn===fn)return l.fn=falseFn,this._firingCount&&(this._events[type]=listeners=listeners.slice()),void listeners.splice(i,1)}}else{for(i=0,len=listeners.length;i<len;i++)listeners[i].fn=falseFn;delete this._events[type]}},fire:function(type,data,propagate){if(!this.listens(type,propagate))return this;var event=extend({},data,{type:type,target:this,sourceTarget:data&&data.sourceTarget||this});if(this._events){var listeners=this._events[type];if(listeners){this._firingCount=this._firingCount+1||1;for(var i=0,len=listeners.length;i<len;i++){var l=listeners[i];l.fn.call(l.ctx||this,event)}this._firingCount--}}return propagate&&this._propagateEvent(event),this},listens:function(type,propagate){var listeners=this._events&&this._events[type];if(listeners&&listeners.length)return!0;if(propagate)for(var id in this._eventParents)if(this._eventParents[id].listens(type,propagate))return!0;return!1},once:function(types,fn,context){if("object"==typeof types){for(var type in types)this.once(type,types[type],fn);return this}var handler=bind(function(){this.off(types,fn,context).off(types,handler,context)},this);return this.on(types,fn,context).on(types,handler,context)},addEventParent:function(obj){return this._eventParents=this._eventParents||{},this._eventParents[stamp(obj)]=obj,this},removeEventParent:function(obj){return this._eventParents&&delete this._eventParents[stamp(obj)],this},_propagateEvent:function(e){for(var id in this._eventParents)this._eventParents[id].fire(e.type,extend({layer:e.target,propagatedFrom:e.target},e),!0)}};Events.addEventListener=Events.on,Events.removeEventListener=Events.clearAllEventListeners=Events.off,Events.addOneTimeEventListener=Events.once,Events.fireEvent=Events.fire,Events.hasEventListeners=Events.listens;var Evented=Class.extend(Events);function Point(x,y,round){this.x=round?Math.round(x):x,this.y=round?Math.round(y):y}var trunc=Math.trunc||function(v){return 0<v?Math.floor(v):Math.ceil(v)};function toPoint(x,y,round){return x instanceof Point?x:isArray(x)?new Point(x[0],x[1]):null==x?x:"object"==typeof x&&"x"in x&&"y"in x?new Point(x.x,x.y):new Point(x,y,round)}function Bounds(a,b){if(a)for(var points=b?[a,b]:a,i=0,len=points.length;i<len;i++)this.extend(points[i])}function toBounds(a,b){return!a||a instanceof Bounds?a:new Bounds(a,b)}function LatLngBounds(corner1,corner2){if(corner1)for(var latlngs=corner2?[corner1,corner2]:corner1,i=0,len=latlngs.length;i<len;i++)this.extend(latlngs[i])}function toLatLngBounds(a,b){return a instanceof LatLngBounds?a:new LatLngBounds(a,b)}function LatLng(lat,lng,alt){if(isNaN(lat)||isNaN(lng))throw new Error("Invalid LatLng object: ("+lat+", "+lng+")");this.lat=+lat,this.lng=+lng,void 0!==alt&&(this.alt=+alt)}function toLatLng(a,b,c){return a instanceof LatLng?a:isArray(a)&&"object"!=typeof a[0]?3===a.length?new LatLng(a[0],a[1],a[2]):2===a.length?new LatLng(a[0],a[1]):null:null==a?a:"object"==typeof a&&"lat"in a?new LatLng(a.lat,"lng"in a?a.lng:a.lon,a.alt):void 0===b?null:new LatLng(a,b,c)}Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(point){return this.clone()._add(toPoint(point))},_add:function(point){return this.x+=point.x,this.y+=point.y,this},subtract:function(point){return this.clone()._subtract(toPoint(point))},_subtract:function(point){return this.x-=point.x,this.y-=point.y,this},divideBy:function(num){return this.clone()._divideBy(num)},_divideBy:function(num){return this.x/=num,this.y/=num,this},multiplyBy:function(num){return this.clone()._multiplyBy(num)},_multiplyBy:function(num){return this.x*=num,this.y*=num,this},scaleBy:function(point){return new Point(this.x*point.x,this.y*point.y)},unscaleBy:function(point){return new Point(this.x/point.x,this.y/point.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=trunc(this.x),this.y=trunc(this.y),this},distanceTo:function(point){var x=(point=toPoint(point)).x-this.x,y=point.y-this.y;return Math.sqrt(x*x+y*y)},equals:function(point){return(point=toPoint(point)).x===this.x&&point.y===this.y},contains:function(point){return point=toPoint(point),Math.abs(point.x)<=Math.abs(this.x)&&Math.abs(point.y)<=Math.abs(this.y)},toString:function(){return"Point("+formatNum(this.x)+", "+formatNum(this.y)+")"}},Bounds.prototype={extend:function(point){return point=toPoint(point),this.min||this.max?(this.min.x=Math.min(point.x,this.min.x),this.max.x=Math.max(point.x,this.max.x),this.min.y=Math.min(point.y,this.min.y),this.max.y=Math.max(point.y,this.max.y)):(this.min=point.clone(),this.max=point.clone()),this},getCenter:function(round){return new Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,round)},getBottomLeft:function(){return new Point(this.min.x,this.max.y)},getTopRight:function(){return new Point(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(obj){var min,max;return(obj="number"==typeof obj[0]||obj instanceof Point?toPoint(obj):toBounds(obj))instanceof Bounds?(min=obj.min,max=obj.max):min=max=obj,min.x>=this.min.x&&max.x<=this.max.x&&min.y>=this.min.y&&max.y<=this.max.y},intersects:function(bounds){bounds=toBounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xIntersects=max2.x>=min.x&&min2.x<=max.x,yIntersects=max2.y>=min.y&&min2.y<=max.y;return xIntersects&&yIntersects},overlaps:function(bounds){bounds=toBounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xOverlaps=max2.x>min.x&&min2.x<max.x,yOverlaps=max2.y>min.y&&min2.y<max.y;return xOverlaps&&yOverlaps},isValid:function(){return!(!this.min||!this.max)}},LatLngBounds.prototype={extend:function(obj){var sw2,ne2,sw=this._southWest,ne=this._northEast;if(obj instanceof LatLng)ne2=sw2=obj;else{if(!(obj instanceof LatLngBounds))return obj?this.extend(toLatLng(obj)||toLatLngBounds(obj)):this;if(sw2=obj._southWest,ne2=obj._northEast,!sw2||!ne2)return this}return sw||ne?(sw.lat=Math.min(sw2.lat,sw.lat),sw.lng=Math.min(sw2.lng,sw.lng),ne.lat=Math.max(ne2.lat,ne.lat),ne.lng=Math.max(ne2.lng,ne.lng)):(this._southWest=new LatLng(sw2.lat,sw2.lng),this._northEast=new LatLng(ne2.lat,ne2.lng)),this},pad:function(bufferRatio){var sw=this._southWest,ne=this._northEast,heightBuffer=Math.abs(sw.lat-ne.lat)*bufferRatio,widthBuffer=Math.abs(sw.lng-ne.lng)*bufferRatio;return new LatLngBounds(new LatLng(sw.lat-heightBuffer,sw.lng-widthBuffer),new LatLng(ne.lat+heightBuffer,ne.lng+widthBuffer))},getCenter:function(){return new LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(obj){obj="number"==typeof obj[0]||obj instanceof LatLng||"lat"in obj?toLatLng(obj):toLatLngBounds(obj);var sw2,ne2,sw=this._southWest,ne=this._northEast;return obj instanceof LatLngBounds?(sw2=obj.getSouthWest(),ne2=obj.getNorthEast()):sw2=ne2=obj,sw2.lat>=sw.lat&&ne2.lat<=ne.lat&&sw2.lng>=sw.lng&&ne2.lng<=ne.lng},intersects:function(bounds){bounds=toLatLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latIntersects=ne2.lat>=sw.lat&&sw2.lat<=ne.lat,lngIntersects=ne2.lng>=sw.lng&&sw2.lng<=ne.lng;return latIntersects&&lngIntersects},overlaps:function(bounds){bounds=toLatLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latOverlaps=ne2.lat>sw.lat&&sw2.lat<ne.lat,lngOverlaps=ne2.lng>sw.lng&&sw2.lng<ne.lng;return latOverlaps&&lngOverlaps},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(bounds,maxMargin){return!!bounds&&(bounds=toLatLngBounds(bounds),this._southWest.equals(bounds.getSouthWest(),maxMargin)&&this._northEast.equals(bounds.getNorthEast(),maxMargin))},isValid:function(){return!(!this._southWest||!this._northEast)}};var CRS={latLngToPoint:function(latlng,zoom){var projectedPoint=this.projection.project(latlng),scale=this.scale(zoom);return this.transformation._transform(projectedPoint,scale)},pointToLatLng:function(point,zoom){var scale=this.scale(zoom),untransformedPoint=this.transformation.untransform(point,scale);return this.projection.unproject(untransformedPoint)},project:function(latlng){return this.projection.project(latlng)},unproject:function(point){return this.projection.unproject(point)},scale:function(zoom){return 256*Math.pow(2,zoom)},zoom:function(scale){return Math.log(scale/256)/Math.LN2},getProjectedBounds:function(zoom){if(this.infinite)return null;var b=this.projection.bounds,s=this.scale(zoom),min=this.transformation.transform(b.min,s),max=this.transformation.transform(b.max,s);return new Bounds(min,max)},infinite:!(LatLng.prototype={equals:function(obj,maxMargin){if(!obj)return!1;obj=toLatLng(obj);var margin=Math.max(Math.abs(this.lat-obj.lat),Math.abs(this.lng-obj.lng));return margin<=(void 0===maxMargin?1e-9:maxMargin)},toString:function(precision){return"LatLng("+formatNum(this.lat,precision)+", "+formatNum(this.lng,precision)+")"},distanceTo:function(other){return Earth.distance(this,toLatLng(other))},wrap:function(){return Earth.wrapLatLng(this)},toBounds:function(sizeInMeters){var latAccuracy=180*sizeInMeters/40075017,lngAccuracy=latAccuracy/Math.cos(Math.PI/180*this.lat);return toLatLngBounds([this.lat-latAccuracy,this.lng-lngAccuracy],[this.lat+latAccuracy,this.lng+lngAccuracy])},clone:function(){return new LatLng(this.lat,this.lng,this.alt)}}),wrapLatLng:function(latlng){var lng=this.wrapLng?wrapNum(latlng.lng,this.wrapLng,!0):latlng.lng,lat=this.wrapLat?wrapNum(latlng.lat,this.wrapLat,!0):latlng.lat,alt=latlng.alt;return new LatLng(lat,lng,alt)},wrapLatLngBounds:function(bounds){var center=bounds.getCenter(),newCenter=this.wrapLatLng(center),latShift=center.lat-newCenter.lat,lngShift=center.lng-newCenter.lng;if(0==latShift&&0==lngShift)return bounds;var sw=bounds.getSouthWest(),ne=bounds.getNorthEast(),newSw=new LatLng(sw.lat-latShift,sw.lng-lngShift),newNe=new LatLng(ne.lat-latShift,ne.lng-lngShift);return new LatLngBounds(newSw,newNe)}},Earth=extend({},CRS,{wrapLng:[-180,180],R:6371e3,distance:function(latlng1,latlng2){var rad=Math.PI/180,lat1=latlng1.lat*rad,lat2=latlng2.lat*rad,sinDLat=Math.sin((latlng2.lat-latlng1.lat)*rad/2),sinDLon=Math.sin((latlng2.lng-latlng1.lng)*rad/2),a=sinDLat*sinDLat+Math.cos(lat1)*Math.cos(lat2)*sinDLon*sinDLon,c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*c}}),SphericalMercator={R:6378137,MAX_LATITUDE:85.0511287798,project:function(latlng){var d=Math.PI/180,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),sin=Math.sin(lat*d);return new Point(this.R*latlng.lng*d,this.R*Math.log((1+sin)/(1-sin))/2)},unproject:function(point){var d=180/Math.PI;return new LatLng((2*Math.atan(Math.exp(point.y/this.R))-Math.PI/2)*d,point.x*d/this.R)},bounds:function(){var d=6378137*Math.PI;return new Bounds([-d,-d],[d,d])}()};function Transformation(a,b,c,d){if(isArray(a))return this._a=a[0],this._b=a[1],this._c=a[2],void(this._d=a[3]);this._a=a,this._b=b,this._c=c,this._d=d}function toTransformation(a,b,c,d){return new Transformation(a,b,c,d)}Transformation.prototype={transform:function(point,scale){return this._transform(point.clone(),scale)},_transform:function(point,scale){return scale=scale||1,point.x=scale*(this._a*point.x+this._b),point.y=scale*(this._c*point.y+this._d),point},untransform:function(point,scale){return scale=scale||1,new Point((point.x/scale-this._b)/this._a,(point.y/scale-this._d)/this._c)}};var EPSG3857=extend({},Earth,{code:"EPSG:3857",projection:SphericalMercator,transformation:function(){var scale=.5/(Math.PI*SphericalMercator.R);return toTransformation(scale,.5,-scale,.5)}()}),EPSG900913=extend({},EPSG3857,{code:"EPSG:900913"});function svgCreate(name){return document.createElementNS("http://www.w3.org/2000/svg",name)}function pointsToPath(rings,closed){var i,j,len,len2,points,p,str="";for(i=0,len=rings.length;i<len;i++){for(points=rings[i],j=0,len2=points.length;j<len2;j++)p=points[j],str+=(j?"L":"M")+p.x+" "+p.y;str+=closed?svg?"z":"x":""}return str||"M0 0"}var style$1=document.documentElement.style,ie="ActiveXObject"in window,ielt9=ie&&!document.addEventListener,edge="msLaunchUri"in navigator&&!("documentMode"in document),webkit=userAgentContains("webkit"),android=userAgentContains("android"),android23=userAgentContains("android 2")||userAgentContains("android 3"),webkitVer=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),androidStock=android&&userAgentContains("Google")&&webkitVer<537&&!("AudioNode"in window),opera=!!window.opera,chrome=userAgentContains("chrome"),gecko=userAgentContains("gecko")&&!webkit&&!opera&&!ie,safari=!chrome&&userAgentContains("safari"),phantom=userAgentContains("phantom"),opera12="OTransition"in style$1,win=0===navigator.platform.indexOf("Win"),ie3d=ie&&"transition"in style$1,webkit3d="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!android23,gecko3d="MozPerspective"in style$1,any3d=!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d)&&!opera12&&!phantom,mobile="undefined"!=typeof orientation||userAgentContains("mobile"),mobileWebkit=mobile&&webkit,mobileWebkit3d=mobile&&webkit3d,msPointer=!window.PointerEvent&&window.MSPointerEvent,pointer=!(!window.PointerEvent&&!msPointer),touch=!window.L_NO_TOUCH&&(pointer||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),mobileOpera=mobile&&opera,mobileGecko=mobile&&gecko,retina=1<(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI),canvas=!!document.createElement("canvas").getContext,svg=!(!document.createElementNS||!svgCreate("svg").createSVGRect),vml=!svg&&function(){try{var div=document.createElement("div");div.innerHTML='<v:shape adj="1"/>';var shape=div.firstChild;return shape.style.behavior="url(#default#VML)",shape&&"object"==typeof shape.adj}catch(e){return!1}}();function userAgentContains(str){return 0<=navigator.userAgent.toLowerCase().indexOf(str)}var Browser=(Object.freeze||Object)({ie:ie,ielt9:ielt9,edge:edge,webkit:webkit,android:android,android23:android23,androidStock:androidStock,opera:opera,chrome:chrome,gecko:gecko,safari:safari,phantom:phantom,opera12:opera12,win:win,ie3d:ie3d,webkit3d:webkit3d,gecko3d:gecko3d,any3d:any3d,mobile:mobile,mobileWebkit:mobileWebkit,mobileWebkit3d:mobileWebkit3d,msPointer:msPointer,pointer:pointer,touch:touch,mobileOpera:mobileOpera,mobileGecko:mobileGecko,retina:retina,canvas:canvas,svg:svg,vml:vml}),POINTER_DOWN=msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE=msPointer?"MSPointerMove":"pointermove",POINTER_UP=msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL=msPointer?"MSPointerCancel":"pointercancel",TAG_WHITE_LIST=["INPUT","SELECT","OPTION"],_pointers={},_pointerDocListener=!1,_pointersCount=0;function addPointerListener(obj,type,handler,id){return"touchstart"===type?function(obj,handler,id){var onDown=bind(function(e){if("mouse"!==e.pointerType&&e.MSPOINTER_TYPE_MOUSE&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE){if(!(TAG_WHITE_LIST.indexOf(e.target.tagName)<0))return;preventDefault(e)}_handlePointer(e,handler)});obj["_leaflet_touchstart"+id]=onDown,obj.addEventListener(POINTER_DOWN,onDown,!1),_pointerDocListener||(document.documentElement.addEventListener(POINTER_DOWN,_globalPointerDown,!0),document.documentElement.addEventListener(POINTER_MOVE,_globalPointerMove,!0),document.documentElement.addEventListener(POINTER_UP,_globalPointerUp,!0),document.documentElement.addEventListener(POINTER_CANCEL,_globalPointerUp,!0),_pointerDocListener=!0)}(obj,handler,id):"touchmove"===type?function(obj,handler,id){function onMove(e){(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType||0!==e.buttons)&&_handlePointer(e,handler)}obj["_leaflet_touchmove"+id]=onMove,obj.addEventListener(POINTER_MOVE,onMove,!1)}(obj,handler,id):"touchend"===type&&function(obj,handler,id){function onUp(e){_handlePointer(e,handler)}obj["_leaflet_touchend"+id]=onUp,obj.addEventListener(POINTER_UP,onUp,!1),obj.addEventListener(POINTER_CANCEL,onUp,!1)}(obj,handler,id),this}function _globalPointerDown(e){_pointers[e.pointerId]=e,_pointersCount++}function _globalPointerMove(e){_pointers[e.pointerId]&&(_pointers[e.pointerId]=e)}function _globalPointerUp(e){delete _pointers[e.pointerId],_pointersCount--}function _handlePointer(e,handler){for(var i in e.touches=[],_pointers)e.touches.push(_pointers[i]);e.changedTouches=[e],handler(e)}var _touchstart=msPointer?"MSPointerDown":pointer?"pointerdown":"touchstart",_touchend=msPointer?"MSPointerUp":pointer?"pointerup":"touchend",_pre="_leaflet_";function addDoubleTapListener(obj,handler,id){var last,touch$$1,doubleTap=!1;function onTouchStart(e){var count;if(pointer){if(!edge||"mouse"===e.pointerType)return;count=_pointersCount}else count=e.touches.length;if(!(1<count)){var now=Date.now(),delta=now-(last||now);touch$$1=e.touches?e.touches[0]:e,doubleTap=0<delta&&delta<=250,last=now}}function onTouchEnd(e){if(doubleTap&&!touch$$1.cancelBubble){if(pointer){if(!edge||"mouse"===e.pointerType)return;var prop,i,newTouch={};for(i in touch$$1)prop=touch$$1[i],newTouch[i]=prop&&prop.bind?prop.bind(touch$$1):prop;touch$$1=newTouch}touch$$1.type="dblclick",handler(touch$$1),last=null}}return obj[_pre+_touchstart+id]=onTouchStart,obj[_pre+_touchend+id]=onTouchEnd,obj[_pre+"dblclick"+id]=handler,obj.addEventListener(_touchstart,onTouchStart,!1),obj.addEventListener(_touchend,onTouchEnd,!1),obj.addEventListener("dblclick",handler,!1),this}function removeDoubleTapListener(obj,id){var touchstart=obj[_pre+_touchstart+id],touchend=obj[_pre+_touchend+id],dblclick=obj[_pre+"dblclick"+id];return obj.removeEventListener(_touchstart,touchstart,!1),obj.removeEventListener(_touchend,touchend,!1),edge||obj.removeEventListener("dblclick",dblclick,!1),this}var disableTextSelection,enableTextSelection,_userSelect,_outlineElement,_outlineStyle,TRANSFORM=testProp(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),TRANSITION=testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),TRANSITION_END="webkitTransition"===TRANSITION||"OTransition"===TRANSITION?TRANSITION+"End":"transitionend";function get(id){return"string"==typeof id?document.getElementById(id):id}function getStyle(el,style){var value=el.style[style]||el.currentStyle&&el.currentStyle[style];if((!value||"auto"===value)&&document.defaultView){var css=document.defaultView.getComputedStyle(el,null);value=css?css[style]:null}return"auto"===value?null:value}function create$1(tagName,className,container){var el=document.createElement(tagName);return el.className=className||"",container&&container.appendChild(el),el}function remove(el){var parent=el.parentNode;parent&&parent.removeChild(el)}function empty(el){for(;el.firstChild;)el.removeChild(el.firstChild)}function toFront(el){var parent=el.parentNode;parent.lastChild!==el&&parent.appendChild(el)}function toBack(el){var parent=el.parentNode;parent.firstChild!==el&&parent.insertBefore(el,parent.firstChild)}function hasClass(el,name){if(void 0!==el.classList)return el.classList.contains(name);var className=getClass(el);return 0<className.length&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(className)}function addClass(el,name){if(void 0!==el.classList)for(var classes=splitWords(name),i=0,len=classes.length;i<len;i++)el.classList.add(classes[i]);else if(!hasClass(el,name)){var className=getClass(el);setClass(el,(className?className+" ":"")+name)}}function removeClass(el,name){void 0!==el.classList?el.classList.remove(name):setClass(el,trim((" "+getClass(el)+" ").replace(" "+name+" "," ")))}function setClass(el,name){void 0===el.className.baseVal?el.className=name:el.className.baseVal=name}function getClass(el){return void 0===el.className.baseVal?el.className:el.className.baseVal}function setOpacity(el,value){"opacity"in el.style?el.style.opacity=value:"filter"in el.style&&function(el,value){var filter=!1,filterName="DXImageTransform.Microsoft.Alpha";try{filter=el.filters.item(filterName)}catch(e){if(1===value)return}value=Math.round(100*value),filter?(filter.Enabled=100!==value,filter.Opacity=value):el.style.filter+=" progid:"+filterName+"(opacity="+value+")"}(el,value)}function testProp(props){for(var style=document.documentElement.style,i=0;i<props.length;i++)if(props[i]in style)return props[i];return!1}function setTransform(el,offset,scale){var pos=offset||new Point(0,0);el.style[TRANSFORM]=(ie3d?"translate("+pos.x+"px,"+pos.y+"px)":"translate3d("+pos.x+"px,"+pos.y+"px,0)")+(scale?" scale("+scale+")":"")}function setPosition(el,point){el._leaflet_pos=point,any3d?setTransform(el,point):(el.style.left=point.x+"px",el.style.top=point.y+"px")}function getPosition(el){return el._leaflet_pos||new Point(0,0)}if("onselectstart"in document)disableTextSelection=function(){on(window,"selectstart",preventDefault)},enableTextSelection=function(){off(window,"selectstart",preventDefault)};else{var userSelectProperty=testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);disableTextSelection=function(){if(userSelectProperty){var style=document.documentElement.style;_userSelect=style[userSelectProperty],style[userSelectProperty]="none"}},enableTextSelection=function(){userSelectProperty&&(document.documentElement.style[userSelectProperty]=_userSelect,_userSelect=void 0)}}function disableImageDrag(){on(window,"dragstart",preventDefault)}function enableImageDrag(){off(window,"dragstart",preventDefault)}function preventOutline(element){for(;-1===element.tabIndex;)element=element.parentNode;element.style&&(restoreOutline(),_outlineStyle=(_outlineElement=element).style.outline,element.style.outline="none",on(window,"keydown",restoreOutline))}function restoreOutline(){_outlineElement&&(_outlineElement.style.outline=_outlineStyle,_outlineStyle=_outlineElement=void 0,off(window,"keydown",restoreOutline))}function getSizedParentNode(element){for(;!((element=element.parentNode).offsetWidth&&element.offsetHeight||element===document.body););return element}function getScale(element){var rect=element.getBoundingClientRect();return{x:rect.width/element.offsetWidth||1,y:rect.height/element.offsetHeight||1,boundingClientRect:rect}}var DomUtil=(Object.freeze||Object)({TRANSFORM:TRANSFORM,TRANSITION:TRANSITION,TRANSITION_END:TRANSITION_END,get:get,getStyle:getStyle,create:create$1,remove:remove,empty:empty,toFront:toFront,toBack:toBack,hasClass:hasClass,addClass:addClass,removeClass:removeClass,setClass:setClass,getClass:getClass,setOpacity:setOpacity,testProp:testProp,setTransform:setTransform,setPosition:setPosition,getPosition:getPosition,disableTextSelection:disableTextSelection,enableTextSelection:enableTextSelection,disableImageDrag:disableImageDrag,enableImageDrag:enableImageDrag,preventOutline:preventOutline,restoreOutline:restoreOutline,getSizedParentNode:getSizedParentNode,getScale:getScale});function on(obj,types,fn,context){if("object"==typeof types)for(var type in types)addOne(obj,type,types[type],fn);else{types=splitWords(types);for(var i=0,len=types.length;i<len;i++)addOne(obj,types[i],fn,context)}return this}var eventsKey="_leaflet_events";function off(obj,types,fn,context){if("object"==typeof types)for(var type in types)removeOne(obj,type,types[type],fn);else if(types){types=splitWords(types);for(var i=0,len=types.length;i<len;i++)removeOne(obj,types[i],fn,context)}else{for(var j in obj[eventsKey])removeOne(obj,j,obj[eventsKey][j]);delete obj[eventsKey]}return this}function addOne(obj,type,fn,context){var id=type+stamp(fn)+(context?"_"+stamp(context):"");if(obj[eventsKey]&&obj[eventsKey][id])return this;var handler=function(e){return fn.call(context||obj,e||window.event)},originalHandler=handler;pointer&&0===type.indexOf("touch")?addPointerListener(obj,type,handler,id):!touch||"dblclick"!==type||pointer&&chrome?"addEventListener"in obj?"mousewheel"===type?obj.addEventListener("onwheel"in obj?"wheel":"mousewheel",handler,!1):"mouseenter"===type||"mouseleave"===type?(handler=function(e){e=e||window.event,isExternalTarget(obj,e)&&originalHandler(e)},obj.addEventListener("mouseenter"===type?"mouseover":"mouseout",handler,!1)):("click"===type&&android&&(handler=function(e){!function(e,handler){var timeStamp=e.timeStamp||e.originalEvent&&e.originalEvent.timeStamp,elapsed=lastClick&&timeStamp-lastClick;if(elapsed&&100<elapsed&&elapsed<500||e.target._simulatedClick&&!e._simulated)return stop(e);lastClick=timeStamp,handler(e)}(e,originalHandler)}),obj.addEventListener(type,handler,!1)):"attachEvent"in obj&&obj.attachEvent("on"+type,handler):addDoubleTapListener(obj,handler,id),obj[eventsKey]=obj[eventsKey]||{},obj[eventsKey][id]=handler}function removeOne(obj,type,fn,context){var id=type+stamp(fn)+(context?"_"+stamp(context):""),handler=obj[eventsKey]&&obj[eventsKey][id];if(!handler)return this;pointer&&0===type.indexOf("touch")?function(obj,type,id){var handler=obj["_leaflet_"+type+id];"touchstart"===type?obj.removeEventListener(POINTER_DOWN,handler,!1):"touchmove"===type?obj.removeEventListener(POINTER_MOVE,handler,!1):"touchend"===type&&(obj.removeEventListener(POINTER_UP,handler,!1),obj.removeEventListener(POINTER_CANCEL,handler,!1))}(obj,type,id):!touch||"dblclick"!==type||pointer&&chrome?"removeEventListener"in obj?"mousewheel"===type?obj.removeEventListener("onwheel"in obj?"wheel":"mousewheel",handler,!1):obj.removeEventListener("mouseenter"===type?"mouseover":"mouseleave"===type?"mouseout":type,handler,!1):"detachEvent"in obj&&obj.detachEvent("on"+type,handler):removeDoubleTapListener(obj,id),obj[eventsKey][id]=null}function stopPropagation(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,skipped(e),this}function disableScrollPropagation(el){return addOne(el,"mousewheel",stopPropagation),this}function disableClickPropagation(el){return on(el,"mousedown touchstart dblclick",stopPropagation),addOne(el,"click",fakeStop),this}function preventDefault(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function stop(e){return preventDefault(e),stopPropagation(e),this}function getMousePosition(e,container){if(!container)return new Point(e.clientX,e.clientY);var scale=getScale(container),offset=scale.boundingClientRect;return new Point((e.clientX-offset.left)/scale.x-container.clientLeft,(e.clientY-offset.top)/scale.y-container.clientTop)}var wheelPxFactor=win&&chrome?2*window.devicePixelRatio:gecko?window.devicePixelRatio:1;function getWheelDelta(e){return edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/wheelPxFactor:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}var lastClick,skipEvents={};function fakeStop(e){skipEvents[e.type]=!0}function skipped(e){var events=skipEvents[e.type];return skipEvents[e.type]=!1,events}function isExternalTarget(el,e){var related=e.relatedTarget;if(!related)return!0;try{for(;related&&related!==el;)related=related.parentNode}catch(err){return!1}return related!==el}var DomEvent=(Object.freeze||Object)({on:on,off:off,stopPropagation:stopPropagation,disableScrollPropagation:disableScrollPropagation,disableClickPropagation:disableClickPropagation,preventDefault:preventDefault,stop:stop,getMousePosition:getMousePosition,getWheelDelta:getWheelDelta,fakeStop:fakeStop,skipped:skipped,isExternalTarget:isExternalTarget,addListener:on,removeListener:off}),PosAnimation=Evented.extend({run:function(el,newPos,duration,easeLinearity){this.stop(),this._el=el,this._inProgress=!0,this._duration=duration||.25,this._easeOutPower=1/Math.max(easeLinearity||.5,.2),this._startPos=getPosition(el),this._offset=newPos.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=requestAnimFrame(this._animate,this),this._step()},_step:function(round){var elapsed=+new Date-this._startTime,duration=1e3*this._duration;elapsed<duration?this._runFrame(this._easeOut(elapsed/duration),round):(this._runFrame(1),this._complete())},_runFrame:function(progress,round){var pos=this._startPos.add(this._offset.multiplyBy(progress));round&&pos._round(),setPosition(this._el,pos),this.fire("step")},_complete:function(){cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Map=Evented.extend({options:{crs:EPSG3857,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(id,options){options=setOptions(this,options),this._initContainer(id),this._initLayout(),this._onResize=bind(this._onResize,this),this._initEvents(),options.maxBounds&&this.setMaxBounds(options.maxBounds),void 0!==options.zoom&&(this._zoom=this._limitZoom(options.zoom)),options.center&&void 0!==options.zoom&&this.setView(toLatLng(options.center),options.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._zoomAnimated=TRANSITION&&any3d&&!mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),on(this._proxy,TRANSITION_END,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(center,zoom,options){if(zoom=void 0===zoom?this._zoom:this._limitZoom(zoom),center=this._limitCenter(toLatLng(center),zoom,this.options.maxBounds),options=options||{},this._stop(),this._loaded&&!options.reset&&!0!==options){void 0!==options.animate&&(options.zoom=extend({animate:options.animate},options.zoom),options.pan=extend({animate:options.animate,duration:options.duration},options.pan));var moved=this._zoom!==zoom?this._tryAnimatedZoom&&this._tryAnimatedZoom(center,zoom,options.zoom):this._tryAnimatedPan(center,options.pan);if(moved)return clearTimeout(this._sizeTimer),this}return this._resetView(center,zoom),this},setZoom:function(zoom,options){return this._loaded?this.setView(this.getCenter(),zoom,{zoom:options}):(this._zoom=zoom,this)},zoomIn:function(delta,options){return delta=delta||(any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+delta,options)},zoomOut:function(delta,options){return delta=delta||(any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-delta,options)},setZoomAround:function(latlng,zoom,options){var scale=this.getZoomScale(zoom),viewHalf=this.getSize().divideBy(2),containerPoint=latlng instanceof Point?latlng:this.latLngToContainerPoint(latlng),centerOffset=containerPoint.subtract(viewHalf).multiplyBy(1-1/scale),newCenter=this.containerPointToLatLng(viewHalf.add(centerOffset));return this.setView(newCenter,zoom,{zoom:options})},_getBoundsCenterZoom:function(bounds,options){options=options||{},bounds=bounds.getBounds?bounds.getBounds():toLatLngBounds(bounds);var paddingTL=toPoint(options.paddingTopLeft||options.padding||[0,0]),paddingBR=toPoint(options.paddingBottomRight||options.padding||[0,0]),zoom=this.getBoundsZoom(bounds,!1,paddingTL.add(paddingBR));if((zoom="number"==typeof options.maxZoom?Math.min(options.maxZoom,zoom):zoom)===1/0)return{center:bounds.getCenter(),zoom:zoom};var paddingOffset=paddingBR.subtract(paddingTL).divideBy(2),swPoint=this.project(bounds.getSouthWest(),zoom),nePoint=this.project(bounds.getNorthEast(),zoom),center=this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset),zoom);return{center:center,zoom:zoom}},fitBounds:function(bounds,options){if(!(bounds=toLatLngBounds(bounds)).isValid())throw new Error("Bounds are not valid.");var target=this._getBoundsCenterZoom(bounds,options);return this.setView(target.center,target.zoom,options)},fitWorld:function(options){return this.fitBounds([[-90,-180],[90,180]],options)},panTo:function(center,options){return this.setView(center,this._zoom,{pan:options})},panBy:function(offset,options){if(offset=toPoint(offset).round(),options=options||{},!offset.x&&!offset.y)return this.fire("moveend");if(!0!==options.animate&&!this.getSize().contains(offset))return this._resetView(this.unproject(this.project(this.getCenter()).add(offset)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),options.noMoveStart||this.fire("movestart"),!1!==options.animate){addClass(this._mapPane,"leaflet-pan-anim");var newPos=this._getMapPanePos().subtract(offset).round();this._panAnim.run(this._mapPane,newPos,options.duration||.25,options.easeLinearity)}else this._rawPanBy(offset),this.fire("move").fire("moveend");return this},flyTo:function(targetCenter,targetZoom,options){if(!1===(options=options||{}).animate||!any3d)return this.setView(targetCenter,targetZoom,options);this._stop();var from=this.project(this.getCenter()),to=this.project(targetCenter),size=this.getSize(),startZoom=this._zoom;targetCenter=toLatLng(targetCenter),targetZoom=void 0===targetZoom?startZoom:targetZoom;var w0=Math.max(size.x,size.y),w1=w0*this.getZoomScale(startZoom,targetZoom),u1=to.distanceTo(from)||1,rho=1.42,rho2=rho*rho;function r(i){var s1=i?-1:1,s2=i?w1:w0,t1=w1*w1-w0*w0+s1*rho2*rho2*u1*u1,b1=2*s2*rho2*u1,b=t1/b1,sq=Math.sqrt(b*b+1)-b,log=sq<1e-9?-18:Math.log(sq);return log}function sinh(n){return(Math.exp(n)-Math.exp(-n))/2}function cosh(n){return(Math.exp(n)+Math.exp(-n))/2}var r0=r(0);function w(s){return w0*(cosh(r0)/cosh(r0+rho*s))}function u(s){return w0*(cosh(r0)*function(n){return sinh(n)/cosh(n)}(r0+rho*s)-sinh(r0))/rho2}function easeOut(t){return 1-Math.pow(1-t,1.5)}var start=Date.now(),S=(r(1)-r0)/rho,duration=options.duration?1e3*options.duration:1e3*S*.8;return this._moveStart(!0,options.noMoveStart),function frame(){var t=(Date.now()-start)/duration,s=easeOut(t)*S;t<=1?(this._flyToFrame=requestAnimFrame(frame,this),this._move(this.unproject(from.add(to.subtract(from).multiplyBy(u(s)/u1)),startZoom),this.getScaleZoom(w0/w(s),startZoom),{flyTo:!0})):this._move(targetCenter,targetZoom)._moveEnd(!0)}.call(this),this},flyToBounds:function(bounds,options){var target=this._getBoundsCenterZoom(bounds,options);return this.flyTo(target.center,target.zoom,options)},setMaxBounds:function(bounds){return(bounds=toLatLngBounds(bounds)).isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=bounds,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(zoom){var oldZoom=this.options.minZoom;return this.options.minZoom=zoom,this._loaded&&oldZoom!==zoom&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(zoom):this},setMaxZoom:function(zoom){var oldZoom=this.options.maxZoom;return this.options.maxZoom=zoom,this._loaded&&oldZoom!==zoom&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(zoom):this},panInsideBounds:function(bounds,options){this._enforcingBounds=!0;var center=this.getCenter(),newCenter=this._limitCenter(center,this._zoom,toLatLngBounds(bounds));return center.equals(newCenter)||this.panTo(newCenter,options),this._enforcingBounds=!1,this},invalidateSize:function(options){if(!this._loaded)return this;options=extend({animate:!1,pan:!0},!0===options?{animate:!0}:options);var oldSize=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var newSize=this.getSize(),oldCenter=oldSize.divideBy(2).round(),newCenter=newSize.divideBy(2).round(),offset=oldCenter.subtract(newCenter);return offset.x||offset.y?(options.animate&&options.pan?this.panBy(offset):(options.pan&&this._rawPanBy(offset),this.fire("move"),options.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:oldSize,newSize:newSize})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(options){if(options=this._locateOptions=extend({timeout:1e4,watch:!1},options),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var onResponse=bind(this._handleGeolocationResponse,this),onError=bind(this._handleGeolocationError,this);return options.watch?this._locationWatchId=navigator.geolocation.watchPosition(onResponse,onError,options):navigator.geolocation.getCurrentPosition(onResponse,onError,options),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(error){var c=error.code,message=error.message||(1===c?"permission denied":2===c?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:c,message:"Geolocation error: "+message+"."})},_handleGeolocationResponse:function(pos){var lat=pos.coords.latitude,lng=pos.coords.longitude,latlng=new LatLng(lat,lng),bounds=latlng.toBounds(2*pos.coords.accuracy),options=this._locateOptions;if(options.setView){var zoom=this.getBoundsZoom(bounds);this.setView(latlng,options.maxZoom?Math.min(zoom,options.maxZoom):zoom)}var data={latlng:latlng,bounds:bounds,timestamp:pos.timestamp};for(var i in pos.coords)"number"==typeof pos.coords[i]&&(data[i]=pos.coords[i]);this.fire("locationfound",data)},addHandler:function(name,HandlerClass){if(!HandlerClass)return this;var handler=this[name]=new HandlerClass(this);return this._handlers.push(handler),this.options[name]&&handler.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(e){this._container._leaflet_id=void 0,this._containerId=void 0}var i;for(i in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),remove(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(cancelAnimFrame(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[i].remove();for(i in this._panes)remove(this._panes[i]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(name,container){var className="leaflet-pane"+(name?" leaflet-"+name.replace("Pane","")+"-pane":""),pane=create$1("div",className,container||this._mapPane);return name&&(this._panes[name]=pane),pane},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var bounds=this.getPixelBounds(),sw=this.unproject(bounds.getBottomLeft()),ne=this.unproject(bounds.getTopRight());return new LatLngBounds(sw,ne)},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(bounds,inside,padding){bounds=toLatLngBounds(bounds),padding=toPoint(padding||[0,0]);var zoom=this.getZoom()||0,min=this.getMinZoom(),max=this.getMaxZoom(),nw=bounds.getNorthWest(),se=bounds.getSouthEast(),size=this.getSize().subtract(padding),boundsSize=toBounds(this.project(se,zoom),this.project(nw,zoom)).getSize(),snap=any3d?this.options.zoomSnap:1,scalex=size.x/boundsSize.x,scaley=size.y/boundsSize.y,scale=inside?Math.max(scalex,scaley):Math.min(scalex,scaley);return zoom=this.getScaleZoom(scale,zoom),snap&&(zoom=Math.round(zoom/(snap/100))*(snap/100),zoom=inside?Math.ceil(zoom/snap)*snap:Math.floor(zoom/snap)*snap),Math.max(min,Math.min(max,zoom))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new Point(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(center,zoom){var topLeftPoint=this._getTopLeftPoint(center,zoom);return new Bounds(topLeftPoint,topLeftPoint.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(zoom){return this.options.crs.getProjectedBounds(void 0===zoom?this.getZoom():zoom)},getPane:function(pane){return"string"==typeof pane?this._panes[pane]:pane},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(toZoom,fromZoom){var crs=this.options.crs;return fromZoom=void 0===fromZoom?this._zoom:fromZoom,crs.scale(toZoom)/crs.scale(fromZoom)},getScaleZoom:function(scale,fromZoom){var crs=this.options.crs;fromZoom=void 0===fromZoom?this._zoom:fromZoom;var zoom=crs.zoom(scale*crs.scale(fromZoom));return isNaN(zoom)?1/0:zoom},project:function(latlng,zoom){return zoom=void 0===zoom?this._zoom:zoom,this.options.crs.latLngToPoint(toLatLng(latlng),zoom)},unproject:function(point,zoom){return zoom=void 0===zoom?this._zoom:zoom,this.options.crs.pointToLatLng(toPoint(point),zoom)},layerPointToLatLng:function(point){var projectedPoint=toPoint(point).add(this.getPixelOrigin());return this.unproject(projectedPoint)},latLngToLayerPoint:function(latlng){var projectedPoint=this.project(toLatLng(latlng))._round();return projectedPoint._subtract(this.getPixelOrigin())},wrapLatLng:function(latlng){return this.options.crs.wrapLatLng(toLatLng(latlng))},wrapLatLngBounds:function(latlng){return this.options.crs.wrapLatLngBounds(toLatLngBounds(latlng))},distance:function(latlng1,latlng2){return this.options.crs.distance(toLatLng(latlng1),toLatLng(latlng2))},containerPointToLayerPoint:function(point){return toPoint(point).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(point){return toPoint(point).add(this._getMapPanePos())},containerPointToLatLng:function(point){var layerPoint=this.containerPointToLayerPoint(toPoint(point));return this.layerPointToLatLng(layerPoint)},latLngToContainerPoint:function(latlng){return this.layerPointToContainerPoint(this.latLngToLayerPoint(toLatLng(latlng)))},mouseEventToContainerPoint:function(e){return getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(id){var container=this._container=get(id);if(!container)throw new Error("Map container not found.");if(container._leaflet_id)throw new Error("Map container is already initialized.");on(container,"scroll",this._onScroll,this),this._containerId=stamp(container)},_initLayout:function(){var container=this._container;this._fadeAnimated=this.options.fadeAnimation&&any3d,addClass(container,"leaflet-container"+(touch?" leaflet-touch":"")+(retina?" leaflet-retina":"")+(ielt9?" leaflet-oldie":"")+(safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var position=getStyle(container,"position");"absolute"!==position&&"relative"!==position&&"fixed"!==position&&(container.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var panes=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),setPosition(this._mapPane,new Point(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(addClass(panes.markerPane,"leaflet-zoom-hide"),addClass(panes.shadowPane,"leaflet-zoom-hide"))},_resetView:function(center,zoom){setPosition(this._mapPane,new Point(0,0));var loading=!this._loaded;this._loaded=!0,zoom=this._limitZoom(zoom),this.fire("viewprereset");var zoomChanged=this._zoom!==zoom;this._moveStart(zoomChanged,!1)._move(center,zoom)._moveEnd(zoomChanged),this.fire("viewreset"),loading&&this.fire("load")},_moveStart:function(zoomChanged,noMoveStart){return zoomChanged&&this.fire("zoomstart"),noMoveStart||this.fire("movestart"),this},_move:function(center,zoom,data){void 0===zoom&&(zoom=this._zoom);var zoomChanged=this._zoom!==zoom;return this._zoom=zoom,this._lastCenter=center,this._pixelOrigin=this._getNewPixelOrigin(center),(zoomChanged||data&&data.pinch)&&this.fire("zoom",data),this.fire("move",data)},_moveEnd:function(zoomChanged){return zoomChanged&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return cancelAnimFrame(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(offset){setPosition(this._mapPane,this._getMapPanePos().subtract(offset))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(remove$$1){this._targets={},this._targets[stamp(this._container)]=this;var onOff=remove$$1?off:on;onOff(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&onOff(window,"resize",this._onResize,this),any3d&&this.options.transform3DLimit&&(remove$$1?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){cancelAnimFrame(this._resizeRequest),this._resizeRequest=requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var pos=this._getMapPanePos();Math.max(Math.abs(pos.x),Math.abs(pos.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,type){for(var target,targets=[],isHover="mouseout"===type||"mouseover"===type,src=e.target||e.srcElement,dragging=!1;src;){if((target=this._targets[stamp(src)])&&("click"===type||"preclick"===type)&&!e._simulated&&this._draggableMoved(target)){dragging=!0;break}if(target&&target.listens(type,!0)){if(isHover&&!isExternalTarget(src,e))break;if(targets.push(target),isHover)break}if(src===this._container)break;src=src.parentNode}return targets.length||dragging||isHover||!isExternalTarget(src,e)||(targets=[this]),targets},_handleDOMEvent:function(e){if(this._loaded&&!skipped(e)){var type=e.type;"mousedown"!==type&&"keypress"!==type||preventOutline(e.target||e.srcElement),this._fireDOMEvent(e,type)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,type,targets){if("click"===e.type){var synth=extend({},e);synth.type="preclick",this._fireDOMEvent(synth,synth.type,targets)}if(!e._stopped&&(targets=(targets||[]).concat(this._findEventTargets(e,type))).length){var target=targets[0];"contextmenu"===type&&target.listens(type,!0)&&preventDefault(e);var data={originalEvent:e};if("keypress"!==e.type){var isMarker=target.getLatLng&&(!target._radius||target._radius<=10);data.containerPoint=isMarker?this.latLngToContainerPoint(target.getLatLng()):this.mouseEventToContainerPoint(e),data.layerPoint=this.containerPointToLayerPoint(data.containerPoint),data.latlng=isMarker?target.getLatLng():this.layerPointToLatLng(data.layerPoint)}for(var i=0;i<targets.length;i++)if(targets[i].fire(type,data,!0),data.originalEvent._stopped||!1===targets[i].options.bubblingMouseEvents&&-1!==indexOf(this._mouseEvents,type))return}},_draggableMoved:function(obj){return(obj=obj.dragging&&obj.dragging.enabled()?obj:this).dragging&&obj.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var i=0,len=this._handlers.length;i<len;i++)this._handlers[i].disable()},whenReady:function(callback,context){return this._loaded?callback.call(context||this,{target:this}):this.on("load",callback,context),this},_getMapPanePos:function(){return getPosition(this._mapPane)||new Point(0,0)},_moved:function(){var pos=this._getMapPanePos();return pos&&!pos.equals([0,0])},_getTopLeftPoint:function(center,zoom){var pixelOrigin=center&&void 0!==zoom?this._getNewPixelOrigin(center,zoom):this.getPixelOrigin();return pixelOrigin.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(center,zoom){var viewHalf=this.getSize()._divideBy(2);return this.project(center,zoom)._subtract(viewHalf)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(latlng,zoom,center){var topLeft=this._getNewPixelOrigin(center,zoom);return this.project(latlng,zoom)._subtract(topLeft)},_latLngBoundsToNewLayerBounds:function(latLngBounds,zoom,center){var topLeft=this._getNewPixelOrigin(center,zoom);return toBounds([this.project(latLngBounds.getSouthWest(),zoom)._subtract(topLeft),this.project(latLngBounds.getNorthWest(),zoom)._subtract(topLeft),this.project(latLngBounds.getSouthEast(),zoom)._subtract(topLeft),this.project(latLngBounds.getNorthEast(),zoom)._subtract(topLeft)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(latlng){return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint())},_limitCenter:function(center,zoom,bounds){if(!bounds)return center;var centerPoint=this.project(center,zoom),viewHalf=this.getSize().divideBy(2),viewBounds=new Bounds(centerPoint.subtract(viewHalf),centerPoint.add(viewHalf)),offset=this._getBoundsOffset(viewBounds,bounds,zoom);return offset.round().equals([0,0])?center:this.unproject(centerPoint.add(offset),zoom)},_limitOffset:function(offset,bounds){if(!bounds)return offset;var viewBounds=this.getPixelBounds(),newBounds=new Bounds(viewBounds.min.add(offset),viewBounds.max.add(offset));return offset.add(this._getBoundsOffset(newBounds,bounds))},_getBoundsOffset:function(pxBounds,maxBounds,zoom){var projectedMaxBounds=toBounds(this.project(maxBounds.getNorthEast(),zoom),this.project(maxBounds.getSouthWest(),zoom)),minOffset=projectedMaxBounds.min.subtract(pxBounds.min),maxOffset=projectedMaxBounds.max.subtract(pxBounds.max),dx=this._rebound(minOffset.x,-maxOffset.x),dy=this._rebound(minOffset.y,-maxOffset.y);return new Point(dx,dy)},_rebound:function(left,right){return 0<left+right?Math.round(left-right)/2:Math.max(0,Math.ceil(left))-Math.max(0,Math.floor(right))},_limitZoom:function(zoom){var min=this.getMinZoom(),max=this.getMaxZoom(),snap=any3d?this.options.zoomSnap:1;return snap&&(zoom=Math.round(zoom/snap)*snap),Math.max(min,Math.min(max,zoom))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(center,options){var offset=this._getCenterOffset(center)._trunc();return!(!0!==(options&&options.animate)&&!this.getSize().contains(offset))&&(this.panBy(offset,options),!0)},_createAnimProxy:function(){var proxy=this._proxy=create$1("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(proxy),this.on("zoomanim",function(e){var prop=TRANSFORM,transform=this._proxy.style[prop];setTransform(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),transform===this._proxy.style[prop]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var c=this.getCenter(),z=this.getZoom();setTransform(this._proxy,this.project(c,z),this.getZoomScale(z,1))},this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){remove(this._proxy),delete this._proxy},_catchTransitionEnd:function(e){this._animatingZoom&&0<=e.propertyName.indexOf("transform")&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(center,zoom,options){if(this._animatingZoom)return!0;if(options=options||{},!this._zoomAnimated||!1===options.animate||this._nothingToAnimate()||Math.abs(zoom-this._zoom)>this.options.zoomAnimationThreshold)return!1;var scale=this.getZoomScale(zoom),offset=this._getCenterOffset(center)._divideBy(1-1/scale);return!(!0!==options.animate&&!this.getSize().contains(offset))&&(requestAnimFrame(function(){this._moveStart(!0,!1)._animateZoom(center,zoom,!0)},this),!0)},_animateZoom:function(center,zoom,startAnim,noUpdate){this._mapPane&&(startAnim&&(this._animatingZoom=!0,this._animateToCenter=center,this._animateToZoom=zoom,addClass(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:center,zoom:zoom,noUpdate:noUpdate}),setTimeout(bind(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&removeClass(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),requestAnimFrame(function(){this._moveEnd(!0)},this))}});var Control=Class.extend({options:{position:"topright"},initialize:function(options){setOptions(this,options)},getPosition:function(){return this.options.position},setPosition:function(position){var map=this._map;return map&&map.removeControl(this),this.options.position=position,map&&map.addControl(this),this},getContainer:function(){return this._container},addTo:function(map){this.remove(),this._map=map;var container=this._container=this.onAdd(map),pos=this.getPosition(),corner=map._controlCorners[pos];return addClass(container,"leaflet-control"),-1!==pos.indexOf("bottom")?corner.insertBefore(container,corner.firstChild):corner.appendChild(container),this},remove:function(){return this._map&&(remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null),this},_refocusOnMap:function(e){this._map&&e&&0<e.screenX&&0<e.screenY&&this._map.getContainer().focus()}}),control=function(options){return new Control(options)};Map.include({addControl:function(control){return control.addTo(this),this},removeControl:function(control){return control.remove(),this},_initControlPos:function(){var corners=this._controlCorners={},l="leaflet-",container=this._controlContainer=create$1("div",l+"control-container",this._container);function createCorner(vSide,hSide){var className=l+vSide+" "+l+hSide;corners[vSide+hSide]=create$1("div",className,container)}createCorner("top","left"),createCorner("top","right"),createCorner("bottom","left"),createCorner("bottom","right")},_clearControlPos:function(){for(var i in this._controlCorners)remove(this._controlCorners[i]);remove(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Layers=Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(layerA,layerB,nameA,nameB){return nameA<nameB?-1:nameB<nameA?1:0}},initialize:function(baseLayers,overlays,options){for(var i in setOptions(this,options),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,baseLayers)this._addLayer(baseLayers[i],i);for(i in overlays)this._addLayer(overlays[i],i,!0)},onAdd:function(map){this._initLayout(),this._update(),(this._map=map).on("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(map){return Control.prototype.addTo.call(this,map),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var i=0;i<this._layers.length;i++)this._layers[i].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(layer,name){return this._addLayer(layer,name),this._map?this._update():this},addOverlay:function(layer,name){return this._addLayer(layer,name,!0),this._map?this._update():this},removeLayer:function(layer){layer.off("add remove",this._onLayerChange,this);var obj=this._getLayer(stamp(layer));return obj&&this._layers.splice(this._layers.indexOf(obj),1),this._map?this._update():this},expand:function(){addClass(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var acceptableHeight=this._map.getSize().y-(this._container.offsetTop+50);return acceptableHeight<this._form.clientHeight?(addClass(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=acceptableHeight+"px"):removeClass(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return removeClass(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var className="leaflet-control-layers",container=this._container=create$1("div",className),collapsed=this.options.collapsed;container.setAttribute("aria-haspopup",!0),disableClickPropagation(container),disableScrollPropagation(container);var form=this._form=create$1("form",className+"-list");collapsed&&(this._map.on("click",this.collapse,this),android||on(container,{mouseenter:this.expand,mouseleave:this.collapse},this));var link=this._layersLink=create$1("a",className+"-toggle",container);link.href="#",link.title="Layers",touch?(on(link,"click",stop),on(link,"click",this.expand,this)):on(link,"focus",this.expand,this),collapsed||this.expand(),this._baseLayersList=create$1("div",className+"-base",form),this._separator=create$1("div",className+"-separator",form),this._overlaysList=create$1("div",className+"-overlays",form),container.appendChild(form)},_getLayer:function(id){for(var i=0;i<this._layers.length;i++)if(this._layers[i]&&stamp(this._layers[i].layer)===id)return this._layers[i]},_addLayer:function(layer,name,overlay){this._map&&layer.on("add remove",this._onLayerChange,this),this._layers.push({layer:layer,name:name,overlay:overlay}),this.options.sortLayers&&this._layers.sort(bind(function(a,b){return this.options.sortFunction(a.layer,b.layer,a.name,b.name)},this)),this.options.autoZIndex&&layer.setZIndex&&(this._lastZIndex++,layer.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;empty(this._baseLayersList),empty(this._overlaysList),this._layerControlInputs=[];var baseLayersPresent,overlaysPresent,i,obj,baseLayersCount=0;for(i=0;i<this._layers.length;i++)obj=this._layers[i],this._addItem(obj),overlaysPresent=overlaysPresent||obj.overlay,baseLayersPresent=baseLayersPresent||!obj.overlay,baseLayersCount+=obj.overlay?0:1;return this.options.hideSingleBase&&(baseLayersPresent=baseLayersPresent&&1<baseLayersCount,this._baseLayersList.style.display=baseLayersPresent?"":"none"),this._separator.style.display=overlaysPresent&&baseLayersPresent?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var obj=this._getLayer(stamp(e.target)),type=obj.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;type&&this._map.fire(type,obj)},_createRadioElement:function(name,checked){var radioHtml='<input type="radio" class="leaflet-control-layers-selector" name="'+name+'"'+(checked?' checked="checked"':"")+"/>",radioFragment=document.createElement("div");return radioFragment.innerHTML=radioHtml,radioFragment.firstChild},_addItem:function(obj){var input,label=document.createElement("label"),checked=this._map.hasLayer(obj.layer);obj.overlay?((input=document.createElement("input")).type="checkbox",input.className="leaflet-control-layers-selector",input.defaultChecked=checked):input=this._createRadioElement("leaflet-base-layers",checked),this._layerControlInputs.push(input),input.layerId=stamp(obj.layer),on(input,"click",this._onInputClick,this);var name=document.createElement("span");name.innerHTML=" "+obj.name;var holder=document.createElement("div");label.appendChild(holder),holder.appendChild(input),holder.appendChild(name);var container=obj.overlay?this._overlaysList:this._baseLayersList;return container.appendChild(label),this._checkDisabledLayers(),label},_onInputClick:function(){var input,layer,inputs=this._layerControlInputs,addedLayers=[],removedLayers=[];this._handlingClick=!0;for(var i=inputs.length-1;0<=i;i--)input=inputs[i],layer=this._getLayer(input.layerId).layer,input.checked?addedLayers.push(layer):input.checked||removedLayers.push(layer);for(i=0;i<removedLayers.length;i++)this._map.hasLayer(removedLayers[i])&&this._map.removeLayer(removedLayers[i]);for(i=0;i<addedLayers.length;i++)this._map.hasLayer(addedLayers[i])||this._map.addLayer(addedLayers[i]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var input,layer,inputs=this._layerControlInputs,zoom=this._map.getZoom(),i=inputs.length-1;0<=i;i--)input=inputs[i],layer=this._getLayer(input.layerId).layer,input.disabled=void 0!==layer.options.minZoom&&zoom<layer.options.minZoom||void 0!==layer.options.maxZoom&&zoom>layer.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),Zoom=Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(map){var zoomName="leaflet-control-zoom",container=create$1("div",zoomName+" leaflet-bar"),options=this.options;return this._zoomInButton=this._createButton(options.zoomInText,options.zoomInTitle,zoomName+"-in",container,this._zoomIn),this._zoomOutButton=this._createButton(options.zoomOutText,options.zoomOutTitle,zoomName+"-out",container,this._zoomOut),this._updateDisabled(),map.on("zoomend zoomlevelschange",this._updateDisabled,this),container},onRemove:function(map){map.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(html,title,className,container,fn){var link=create$1("a",className,container);return link.innerHTML=html,link.href="#",link.title=title,link.setAttribute("role","button"),link.setAttribute("aria-label",title),disableClickPropagation(link),on(link,"click",stop),on(link,"click",fn,this),on(link,"click",this._refocusOnMap,this),link},_updateDisabled:function(){var map=this._map,className="leaflet-disabled";removeClass(this._zoomInButton,className),removeClass(this._zoomOutButton,className),!this._disabled&&map._zoom!==map.getMinZoom()||addClass(this._zoomOutButton,className),!this._disabled&&map._zoom!==map.getMaxZoom()||addClass(this._zoomInButton,className)}});Map.mergeOptions({zoomControl:!0}),Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Zoom,this.addControl(this.zoomControl))});var Scale=Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(map){var container=create$1("div","leaflet-control-scale"),options=this.options;return this._addScales(options,"leaflet-control-scale-line",container),map.on(options.updateWhenIdle?"moveend":"move",this._update,this),map.whenReady(this._update,this),container},onRemove:function(map){map.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(options,className,container){options.metric&&(this._mScale=create$1("div",className,container)),options.imperial&&(this._iScale=create$1("div",className,container))},_update:function(){var map=this._map,y=map.getSize().y/2,maxMeters=map.distance(map.containerPointToLatLng([0,y]),map.containerPointToLatLng([this.options.maxWidth,y]));this._updateScales(maxMeters)},_updateScales:function(maxMeters){this.options.metric&&maxMeters&&this._updateMetric(maxMeters),this.options.imperial&&maxMeters&&this._updateImperial(maxMeters)},_updateMetric:function(maxMeters){var meters=this._getRoundNum(maxMeters),label=meters<1e3?meters+" m":meters/1e3+" km";this._updateScale(this._mScale,label,meters/maxMeters)},_updateImperial:function(maxMeters){var maxMiles,miles,feet,maxFeet=3.2808399*maxMeters;5280<maxFeet?(maxMiles=maxFeet/5280,miles=this._getRoundNum(maxMiles),this._updateScale(this._iScale,miles+" mi",miles/maxMiles)):(feet=this._getRoundNum(maxFeet),this._updateScale(this._iScale,feet+" ft",feet/maxFeet))},_updateScale:function(scale,text,ratio){scale.style.width=Math.round(this.options.maxWidth*ratio)+"px",scale.innerHTML=text},_getRoundNum:function(num){var pow10=Math.pow(10,(Math.floor(num)+"").length-1),d=num/pow10;return pow10*(d=10<=d?10:5<=d?5:3<=d?3:2<=d?2:1)}}),Attribution=Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(options){setOptions(this,options),this._attributions={}},onAdd:function(map){for(var i in(map.attributionControl=this)._container=create$1("div","leaflet-control-attribution"),disableClickPropagation(this._container),map._layers)map._layers[i].getAttribution&&this.addAttribution(map._layers[i].getAttribution());return this._update(),this._container},setPrefix:function(prefix){return this.options.prefix=prefix,this._update(),this},addAttribution:function(text){return text&&(this._attributions[text]||(this._attributions[text]=0),this._attributions[text]++,this._update()),this},removeAttribution:function(text){return text&&this._attributions[text]&&(this._attributions[text]--,this._update()),this},_update:function(){if(this._map){var attribs=[];for(var i in this._attributions)this._attributions[i]&&attribs.push(i);var prefixAndAttribs=[];this.options.prefix&&prefixAndAttribs.push(this.options.prefix),attribs.length&&prefixAndAttribs.push(attribs.join(", ")),this._container.innerHTML=prefixAndAttribs.join(" | ")}}});Map.mergeOptions({attributionControl:!0}),Map.addInitHook(function(){this.options.attributionControl&&(new Attribution).addTo(this)});Control.Layers=Layers,Control.Zoom=Zoom,Control.Scale=Scale,Control.Attribution=Attribution,control.layers=function(baseLayers,overlays,options){return new Layers(baseLayers,overlays,options)},control.zoom=function(options){return new Zoom(options)},control.scale=function(options){return new Scale(options)},control.attribution=function(options){return new Attribution(options)};var Handler=Class.extend({initialize:function(map){this._map=map},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled&&(this._enabled=!1,this.removeHooks()),this},enabled:function(){return!!this._enabled}});Handler.addTo=function(map,name){return map.addHandler(name,this),this};var _lastCode,Mixin={Events:Events},START=touch?"touchstart mousedown":"mousedown",END={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Draggable=Evented.extend({options:{clickTolerance:3},initialize:function(element,dragStartTarget,preventOutline$$1,options){setOptions(this,options),this._element=element,this._dragStartTarget=dragStartTarget||element,this._preventOutline=preventOutline$$1},enable:function(){this._enabled||(on(this._dragStartTarget,START,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Draggable._dragging===this&&this.finishDrag(),off(this._dragStartTarget,START,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(!e._simulated&&this._enabled&&(this._moved=!1,!hasClass(this._element,"leaflet-zoom-anim")&&!(Draggable._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches||((Draggable._dragging=this)._preventOutline&&preventOutline(this._element),disableImageDrag(),disableTextSelection(),this._moving)))){this.fire("down");var first=e.touches?e.touches[0]:e,sizedParent=getSizedParentNode(this._element);this._startPoint=new Point(first.clientX,first.clientY),this._parentScale=getScale(sizedParent),on(document,MOVE[e.type],this._onMove,this),on(document,END[e.type],this._onUp,this)}},_onMove:function(e){if(!e._simulated&&this._enabled)if(e.touches&&1<e.touches.length)this._moved=!0;else{var first=e.touches&&1===e.touches.length?e.touches[0]:e,offset=new Point(first.clientX,first.clientY)._subtract(this._startPoint);(offset.x||offset.y)&&(Math.abs(offset.x)+Math.abs(offset.y)<this.options.clickTolerance||(offset.x/=this._parentScale.x,offset.y/=this._parentScale.y,preventDefault(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=getPosition(this._element).subtract(offset),addClass(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(offset),this._moving=!0,cancelAnimFrame(this._animRequest),this._lastEvent=e,this._animRequest=requestAnimFrame(this._updatePosition,this,!0)))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),setPosition(this._element,this._newPos),this.fire("drag",e)},_onUp:function(e){!e._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){for(var i in removeClass(document.body,"leaflet-dragging"),this._lastTarget&&(removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),MOVE)off(document,MOVE[i],this._onMove,this),off(document,END[i],this._onUp,this);enableImageDrag(),enableTextSelection(),this._moved&&this._moving&&(cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,Draggable._dragging=!1}});function simplify(points,tolerance){if(!tolerance||!points.length)return points.slice();var sqTolerance=tolerance*tolerance;return points=function(points,sqTolerance){var len=points.length,markers=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(len);markers[0]=markers[len-1]=1,function _simplifyDPStep(points,markers,sqTolerance,first,last){var index,i,sqDist,maxSqDist=0;for(i=first+1;i<=last-1;i++)sqDist=_sqClosestPointOnSegment(points[i],points[first],points[last],!0),maxSqDist<sqDist&&(index=i,maxSqDist=sqDist);sqTolerance<maxSqDist&&(markers[index]=1,_simplifyDPStep(points,markers,sqTolerance,first,index),_simplifyDPStep(points,markers,sqTolerance,index,last))}(points,markers,sqTolerance,0,len-1);var i,newPoints=[];for(i=0;i<len;i++)markers[i]&&newPoints.push(points[i]);return newPoints}(points=function(points,sqTolerance){for(var reducedPoints=[points[0]],i=1,prev=0,len=points.length;i<len;i++)p1=points[i],p2=points[prev],void 0,dx=p2.x-p1.x,dy=p2.y-p1.y,sqTolerance<dx*dx+dy*dy&&(reducedPoints.push(points[i]),prev=i);var p1,p2,dx,dy;prev<len-1&&reducedPoints.push(points[len-1]);return reducedPoints}(points,sqTolerance),sqTolerance)}function pointToSegmentDistance(p,p1,p2){return Math.sqrt(_sqClosestPointOnSegment(p,p1,p2,!0))}function clipSegment(a,b,bounds,useLastCode,round){var codeOut,p,newCode,codeA=useLastCode?_lastCode:_getBitCode(a,bounds),codeB=_getBitCode(b,bounds);for(_lastCode=codeB;;){if(!(codeA|codeB))return[a,b];if(codeA&codeB)return!1;p=_getEdgeIntersection(a,b,codeOut=codeA||codeB,bounds,round),newCode=_getBitCode(p,bounds),codeOut===codeA?(a=p,codeA=newCode):(b=p,codeB=newCode)}}function _getEdgeIntersection(a,b,code,bounds,round){var x,y,dx=b.x-a.x,dy=b.y-a.y,min=bounds.min,max=bounds.max;return 8&code?(x=a.x+dx*(max.y-a.y)/dy,y=max.y):4&code?(x=a.x+dx*(min.y-a.y)/dy,y=min.y):2&code?(x=max.x,y=a.y+dy*(max.x-a.x)/dx):1&code&&(x=min.x,y=a.y+dy*(min.x-a.x)/dx),new Point(x,y,round)}function _getBitCode(p,bounds){var code=0;return p.x<bounds.min.x?code|=1:p.x>bounds.max.x&&(code|=2),p.y<bounds.min.y?code|=4:p.y>bounds.max.y&&(code|=8),code}function _sqClosestPointOnSegment(p,p1,p2,sqDist){var t,x=p1.x,y=p1.y,dx=p2.x-x,dy=p2.y-y,dot=dx*dx+dy*dy;return 0<dot&&(1<(t=((p.x-x)*dx+(p.y-y)*dy)/dot)?(x=p2.x,y=p2.y):0<t&&(x+=dx*t,y+=dy*t)),dx=p.x-x,dy=p.y-y,sqDist?dx*dx+dy*dy:new Point(x,y)}function isFlat(latlngs){return!isArray(latlngs[0])||"object"!=typeof latlngs[0][0]&&void 0!==latlngs[0][0]}function _flat(latlngs){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),isFlat(latlngs)}var LineUtil=(Object.freeze||Object)({simplify:simplify,pointToSegmentDistance:pointToSegmentDistance,closestPointOnSegment:function(p,p1,p2){return _sqClosestPointOnSegment(p,p1,p2)},clipSegment:clipSegment,_getEdgeIntersection:_getEdgeIntersection,_getBitCode:_getBitCode,_sqClosestPointOnSegment:_sqClosestPointOnSegment,isFlat:isFlat,_flat:_flat});function clipPolygon(points,bounds,round){var clippedPoints,i,j,k,a,b,len,edge,p,edges=[1,4,2,8];for(i=0,len=points.length;i<len;i++)points[i]._code=_getBitCode(points[i],bounds);for(k=0;k<4;k++){for(edge=edges[k],clippedPoints=[],i=0,len=points.length,j=len-1;i<len;j=i++)a=points[i],b=points[j],a._code&edge?b._code&edge||((p=_getEdgeIntersection(b,a,edge,bounds,round))._code=_getBitCode(p,bounds),clippedPoints.push(p)):(b._code&edge&&((p=_getEdgeIntersection(b,a,edge,bounds,round))._code=_getBitCode(p,bounds),clippedPoints.push(p)),clippedPoints.push(a));points=clippedPoints}return points}var PolyUtil=(Object.freeze||Object)({clipPolygon:clipPolygon}),LonLat={project:function(latlng){return new Point(latlng.lng,latlng.lat)},unproject:function(point){return new LatLng(point.y,point.x)},bounds:new Bounds([-180,-90],[180,90])},Mercator={R:6378137,R_MINOR:6356752.314245179,bounds:new Bounds([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(latlng){var d=Math.PI/180,r=this.R,y=latlng.lat*d,tmp=this.R_MINOR/r,e=Math.sqrt(1-tmp*tmp),con=e*Math.sin(y),ts=Math.tan(Math.PI/4-y/2)/Math.pow((1-con)/(1+con),e/2);return y=-r*Math.log(Math.max(ts,1e-10)),new Point(latlng.lng*d*r,y)},unproject:function(point){for(var con,d=180/Math.PI,r=this.R,tmp=this.R_MINOR/r,e=Math.sqrt(1-tmp*tmp),ts=Math.exp(-point.y/r),phi=Math.PI/2-2*Math.atan(ts),i=0,dphi=.1;i<15&&1e-7<Math.abs(dphi);i++)con=e*Math.sin(phi),con=Math.pow((1-con)/(1+con),e/2),dphi=Math.PI/2-2*Math.atan(ts*con)-phi,phi+=dphi;return new LatLng(phi*d,point.x*d/r)}},index=(Object.freeze||Object)({LonLat:LonLat,Mercator:Mercator,SphericalMercator:SphericalMercator}),EPSG3395=extend({},Earth,{code:"EPSG:3395",projection:Mercator,transformation:function(){var scale=.5/(Math.PI*Mercator.R);return toTransformation(scale,.5,-scale,.5)}()}),EPSG4326=extend({},Earth,{code:"EPSG:4326",projection:LonLat,transformation:toTransformation(1/180,1,-1/180,.5)}),Simple=extend({},CRS,{projection:LonLat,transformation:toTransformation(1,0,-1,0),scale:function(zoom){return Math.pow(2,zoom)},zoom:function(scale){return Math.log(scale)/Math.LN2},distance:function(latlng1,latlng2){var dx=latlng2.lng-latlng1.lng,dy=latlng2.lat-latlng1.lat;return Math.sqrt(dx*dx+dy*dy)},infinite:!0});CRS.Earth=Earth,CRS.EPSG3395=EPSG3395,CRS.EPSG3857=EPSG3857,CRS.EPSG900913=EPSG900913,CRS.EPSG4326=EPSG4326,CRS.Simple=Simple;var Layer=Evented.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(map){return map.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(obj){return obj&&obj.removeLayer(this),this},getPane:function(name){return this._map.getPane(name?this.options[name]||name:this.options.pane)},addInteractiveTarget:function(targetEl){return this._map._targets[stamp(targetEl)]=this},removeInteractiveTarget:function(targetEl){return delete this._map._targets[stamp(targetEl)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var map=e.target;if(map.hasLayer(this)){if(this._map=map,this._zoomAnimated=map._zoomAnimated,this.getEvents){var events=this.getEvents();map.on(events,this),this.once("remove",function(){map.off(events,this)},this)}this.onAdd(map),this.getAttribution&&map.attributionControl&&map.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),map.fire("layeradd",{layer:this})}}});Map.include({addLayer:function(layer){if(!layer._layerAdd)throw new Error("The provided object is not a Layer.");var id=stamp(layer);return this._layers[id]||((this._layers[id]=layer)._mapToAdd=this,layer.beforeAdd&&layer.beforeAdd(this),this.whenReady(layer._layerAdd,layer)),this},removeLayer:function(layer){var id=stamp(layer);return this._layers[id]&&(this._loaded&&layer.onRemove(this),layer.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(layer.getAttribution()),delete this._layers[id],this._loaded&&(this.fire("layerremove",{layer:layer}),layer.fire("remove")),layer._map=layer._mapToAdd=null),this},hasLayer:function(layer){return!!layer&&stamp(layer)in this._layers},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this},_addLayers:function(layers){layers=layers?isArray(layers)?layers:[layers]:[];for(var i=0,len=layers.length;i<len;i++)this.addLayer(layers[i])},_addZoomLimit:function(layer){!isNaN(layer.options.maxZoom)&&isNaN(layer.options.minZoom)||(this._zoomBoundLayers[stamp(layer)]=layer,this._updateZoomLevels())},_removeZoomLimit:function(layer){var id=stamp(layer);this._zoomBoundLayers[id]&&(delete this._zoomBoundLayers[id],this._updateZoomLevels())},_updateZoomLevels:function(){var minZoom=1/0,maxZoom=-1/0,oldZoomSpan=this._getZoomSpan();for(var i in this._zoomBoundLayers){var options=this._zoomBoundLayers[i].options;minZoom=void 0===options.minZoom?minZoom:Math.min(minZoom,options.minZoom),maxZoom=void 0===options.maxZoom?maxZoom:Math.max(maxZoom,options.maxZoom)}this._layersMaxZoom=maxZoom===-1/0?void 0:maxZoom,this._layersMinZoom=minZoom===1/0?void 0:minZoom,oldZoomSpan!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var LayerGroup=Layer.extend({initialize:function(layers,options){var i,len;if(setOptions(this,options),this._layers={},layers)for(i=0,len=layers.length;i<len;i++)this.addLayer(layers[i])},addLayer:function(layer){var id=this.getLayerId(layer);return this._layers[id]=layer,this._map&&this._map.addLayer(layer),this},removeLayer:function(layer){var id=layer in this._layers?layer:this.getLayerId(layer);return this._map&&this._layers[id]&&this._map.removeLayer(this._layers[id]),delete this._layers[id],this},hasLayer:function(layer){return!!layer&&(layer in this._layers||this.getLayerId(layer)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(methodName){var i,layer,args=Array.prototype.slice.call(arguments,1);for(i in this._layers)(layer=this._layers[i])[methodName]&&layer[methodName].apply(layer,args);return this},onAdd:function(map){this.eachLayer(map.addLayer,map)},onRemove:function(map){this.eachLayer(map.removeLayer,map)},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this},getLayer:function(id){return this._layers[id]},getLayers:function(){var layers=[];return this.eachLayer(layers.push,layers),layers},setZIndex:function(zIndex){return this.invoke("setZIndex",zIndex)},getLayerId:function(layer){return stamp(layer)}}),FeatureGroup=LayerGroup.extend({addLayer:function(layer){return this.hasLayer(layer)?this:(layer.addEventParent(this),LayerGroup.prototype.addLayer.call(this,layer),this.fire("layeradd",{layer:layer}))},removeLayer:function(layer){return this.hasLayer(layer)?(layer in this._layers&&(layer=this._layers[layer]),layer.removeEventParent(this),LayerGroup.prototype.removeLayer.call(this,layer),this.fire("layerremove",{layer:layer})):this},setStyle:function(style){return this.invoke("setStyle",style)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var bounds=new LatLngBounds;for(var id in this._layers){var layer=this._layers[id];bounds.extend(layer.getBounds?layer.getBounds():layer.getLatLng())}return bounds}}),Icon=Class.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(options){setOptions(this,options)},createIcon:function(oldIcon){return this._createIcon("icon",oldIcon)},createShadow:function(oldIcon){return this._createIcon("shadow",oldIcon)},_createIcon:function(name,oldIcon){var src=this._getIconUrl(name);if(!src){if("icon"===name)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var img=this._createImg(src,oldIcon&&"IMG"===oldIcon.tagName?oldIcon:null);return this._setIconStyles(img,name),img},_setIconStyles:function(img,name){var options=this.options,sizeOption=options[name+"Size"];"number"==typeof sizeOption&&(sizeOption=[sizeOption,sizeOption]);var size=toPoint(sizeOption),anchor=toPoint("shadow"===name&&options.shadowAnchor||options.iconAnchor||size&&size.divideBy(2,!0));img.className="leaflet-marker-"+name+" "+(options.className||""),anchor&&(img.style.marginLeft=-anchor.x+"px",img.style.marginTop=-anchor.y+"px"),size&&(img.style.width=size.x+"px",img.style.height=size.y+"px")},_createImg:function(src,el){return(el=el||document.createElement("img")).src=src,el},_getIconUrl:function(name){return retina&&this.options[name+"RetinaUrl"]||this.options[name+"Url"]}});var IconDefault=Icon.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(name){return IconDefault.imagePath||(IconDefault.imagePath=this._detectIconPath()),(this.options.imagePath||IconDefault.imagePath)+Icon.prototype._getIconUrl.call(this,name)},_detectIconPath:function(){var el=create$1("div","leaflet-default-icon-path",document.body),path=getStyle(el,"background-image")||getStyle(el,"backgroundImage");return document.body.removeChild(el),path=null===path||0!==path.indexOf("url")?"":path.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),MarkerDrag=Handler.extend({initialize:function(marker){this._marker=marker},addHooks:function(){var icon=this._marker._icon;this._draggable||(this._draggable=new Draggable(icon,icon,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),addClass(icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var marker=this._marker,map=marker._map,speed=this._marker.options.autoPanSpeed,padding=this._marker.options.autoPanPadding,iconPos=getPosition(marker._icon),bounds=map.getPixelBounds(),origin=map.getPixelOrigin(),panBounds=toBounds(bounds.min._subtract(origin).add(padding),bounds.max._subtract(origin).subtract(padding));if(!panBounds.contains(iconPos)){var movement=toPoint((Math.max(panBounds.max.x,iconPos.x)-panBounds.max.x)/(bounds.max.x-panBounds.max.x)-(Math.min(panBounds.min.x,iconPos.x)-panBounds.min.x)/(bounds.min.x-panBounds.min.x),(Math.max(panBounds.max.y,iconPos.y)-panBounds.max.y)/(bounds.max.y-panBounds.max.y)-(Math.min(panBounds.min.y,iconPos.y)-panBounds.min.y)/(bounds.min.y-panBounds.min.y)).multiplyBy(speed);map.panBy(movement,{animate:!1}),this._draggable._newPos._add(movement),this._draggable._startPos._add(movement),setPosition(marker._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=requestAnimFrame(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(cancelAnimFrame(this._panRequest),this._panRequest=requestAnimFrame(this._adjustPan.bind(this,e)))},_onDrag:function(e){var marker=this._marker,shadow=marker._shadow,iconPos=getPosition(marker._icon),latlng=marker._map.layerPointToLatLng(iconPos);shadow&&setPosition(shadow,iconPos),marker._latlng=latlng,e.latlng=latlng,e.oldLatLng=this._oldLatLng,marker.fire("move",e).fire("drag",e)},_onDragEnd:function(e){cancelAnimFrame(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),Marker=Layer.extend({options:{icon:new IconDefault,interactive:!0,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",bubblingMouseEvents:!1,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(latlng,options){setOptions(this,options),this._latlng=toLatLng(latlng)},onAdd:function(map){this._zoomAnimated=this._zoomAnimated&&map.options.markerZoomAnimation,this._zoomAnimated&&map.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(map){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&map.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(latlng){var oldLatLng=this._latlng;return this._latlng=toLatLng(latlng),this.update(),this.fire("move",{oldLatLng:oldLatLng,latlng:this._latlng})},setZIndexOffset:function(offset){return this.options.zIndexOffset=offset,this.update()},setIcon:function(icon){return this.options.icon=icon,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var pos=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(pos)}return this},_initIcon:function(){var options=this.options,classToAdd="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),icon=options.icon.createIcon(this._icon),addIcon=!1;icon!==this._icon&&(this._icon&&this._removeIcon(),addIcon=!0,options.title&&(icon.title=options.title),"IMG"===icon.tagName&&(icon.alt=options.alt||"")),addClass(icon,classToAdd),options.keyboard&&(icon.tabIndex="0"),this._icon=icon,options.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var newShadow=options.icon.createShadow(this._shadow),addShadow=!1;newShadow!==this._shadow&&(this._removeShadow(),addShadow=!0),newShadow&&(addClass(newShadow,classToAdd),newShadow.alt=""),this._shadow=newShadow,options.opacity<1&&this._updateOpacity(),addIcon&&this.getPane().appendChild(this._icon),this._initInteraction(),newShadow&&addShadow&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),remove(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&remove(this._shadow),this._shadow=null},_setPos:function(pos){setPosition(this._icon,pos),this._shadow&&setPosition(this._shadow,pos),this._zIndex=pos.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(offset){this._icon.style.zIndex=this._zIndex+offset},_animateZoom:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center).round();this._setPos(pos)},_initInteraction:function(){if(this.options.interactive&&(addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),MarkerDrag)){var draggable=this.options.draggable;this.dragging&&(draggable=this.dragging.enabled(),this.dragging.disable()),this.dragging=new MarkerDrag(this),draggable&&this.dragging.enable()}},setOpacity:function(opacity){return this.options.opacity=opacity,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var opacity=this.options.opacity;setOpacity(this._icon,opacity),this._shadow&&setOpacity(this._shadow,opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});var Path=Layer.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(map){this._renderer=map.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(style){return setOptions(this,style),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),CircleMarker=Path.extend({options:{fill:!0,radius:10},initialize:function(latlng,options){setOptions(this,options),this._latlng=toLatLng(latlng),this._radius=this.options.radius},setLatLng:function(latlng){return this._latlng=toLatLng(latlng),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(radius){return this.options.radius=this._radius=radius,this.redraw()},getRadius:function(){return this._radius},setStyle:function(options){var radius=options&&options.radius||this._radius;return Path.prototype.setStyle.call(this,options),this.setRadius(radius),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var r=this._radius,r2=this._radiusY||r,w=this._clickTolerance(),p=[r+w,r2+w];this._pxBounds=new Bounds(this._point.subtract(p),this._point.add(p))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(p){return p.distanceTo(this._point)<=this._radius+this._clickTolerance()}});var Circle=CircleMarker.extend({initialize:function(latlng,options,legacyOptions){if("number"==typeof options&&(options=extend({},legacyOptions,{radius:options})),setOptions(this,options),this._latlng=toLatLng(latlng),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(radius){return this._mRadius=radius,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var half=[this._radius,this._radiusY||this._radius];return new LatLngBounds(this._map.layerPointToLatLng(this._point.subtract(half)),this._map.layerPointToLatLng(this._point.add(half)))},setStyle:Path.prototype.setStyle,_project:function(){var lng=this._latlng.lng,lat=this._latlng.lat,map=this._map,crs=map.options.crs;if(crs.distance===Earth.distance){var d=Math.PI/180,latR=this._mRadius/Earth.R/d,top=map.project([lat+latR,lng]),bottom=map.project([lat-latR,lng]),p=top.add(bottom).divideBy(2),lat2=map.unproject(p).lat,lngR=Math.acos((Math.cos(latR*d)-Math.sin(lat*d)*Math.sin(lat2*d))/(Math.cos(lat*d)*Math.cos(lat2*d)))/d;!isNaN(lngR)&&0!==lngR||(lngR=latR/Math.cos(Math.PI/180*lat)),this._point=p.subtract(map.getPixelOrigin()),this._radius=isNaN(lngR)?0:p.x-map.project([lat2,lng-lngR]).x,this._radiusY=p.y-top.y}else{var latlng2=crs.unproject(crs.project(this._latlng).subtract([this._mRadius,0]));this._point=map.latLngToLayerPoint(this._latlng),this._radius=this._point.x-map.latLngToLayerPoint(latlng2).x}this._updateBounds()}});var Polyline=Path.extend({options:{smoothFactor:1,noClip:!1},initialize:function(latlngs,options){setOptions(this,options),this._setLatLngs(latlngs)},getLatLngs:function(){return this._latlngs},setLatLngs:function(latlngs){return this._setLatLngs(latlngs),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(p){for(var p1,p2,minDistance=1/0,minPoint=null,closest=_sqClosestPointOnSegment,j=0,jLen=this._parts.length;j<jLen;j++)for(var points=this._parts[j],i=1,len=points.length;i<len;i++){p1=points[i-1],p2=points[i];var sqDist=closest(p,p1,p2,!0);sqDist<minDistance&&(minDistance=sqDist,minPoint=closest(p,p1,p2))}return minPoint&&(minPoint.distance=Math.sqrt(minDistance)),minPoint},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var i,halfDist,segDist,dist,p1,p2,ratio,points=this._rings[0],len=points.length;if(!len)return null;for(halfDist=i=0;i<len-1;i++)halfDist+=points[i].distanceTo(points[i+1])/2;if(0===halfDist)return this._map.layerPointToLatLng(points[0]);for(dist=i=0;i<len-1;i++)if(p1=points[i],p2=points[i+1],segDist=p1.distanceTo(p2),halfDist<(dist+=segDist))return ratio=(dist-halfDist)/segDist,this._map.layerPointToLatLng([p2.x-ratio*(p2.x-p1.x),p2.y-ratio*(p2.y-p1.y)])},getBounds:function(){return this._bounds},addLatLng:function(latlng,latlngs){return latlngs=latlngs||this._defaultShape(),latlng=toLatLng(latlng),latlngs.push(latlng),this._bounds.extend(latlng),this.redraw()},_setLatLngs:function(latlngs){this._bounds=new LatLngBounds,this._latlngs=this._convertLatLngs(latlngs)},_defaultShape:function(){return isFlat(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(latlngs){for(var result=[],flat=isFlat(latlngs),i=0,len=latlngs.length;i<len;i++)flat?(result[i]=toLatLng(latlngs[i]),this._bounds.extend(result[i])):result[i]=this._convertLatLngs(latlngs[i]);return result},_project:function(){var pxBounds=new Bounds;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,pxBounds);var w=this._clickTolerance(),p=new Point(w,w);this._bounds.isValid()&&pxBounds.isValid()&&(pxBounds.min._subtract(p),pxBounds.max._add(p),this._pxBounds=pxBounds)},_projectLatlngs:function(latlngs,result,projectedBounds){var i,ring,flat=latlngs[0]instanceof LatLng,len=latlngs.length;if(flat){for(ring=[],i=0;i<len;i++)ring[i]=this._map.latLngToLayerPoint(latlngs[i]),projectedBounds.extend(ring[i]);result.push(ring)}else for(i=0;i<len;i++)this._projectLatlngs(latlngs[i],result,projectedBounds)},_clipPoints:function(){var bounds=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(bounds))if(this.options.noClip)this._parts=this._rings;else{var i,j,k,len,len2,segment,points,parts=this._parts;for(k=i=0,len=this._rings.length;i<len;i++)for(points=this._rings[i],j=0,len2=points.length;j<len2-1;j++)(segment=clipSegment(points[j],points[j+1],bounds,j,!0))&&(parts[k]=parts[k]||[],parts[k].push(segment[0]),segment[1]===points[j+1]&&j!==len2-2||(parts[k].push(segment[1]),k++))}},_simplifyPoints:function(){for(var parts=this._parts,tolerance=this.options.smoothFactor,i=0,len=parts.length;i<len;i++)parts[i]=simplify(parts[i],tolerance)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(p,closed){var i,j,k,len,len2,part,w=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(p))return!1;for(i=0,len=this._parts.length;i<len;i++)for(part=this._parts[i],j=0,len2=part.length,k=len2-1;j<len2;k=j++)if((closed||0!==j)&&pointToSegmentDistance(p,part[k],part[j])<=w)return!0;return!1}});Polyline._flat=_flat;var Polygon=Polyline.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var i,j,p1,p2,f,area,x,y,center,points=this._rings[0],len=points.length;if(!len)return null;for(area=x=y=0,i=0,j=len-1;i<len;j=i++)p1=points[i],p2=points[j],f=p1.y*p2.x-p2.y*p1.x,x+=(p1.x+p2.x)*f,y+=(p1.y+p2.y)*f,area+=3*f;return center=0===area?points[0]:[x/area,y/area],this._map.layerPointToLatLng(center)},_convertLatLngs:function(latlngs){var result=Polyline.prototype._convertLatLngs.call(this,latlngs),len=result.length;return 2<=len&&result[0]instanceof LatLng&&result[0].equals(result[len-1])&&result.pop(),result},_setLatLngs:function(latlngs){Polyline.prototype._setLatLngs.call(this,latlngs),isFlat(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return isFlat(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var bounds=this._renderer._bounds,w=this.options.weight,p=new Point(w,w);if(bounds=new Bounds(bounds.min.subtract(p),bounds.max.add(p)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(bounds))if(this.options.noClip)this._parts=this._rings;else for(var clipped,i=0,len=this._rings.length;i<len;i++)(clipped=clipPolygon(this._rings[i],bounds,!0)).length&&this._parts.push(clipped)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(p){var part,p1,p2,i,j,k,len,len2,inside=!1;if(!this._pxBounds||!this._pxBounds.contains(p))return!1;for(i=0,len=this._parts.length;i<len;i++)for(part=this._parts[i],j=0,len2=part.length,k=len2-1;j<len2;k=j++)p1=part[j],p2=part[k],p1.y>p.y!=p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x&&(inside=!inside);return inside||Polyline.prototype._containsPoint.call(this,p,!0)}});var GeoJSON=FeatureGroup.extend({initialize:function(geojson,options){setOptions(this,options),this._layers={},geojson&&this.addData(geojson)},addData:function(geojson){var i,len,feature,features=isArray(geojson)?geojson:geojson.features;if(features){for(i=0,len=features.length;i<len;i++)((feature=features[i]).geometries||feature.geometry||feature.features||feature.coordinates)&&this.addData(feature);return this}var options=this.options;if(options.filter&&!options.filter(geojson))return this;var layer=geometryToLayer(geojson,options);return layer?(layer.feature=asFeature(geojson),layer.defaultOptions=layer.options,this.resetStyle(layer),options.onEachFeature&&options.onEachFeature(geojson,layer),this.addLayer(layer)):this},resetStyle:function(layer){return layer.options=extend({},layer.defaultOptions),this._setLayerStyle(layer,this.options.style),this},setStyle:function(style){return this.eachLayer(function(layer){this._setLayerStyle(layer,style)},this)},_setLayerStyle:function(layer,style){"function"==typeof style&&(style=style(layer.feature)),layer.setStyle&&layer.setStyle(style)}});function geometryToLayer(geojson,options){var latlng,latlngs,i,len,geometry="Feature"===geojson.type?geojson.geometry:geojson,coords=geometry?geometry.coordinates:null,layers=[],pointToLayer=options&&options.pointToLayer,_coordsToLatLng=options&&options.coordsToLatLng||coordsToLatLng;if(!coords&&!geometry)return null;switch(geometry.type){case"Point":return latlng=_coordsToLatLng(coords),pointToLayer?pointToLayer(geojson,latlng):new Marker(latlng);case"MultiPoint":for(i=0,len=coords.length;i<len;i++)latlng=_coordsToLatLng(coords[i]),layers.push(pointToLayer?pointToLayer(geojson,latlng):new Marker(latlng));return new FeatureGroup(layers);case"LineString":case"MultiLineString":return latlngs=coordsToLatLngs(coords,"LineString"===geometry.type?0:1,_coordsToLatLng),new Polyline(latlngs,options);case"Polygon":case"MultiPolygon":return latlngs=coordsToLatLngs(coords,"Polygon"===geometry.type?1:2,_coordsToLatLng),new Polygon(latlngs,options);case"GeometryCollection":for(i=0,len=geometry.geometries.length;i<len;i++){var layer=geometryToLayer({geometry:geometry.geometries[i],type:"Feature",properties:geojson.properties},options);layer&&layers.push(layer)}return new FeatureGroup(layers);default:throw new Error("Invalid GeoJSON object.")}}function coordsToLatLng(coords){return new LatLng(coords[1],coords[0],coords[2])}function coordsToLatLngs(coords,levelsDeep,_coordsToLatLng){for(var latlng,latlngs=[],i=0,len=coords.length;i<len;i++)latlng=levelsDeep?coordsToLatLngs(coords[i],levelsDeep-1,_coordsToLatLng):(_coordsToLatLng||coordsToLatLng)(coords[i]),latlngs.push(latlng);return latlngs}function latLngToCoords(latlng,precision){return precision="number"==typeof precision?precision:6,void 0!==latlng.alt?[formatNum(latlng.lng,precision),formatNum(latlng.lat,precision),formatNum(latlng.alt,precision)]:[formatNum(latlng.lng,precision),formatNum(latlng.lat,precision)]}function latLngsToCoords(latlngs,levelsDeep,closed,precision){for(var coords=[],i=0,len=latlngs.length;i<len;i++)coords.push(levelsDeep?latLngsToCoords(latlngs[i],levelsDeep-1,closed,precision):latLngToCoords(latlngs[i],precision));return!levelsDeep&&closed&&coords.push(coords[0]),coords}function getFeature(layer,newGeometry){return layer.feature?extend({},layer.feature,{geometry:newGeometry}):asFeature(newGeometry)}function asFeature(geojson){return"Feature"===geojson.type||"FeatureCollection"===geojson.type?geojson:{type:"Feature",properties:{},geometry:geojson}}var PointToGeoJSON={toGeoJSON:function(precision){return getFeature(this,{type:"Point",coordinates:latLngToCoords(this.getLatLng(),precision)})}};function geoJSON(geojson,options){return new GeoJSON(geojson,options)}Marker.include(PointToGeoJSON),Circle.include(PointToGeoJSON),CircleMarker.include(PointToGeoJSON),Polyline.include({toGeoJSON:function(precision){var multi=!isFlat(this._latlngs),coords=latLngsToCoords(this._latlngs,multi?1:0,!1,precision);return getFeature(this,{type:(multi?"Multi":"")+"LineString",coordinates:coords})}}),Polygon.include({toGeoJSON:function(precision){var holes=!isFlat(this._latlngs),multi=holes&&!isFlat(this._latlngs[0]),coords=latLngsToCoords(this._latlngs,multi?2:holes?1:0,!0,precision);return holes||(coords=[coords]),getFeature(this,{type:(multi?"Multi":"")+"Polygon",coordinates:coords})}}),LayerGroup.include({toMultiPoint:function(precision){var coords=[];return this.eachLayer(function(layer){coords.push(layer.toGeoJSON(precision).geometry.coordinates)}),getFeature(this,{type:"MultiPoint",coordinates:coords})},toGeoJSON:function(precision){var type=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===type)return this.toMultiPoint(precision);var isGeometryCollection="GeometryCollection"===type,jsons=[];return this.eachLayer(function(layer){if(layer.toGeoJSON){var json=layer.toGeoJSON(precision);if(isGeometryCollection)jsons.push(json.geometry);else{var feature=asFeature(json);"FeatureCollection"===feature.type?jsons.push.apply(jsons,feature.features):jsons.push(feature)}}}),isGeometryCollection?getFeature(this,{geometries:jsons,type:"GeometryCollection"}):{type:"FeatureCollection",features:jsons}}});var geoJson=geoJSON,ImageOverlay=Layer.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(url,bounds,options){this._url=url,this._bounds=toLatLngBounds(bounds),setOptions(this,options)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(addClass(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){remove(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(opacity){return this.options.opacity=opacity,this._image&&this._updateOpacity(),this},setStyle:function(styleOpts){return styleOpts.opacity&&this.setOpacity(styleOpts.opacity),this},bringToFront:function(){return this._map&&toFront(this._image),this},bringToBack:function(){return this._map&&toBack(this._image),this},setUrl:function(url){return this._url=url,this._image&&(this._image.src=url),this},setBounds:function(bounds){return this._bounds=toLatLngBounds(bounds),this._map&&this._reset(),this},getEvents:function(){var events={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(events.zoomanim=this._animateZoom),events},setZIndex:function(value){return this.options.zIndex=value,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var wasElementSupplied="IMG"===this._url.tagName,img=this._image=wasElementSupplied?this._url:create$1("img");addClass(img,"leaflet-image-layer"),this._zoomAnimated&&addClass(img,"leaflet-zoom-animated"),this.options.className&&addClass(img,this.options.className),img.onselectstart=falseFn,img.onmousemove=falseFn,img.onload=bind(this.fire,this,"load"),img.onerror=bind(this._overlayOnError,this,"error"),!this.options.crossOrigin&&""!==this.options.crossOrigin||(img.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),wasElementSupplied?this._url=img.src:(img.src=this._url,img.alt=this.options.alt)},_animateZoom:function(e){var scale=this._map.getZoomScale(e.zoom),offset=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;setTransform(this._image,offset,scale)},_reset:function(){var image=this._image,bounds=new Bounds(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),size=bounds.getSize();setPosition(image,bounds.min),image.style.width=size.x+"px",image.style.height=size.y+"px"},_updateOpacity:function(){setOpacity(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var errorUrl=this.options.errorOverlayUrl;errorUrl&&this._url!==errorUrl&&(this._url=errorUrl,this._image.src=errorUrl)}}),VideoOverlay=ImageOverlay.extend({options:{autoplay:!0,loop:!0},_initImage:function(){var wasElementSupplied="VIDEO"===this._url.tagName,vid=this._image=wasElementSupplied?this._url:create$1("video");if(addClass(vid,"leaflet-image-layer"),this._zoomAnimated&&addClass(vid,"leaflet-zoom-animated"),vid.onselectstart=falseFn,vid.onmousemove=falseFn,vid.onloadeddata=bind(this.fire,this,"load"),wasElementSupplied){for(var sourceElements=vid.getElementsByTagName("source"),sources=[],j=0;j<sourceElements.length;j++)sources.push(sourceElements[j].src);this._url=0<sourceElements.length?sources:[vid.src]}else{isArray(this._url)||(this._url=[this._url]),vid.autoplay=!!this.options.autoplay,vid.loop=!!this.options.loop;for(var i=0;i<this._url.length;i++){var source=create$1("source");source.src=this._url[i],vid.appendChild(source)}}}});var DivOverlay=Layer.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(options,source){setOptions(this,options),this._source=source},onAdd:function(map){this._zoomAnimated=map._zoomAnimated,this._container||this._initLayout(),map._fadeAnimated&&setOpacity(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),map._fadeAnimated&&setOpacity(this._container,1),this.bringToFront()},onRemove:function(map){map._fadeAnimated?(setOpacity(this._container,0),this._removeTimeout=setTimeout(bind(remove,void 0,this._container),200)):remove(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(latlng){return this._latlng=toLatLng(latlng),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(content){return this._content=content,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var events={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(events.zoomanim=this._animateZoom),events},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&toFront(this._container),this},bringToBack:function(){return this._map&&toBack(this._container),this},_updateContent:function(){if(this._content){var node=this._contentNode,content="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof content)node.innerHTML=content;else{for(;node.hasChildNodes();)node.removeChild(node.firstChild);node.appendChild(content)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var pos=this._map.latLngToLayerPoint(this._latlng),offset=toPoint(this.options.offset),anchor=this._getAnchor();this._zoomAnimated?setPosition(this._container,pos.add(anchor)):offset=offset.add(pos).add(anchor);var bottom=this._containerBottom=-offset.y,left=this._containerLeft=-Math.round(this._containerWidth/2)+offset.x;this._container.style.bottom=bottom+"px",this._container.style.left=left+"px"}},_getAnchor:function(){return[0,0]}}),Popup=DivOverlay.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(map){return map.openPopup(this),this},onAdd:function(map){DivOverlay.prototype.onAdd.call(this,map),map.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Path||this._source.on("preclick",stopPropagation))},onRemove:function(map){DivOverlay.prototype.onRemove.call(this,map),map.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Path||this._source.off("preclick",stopPropagation))},getEvents:function(){var events=DivOverlay.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(events.preclick=this._close),this.options.keepInView&&(events.moveend=this._adjustPan),events},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var prefix="leaflet-popup",container=this._container=create$1("div",prefix+" "+(this.options.className||"")+" leaflet-zoom-animated"),wrapper=this._wrapper=create$1("div",prefix+"-content-wrapper",container);if(this._contentNode=create$1("div",prefix+"-content",wrapper),disableClickPropagation(wrapper),disableScrollPropagation(this._contentNode),on(wrapper,"contextmenu",stopPropagation),this._tipContainer=create$1("div",prefix+"-tip-container",container),this._tip=create$1("div",prefix+"-tip",this._tipContainer),this.options.closeButton){var closeButton=this._closeButton=create$1("a",prefix+"-close-button",container);closeButton.href="#close",closeButton.innerHTML="&#215;",on(closeButton,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var container=this._contentNode,style=container.style;style.width="",style.whiteSpace="nowrap";var width=container.offsetWidth;width=Math.min(width,this.options.maxWidth),width=Math.max(width,this.options.minWidth),style.width=width+1+"px",style.whiteSpace="",style.height="";var height=container.offsetHeight,maxHeight=this.options.maxHeight;maxHeight&&maxHeight<height?(style.height=maxHeight+"px",addClass(container,"leaflet-popup-scrolled")):removeClass(container,"leaflet-popup-scrolled"),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var pos=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),anchor=this._getAnchor();setPosition(this._container,pos.add(anchor))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var map=this._map,marginBottom=parseInt(getStyle(this._container,"marginBottom"),10)||0,containerHeight=this._container.offsetHeight+marginBottom,containerWidth=this._containerWidth,layerPos=new Point(this._containerLeft,-containerHeight-this._containerBottom);layerPos._add(getPosition(this._container));var containerPos=map.layerPointToContainerPoint(layerPos),padding=toPoint(this.options.autoPanPadding),paddingTL=toPoint(this.options.autoPanPaddingTopLeft||padding),paddingBR=toPoint(this.options.autoPanPaddingBottomRight||padding),size=map.getSize(),dx=0,dy=0;containerPos.x+containerWidth+paddingBR.x>size.x&&(dx=containerPos.x+containerWidth-size.x+paddingBR.x),containerPos.x-dx-paddingTL.x<0&&(dx=containerPos.x-paddingTL.x),containerPos.y+containerHeight+paddingBR.y>size.y&&(dy=containerPos.y+containerHeight-size.y+paddingBR.y),containerPos.y-dy-paddingTL.y<0&&(dy=containerPos.y-paddingTL.y),(dx||dy)&&map.fire("autopanstart").panBy([dx,dy])}},_onCloseButtonClick:function(e){this._close(),stop(e)},_getAnchor:function(){return toPoint(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}});Map.mergeOptions({closePopupOnClick:!0}),Map.include({openPopup:function(popup,latlng,options){return popup instanceof Popup||(popup=new Popup(options).setContent(popup)),latlng&&popup.setLatLng(latlng),this.hasLayer(popup)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=popup,this.addLayer(popup))},closePopup:function(popup){return popup&&popup!==this._popup||(popup=this._popup,this._popup=null),popup&&this.removeLayer(popup),this}}),Layer.include({bindPopup:function(content,options){return content instanceof Popup?(setOptions(content,options),(this._popup=content)._source=this):(this._popup&&!options||(this._popup=new Popup(options,this)),this._popup.setContent(content)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(layer,latlng){if(layer instanceof Layer||(latlng=layer,layer=this),layer instanceof FeatureGroup)for(var id in this._layers){layer=this._layers[id];break}return latlng=latlng||(layer.getCenter?layer.getCenter():layer.getLatLng()),this._popup&&this._map&&(this._popup._source=layer,this._popup.update(),this._map.openPopup(this._popup,latlng)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(target){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(target)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(content){return this._popup&&this._popup.setContent(content),this},getPopup:function(){return this._popup},_openPopup:function(e){var layer=e.layer||e.target;this._popup&&this._map&&(stop(e),layer instanceof Path?this.openPopup(e.layer||e.target,e.latlng):this._map.hasLayer(this._popup)&&this._popup._source===layer?this.closePopup():this.openPopup(layer,e.latlng))},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var Tooltip=DivOverlay.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(map){DivOverlay.prototype.onAdd.call(this,map),this.setOpacity(this.options.opacity),map.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(map){DivOverlay.prototype.onRemove.call(this,map),map.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var events=DivOverlay.prototype.getEvents.call(this);return touch&&!this.options.permanent&&(events.preclick=this._close),events},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var className="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=create$1("div",className)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(pos){var map=this._map,container=this._container,centerPoint=map.latLngToContainerPoint(map.getCenter()),tooltipPoint=map.layerPointToContainerPoint(pos),direction=this.options.direction,tooltipWidth=container.offsetWidth,tooltipHeight=container.offsetHeight,offset=toPoint(this.options.offset),anchor=this._getAnchor();pos="top"===direction?pos.add(toPoint(-tooltipWidth/2+offset.x,-tooltipHeight+offset.y+anchor.y,!0)):"bottom"===direction?pos.subtract(toPoint(tooltipWidth/2-offset.x,-offset.y,!0)):"center"===direction?pos.subtract(toPoint(tooltipWidth/2+offset.x,tooltipHeight/2-anchor.y+offset.y,!0)):"right"===direction||"auto"===direction&&tooltipPoint.x<centerPoint.x?(direction="right",pos.add(toPoint(offset.x+anchor.x,anchor.y-tooltipHeight/2+offset.y,!0))):(direction="left",pos.subtract(toPoint(tooltipWidth+anchor.x-offset.x,tooltipHeight/2-anchor.y-offset.y,!0))),removeClass(container,"leaflet-tooltip-right"),removeClass(container,"leaflet-tooltip-left"),removeClass(container,"leaflet-tooltip-top"),removeClass(container,"leaflet-tooltip-bottom"),addClass(container,"leaflet-tooltip-"+direction),setPosition(container,pos)},_updatePosition:function(){var pos=this._map.latLngToLayerPoint(this._latlng);this._setPosition(pos)},setOpacity:function(opacity){this.options.opacity=opacity,this._container&&setOpacity(this._container,opacity)},_animateZoom:function(e){var pos=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(pos)},_getAnchor:function(){return toPoint(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}});Map.include({openTooltip:function(tooltip,latlng,options){return tooltip instanceof Tooltip||(tooltip=new Tooltip(options).setContent(tooltip)),latlng&&tooltip.setLatLng(latlng),this.hasLayer(tooltip)?this:this.addLayer(tooltip)},closeTooltip:function(tooltip){return tooltip&&this.removeLayer(tooltip),this}}),Layer.include({bindTooltip:function(content,options){return content instanceof Tooltip?(setOptions(content,options),(this._tooltip=content)._source=this):(this._tooltip&&!options||(this._tooltip=new Tooltip(options,this)),this._tooltip.setContent(content)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(remove$$1){if(remove$$1||!this._tooltipHandlersAdded){var onOff=remove$$1?"off":"on",events={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?events.add=this._openTooltip:(events.mouseover=this._openTooltip,events.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(events.mousemove=this._moveTooltip),touch&&(events.click=this._openTooltip)),this[onOff](events),this._tooltipHandlersAdded=!remove$$1}},openTooltip:function(layer,latlng){if(layer instanceof Layer||(latlng=layer,layer=this),layer instanceof FeatureGroup)for(var id in this._layers){layer=this._layers[id];break}return latlng=latlng||(layer.getCenter?layer.getCenter():layer.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=layer,this._tooltip.update(),this._map.openTooltip(this._tooltip,latlng),this._tooltip.options.interactive&&this._tooltip._container&&(addClass(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(removeClass(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(target){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(target)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(content){return this._tooltip&&this._tooltip.setContent(content),this},getTooltip:function(){return this._tooltip},_openTooltip:function(e){var layer=e.layer||e.target;this._tooltip&&this._map&&this.openTooltip(layer,this._tooltip.options.sticky?e.latlng:void 0)},_moveTooltip:function(e){var containerPoint,layerPoint,latlng=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(containerPoint=this._map.mouseEventToContainerPoint(e.originalEvent),layerPoint=this._map.containerPointToLayerPoint(containerPoint),latlng=this._map.layerPointToLatLng(layerPoint)),this._tooltip.setLatLng(latlng)}});var DivIcon=Icon.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(oldIcon){var div=oldIcon&&"DIV"===oldIcon.tagName?oldIcon:document.createElement("div"),options=this.options;if(div.innerHTML=!1!==options.html?options.html:"",options.bgPos){var bgPos=toPoint(options.bgPos);div.style.backgroundPosition=-bgPos.x+"px "+-bgPos.y+"px"}return this._setIconStyles(div,"icon"),div},createShadow:function(){return null}});Icon.Default=IconDefault;var GridLayer=Layer.extend({options:{tileSize:256,opacity:1,updateWhenIdle:mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(options){setOptions(this,options)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(map){map._addZoomLimit(this)},onRemove:function(map){this._removeAllTiles(),remove(this._container),map._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(toFront(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(toBack(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(opacity){return this.options.opacity=opacity,this._updateOpacity(),this},setZIndex:function(zIndex){return this.options.zIndex=zIndex,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var events={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=throttle(this._onMoveEnd,this.options.updateInterval,this)),events.move=this._onMove),this._zoomAnimated&&(events.zoomanim=this._animateZoom),events},createTile:function(){return document.createElement("div")},getTileSize:function(){var s=this.options.tileSize;return s instanceof Point?s:new Point(s,s)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(compare){for(var zIndex,layers=this.getPane().children,edgeZIndex=-compare(-1/0,1/0),i=0,len=layers.length;i<len;i++)zIndex=layers[i].style.zIndex,layers[i]!==this._container&&zIndex&&(edgeZIndex=compare(edgeZIndex,+zIndex));isFinite(edgeZIndex)&&(this.options.zIndex=edgeZIndex+compare(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ielt9){setOpacity(this._container,this.options.opacity);var now=+new Date,nextFrame=!1,willPrune=!1;for(var key in this._tiles){var tile=this._tiles[key];if(tile.current&&tile.loaded){var fade=Math.min(1,(now-tile.loaded)/200);setOpacity(tile.el,fade),fade<1?nextFrame=!0:(tile.active?willPrune=!0:this._onOpaqueTile(tile),tile.active=!0)}}willPrune&&!this._noPrune&&this._pruneTiles(),nextFrame&&(cancelAnimFrame(this._fadeFrame),this._fadeFrame=requestAnimFrame(this._updateOpacity,this))}},_onOpaqueTile:falseFn,_initContainer:function(){this._container||(this._container=create$1("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var zoom=this._tileZoom,maxZoom=this.options.maxZoom;if(void 0!==zoom){for(var z in this._levels)this._levels[z].el.children.length||z===zoom?(this._levels[z].el.style.zIndex=maxZoom-Math.abs(zoom-z),this._onUpdateLevel(z)):(remove(this._levels[z].el),this._removeTilesAtZoom(z),this._onRemoveLevel(z),delete this._levels[z]);var level=this._levels[zoom],map=this._map;return level||((level=this._levels[zoom]={}).el=create$1("div","leaflet-tile-container leaflet-zoom-animated",this._container),level.el.style.zIndex=maxZoom,level.origin=map.project(map.unproject(map.getPixelOrigin()),zoom).round(),level.zoom=zoom,this._setZoomTransform(level,map.getCenter(),map.getZoom()),level.el.offsetWidth,this._onCreateLevel(level)),this._level=level}},_onUpdateLevel:falseFn,_onRemoveLevel:falseFn,_onCreateLevel:falseFn,_pruneTiles:function(){if(this._map){var key,tile,zoom=this._map.getZoom();if(zoom>this.options.maxZoom||zoom<this.options.minZoom)this._removeAllTiles();else{for(key in this._tiles)(tile=this._tiles[key]).retain=tile.current;for(key in this._tiles)if((tile=this._tiles[key]).current&&!tile.active){var coords=tile.coords;this._retainParent(coords.x,coords.y,coords.z,coords.z-5)||this._retainChildren(coords.x,coords.y,coords.z,coords.z+2)}for(key in this._tiles)this._tiles[key].retain||this._removeTile(key)}}},_removeTilesAtZoom:function(zoom){for(var key in this._tiles)this._tiles[key].coords.z===zoom&&this._removeTile(key)},_removeAllTiles:function(){for(var key in this._tiles)this._removeTile(key)},_invalidateAll:function(){for(var z in this._levels)remove(this._levels[z].el),this._onRemoveLevel(z),delete this._levels[z];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(x,y,z,minZoom){var x2=Math.floor(x/2),y2=Math.floor(y/2),z2=z-1,coords2=new Point(+x2,+y2);coords2.z=+z2;var key=this._tileCoordsToKey(coords2),tile=this._tiles[key];return tile&&tile.active?tile.retain=!0:(tile&&tile.loaded&&(tile.retain=!0),minZoom<z2&&this._retainParent(x2,y2,z2,minZoom))},_retainChildren:function(x,y,z,maxZoom){for(var i=2*x;i<2*x+2;i++)for(var j=2*y;j<2*y+2;j++){var coords=new Point(i,j);coords.z=z+1;var key=this._tileCoordsToKey(coords),tile=this._tiles[key];tile&&tile.active?tile.retain=!0:(tile&&tile.loaded&&(tile.retain=!0),z+1<maxZoom&&this._retainChildren(i,j,z+1,maxZoom))}},_resetView:function(e){var animating=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),animating,animating)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(zoom){var options=this.options;return void 0!==options.minNativeZoom&&zoom<options.minNativeZoom?options.minNativeZoom:void 0!==options.maxNativeZoom&&options.maxNativeZoom<zoom?options.maxNativeZoom:zoom},_setView:function(center,zoom,noPrune,noUpdate){var tileZoom=this._clampZoom(Math.round(zoom));(void 0!==this.options.maxZoom&&tileZoom>this.options.maxZoom||void 0!==this.options.minZoom&&tileZoom<this.options.minZoom)&&(tileZoom=void 0);var tileZoomChanged=this.options.updateWhenZooming&&tileZoom!==this._tileZoom;noUpdate&&!tileZoomChanged||(this._tileZoom=tileZoom,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==tileZoom&&this._update(center),noPrune||this._pruneTiles(),this._noPrune=!!noPrune),this._setZoomTransforms(center,zoom)},_setZoomTransforms:function(center,zoom){for(var i in this._levels)this._setZoomTransform(this._levels[i],center,zoom)},_setZoomTransform:function(level,center,zoom){var scale=this._map.getZoomScale(zoom,level.zoom),translate=level.origin.multiplyBy(scale).subtract(this._map._getNewPixelOrigin(center,zoom)).round();any3d?setTransform(level.el,translate,scale):setPosition(level.el,translate)},_resetGrid:function(){var map=this._map,crs=map.options.crs,tileSize=this._tileSize=this.getTileSize(),tileZoom=this._tileZoom,bounds=this._map.getPixelWorldBounds(this._tileZoom);bounds&&(this._globalTileRange=this._pxBoundsToTileRange(bounds)),this._wrapX=crs.wrapLng&&!this.options.noWrap&&[Math.floor(map.project([0,crs.wrapLng[0]],tileZoom).x/tileSize.x),Math.ceil(map.project([0,crs.wrapLng[1]],tileZoom).x/tileSize.y)],this._wrapY=crs.wrapLat&&!this.options.noWrap&&[Math.floor(map.project([crs.wrapLat[0],0],tileZoom).y/tileSize.x),Math.ceil(map.project([crs.wrapLat[1],0],tileZoom).y/tileSize.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(center){var map=this._map,mapZoom=map._animatingZoom?Math.max(map._animateToZoom,map.getZoom()):map.getZoom(),scale=map.getZoomScale(mapZoom,this._tileZoom),pixelCenter=map.project(center,this._tileZoom).floor(),halfSize=map.getSize().divideBy(2*scale);return new Bounds(pixelCenter.subtract(halfSize),pixelCenter.add(halfSize))},_update:function(center){var map=this._map;if(map){var zoom=this._clampZoom(map.getZoom());if(void 0===center&&(center=map.getCenter()),void 0!==this._tileZoom){var pixelBounds=this._getTiledPixelBounds(center),tileRange=this._pxBoundsToTileRange(pixelBounds),tileCenter=tileRange.getCenter(),queue=[],margin=this.options.keepBuffer,noPruneRange=new Bounds(tileRange.getBottomLeft().subtract([margin,-margin]),tileRange.getTopRight().add([margin,-margin]));if(!(isFinite(tileRange.min.x)&&isFinite(tileRange.min.y)&&isFinite(tileRange.max.x)&&isFinite(tileRange.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var key in this._tiles){var c=this._tiles[key].coords;c.z===this._tileZoom&&noPruneRange.contains(new Point(c.x,c.y))||(this._tiles[key].current=!1)}if(1<Math.abs(zoom-this._tileZoom))this._setView(center,zoom);else{for(var j=tileRange.min.y;j<=tileRange.max.y;j++)for(var i=tileRange.min.x;i<=tileRange.max.x;i++){var coords=new Point(i,j);if(coords.z=this._tileZoom,this._isValidTile(coords)){var tile=this._tiles[this._tileCoordsToKey(coords)];tile?tile.current=!0:queue.push(coords)}}if(queue.sort(function(a,b){return a.distanceTo(tileCenter)-b.distanceTo(tileCenter)}),0!==queue.length){this._loading||(this._loading=!0,this.fire("loading"));var fragment=document.createDocumentFragment();for(i=0;i<queue.length;i++)this._addTile(queue[i],fragment);this._level.el.appendChild(fragment)}}}}},_isValidTile:function(coords){var crs=this._map.options.crs;if(!crs.infinite){var bounds=this._globalTileRange;if(!crs.wrapLng&&(coords.x<bounds.min.x||coords.x>bounds.max.x)||!crs.wrapLat&&(coords.y<bounds.min.y||coords.y>bounds.max.y))return!1}if(!this.options.bounds)return!0;var tileBounds=this._tileCoordsToBounds(coords);return toLatLngBounds(this.options.bounds).overlaps(tileBounds)},_keyToBounds:function(key){return this._tileCoordsToBounds(this._keyToTileCoords(key))},_tileCoordsToNwSe:function(coords){var map=this._map,tileSize=this.getTileSize(),nwPoint=coords.scaleBy(tileSize),sePoint=nwPoint.add(tileSize),nw=map.unproject(nwPoint,coords.z),se=map.unproject(sePoint,coords.z);return[nw,se]},_tileCoordsToBounds:function(coords){var bp=this._tileCoordsToNwSe(coords),bounds=new LatLngBounds(bp[0],bp[1]);return this.options.noWrap||(bounds=this._map.wrapLatLngBounds(bounds)),bounds},_tileCoordsToKey:function(coords){return coords.x+":"+coords.y+":"+coords.z},_keyToTileCoords:function(key){var k=key.split(":"),coords=new Point(+k[0],+k[1]);return coords.z=+k[2],coords},_removeTile:function(key){var tile=this._tiles[key];tile&&(remove(tile.el),delete this._tiles[key],this.fire("tileunload",{tile:tile.el,coords:this._keyToTileCoords(key)}))},_initTile:function(tile){addClass(tile,"leaflet-tile");var tileSize=this.getTileSize();tile.style.width=tileSize.x+"px",tile.style.height=tileSize.y+"px",tile.onselectstart=falseFn,tile.onmousemove=falseFn,ielt9&&this.options.opacity<1&&setOpacity(tile,this.options.opacity),android&&!android23&&(tile.style.WebkitBackfaceVisibility="hidden")},_addTile:function(coords,container){var tilePos=this._getTilePos(coords),key=this._tileCoordsToKey(coords),tile=this.createTile(this._wrapCoords(coords),bind(this._tileReady,this,coords));this._initTile(tile),this.createTile.length<2&&requestAnimFrame(bind(this._tileReady,this,coords,null,tile)),setPosition(tile,tilePos),this._tiles[key]={el:tile,coords:coords,current:!0},container.appendChild(tile),this.fire("tileloadstart",{tile:tile,coords:coords})},_tileReady:function(coords,err,tile){err&&this.fire("tileerror",{error:err,tile:tile,coords:coords});var key=this._tileCoordsToKey(coords);(tile=this._tiles[key])&&(tile.loaded=+new Date,this._map._fadeAnimated?(setOpacity(tile.el,0),cancelAnimFrame(this._fadeFrame),this._fadeFrame=requestAnimFrame(this._updateOpacity,this)):(tile.active=!0,this._pruneTiles()),err||(addClass(tile.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:tile.el,coords:coords})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ielt9||!this._map._fadeAnimated?requestAnimFrame(this._pruneTiles,this):setTimeout(bind(this._pruneTiles,this),250)))},_getTilePos:function(coords){return coords.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(coords){var newCoords=new Point(this._wrapX?wrapNum(coords.x,this._wrapX):coords.x,this._wrapY?wrapNum(coords.y,this._wrapY):coords.y);return newCoords.z=coords.z,newCoords},_pxBoundsToTileRange:function(bounds){var tileSize=this.getTileSize();return new Bounds(bounds.min.unscaleBy(tileSize).floor(),bounds.max.unscaleBy(tileSize).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var key in this._tiles)if(!this._tiles[key].loaded)return!1;return!0}});var TileLayer=GridLayer.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(url,options){this._url=url,(options=setOptions(this,options)).detectRetina&&retina&&0<options.maxZoom&&(options.tileSize=Math.floor(options.tileSize/2),options.zoomReverse?(options.zoomOffset--,options.minZoom++):(options.zoomOffset++,options.maxZoom--),options.minZoom=Math.max(0,options.minZoom)),"string"==typeof options.subdomains&&(options.subdomains=options.subdomains.split("")),android||this.on("tileunload",this._onTileRemove)},setUrl:function(url,noRedraw){return this._url=url,noRedraw||this.redraw(),this},createTile:function(coords,done){var tile=document.createElement("img");return on(tile,"load",bind(this._tileOnLoad,this,done,tile)),on(tile,"error",bind(this._tileOnError,this,done,tile)),!this.options.crossOrigin&&""!==this.options.crossOrigin||(tile.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),tile.alt="",tile.setAttribute("role","presentation"),tile.src=this.getTileUrl(coords),tile},getTileUrl:function(coords){var data={r:retina?"@2x":"",s:this._getSubdomain(coords),x:coords.x,y:coords.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var invertedY=this._globalTileRange.max.y-coords.y;this.options.tms&&(data.y=invertedY),data["-y"]=invertedY}return template(this._url,extend(data,this.options))},_tileOnLoad:function(done,tile){ielt9?setTimeout(bind(done,this,null,tile),0):done(null,tile)},_tileOnError:function(done,tile,e){var errorUrl=this.options.errorTileUrl;errorUrl&&tile.getAttribute("src")!==errorUrl&&(tile.src=errorUrl),done(e,tile)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var zoom=this._tileZoom,maxZoom=this.options.maxZoom,zoomReverse=this.options.zoomReverse,zoomOffset=this.options.zoomOffset;return zoomReverse&&(zoom=maxZoom-zoom),zoom+zoomOffset},_getSubdomain:function(tilePoint){var index=Math.abs(tilePoint.x+tilePoint.y)%this.options.subdomains.length;return this.options.subdomains[index]},_abortLoading:function(){var i,tile;for(i in this._tiles)this._tiles[i].coords.z!==this._tileZoom&&((tile=this._tiles[i].el).onload=falseFn,tile.onerror=falseFn,tile.complete||(tile.src=emptyImageUrl,remove(tile),delete this._tiles[i]))},_removeTile:function(key){var tile=this._tiles[key];if(tile)return androidStock||tile.el.setAttribute("src",emptyImageUrl),GridLayer.prototype._removeTile.call(this,key)},_tileReady:function(coords,err,tile){if(this._map&&(!tile||tile.getAttribute("src")!==emptyImageUrl))return GridLayer.prototype._tileReady.call(this,coords,err,tile)}});function tileLayer(url,options){return new TileLayer(url,options)}var TileLayerWMS=TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(url,options){this._url=url;var wmsParams=extend({},this.defaultWmsParams);for(var i in options)i in this.options||(wmsParams[i]=options[i]);var realRetina=(options=setOptions(this,options)).detectRetina&&retina?2:1,tileSize=this.getTileSize();wmsParams.width=tileSize.x*realRetina,wmsParams.height=tileSize.y*realRetina,this.wmsParams=wmsParams},onAdd:function(map){this._crs=this.options.crs||map.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var projectionKey=1.3<=this._wmsVersion?"crs":"srs";this.wmsParams[projectionKey]=this._crs.code,TileLayer.prototype.onAdd.call(this,map)},getTileUrl:function(coords){var tileBounds=this._tileCoordsToNwSe(coords),crs=this._crs,bounds=toBounds(crs.project(tileBounds[0]),crs.project(tileBounds[1])),min=bounds.min,max=bounds.max,bbox=(1.3<=this._wmsVersion&&this._crs===EPSG4326?[min.y,min.x,max.y,max.x]:[min.x,min.y,max.x,max.y]).join(","),url=TileLayer.prototype.getTileUrl.call(this,coords);return url+getParamString(this.wmsParams,url,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+bbox},setParams:function(params,noRedraw){return extend(this.wmsParams,params),noRedraw||this.redraw(),this}});TileLayer.WMS=TileLayerWMS,tileLayer.wms=function(url,options){return new TileLayerWMS(url,options)};var Renderer=Layer.extend({options:{padding:.1,tolerance:0},initialize:function(options){setOptions(this,options),stamp(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&addClass(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var events={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(events.zoomanim=this._onAnimZoom),events},_onAnimZoom:function(ev){this._updateTransform(ev.center,ev.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(center,zoom){var scale=this._map.getZoomScale(zoom,this._zoom),position=getPosition(this._container),viewHalf=this._map.getSize().multiplyBy(.5+this.options.padding),currentCenterPoint=this._map.project(this._center,zoom),destCenterPoint=this._map.project(center,zoom),centerOffset=destCenterPoint.subtract(currentCenterPoint),topLeftOffset=viewHalf.multiplyBy(-scale).add(position).add(viewHalf).subtract(centerOffset);any3d?setTransform(this._container,topLeftOffset,scale):setPosition(this._container,topLeftOffset)},_reset:function(){for(var id in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[id]._reset()},_onZoomEnd:function(){for(var id in this._layers)this._layers[id]._project()},_updatePaths:function(){for(var id in this._layers)this._layers[id]._update()},_update:function(){var p=this.options.padding,size=this._map.getSize(),min=this._map.containerPointToLayerPoint(size.multiplyBy(-p)).round();this._bounds=new Bounds(min,min.add(size.multiplyBy(1+2*p)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Canvas=Renderer.extend({getEvents:function(){var events=Renderer.prototype.getEvents.call(this);return events.viewprereset=this._onViewPreReset,events},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Renderer.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var container=this._container=document.createElement("canvas");on(container,"mousemove",throttle(this._onMouseMove,32,this),this),on(container,"click dblclick mousedown mouseup contextmenu",this._onClick,this),on(container,"mouseout",this._handleMouseOut,this),this._ctx=container.getContext("2d")},_destroyContainer:function(){cancelAnimFrame(this._redrawRequest),delete this._ctx,remove(this._container),off(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var id in this._redrawBounds=null,this._layers)this._layers[id]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},Renderer.prototype._update.call(this);var b=this._bounds,container=this._container,size=b.getSize(),m=retina?2:1;setPosition(container,b.min),container.width=m*size.x,container.height=m*size.y,container.style.width=size.x+"px",container.style.height=size.y+"px",retina&&this._ctx.scale(2,2),this._ctx.translate(-b.min.x,-b.min.y),this.fire("update")}},_reset:function(){Renderer.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(layer){this._updateDashArray(layer);var order=(this._layers[stamp(layer)]=layer)._order={layer:layer,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=order),this._drawLast=order,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(layer){this._requestRedraw(layer)},_removePath:function(layer){var order=layer._order,next=order.next,prev=order.prev;next?next.prev=prev:this._drawLast=prev,prev?prev.next=next:this._drawFirst=next,delete this._drawnLayers[layer._leaflet_id],delete layer._order,delete this._layers[stamp(layer)],this._requestRedraw(layer)},_updatePath:function(layer){this._extendRedrawBounds(layer),layer._project(),layer._update(),this._requestRedraw(layer)},_updateStyle:function(layer){this._updateDashArray(layer),this._requestRedraw(layer)},_updateDashArray:function(layer){if("string"==typeof layer.options.dashArray){var i,parts=layer.options.dashArray.split(/[, ]+/),dashArray=[];for(i=0;i<parts.length;i++)dashArray.push(Number(parts[i]));layer.options._dashArray=dashArray}else layer.options._dashArray=layer.options.dashArray},_requestRedraw:function(layer){this._map&&(this._extendRedrawBounds(layer),this._redrawRequest=this._redrawRequest||requestAnimFrame(this._redraw,this))},_extendRedrawBounds:function(layer){if(layer._pxBounds){var padding=(layer.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Bounds,this._redrawBounds.extend(layer._pxBounds.min.subtract([padding,padding])),this._redrawBounds.extend(layer._pxBounds.max.add([padding,padding]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var bounds=this._redrawBounds;if(bounds){var size=bounds.getSize();this._ctx.clearRect(bounds.min.x,bounds.min.y,size.x,size.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var layer,bounds=this._redrawBounds;if(this._ctx.save(),bounds){var size=bounds.getSize();this._ctx.beginPath(),this._ctx.rect(bounds.min.x,bounds.min.y,size.x,size.y),this._ctx.clip()}this._drawing=!0;for(var order=this._drawFirst;order;order=order.next)layer=order.layer,(!bounds||layer._pxBounds&&layer._pxBounds.intersects(bounds))&&layer._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(layer,closed){if(this._drawing){var i,j,len2,p,parts=layer._parts,len=parts.length,ctx=this._ctx;if(len){for(this._drawnLayers[layer._leaflet_id]=layer,ctx.beginPath(),i=0;i<len;i++){for(j=0,len2=parts[i].length;j<len2;j++)p=parts[i][j],ctx[j?"lineTo":"moveTo"](p.x,p.y);closed&&ctx.closePath()}this._fillStroke(ctx,layer)}}},_updateCircle:function(layer){if(this._drawing&&!layer._empty()){var p=layer._point,ctx=this._ctx,r=Math.max(Math.round(layer._radius),1),s=(Math.max(Math.round(layer._radiusY),1)||r)/r;this._drawnLayers[layer._leaflet_id]=layer,1!=s&&(ctx.save(),ctx.scale(1,s)),ctx.beginPath(),ctx.arc(p.x,p.y/s,r,0,2*Math.PI,!1),1!=s&&ctx.restore(),this._fillStroke(ctx,layer)}},_fillStroke:function(ctx,layer){var options=layer.options;options.fill&&(ctx.globalAlpha=options.fillOpacity,ctx.fillStyle=options.fillColor||options.color,ctx.fill(options.fillRule||"evenodd")),options.stroke&&0!==options.weight&&(ctx.setLineDash&&ctx.setLineDash(layer.options&&layer.options._dashArray||[]),ctx.globalAlpha=options.opacity,ctx.lineWidth=options.weight,ctx.strokeStyle=options.color,ctx.lineCap=options.lineCap,ctx.lineJoin=options.lineJoin,ctx.stroke())},_onClick:function(e){for(var layer,clickedLayer,point=this._map.mouseEventToLayerPoint(e),order=this._drawFirst;order;order=order.next)(layer=order.layer).options.interactive&&layer._containsPoint(point)&&!this._map._draggableMoved(layer)&&(clickedLayer=layer);clickedLayer&&(fakeStop(e),this._fireEvent([clickedLayer],e))},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var point=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,point)}},_handleMouseOut:function(e){var layer=this._hoveredLayer;layer&&(removeClass(this._container,"leaflet-interactive"),this._fireEvent([layer],e,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(e,point){for(var layer,candidateHoveredLayer,order=this._drawFirst;order;order=order.next)(layer=order.layer).options.interactive&&layer._containsPoint(point)&&(candidateHoveredLayer=layer);candidateHoveredLayer!==this._hoveredLayer&&(this._handleMouseOut(e),candidateHoveredLayer&&(addClass(this._container,"leaflet-interactive"),this._fireEvent([candidateHoveredLayer],e,"mouseover"),this._hoveredLayer=candidateHoveredLayer)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],e)},_fireEvent:function(layers,e,type){this._map._fireDOMEvent(e,type||e.type,layers)},_bringToFront:function(layer){var order=layer._order,next=order.next,prev=order.prev;next&&((next.prev=prev)?prev.next=next:next&&(this._drawFirst=next),order.prev=this._drawLast,(this._drawLast.next=order).next=null,this._drawLast=order,this._requestRedraw(layer))},_bringToBack:function(layer){var order=layer._order,next=order.next,prev=order.prev;prev&&((prev.next=next)?next.prev=prev:prev&&(this._drawLast=prev),order.prev=null,order.next=this._drawFirst,this._drawFirst.prev=order,this._drawFirst=order,this._requestRedraw(layer))}});function canvas$1(options){return canvas?new Canvas(options):null}var vmlCreate=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(name){return document.createElement("<lvml:"+name+' class="lvml">')}}catch(e){return function(name){return document.createElement("<"+name+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),vmlMixin={_initContainer:function(){this._container=create$1("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Renderer.prototype._update.call(this),this.fire("update"))},_initPath:function(layer){var container=layer._container=vmlCreate("shape");addClass(container,"leaflet-vml-shape "+(this.options.className||"")),container.coordsize="1 1",layer._path=vmlCreate("path"),container.appendChild(layer._path),this._updateStyle(layer),this._layers[stamp(layer)]=layer},_addPath:function(layer){var container=layer._container;this._container.appendChild(container),layer.options.interactive&&layer.addInteractiveTarget(container)},_removePath:function(layer){var container=layer._container;remove(container),layer.removeInteractiveTarget(container),delete this._layers[stamp(layer)]},_updateStyle:function(layer){var stroke=layer._stroke,fill=layer._fill,options=layer.options,container=layer._container;container.stroked=!!options.stroke,container.filled=!!options.fill,options.stroke?(stroke=stroke||(layer._stroke=vmlCreate("stroke")),container.appendChild(stroke),stroke.weight=options.weight+"px",stroke.color=options.color,stroke.opacity=options.opacity,options.dashArray?stroke.dashStyle=isArray(options.dashArray)?options.dashArray.join(" "):options.dashArray.replace(/( *, *)/g," "):stroke.dashStyle="",stroke.endcap=options.lineCap.replace("butt","flat"),stroke.joinstyle=options.lineJoin):stroke&&(container.removeChild(stroke),layer._stroke=null),options.fill?(fill=fill||(layer._fill=vmlCreate("fill")),container.appendChild(fill),fill.color=options.fillColor||options.color,fill.opacity=options.fillOpacity):fill&&(container.removeChild(fill),layer._fill=null)},_updateCircle:function(layer){var p=layer._point.round(),r=Math.round(layer._radius),r2=Math.round(layer._radiusY||r);this._setPath(layer,layer._empty()?"M0 0":"AL "+p.x+","+p.y+" "+r+","+r2+" 0,23592600")},_setPath:function(layer,path){layer._path.v=path},_bringToFront:function(layer){toFront(layer._container)},_bringToBack:function(layer){toBack(layer._container)}},create$2=vml?vmlCreate:svgCreate,SVG=Renderer.extend({getEvents:function(){var events=Renderer.prototype.getEvents.call(this);return events.zoomstart=this._onZoomStart,events},_initContainer:function(){this._container=create$2("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=create$2("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){remove(this._container),off(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){Renderer.prototype._update.call(this);var b=this._bounds,size=b.getSize(),container=this._container;this._svgSize&&this._svgSize.equals(size)||(this._svgSize=size,container.setAttribute("width",size.x),container.setAttribute("height",size.y)),setPosition(container,b.min),container.setAttribute("viewBox",[b.min.x,b.min.y,size.x,size.y].join(" ")),this.fire("update")}},_initPath:function(layer){var path=layer._path=create$2("path");layer.options.className&&addClass(path,layer.options.className),layer.options.interactive&&addClass(path,"leaflet-interactive"),this._updateStyle(layer),this._layers[stamp(layer)]=layer},_addPath:function(layer){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(layer._path),layer.addInteractiveTarget(layer._path)},_removePath:function(layer){remove(layer._path),layer.removeInteractiveTarget(layer._path),delete this._layers[stamp(layer)]},_updatePath:function(layer){layer._project(),layer._update()},_updateStyle:function(layer){var path=layer._path,options=layer.options;path&&(options.stroke?(path.setAttribute("stroke",options.color),path.setAttribute("stroke-opacity",options.opacity),path.setAttribute("stroke-width",options.weight),path.setAttribute("stroke-linecap",options.lineCap),path.setAttribute("stroke-linejoin",options.lineJoin),options.dashArray?path.setAttribute("stroke-dasharray",options.dashArray):path.removeAttribute("stroke-dasharray"),options.dashOffset?path.setAttribute("stroke-dashoffset",options.dashOffset):path.removeAttribute("stroke-dashoffset")):path.setAttribute("stroke","none"),options.fill?(path.setAttribute("fill",options.fillColor||options.color),path.setAttribute("fill-opacity",options.fillOpacity),path.setAttribute("fill-rule",options.fillRule||"evenodd")):path.setAttribute("fill","none"))},_updatePoly:function(layer,closed){this._setPath(layer,pointsToPath(layer._parts,closed))},_updateCircle:function(layer){var p=layer._point,r=Math.max(Math.round(layer._radius),1),r2=Math.max(Math.round(layer._radiusY),1)||r,arc="a"+r+","+r2+" 0 1,0 ",d=layer._empty()?"M0 0":"M"+(p.x-r)+","+p.y+arc+2*r+",0 "+arc+2*-r+",0 ";this._setPath(layer,d)},_setPath:function(layer,path){layer._path.setAttribute("d",path)},_bringToFront:function(layer){toFront(layer._path)},_bringToBack:function(layer){toBack(layer._path)}});function svg$1(options){return svg||vml?new SVG(options):null}vml&&SVG.include(vmlMixin),Map.include({getRenderer:function(layer){var renderer=layer.options.renderer||this._getPaneRenderer(layer.options.pane)||this.options.renderer||this._renderer;return renderer=renderer||(this._renderer=this._createRenderer()),this.hasLayer(renderer)||this.addLayer(renderer),renderer},_getPaneRenderer:function(name){if("overlayPane"===name||void 0===name)return!1;var renderer=this._paneRenderers[name];return void 0===renderer&&(renderer=this._createRenderer({pane:name}),this._paneRenderers[name]=renderer),renderer},_createRenderer:function(options){return this.options.preferCanvas&&canvas$1(options)||svg$1(options)}});var Rectangle=Polygon.extend({initialize:function(latLngBounds,options){Polygon.prototype.initialize.call(this,this._boundsToLatLngs(latLngBounds),options)},setBounds:function(latLngBounds){return this.setLatLngs(this._boundsToLatLngs(latLngBounds))},_boundsToLatLngs:function(latLngBounds){return[(latLngBounds=toLatLngBounds(latLngBounds)).getSouthWest(),latLngBounds.getNorthWest(),latLngBounds.getNorthEast(),latLngBounds.getSouthEast()]}});SVG.create=create$2,SVG.pointsToPath=pointsToPath,GeoJSON.geometryToLayer=geometryToLayer,GeoJSON.coordsToLatLng=coordsToLatLng,GeoJSON.coordsToLatLngs=coordsToLatLngs,GeoJSON.latLngToCoords=latLngToCoords,GeoJSON.latLngsToCoords=latLngsToCoords,GeoJSON.getFeature=getFeature,GeoJSON.asFeature=asFeature,Map.mergeOptions({boxZoom:!0});var BoxZoom=Handler.extend({initialize:function(map){this._map=map,this._container=map._container,this._pane=map._panes.overlayPane,this._resetStateTimeout=0,map.on("unload",this._destroy,this)},addHooks:function(){on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){off(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){remove(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),disableTextSelection(),disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(e),on(document,{contextmenu:stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=create$1("div","leaflet-zoom-box",this._container),addClass(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var bounds=new Bounds(this._point,this._startPoint),size=bounds.getSize();setPosition(this._box,bounds.min),this._box.style.width=size.x+"px",this._box.style.height=size.y+"px"},_finish:function(){this._moved&&(remove(this._box),removeClass(this._container,"leaflet-crosshair")),enableTextSelection(),enableImageDrag(),off(document,{contextmenu:stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(bind(this._resetState,this),0);var bounds=new LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(bounds).fire("boxzoomend",{boxZoomBounds:bounds})}},_onKeyDown:function(e){27===e.keyCode&&this._finish()}});Map.addInitHook("addHandler","boxZoom",BoxZoom),Map.mergeOptions({doubleClickZoom:!0});var DoubleClickZoom=Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var map=this._map,oldZoom=map.getZoom(),delta=map.options.zoomDelta,zoom=e.originalEvent.shiftKey?oldZoom-delta:oldZoom+delta;"center"===map.options.doubleClickZoom?map.setZoom(zoom):map.setZoomAround(e.containerPoint,zoom)}});Map.addInitHook("addHandler","doubleClickZoom",DoubleClickZoom),Map.mergeOptions({dragging:!0,inertia:!android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Drag=Handler.extend({addHooks:function(){if(!this._draggable){var map=this._map;this._draggable=new Draggable(map._mapPane,map._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),map.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),map.on("zoomend",this._onZoomEnd,this),map.whenReady(this._onZoomEnd,this))}addClass(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){removeClass(this._map._container,"leaflet-grab"),removeClass(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var map=this._map;if(map._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var bounds=toLatLngBounds(this._map.options.maxBounds);this._offsetLimit=toBounds(this._map.latLngToContainerPoint(bounds.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(bounds.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;map.fire("movestart").fire("dragstart"),map.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var time=this._lastTime=+new Date,pos=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(pos),this._times.push(time),this._prunePositions(time)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(time){for(;1<this._positions.length&&50<time-this._times[0];)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var pxCenter=this._map.getSize().divideBy(2),pxWorldCenter=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=pxWorldCenter.subtract(pxCenter).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(value,threshold){return value-(value-threshold)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var offset=this._draggable._newPos.subtract(this._draggable._startPos),limit=this._offsetLimit;offset.x<limit.min.x&&(offset.x=this._viscousLimit(offset.x,limit.min.x)),offset.y<limit.min.y&&(offset.y=this._viscousLimit(offset.y,limit.min.y)),offset.x>limit.max.x&&(offset.x=this._viscousLimit(offset.x,limit.max.x)),offset.y>limit.max.y&&(offset.y=this._viscousLimit(offset.y,limit.max.y)),this._draggable._newPos=this._draggable._startPos.add(offset)}},_onPreDragWrap:function(){var worldWidth=this._worldWidth,halfWidth=Math.round(worldWidth/2),dx=this._initialWorldOffset,x=this._draggable._newPos.x,newX1=(x-halfWidth+dx)%worldWidth+halfWidth-dx,newX2=(x+halfWidth+dx)%worldWidth-halfWidth-dx,newX=Math.abs(newX1+dx)<Math.abs(newX2+dx)?newX1:newX2;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=newX},_onDragEnd:function(e){var map=this._map,options=map.options,noInertia=!options.inertia||this._times.length<2;if(map.fire("dragend",e),noInertia)map.fire("moveend");else{this._prunePositions(+new Date);var direction=this._lastPos.subtract(this._positions[0]),duration=(this._lastTime-this._times[0])/1e3,ease=options.easeLinearity,speedVector=direction.multiplyBy(ease/duration),speed=speedVector.distanceTo([0,0]),limitedSpeed=Math.min(options.inertiaMaxSpeed,speed),limitedSpeedVector=speedVector.multiplyBy(limitedSpeed/speed),decelerationDuration=limitedSpeed/(options.inertiaDeceleration*ease),offset=limitedSpeedVector.multiplyBy(-decelerationDuration/2).round();offset.x||offset.y?(offset=map._limitOffset(offset,map.options.maxBounds),requestAnimFrame(function(){map.panBy(offset,{duration:decelerationDuration,easeLinearity:ease,noMoveStart:!0,animate:!0})})):map.fire("moveend")}}});Map.addInitHook("addHandler","dragging",Drag),Map.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Keyboard=Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(map){this._map=map,this._setPanDelta(map.options.keyboardPanDelta),this._setZoomDelta(map.options.zoomDelta)},addHooks:function(){var container=this._map._container;container.tabIndex<=0&&(container.tabIndex="0"),on(container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),off(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var body=document.body,docEl=document.documentElement,top=body.scrollTop||docEl.scrollTop,left=body.scrollLeft||docEl.scrollLeft;this._map._container.focus(),window.scrollTo(left,top)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(panDelta){var i,len,keys=this._panKeys={},codes=this.keyCodes;for(i=0,len=codes.left.length;i<len;i++)keys[codes.left[i]]=[-1*panDelta,0];for(i=0,len=codes.right.length;i<len;i++)keys[codes.right[i]]=[panDelta,0];for(i=0,len=codes.down.length;i<len;i++)keys[codes.down[i]]=[0,panDelta];for(i=0,len=codes.up.length;i<len;i++)keys[codes.up[i]]=[0,-1*panDelta]},_setZoomDelta:function(zoomDelta){var i,len,keys=this._zoomKeys={},codes=this.keyCodes;for(i=0,len=codes.zoomIn.length;i<len;i++)keys[codes.zoomIn[i]]=zoomDelta;for(i=0,len=codes.zoomOut.length;i<len;i++)keys[codes.zoomOut[i]]=-zoomDelta},_addHooks:function(){on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){off(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var offset,key=e.keyCode,map=this._map;if(key in this._panKeys)map._panAnim&&map._panAnim._inProgress||(offset=this._panKeys[key],e.shiftKey&&(offset=toPoint(offset).multiplyBy(3)),map.panBy(offset),map.options.maxBounds&&map.panInsideBounds(map.options.maxBounds));else if(key in this._zoomKeys)map.setZoom(map.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[key]);else{if(27!==key||!map._popup||!map._popup.options.closeOnEscapeKey)return;map.closePopup()}stop(e)}}});Map.addInitHook("addHandler","keyboard",Keyboard),Map.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ScrollWheelZoom=Handler.extend({addHooks:function(){on(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){off(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var delta=getWheelDelta(e),debounce=this._map.options.wheelDebounceTime;this._delta+=delta,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var left=Math.max(debounce-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(bind(this._performZoom,this),left),stop(e)},_performZoom:function(){var map=this._map,zoom=map.getZoom(),snap=this._map.options.zoomSnap||0;map._stop();var d2=this._delta/(4*this._map.options.wheelPxPerZoomLevel),d3=4*Math.log(2/(1+Math.exp(-Math.abs(d2))))/Math.LN2,d4=snap?Math.ceil(d3/snap)*snap:d3,delta=map._limitZoom(zoom+(0<this._delta?d4:-d4))-zoom;this._delta=0,this._startTime=null,delta&&("center"===map.options.scrollWheelZoom?map.setZoom(zoom+delta):map.setZoomAround(this._lastMousePos,zoom+delta))}});Map.addInitHook("addHandler","scrollWheelZoom",ScrollWheelZoom),Map.mergeOptions({tap:!0,tapTolerance:15});var Tap=Handler.extend({addHooks:function(){on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(e.touches){if(preventDefault(e),this._fireClick=!0,1<e.touches.length)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var first=e.touches[0],el=first.target;this._startPos=this._newPos=new Point(first.clientX,first.clientY),el.tagName&&"a"===el.tagName.toLowerCase()&&addClass(el,"leaflet-active"),this._holdTimeout=setTimeout(bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",first))},this),1e3),this._simulateEvent("mousedown",first),on(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(e){if(clearTimeout(this._holdTimeout),off(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&e&&e.changedTouches){var first=e.changedTouches[0],el=first.target;el&&el.tagName&&"a"===el.tagName.toLowerCase()&&removeClass(el,"leaflet-active"),this._simulateEvent("mouseup",first),this._isTapValid()&&this._simulateEvent("click",first)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var first=e.touches[0];this._newPos=new Point(first.clientX,first.clientY),this._simulateEvent("mousemove",first)},_simulateEvent:function(type,e){var simulatedEvent=document.createEvent("MouseEvents");simulatedEvent._simulated=!0,e.target._simulatedClick=!0,simulatedEvent.initMouseEvent(type,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(simulatedEvent)}});touch&&!pointer&&Map.addInitHook("addHandler","tap",Tap),Map.mergeOptions({touchZoom:touch&&!android23,bounceAtZoomLimits:!0});var TouchZoom=Handler.extend({addHooks:function(){addClass(this._map._container,"leaflet-touch-zoom"),on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){removeClass(this._map._container,"leaflet-touch-zoom"),off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var map=this._map;if(e.touches&&2===e.touches.length&&!map._animatingZoom&&!this._zooming){var p1=map.mouseEventToContainerPoint(e.touches[0]),p2=map.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=map.getSize()._divideBy(2),this._startLatLng=map.containerPointToLatLng(this._centerPoint),"center"!==map.options.touchZoom&&(this._pinchStartLatLng=map.containerPointToLatLng(p1.add(p2)._divideBy(2))),this._startDist=p1.distanceTo(p2),this._startZoom=map.getZoom(),this._moved=!1,this._zooming=!0,map._stop(),on(document,"touchmove",this._onTouchMove,this),on(document,"touchend",this._onTouchEnd,this),preventDefault(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var map=this._map,p1=map.mouseEventToContainerPoint(e.touches[0]),p2=map.mouseEventToContainerPoint(e.touches[1]),scale=p1.distanceTo(p2)/this._startDist;if(this._zoom=map.getScaleZoom(scale,this._startZoom),!map.options.bounceAtZoomLimits&&(this._zoom<map.getMinZoom()&&scale<1||this._zoom>map.getMaxZoom()&&1<scale)&&(this._zoom=map._limitZoom(this._zoom)),"center"===map.options.touchZoom){if(this._center=this._startLatLng,1==scale)return}else{var delta=p1._add(p2)._divideBy(2)._subtract(this._centerPoint);if(1==scale&&0===delta.x&&0===delta.y)return;this._center=map.unproject(map.project(this._pinchStartLatLng,this._zoom).subtract(delta),this._zoom)}this._moved||(map._moveStart(!0,!1),this._moved=!0),cancelAnimFrame(this._animRequest);var moveFn=bind(map._move,map,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=requestAnimFrame(moveFn,this,!0),preventDefault(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,cancelAnimFrame(this._animRequest),off(document,"touchmove",this._onTouchMove),off(document,"touchend",this._onTouchEnd),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});Map.addInitHook("addHandler","touchZoom",TouchZoom),Map.BoxZoom=BoxZoom,Map.DoubleClickZoom=DoubleClickZoom,Map.Drag=Drag,Map.Keyboard=Keyboard,Map.ScrollWheelZoom=ScrollWheelZoom,Map.Tap=Tap,Map.TouchZoom=TouchZoom,Object.freeze=freeze,exports.version="1.3.4",exports.Control=Control,exports.control=control,exports.Browser=Browser,exports.Evented=Evented,exports.Mixin=Mixin,exports.Util=Util,exports.Class=Class,exports.Handler=Handler,exports.extend=extend,exports.bind=bind,exports.stamp=stamp,exports.setOptions=setOptions,exports.DomEvent=DomEvent,exports.DomUtil=DomUtil,exports.PosAnimation=PosAnimation,exports.Draggable=Draggable,exports.LineUtil=LineUtil,exports.PolyUtil=PolyUtil,exports.Point=Point,exports.point=toPoint,exports.Bounds=Bounds,exports.bounds=toBounds,exports.Transformation=Transformation,exports.transformation=toTransformation,exports.Projection=index,exports.LatLng=LatLng,exports.latLng=toLatLng,exports.LatLngBounds=LatLngBounds,exports.latLngBounds=toLatLngBounds,exports.CRS=CRS,exports.GeoJSON=GeoJSON,exports.geoJSON=geoJSON,exports.geoJson=geoJson,exports.Layer=Layer,exports.LayerGroup=LayerGroup,exports.layerGroup=function(layers,options){return new LayerGroup(layers,options)},exports.FeatureGroup=FeatureGroup,exports.featureGroup=function(layers){return new FeatureGroup(layers)},exports.ImageOverlay=ImageOverlay,exports.imageOverlay=function(url,bounds,options){return new ImageOverlay(url,bounds,options)},exports.VideoOverlay=VideoOverlay,exports.videoOverlay=function(video,bounds,options){return new VideoOverlay(video,bounds,options)},exports.DivOverlay=DivOverlay,exports.Popup=Popup,exports.popup=function(options,source){return new Popup(options,source)},exports.Tooltip=Tooltip,exports.tooltip=function(options,source){return new Tooltip(options,source)},exports.Icon=Icon,exports.icon=function(options){return new Icon(options)},exports.DivIcon=DivIcon,exports.divIcon=function(options){return new DivIcon(options)},exports.Marker=Marker,exports.marker=function(latlng,options){return new Marker(latlng,options)},exports.TileLayer=TileLayer,exports.tileLayer=tileLayer,exports.GridLayer=GridLayer,exports.gridLayer=function(options){return new GridLayer(options)},exports.SVG=SVG,exports.svg=svg$1,exports.Renderer=Renderer,exports.Canvas=Canvas,exports.canvas=canvas$1,exports.Path=Path,exports.CircleMarker=CircleMarker,exports.circleMarker=function(latlng,options){return new CircleMarker(latlng,options)},exports.Circle=Circle,exports.circle=function(latlng,options,legacyOptions){return new Circle(latlng,options,legacyOptions)},exports.Polyline=Polyline,exports.polyline=function(latlngs,options){return new Polyline(latlngs,options)},exports.Polygon=Polygon,exports.polygon=function(latlngs,options){return new Polygon(latlngs,options)},exports.Rectangle=Rectangle,exports.rectangle=function(latLngBounds,options){return new Rectangle(latLngBounds,options)},exports.Map=Map,exports.map=function(id,options){return new Map(id,options)};var oldL=window.L;exports.noConflict=function(){return window.L=oldL,this},window.L=exports}(exports)},function(module,exports){var t,e;t=window,e=document,L.drawVersion="1.0.4",L.Draw={},L.drawLocal={draw:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},finish:{title:"Finish drawing",text:"Finish"},undo:{title:"Delete last point drawn",text:"Delete last point"},buttons:{polyline:"Draw a polyline",polygon:"Draw a polygon",rectangle:"Draw a rectangle",circle:"Draw a circle",marker:"Draw a marker",circlemarker:"Draw a circlemarker"}},handlers:{circle:{tooltip:{start:"Click and drag to draw circle."},radius:"Radius"},circlemarker:{tooltip:{start:"Click map to place circle marker."}},marker:{tooltip:{start:"Click map to place marker."}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},polyline:{error:"<strong>Error:</strong> shape edges cannot cross!",tooltip:{start:"Click to start drawing line.",cont:"Click to continue drawing line.",end:"Click last point to finish line."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},simpleshape:{tooltip:{end:"Release mouse to finish drawing."}}}},edit:{toolbar:{actions:{save:{title:"Save changes",text:"Save"},cancel:{title:"Cancel editing, discards all changes",text:"Cancel"},clearAll:{title:"Clear all layers",text:"Clear All"}},buttons:{edit:"Edit layers",editDisabled:"No layers to edit",remove:"Delete layers",removeDisabled:"No layers to delete"}},handlers:{edit:{tooltip:{text:"Drag handles or markers to edit features.",subtext:"Click cancel to undo changes."}},remove:{tooltip:{text:"Click on a feature to remove."}}}}},L.Draw.Event={},L.Draw.Event.CREATED="draw:created",L.Draw.Event.EDITED="draw:edited",L.Draw.Event.DELETED="draw:deleted",L.Draw.Event.DRAWSTART="draw:drawstart",L.Draw.Event.DRAWSTOP="draw:drawstop",L.Draw.Event.DRAWVERTEX="draw:drawvertex",L.Draw.Event.EDITSTART="draw:editstart",L.Draw.Event.EDITMOVE="draw:editmove",L.Draw.Event.EDITRESIZE="draw:editresize",L.Draw.Event.EDITVERTEX="draw:editvertex",L.Draw.Event.EDITSTOP="draw:editstop",L.Draw.Event.DELETESTART="draw:deletestart",L.Draw.Event.DELETESTOP="draw:deletestop",L.Draw.Event.TOOLBAROPENED="draw:toolbaropened",L.Draw.Event.TOOLBARCLOSED="draw:toolbarclosed",L.Draw.Event.MARKERCONTEXT="draw:markercontext",L.Draw=L.Draw||{},L.Draw.Feature=L.Handler.extend({initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e);var i=L.version.split(".");1===parseInt(i[0],10)&&2<=parseInt(i[1],10)?L.Draw.Feature.include(L.Evented.prototype):L.Draw.Feature.include(L.Mixin.Events)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire(L.Draw.Event.CREATED,{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&(this._map.fire("draw:canceled",{layerType:this.type}),this.disable())}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3,factor:1,maxPoints:0},initialize:function(t,e){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this.options.drawError.message=L.drawLocal.draw.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mouseout",this._onMouseOut,this).on("mousemove",this._onMouseMove,this).on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("touchstart",this._onTouch,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this).off("touchstart",this._onTouch,this).off("click",this._onTouch,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=e.getLatLngs(),o=i.splice(-1,1)[0];this._poly.setLatLngs(i),this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(o,!1)}},addVertex:function(t){2<=this._markers.length&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)?this._showErrorTooltip():(this._errorShown&&this._hideErrorTooltip(),this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0))},completeShape:function(){this._markers.length<=1||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_finishShape:function(){var t=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),e=this._poly.newLatLngIntersects(t[t.length-1]);!this.options.allowIntersection&&e||!this._shapeIsValid()?this._showErrorTooltip():(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._map.fire(L.Draw.Event.DRAWVERTEX,{layers:this._markerGroup}),this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers){this._onMouseMove(t),this._clickHandled=!0,this._disableNewMarkers();var e=t.originalEvent,i=e.clientX,o=e.clientY;this._startPoint.call(this,i,o)}},_startPoint:function(t,e){this._mouseDownOrigin=L.point(t,e)},_onMouseUp:function(t){var e=t.originalEvent,i=e.clientX,o=e.clientY;this._endPoint.call(this,i,o,t),this._clickHandled=null},_endPoint:function(e,i,o){if(this._mouseDownOrigin){var a=L.point(e,i).distanceTo(this._mouseDownOrigin),n=this._calculateFinishDistance(o.latlng);1<this.options.maxPoints&&this.options.maxPoints==this._markers.length+1?(this.addVertex(o.latlng),this._finishShape()):n<10&&L.Browser.touch?this._finishShape():Math.abs(a)<9*(t.devicePixelRatio||1)&&this.addVertex(o.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(t){var e,i,o=t.originalEvent;!o.touches||!o.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(e=o.touches[0].clientX,i=o.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,e,i),this._endPoint.call(this,e,i,t),this._touchHandled=null),this._clickHandled=null},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_calculateFinishDistance:function(t){var e;if(0<this._markers.length){var i;if(this.type===L.Draw.Polyline.TYPE)i=this._markers[this._markers.length-1];else{if(this.type!==L.Draw.Polygon.TYPE)return 1/0;i=this._markers[0]}var o=this._map.latLngToContainerPoint(i.getLatLng()),a=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),n=this._map.latLngToContainerPoint(a.getLatLng());e=o.distanceTo(n)}else e=1/0;return e},_updateFinishHandler:function(){var t=this._markers.length;1<t&&this._markers[t-1].on("click",this._finishShape,this),2<t&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers?this._markers.length:0;0<e&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,o,a,n=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),s=this.options.guidelineDistance,r=this.options.maxGuideLineLength,l=r<n?n-r:s;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));l<n;l+=this.options.guidelineDistance)i=l/n,o={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},(a=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer)).style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(a,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;e<i;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var e,i=this.options.showLength;return 0===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.start}:(e=i?this._getMeasurementString():"",1===this._markers.length?{text:L.drawLocal.draw.handlers.polyline.tooltip.cont,subtext:e}:{text:L.drawLocal.draw.handlers.polyline.tooltip.end,subtext:e})},_updateRunningMeasure:function(t,e){var i,o,a=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=a-(e?2:1),o=L.GeometryUtil.isVersion07x()?t.distanceTo(this._markers[i].getLatLng())*(this.options.factor||1):this._map.distance(t,this._markers[i].getLatLng())*(this.options.factor||1),this._measurementRunningTotal+=o*(e?1:-1))},_getMeasurementString:function(){var t,e=this._currentLatLng,i=this._markers[this._markers.length-1].getLatLng();return t=L.GeometryUtil.isVersion07x()?i&&e&&e.distanceTo?this._measurementRunningTotal+e.distanceTo(i)*(this.options.factor||1):this._measurementRunningTotal||0:i&&e?this._measurementRunningTotal+this._map.distance(e,i)*(this.options.factor||1):this._measurementRunningTotal||0,L.GeometryUtil.readableDistance(t,this.options.metric,this.options.feet,this.options.nautic,this.options.precision)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(L.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout(function(){this._disableMarkers=!1}.bind(this),50)},_cleanUpShape:function(){1<this._markers.length&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,showLength:!1,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0,feet:!0,nautic:!1,precision:{}},initialize:function(t,e){L.Draw.Polyline.prototype.initialize.call(this,t,e),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),2<t&&(this._markers[t-1].on("dblclick",this._finishShape,this),3<t&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getTooltipText:function(){var t,e;return 0===this._markers.length?t=L.drawLocal.draw.handlers.polygon.tooltip.start:(t=this._markers.length<3?L.drawLocal.draw.handlers.polygon.tooltip.cont:L.drawLocal.draw.handlers.polygon.tooltip.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area,e="";return t||this.options.showLength?(this.options.showLength&&(e=L.Draw.Polyline.prototype._getMeasurementString.call(this)),t&&(e+="<br>"+L.GeometryUtil.readableArea(t,this.options.metric,this.options.precision)),e):null},_shapeIsValid:function(){return 3<=this._markers.length},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Draw.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;0<t&&(this._markers[0].off("click",this._finishShape,this),2<t&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.SimpleShape={},L.Draw.SimpleShape=L.Draw.Feature.extend({options:{repeatMode:!1},initialize:function(t,e){this._endLabelText=L.drawLocal.draw.handlers.simpleshape.tooltip.end,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this),e.addEventListener("touchstart",L.DomEvent.preventDefault,{passive:!1}))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(e,"mouseup",this._onMouseUp,this),L.DomEvent.off(e,"touchend",this._onMouseUp,this),e.removeEventListener("touchstart",L.DomEvent.preventDefault),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(e,"mouseup",this._onMouseUp,this).on(e,"touchend",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Rectangle=L.Draw.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showArea:!0,metric:!0},initialize:function(t,e){this.type=L.Draw.Rectangle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.rectangle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},disable:function(){this._enabled&&(this._isCurrentlyTwoClickDrawing=!1,L.Draw.SimpleShape.prototype.disable.call(this))},_onMouseUp:function(t){this._shape||this._isCurrentlyTwoClickDrawing?this._isCurrentlyTwoClickDrawing&&!function(t,e){for(;(t=t.parentElement)&&!t.classList.contains(e););return t}(t.target,"leaflet-pane")||L.Draw.SimpleShape.prototype._onMouseUp.call(this):this._isCurrentlyTwoClickDrawing=!0},_drawShape:function(t){this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o=L.Draw.SimpleShape.prototype._getTooltipText.call(this),a=this._shape,n=this.options.showArea;return a&&(t=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=n?L.GeometryUtil.readableArea(e,this.options.metric):""),{text:o.text,subtext:i}}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.Marker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.marker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._tooltip.updateContent({text:this._initialLabelText}),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onTouch,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._map.off("click",this._onClick,this).off("click",this._onTouch,this),this._marker&&(this._marker.off("click",this._onClick,this),this._map.removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._mouseMarker.setLatLng(e),this._marker?(e=this._mouseMarker.getLatLng(),this._marker.setLatLng(e)):(this._marker=this._createMarker(e),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_createMarker:function(t){return new L.Marker(t,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset})},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_onTouch:function(t){this._onMouseMove(t),this._onClick()},_fireCreatedEvent:function(){var t=new L.Marker.Touch(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Draw.CircleMarker=L.Draw.Marker.extend({statics:{TYPE:"circlemarker"},options:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,zIndexOffset:2e3},initialize:function(t,e){this.type=L.Draw.CircleMarker.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circlemarker.tooltip.start,L.Draw.Feature.prototype.initialize.call(this,t,e)},_fireCreatedEvent:function(){var t=new L.CircleMarker(this._marker.getLatLng(),this.options);L.Draw.Feature.prototype._fireCreatedEvent.call(this,t)},_createMarker:function(t){return new L.CircleMarker(t,this.options)}}),L.Draw.Circle=L.Draw.SimpleShape.extend({statics:{TYPE:"circle"},options:{shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},showRadius:!0,metric:!0,feet:!0,nautic:!1},initialize:function(t,e){this.type=L.Draw.Circle.TYPE,this._initialLabelText=L.drawLocal.draw.handlers.circle.tooltip.start,L.Draw.SimpleShape.prototype.initialize.call(this,t,e)},_drawShape:function(t){if(L.GeometryUtil.isVersion07x())var e=this._startLatLng.distanceTo(t);else e=this._map.distance(this._startLatLng,t);this._shape?this._shape.setRadius(e):(this._shape=new L.Circle(this._startLatLng,e,this.options.shapeOptions),this._map.addLayer(this._shape))},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Draw.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_onMouseMove:function(t){var e,i=t.latlng,o=this.options.showRadius,a=this.options.metric;if(this._tooltip.updatePosition(i),this._isDrawing){this._drawShape(i),e=this._shape.getRadius().toFixed(1);var n="";o&&(n=L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(e,a,this.options.feet,this.options.nautic)),this._tooltip.updateContent({text:this._endLabelText,subtext:n})}}}),L.Edit=L.Edit||{},L.Edit.Marker=L.Handler.extend({initialize:function(t,e){this._marker=t,L.setOptions(this,e)},addHooks:function(){var t=this._marker;t.dragging.enable(),t.on("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},removeHooks:function(){var t=this._marker;t.dragging.disable(),t.off("dragend",this._onDragEnd,t),this._toggleMarkerHighlight()},_onDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_toggleMarkerHighlight:function(){var t=this._marker._icon;t&&(t.style.display="none",L.DomUtil.hasClass(t,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,-4)):(L.DomUtil.addClass(t,"leaflet-edit-marker-selected"),this._offsetMarker(t,4)),t.style.display="")},_offsetMarker:function(t,e){var i=parseInt(t.style.marginTop,10)-e,o=parseInt(t.style.marginLeft,10)-e;t.style.marginTop=i+"px",t.style.marginLeft=o+"px"}}),L.Marker.addInitHook(function(){L.Edit.Marker&&(this.editing=new L.Edit.Marker(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({initialize:function(t){this.latlngs=[t._latlngs],t._holes&&(this.latlngs=this.latlngs.concat(t._holes)),this._poly=t,this._poly.on("revert-edited",this._updateLatLngs,this)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._poly._latlngs)?this._poly._latlngs:this._poly._latlngs[0]:this._poly._latlngs},_eachVertexHandler:function(t){for(var e=0;e<this._verticesHandlers.length;e++)t(this._verticesHandlers[e])},addHooks:function(){this._initHandlers(),this._eachVertexHandler(function(t){t.addHooks()})},removeHooks:function(){this._eachVertexHandler(function(t){t.removeHooks()})},updateMarkers:function(){this._eachVertexHandler(function(t){t.updateMarkers()})},_initHandlers:function(){this._verticesHandlers=[];for(var t=0;t<this.latlngs.length;t++)this._verticesHandlers.push(new L.Edit.PolyVerticesEdit(this._poly,this.latlngs[t],this._poly.options.poly))},_updateLatLngs:function(t){this.latlngs=[t.layer._latlngs],t.layer._holes&&(this.latlngs=this.latlngs.concat(t.layer._holes))}}),L.Edit.PolyVerticesEdit=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),drawError:{color:"#b00b00",timeout:1e3}},initialize:function(t,e,i){L.Browser.touch&&(this.options.icon=this.options.touchIcon),this._poly=t,i&&i.drawError&&(i.drawError=L.Util.extend({},this.options.drawError,i.drawError)),this._latlngs=e,L.setOptions(this,i)},_defaultShape:function(){return L.Polyline._flat?L.Polyline._flat(this._latlngs)?this._latlngs:this._latlngs[0]:this._latlngs},addHooks:function(){var t=this._poly,e=t._path;t instanceof L.Polygon||(t.options.fill=!1,t.options.editing&&(t.options.editing.fill=!1)),e&&t.options.editing&&t.options.editing.className&&(t.options.original.className&&t.options.original.className.split(" ").forEach(function(t){L.DomUtil.removeClass(e,t)}),t.options.editing.className.split(" ").forEach(function(t){L.DomUtil.addClass(e,t)})),t.setStyle(t.options.editing),this._poly._map&&(this._map=this._poly._map,this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){var t=this._poly,e=t._path;e&&t.options.editing&&t.options.editing.className&&(t.options.editing.className.split(" ").forEach(function(t){L.DomUtil.removeClass(e,t)}),t.options.original.className&&t.options.original.className.split(" ").forEach(function(t){L.DomUtil.addClass(e,t)})),t.setStyle(t.options.original),t._map&&(t._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var t,e,i,o,n,s,a=this._defaultShape();for(t=0,i=a.length;t<i;t++)(o=this._createMarker(a[t],t)).on("click",this._onMarkerClick,this),o.on("contextmenu",this._onContextMenu,this),this._markers.push(o);for(t=0,e=i-1;t<i;e=t++)(0!==t||L.Polygon&&this._poly instanceof L.Polygon)&&(n=this._markers[e],s=this._markers[t],this._createMiddleMarker(n,s),this._updatePrevNext(n,s))},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:this.options.icon});return i._origLatLng=t,i._index=e,i.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._fireEdit,this).on("touchmove",this._onTouchMove,this).on("touchend",this._fireEdit,this).on("MSPointerMove",this._onTouchMove,this).on("MSPointerUp",this._fireEdit,this),this._markerGroup.addLayer(i),i},_onMarkerDragStart:function(){this._poly.fire("editstart")},_spliceLatLngs:function(){var t=this._defaultShape(),e=[].splice.apply(t,arguments);return this._poly._convertLatLngs(t,!0),this._poly.redraw(),e},_removeMarker:function(t){var e=t._index;this._markerGroup.removeLayer(t),this._markers.splice(e,1),this._spliceLatLngs(e,1),this._updateIndexes(e,-1),t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("touchmove",this._onMarkerDrag,this).off("touchend",this._fireEdit,this).off("click",this._onMarkerClick,this).off("MSPointerMove",this._onTouchMove,this).off("MSPointerUp",this._fireEdit,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit"),this._poly._map.fire(L.Draw.Event.EDITVERTEX,{layers:this._markerGroup,poly:this._poly})},_onMarkerDrag:function(t){var e=t.target,i=this._poly,o=L.LatLngUtil.cloneLatLng(e._origLatLng);if(L.extend(e._origLatLng,e._latlng),i.options.poly){var a=i._map._editTooltip;if(!i.options.poly.allowIntersection&&i.intersects()){L.extend(e._origLatLng,o),e.setLatLng(o);var n=i.options.color;i.setStyle({color:this.options.drawError.color}),a&&a.updateContent({text:L.drawLocal.draw.handlers.polyline.error}),setTimeout(function(){i.setStyle({color:n}),a&&a.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext})},1e3)}}e._middleLeft&&e._middleLeft.setLatLng(this._getMiddleLatLng(e._prev,e)),e._middleRight&&e._middleRight.setLatLng(this._getMiddleLatLng(e,e._next)),this._poly._bounds._southWest=L.latLng(1/0,1/0),this._poly._bounds._northEast=L.latLng(-1/0,-1/0);var s=this._poly.getLatLngs();this._poly._convertLatLngs(s,!0),this._poly.redraw(),this._poly.fire("editdrag")},_onMarkerClick:function(t){var e=L.Polygon&&this._poly instanceof L.Polygon?4:3,i=t.target;this._defaultShape().length<e||(this._removeMarker(i),this._updatePrevNext(i._prev,i._next),i._middleLeft&&this._markerGroup.removeLayer(i._middleLeft),i._middleRight&&this._markerGroup.removeLayer(i._middleRight),i._prev&&i._next?this._createMiddleMarker(i._prev,i._next):i._prev?i._next||(i._prev._middleRight=null):i._next._middleLeft=null,this._fireEdit())},_onContextMenu:function(t){var e=t.target;this._poly,this._poly._map.fire(L.Draw.Event.MARKERCONTEXT,{marker:e,layers:this._markerGroup,poly:this._poly}),L.DomEvent.stopPropagation},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e),o=t.target;L.extend(o._origLatLng,i),o._middleLeft&&o._middleLeft.setLatLng(this._getMiddleLatLng(o._prev,o)),o._middleRight&&o._middleRight.setLatLng(this._getMiddleLatLng(o,o._next)),this._poly.redraw(),this.updateMarkers()},_updateIndexes:function(t,e){this._markerGroup.eachLayer(function(i){i._index>t&&(i._index+=e)})},_createMiddleMarker:function(t,e){var i,o,a,n=this._getMiddleLatLng(t,e),s=this._createMarker(n);s.setOpacity(.6),t._middleRight=e._middleLeft=s,o=function(){s.off("touchmove",o,this);var a=e._index;s._index=a,s.off("click",i,this).on("click",this._onMarkerClick,this),n.lat=s.getLatLng().lat,n.lng=s.getLatLng().lng,this._spliceLatLngs(a,0,n),this._markers.splice(a,0,s),s.setOpacity(1),this._updateIndexes(a,1),e._index++,this._updatePrevNext(t,s),this._updatePrevNext(s,e),this._poly.fire("editstart")},a=function(){s.off("dragstart",o,this),s.off("dragend",a,this),s.off("touchmove",o,this),this._createMiddleMarker(t,s),this._createMiddleMarker(s,e)},i=function(){o.call(this),a.call(this),this._fireEdit()},s.on("click",i,this).on("dragstart",o,this).on("dragend",a,this).on("touchmove",o,this),this._markerGroup.addLayer(s)},_updatePrevNext:function(t,e){t&&(t._next=e),e&&(e._prev=t)},_getMiddleLatLng:function(t,e){var i=this._poly._map,o=i.project(t.getLatLng()),a=i.project(e.getLatLng());return i.unproject(o._add(a)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))}),L.Edit=L.Edit||{},L.Edit.SimpleShape=L.Handler.extend({options:{moveIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move"}),resizeIcon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize"}),touchMoveIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-move leaflet-touch-icon"}),touchResizeIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-edit-resize leaflet-touch-icon"})},initialize:function(t,e){L.Browser.touch&&(this.options.moveIcon=this.options.touchMoveIcon,this.options.resizeIcon=this.options.touchResizeIcon),this._shape=t,L.Util.setOptions(this,e)},addHooks:function(){var t=this._shape;this._shape._map&&(this._map=this._shape._map,t.setStyle(t.options.editing),t._map&&(this._map=t._map,this._markerGroup||this._initMarkers(),this._map.addLayer(this._markerGroup)))},removeHooks:function(){var t=this._shape;if(t.setStyle(t.options.original),t._map){this._unbindMarker(this._moveMarker);for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._unbindMarker(this._resizeMarkers[e]);this._resizeMarkers=null,this._map.removeLayer(this._markerGroup),delete this._markerGroup}this._map=null},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._createMoveMarker(),this._createResizeMarker()},_createMoveMarker:function(){},_createResizeMarker:function(){},_createMarker:function(t,e){var i=new L.Marker.Touch(t,{draggable:!0,icon:e,zIndexOffset:10});return this._bindMarker(i),this._markerGroup.addLayer(i),i},_bindMarker:function(t){t.on("dragstart",this._onMarkerDragStart,this).on("drag",this._onMarkerDrag,this).on("dragend",this._onMarkerDragEnd,this).on("touchstart",this._onTouchStart,this).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onTouchEnd,this).on("MSPointerUp",this._onTouchEnd,this)},_unbindMarker:function(t){t.off("dragstart",this._onMarkerDragStart,this).off("drag",this._onMarkerDrag,this).off("dragend",this._onMarkerDragEnd,this).off("touchstart",this._onTouchStart,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onTouchEnd,this).off("MSPointerUp",this._onTouchEnd,this)},_onMarkerDragStart:function(t){t.target.setOpacity(0),this._shape.fire("editstart")},_fireEdit:function(){this._shape.edited=!0,this._shape.fire("edit")},_onMarkerDrag:function(t){var e=t.target,i=e.getLatLng();e===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),this._shape.fire("editdrag")},_onMarkerDragEnd:function(t){t.target.setOpacity(1),this._fireEdit()},_onTouchStart:function(t){if(L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t),"function"==typeof this._getCorners){var e=this._getCorners(),i=t.target,o=i._cornerIndex;i.setOpacity(0),this._oppositeCorner=e[(o+2)%4],this._toggleCornerMarkers(0,o)}this._shape.fire("editstart")},_onTouchMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent.touches[0]),i=this._map.layerPointToLatLng(e);return t.target===this._moveMarker?this._move(i):this._resize(i),this._shape.redraw(),!1},_onTouchEnd:function(t){t.target.setOpacity(1),this.updateMarkers(),this._fireEdit()},_move:function(){},_resize:function(){}}),L.Edit=L.Edit||{},L.Edit.Rectangle=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var e=this._shape.getBounds().getCenter();this._moveMarker=this._createMarker(e,this.options.moveIcon)},_createResizeMarker:function(){var t=this._getCorners();this._resizeMarkers=[];for(var e=0,i=t.length;e<i;e++)this._resizeMarkers.push(this._createMarker(t[e],this.options.resizeIcon)),this._resizeMarkers[e]._cornerIndex=e},_onMarkerDragStart:function(t){L.Edit.SimpleShape.prototype._onMarkerDragStart.call(this,t);var e=this._getCorners(),o=t.target._cornerIndex;this._oppositeCorner=e[(o+2)%4],this._toggleCornerMarkers(0,o)},_onMarkerDragEnd:function(t){var i,o=t.target;o===this._moveMarker&&(i=this._shape.getBounds().getCenter(),o.setLatLng(i)),this._toggleCornerMarkers(1),this._repositionCornerMarkers(),L.Edit.SimpleShape.prototype._onMarkerDragEnd.call(this,t)},_move:function(t){for(var e,i=this._shape._defaultShape?this._shape._defaultShape():this._shape.getLatLngs(),a=this._shape.getBounds().getCenter(),n=[],s=0,r=i.length;s<r;s++)e=[i[s].lat-a.lat,i[s].lng-a.lng],n.push([t.lat+e[0],t.lng+e[1]]);this._shape.setLatLngs(n),this._repositionCornerMarkers(),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})},_resize:function(t){var e;this._shape.setBounds(L.latLngBounds(t,this._oppositeCorner)),e=this._shape.getBounds(),this._moveMarker.setLatLng(e.getCenter()),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})},_getCorners:function(){var t=this._shape.getBounds();return[t.getNorthWest(),t.getNorthEast(),t.getSouthEast(),t.getSouthWest()]},_toggleCornerMarkers:function(t){for(var e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setOpacity(t)},_repositionCornerMarkers:function(){for(var t=this._getCorners(),e=0,i=this._resizeMarkers.length;e<i;e++)this._resizeMarkers[e].setLatLng(t[e])}}),L.Rectangle.addInitHook(function(){L.Edit.Rectangle&&(this.editing=new L.Edit.Rectangle(this),this.options.editable&&this.editing.enable())}),L.Edit=L.Edit||{},L.Edit.CircleMarker=L.Edit.SimpleShape.extend({_createMoveMarker:function(){var t=this._shape.getLatLng();this._moveMarker=this._createMarker(t,this.options.moveIcon)},_createResizeMarker:function(){this._resizeMarkers=[]},_move:function(t){if(this._resizeMarkers.length){var e=this._getResizeMarkerPoint(t);this._resizeMarkers[0].setLatLng(e)}this._shape.setLatLng(t),this._map.fire(L.Draw.Event.EDITMOVE,{layer:this._shape})}}),L.CircleMarker.addInitHook(function(){L.Edit.CircleMarker&&(this.editing=new L.Edit.CircleMarker(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()})}),L.Edit=L.Edit||{},L.Edit.Circle=L.Edit.CircleMarker.extend({_createResizeMarker:function(){var t=this._shape.getLatLng(),e=this._getResizeMarkerPoint(t);this._resizeMarkers=[],this._resizeMarkers.push(this._createMarker(e,this.options.resizeIcon))},_getResizeMarkerPoint:function(t){var e=this._shape._radius*Math.cos(Math.PI/4),i=this._map.project(t);return this._map.unproject([i.x+e,i.y-e])},_resize:function(t){var e=this._moveMarker.getLatLng();L.GeometryUtil.isVersion07x()?radius=e.distanceTo(t):radius=this._map.distance(e,t),this._shape.setRadius(radius),this._map.editTooltip&&this._map._editTooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.subtext+"<br />"+L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.draw.handlers.circle.radius+": "+L.GeometryUtil.readableDistance(radius,!0,this.options.feet,this.options.nautic)}),this._shape.setRadius(radius),this._map.fire(L.Draw.Event.EDITRESIZE,{layer:this._shape})}}),L.Circle.addInitHook(function(){L.Edit.Circle&&(this.editing=new L.Edit.Circle(this),this.options.editable&&this.editing.enable())}),L.Map.mergeOptions({touchExtend:!0}),L.Map.TouchExtend=L.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){L.DomEvent.on(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.on(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.on(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.on(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.on(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.on(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.on(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.on(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.on(this._container,"touchleave",this._onTouchLeave,this))},removeHooks:function(){L.DomEvent.off(this._container,"touchstart",this._onTouchStart,this),L.DomEvent.off(this._container,"touchend",this._onTouchEnd,this),L.DomEvent.off(this._container,"touchmove",this._onTouchMove,this),this._detectIE()?(L.DomEvent.off(this._container,"MSPointerDown",this._onTouchStart,this),L.DomEvent.off(this._container,"MSPointerUp",this._onTouchEnd,this),L.DomEvent.off(this._container,"MSPointerMove",this._onTouchMove,this),L.DomEvent.off(this._container,"MSPointerCancel",this._onTouchCancel,this)):(L.DomEvent.off(this._container,"touchcancel",this._onTouchCancel,this),L.DomEvent.off(this._container,"touchleave",this._onTouchLeave,this))},_touchEvent:function(t,e){var i={};if(void 0!==t.touches){if(!t.touches.length)return;i=t.touches[0]}else{if("touch"!==t.pointerType)return;if(i=t,!this._filterClick(t))return}var o=this._map.mouseEventToContainerPoint(i),a=this._map.mouseEventToLayerPoint(i),n=this._map.layerPointToLatLng(a);this._map.fire(e,{latlng:n,layerPoint:a,containerPoint:o,pageX:i.pageX,pageY:i.pageY,originalEvent:t})},_filterClick:function(t){var e=t.timeStamp||t.originalEvent.timeStamp,i=L.DomEvent._lastClick&&e-L.DomEvent._lastClick;return i&&100<i&&i<500||t.target._simulatedClick&&!t._simulated?(L.DomEvent.stop(t),!1):(L.DomEvent._lastClick=e,!0)},_onTouchStart:function(t){this._map._loaded&&this._touchEvent(t,"touchstart")},_onTouchEnd:function(t){this._map._loaded&&this._touchEvent(t,"touchend")},_onTouchCancel:function(t){if(this._map._loaded){var e="touchcancel";this._detectIE()&&(e="pointercancel"),this._touchEvent(t,e)}},_onTouchLeave:function(t){this._map._loaded&&this._touchEvent(t,"touchleave")},_onTouchMove:function(t){this._map._loaded&&this._touchEvent(t,"touchmove")},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(0<i)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);if(0<e.indexOf("Trident/")){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}var a=e.indexOf("Edge/");return 0<a&&parseInt(e.substring(a+5,e.indexOf(".",a)),10)}}),L.Map.addInitHook("addHandler","touchExtend",L.Map.TouchExtend),L.Marker.Touch=L.Marker.extend({_initInteraction:function(){return this.addInteractiveTarget?L.Marker.prototype._initInteraction.apply(this):this._initInteractionLegacy()},_initInteractionLegacy:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu","touchstart","touchend","touchmove"];this._detectIE?e.concat(["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"]):e.concat(["touchcancel"]),L.DomUtil.addClass(t,"leaflet-clickable"),L.DomEvent.on(t,"click",this._onMouseClick,this),L.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)L.DomEvent.on(t,e[i],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_detectIE:function(){var e=t.navigator.userAgent,i=e.indexOf("MSIE ");if(0<i)return parseInt(e.substring(i+5,e.indexOf(".",i)),10);if(0<e.indexOf("Trident/")){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}var a=e.indexOf("Edge/");return 0<a&&parseInt(e.substring(a+5,e.indexOf(".",a)),10)}}),L.LatLngUtil={cloneLatLngs:function(t){for(var e=[],i=0,o=t.length;i<o;i++)Array.isArray(t[i])?e.push(L.LatLngUtil.cloneLatLngs(t[i])):e.push(this.cloneLatLng(t[i]));return e},cloneLatLng:function(t){return L.latLng(t.lat,t.lng)}},function(){var t={km:2,ha:2,m:0,mi:2,ac:2,yd:0,ft:0,nm:2};L.GeometryUtil=L.extend(L.GeometryUtil||{},{geodesicArea:function(t){var e,i,o=t.length,a=0,n=Math.PI/180;if(2<o){for(var s=0;s<o;s++)e=t[s],a+=((i=t[(s+1)%o]).lng-e.lng)*n*(2+Math.sin(e.lat*n)+Math.sin(i.lat*n));a=6378137*a*6378137/2}return Math.abs(a)},formattedNumber:function(t,e){var i=parseFloat(t).toFixed(e),o=L.drawLocal.format&&L.drawLocal.format.numeric,a=o&&o.delimiters,n=a&&a.thousands,s=a&&a.decimal;if(n||s){var r=i.split(".");i=n?r[0].replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+n):r[0],s=s||".",1<r.length&&(i=i+s+r[1])}return i},readableArea:function(e,i,o){var n;return o=L.Util.extend({},t,o),i?(n=["ha","m"],type=typeof i,"string"===type?n=[i]:"boolean"!==type&&(n=i),1e6<=e&&-1!==n.indexOf("km")?L.GeometryUtil.formattedNumber(1e-6*e,o.km)+" kmÂ²":1e4<=e&&-1!==n.indexOf("ha")?L.GeometryUtil.formattedNumber(1e-4*e,o.ha)+" ha":L.GeometryUtil.formattedNumber(e,o.m)+" mÂ²"):3097600<=(e/=.836127)?L.GeometryUtil.formattedNumber(e/3097600,o.mi)+" miÂ²":4840<=e?L.GeometryUtil.formattedNumber(e/4840,o.ac)+" acres":L.GeometryUtil.formattedNumber(e,o.yd)+" ydÂ²"},readableDistance:function(e,i,o,a,n){var s;switch(n=L.Util.extend({},t,n),i?"string"==typeof i?i:"metric":o?"feet":a?"nauticalMile":"yards"){case"metric":s=1e3<e?L.GeometryUtil.formattedNumber(e/1e3,n.km)+" km":L.GeometryUtil.formattedNumber(e,n.m)+" m";break;case"feet":e*=3.28083,s=L.GeometryUtil.formattedNumber(e,n.ft)+" ft";break;case"nauticalMile":e*=.53996,s=L.GeometryUtil.formattedNumber(e/1e3,n.nm)+" nm";break;case"yards":default:s=1760<(e*=1.09361)?L.GeometryUtil.formattedNumber(e/1760,n.mi)+" miles":L.GeometryUtil.formattedNumber(e,n.yd)+" yd"}return s},isVersion07x:function(){var t=L.version.split(".");return 0===parseInt(t[0],10)&&7===parseInt(t[1],10)}})}(),L.Util.extend(L.LineUtil,{segmentsIntersect:function(t,e,i,o){return this._checkCounterclockwise(t,i,o)!==this._checkCounterclockwise(e,i,o)&&this._checkCounterclockwise(t,e,i)!==this._checkCounterclockwise(t,e,o)},_checkCounterclockwise:function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}}),L.Polyline.include({intersects:function(){var t,e,i,o=this._getProjectedPoints(),a=o?o.length:0;if(this._tooFewPointsForIntersection())return!1;for(t=a-1;3<=t;t--)if(e=o[t-1],i=o[t],this._lineSegmentsIntersectsRange(e,i,t-2))return!0;return!1},newLatLngIntersects:function(t,e){return!!this._map&&this.newPointIntersects(this._map.latLngToLayerPoint(t),e)},newPointIntersects:function(t,e){var i=this._getProjectedPoints(),o=i?i.length:0,a=i?i[o-1]:null,n=o-2;return!this._tooFewPointsForIntersection(1)&&this._lineSegmentsIntersectsRange(a,t,n,e?1:0)},_tooFewPointsForIntersection:function(t){var e=this._getProjectedPoints(),i=e?e.length:0;return!e||(i+=t||0)<=3},_lineSegmentsIntersectsRange:function(t,e,i,o){var a,n,s=this._getProjectedPoints();o=o||0;for(var r=i;o<r;r--)if(a=s[r-1],n=s[r],L.LineUtil.segmentsIntersect(t,e,a,n))return!0;return!1},_getProjectedPoints:function(){if(!this._defaultShape)return this._originalPoints;for(var t=[],e=this._defaultShape(),i=0;i<e.length;i++)t.push(this._map.latLngToLayerPoint(e[i]));return t}}),L.Polygon.include({intersects:function(){var t,e,i,o,a=this._getProjectedPoints();return!this._tooFewPointsForIntersection()&&(!!L.Polyline.prototype.intersects.call(this)||(t=a.length,e=a[0],i=a[t-1],o=t-2,this._lineSegmentsIntersectsRange(i,e,o,1)))}}),L.Control.Draw=L.Control.extend({options:{position:"topleft",draw:{},edit:!1},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");var e;L.Control.prototype.initialize.call(this,t),this._toolbars={},L.DrawToolbar&&this.options.draw&&(e=new L.DrawToolbar(this.options.draw),this._toolbars[L.DrawToolbar.TYPE]=e,this._toolbars[L.DrawToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.EditToolbar&&this.options.edit&&(e=new L.EditToolbar(this.options.edit),this._toolbars[L.EditToolbar.TYPE]=e,this._toolbars[L.EditToolbar.TYPE].on("enable",this._toolbarEnabled,this)),L.toolbar=this},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),o=!1;for(var a in this._toolbars)this._toolbars.hasOwnProperty(a)&&(e=this._toolbars[a].addToolbar(t))&&(o||(L.DomUtil.hasClass(e,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(e.childNodes[0],"leaflet-draw-toolbar-top"),o=!0),i.appendChild(e));return i},onRemove:function(){for(var t in this._toolbars)this._toolbars.hasOwnProperty(t)&&this._toolbars[t].removeToolbar()},setDrawingOptions:function(t){for(var e in this._toolbars)this._toolbars[e]instanceof L.DrawToolbar&&this._toolbars[e].setOptions(t)},_toolbarEnabled:function(t){var e=t.target;for(var i in this._toolbars)this._toolbars[i]!==e&&this._toolbars[i].disable()}}),L.Map.mergeOptions({drawControlTooltips:!0,drawControl:!1}),L.Map.addInitHook(function(){this.options.drawControl&&(this.drawControl=new L.Control.Draw,this.addControl(this.drawControl))}),L.Toolbar=L.Class.extend({initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null;var e=L.version.split(".");1===parseInt(e[0],10)&&2<=parseInt(e[1],10)?L.Toolbar.include(L.Evented.prototype):L.Toolbar.include(L.Mixin.Events)},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),o=0,a=this._toolbarClass||"",n=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-bar"),this._map=t,e=0;e<n.length;e++)n[e].enabled&&this._initModeHandler(n[e].handler,this._toolbarContainer,o++,a,n[e].title);if(o)return this._lastButtonIndex=--o,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;e<i;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,o,a){var n=t.type;this._modes[n]={},this._modes[n].handler=t,this._modes[n].button=this._createButton({type:n,title:a,className:o+"-"+n,container:e,callback:this._modes[n].handler.enable,context:this._modes[n].handler}),this._modes[n].buttonIndex=i,this._modes[n].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!t.MSStream},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container),i=L.DomUtil.create("span","sr-only",t.container);e.href="#",e.appendChild(i),t.title&&(e.title=t.title,i.innerHTML=t.title),t.text&&(e.innerHTML=t.text,i.innerHTML=t.text);var o=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"touchstart",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,o,t.callback,t.context),e},_disposeButton:function(t,e){var i=this._detectIOS()?"touchstart":"click";L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"touchstart",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,i,e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,o,a,n=this._actionsContainer,s=this.getActions(t),r=s.length;for(i=0,o=this._actionButtons.length;i<o;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];n.firstChild;)n.removeChild(n.firstChild);for(var l=0;l<r;l++)"enabled"in s[l]&&!s[l].enabled||(e=L.DomUtil.create("li","",n),a=this._createButton({title:s[l].title,text:s[l].text,container:e,callback:s[l].callback,context:s[l].context}),this._actionButtons.push({button:a,callback:s[l].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block",this._map.fire(L.Draw.Event.TOOLBAROPENED)},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom"),this._map.fire(L.Draw.Event.TOOLBARCLOSED)}}),L.Draw=L.Draw||{},L.Draw.Tooltip=L.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane,this._visible=!1,this._container=t.options.drawControlTooltips?L.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane):null,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container&&(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?0<t.subtext.length&&this._singleLineLabel&&(L.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(L.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(0<t.subtext.length?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",t.text||t.subtext?(this._visible=!0,this._container.style.visibility="inherit"):(this._visible=!1,this._container.style.visibility="hidden")),this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),i=this._container;return this._container&&(this._visible&&(i.style.visibility="inherit"),L.DomUtil.setPosition(i,e)),this},showAsError:function(){return this._container&&L.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&L.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),L.DrawToolbar=L.Toolbar.extend({statics:{TYPE:"draw"},options:{polyline:{},polygon:{},rectangle:{},circle:{},marker:{},circlemarker:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-draw",L.Toolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(t,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:this.options.polygon,handler:new L.Draw.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(t,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker},{enabled:this.options.circlemarker,handler:new L.Draw.CircleMarker(t,this.options.circlemarker),title:L.drawLocal.draw.toolbar.buttons.circlemarker}]},getActions:function(t){return[{enabled:t.completeShape,title:L.drawLocal.draw.toolbar.finish.title,text:L.drawLocal.draw.toolbar.finish.text,callback:t.completeShape,context:t},{enabled:t.deleteLastVertex,title:L.drawLocal.draw.toolbar.undo.title,text:L.drawLocal.draw.toolbar.undo.text,callback:t.deleteLastVertex,context:t},{title:L.drawLocal.draw.toolbar.actions.title,text:L.drawLocal.draw.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){for(var e in L.setOptions(this,t),this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])}}),L.EditToolbar=L.Toolbar.extend({statics:{TYPE:"edit"},options:{edit:{selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1}},remove:{},poly:null,featureGroup:null},initialize:function(t){t.edit&&(void 0===t.edit.selectedPathOptions&&(t.edit.selectedPathOptions=this.options.edit.selectedPathOptions),t.edit.selectedPathOptions=L.extend({},this.options.edit.selectedPathOptions,t.edit.selectedPathOptions)),t.remove&&(t.remove=L.extend({},this.options.remove,t.remove)),t.poly&&(t.poly=L.extend({},this.options.poly,t.poly)),this._toolbarClass="leaflet-draw-edit",L.Toolbar.prototype.initialize.call(this,t),this._selectedFeatureCount=0},getModeHandlers:function(t){var e=this.options.featureGroup;return[{enabled:this.options.edit,handler:new L.EditToolbar.Edit(t,{featureGroup:e,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:this.options.remove,handler:new L.EditToolbar.Delete(t,{featureGroup:e}),title:L.drawLocal.edit.toolbar.buttons.remove}]},getActions:function(t){var e=[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}];return t.removeAllLayers&&e.push({title:L.drawLocal.edit.toolbar.actions.clearAll.title,text:L.drawLocal.edit.toolbar.actions.clearAll.text,callback:this._clearAllLayers,context:this}),e},addToolbar:function(t){var e=L.Toolbar.prototype.addToolbar.call(this,t);return this._checkDisabled(),this.options.featureGroup.on("layeradd layerremove",this._checkDisabled,this),e},removeToolbar:function(){this.options.featureGroup.off("layeradd layerremove",this._checkDisabled,this),L.Toolbar.prototype.removeToolbar.call(this)},disable:function(){this.enabled()&&(this._activeMode.handler.revertLayers(),L.Toolbar.prototype.disable.call(this))},_save:function(){this._activeMode.handler.save(),this._activeMode&&this._activeMode.handler.disable()},_clearAllLayers:function(){this._activeMode.handler.removeAllLayers(),this._activeMode&&this._activeMode.handler.disable()},_checkDisabled:function(){var t,i=0!==this.options.featureGroup.getLayers().length;this.options.edit&&(t=this._modes[L.EditToolbar.Edit.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.edit:L.drawLocal.edit.toolbar.buttons.editDisabled)),this.options.remove&&(t=this._modes[L.EditToolbar.Delete.TYPE].button,i?L.DomUtil.removeClass(t,"leaflet-disabled"):L.DomUtil.addClass(t,"leaflet-disabled"),t.setAttribute("title",i?L.drawLocal.edit.toolbar.buttons.remove:L.drawLocal.edit.toolbar.buttons.removeDisabled))}}),L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.setOptions(this,e),this._featureGroup=e.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE;var i=L.version.split(".");1===parseInt(i[0],10)&&2<=parseInt(i[1],10)?L.EditToolbar.Edit.include(L.Evented.prototype):L.EditToolbar.Edit.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.EDITSTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this),this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}),t._editTooltip=this._tooltip,this._updateTooltip(),this._map.on("mousemove",this._onMouseMove,this).on("touchmove",this._onMouseMove,this).on("MSPointerMove",this._onMouseMove,this).on(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this).off("touchmove",this._onMouseMove,this).off("MSPointerMove",this._onMouseMove,this).off(L.Draw.Event.EDITVERTEX,this._updateTooltip,this))},revertLayers:function(){this._featureGroup.eachLayer(function(t){this._revertLayer(t)},this)},save:function(){var t=new L.LayerGroup;this._featureGroup.eachLayer(function(e){e.edited&&(t.addLayer(e),e.edited=!1)}),this._map.fire(L.Draw.Event.EDITED,{layers:t})},_backupLayer:function(t){var e=L.Util.stamp(t);this._uneditedLayerProps[e]||(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?this._uneditedLayerProps[e]={latlngs:L.LatLngUtil.cloneLatLngs(t.getLatLngs())}:t instanceof L.Circle?this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng()),radius:t.getRadius()}:(t instanceof L.Marker||t instanceof L.CircleMarker)&&(this._uneditedLayerProps[e]={latlng:L.LatLngUtil.cloneLatLng(t.getLatLng())}))},_getTooltipText:function(){return{text:L.drawLocal.edit.handlers.edit.tooltip.text,subtext:L.drawLocal.edit.handlers.edit.tooltip.subtext}},_updateTooltip:function(){this._tooltip.updateContent(this._getTooltipText())},_revertLayer:function(t){var e=L.Util.stamp(t);t.edited=!1,this._uneditedLayerProps.hasOwnProperty(e)&&(t instanceof L.Polyline||t instanceof L.Polygon||t instanceof L.Rectangle?t.setLatLngs(this._uneditedLayerProps[e].latlngs):t instanceof L.Circle?(t.setLatLng(this._uneditedLayerProps[e].latlng),t.setRadius(this._uneditedLayerProps[e].radius)):(t instanceof L.Marker||t instanceof L.CircleMarker)&&t.setLatLng(this._uneditedLayerProps[e].latlng),t.fire("revert-edited",{layer:t}))},_enableLayerEdit:function(t){var e,i,o=t.layer||t.target||t;this._backupLayer(o),this.options.poly&&(i=L.Util.extend({},this.options.poly),o.options.poly=i),this.options.selectedPathOptions&&((e=L.Util.extend({},this.options.selectedPathOptions)).maintainColor&&(e.color=o.options.color,e.fillColor=o.options.fillColor),o.options.original=L.extend({},o.options),o.options.editing=e),o instanceof L.Marker?(o.editing&&o.editing.enable(),o.dragging.enable(),o.on("dragend",this._onMarkerDragEnd).on("touchmove",this._onTouchMove,this).on("MSPointerMove",this._onTouchMove,this).on("touchend",this._onMarkerDragEnd,this).on("MSPointerUp",this._onMarkerDragEnd,this)):o.editing.enable()},_disableLayerEdit:function(t){var e=t.layer||t.target||t;e.edited=!1,e.editing&&e.editing.disable(),delete e.options.editing,delete e.options.original,this._selectedPathOptions&&(e instanceof L.Marker?this._toggleMarkerHighlight(e):(e.setStyle(e.options.previousOptions),delete e.options.previousOptions)),e instanceof L.Marker?(e.dragging.disable(),e.off("dragend",this._onMarkerDragEnd,this).off("touchmove",this._onTouchMove,this).off("MSPointerMove",this._onTouchMove,this).off("touchend",this._onMarkerDragEnd,this).off("MSPointerUp",this._onMarkerDragEnd,this)):e.editing.disable()},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_onMarkerDragEnd:function(t){var e=t.target;e.edited=!0,this._map.fire(L.Draw.Event.EDITMOVE,{layer:e})},_onTouchMove:function(t){var e=t.originalEvent.changedTouches[0],i=this._map.mouseEventToLayerPoint(e),o=this._map.layerPointToLatLng(i);t.target.setLatLng(o)},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.EditToolbar.Delete=L.Handler.extend({statics:{TYPE:"remove"},initialize:function(t,e){if(L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this._deletableLayers=this.options.featureGroup,!(this._deletableLayers instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this.type=L.EditToolbar.Delete.TYPE;var i=L.version.split(".");1===parseInt(i[0],10)&&2<=parseInt(i[1],10)?L.EditToolbar.Delete.include(L.Evented.prototype):L.EditToolbar.Delete.include(L.Mixin.Events)},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disable:function(){this._enabled&&(this._deletableLayers.off("layeradd",this._enableLayerDelete,this).off("layerremove",this._disableLayerDelete,this),L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DELETESTOP,{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._deletableLayers.eachLayer(this._enableLayerDelete,this),this._deletedLayers=new L.LayerGroup,this._tooltip=new L.Draw.Tooltip(this._map),this._tooltip.updateContent({text:L.drawLocal.edit.handlers.remove.tooltip.text}),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){this._map&&(this._deletableLayers.eachLayer(this._disableLayerDelete,this),this._deletedLayers=null,this._tooltip.dispose(),this._tooltip=null,this._map.off("mousemove",this._onMouseMove,this))},revertLayers:function(){this._deletedLayers.eachLayer(function(t){this._deletableLayers.addLayer(t),t.fire("revert-deleted",{layer:t})},this)},save:function(){this._map.fire(L.Draw.Event.DELETED,{layers:this._deletedLayers})},removeAllLayers:function(){this._deletableLayers.eachLayer(function(t){this._removeLayer({layer:t})},this),this.save()},_enableLayerDelete:function(t){(t.layer||t.target||t).on("click",this._removeLayer,this)},_disableLayerDelete:function(t){var e=t.layer||t.target||t;e.off("click",this._removeLayer,this),this._deletedLayers.removeLayer(e)},_removeLayer:function(t){var e=t.layer||t.target||t;this._deletableLayers.removeLayer(e),this._deletedLayers.addLayer(e),e.fire("deleted")},_onMouseMove:function(t){this._tooltip.updatePosition(t.latlng)},_hasAvailableLayers:function(){return 0!==this._deletableLayers.getLayers().length}})},function(module,exports){L.GridLayer.GoogleMutant=L.GridLayer.extend({options:{minZoom:0,maxZoom:23,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,type:"roadmap",maxNativeZoom:21},initialize:function(options){L.GridLayer.prototype.initialize.call(this,options),this._ready=!!window.google&&!!window.google.maps&&!!window.google.maps.Map,this._GAPIPromise=this._ready?Promise.resolve(window.google):new Promise(function(resolve,reject){var checkCounter=0,intervalId=null;intervalId=setInterval(function(){return 10<=checkCounter?(clearInterval(intervalId),reject(new Error("window.google not found after 10 attempts"))):window.google&&window.google.maps&&window.google.maps.Map?(clearInterval(intervalId),resolve(window.google)):void checkCounter++},500)}),this._tileCallbacks={},this._freshTiles={},this._imagesPerTile="hybrid"===this.options.type?2:1},onAdd:function(map){L.GridLayer.prototype.onAdd.call(this,map),this._initMutantContainer(),this._GAPIPromise.then(function(){if(this._ready=!0,this._map=map,this._initMutant(),map.on("viewreset",this._reset,this),map.on("move",this._update,this),map.on("zoomend",this._handleZoomAnim,this),map.on("resize",this._resize,this),google.maps.event.addListenerOnce(this._mutant,"idle",function(){this._checkZoomLevels(),this._mutantIsReady=!0}.bind(this)),map._controlCorners.bottomright.style.marginBottom="20px",map._controlCorners.bottomleft.style.marginBottom="20px",this._reset(),this._update(),this._subLayers)for(var layerName in this._subLayers)this._subLayers[layerName].setMap(this._mutant)}.bind(this))},onRemove:function(map){L.GridLayer.prototype.onRemove.call(this,map),map._container.removeChild(this._mutantContainer),this._mutantContainer=void 0,google.maps.event.clearListeners(map,"idle"),google.maps.event.clearListeners(this._mutant,"idle"),map.off("viewreset",this._reset,this),map.off("move",this._update,this),map.off("zoomend",this._handleZoomAnim,this),map.off("resize",this._resize,this),map._controlCorners&&(map._controlCorners.bottomright.style.marginBottom="0em",map._controlCorners.bottomleft.style.marginBottom="0em")},getAttribution:function(){return this.options.attribution},setOpacity:function(opacity){(this.options.opacity=opacity)<1&&L.DomUtil.setOpacity(this._mutantContainer,opacity)},setElementSize:function(e,size){e.style.width=size.x+"px",e.style.height=size.y+"px"},addGoogleLayer:function(googleLayerName,options){return this._subLayers||(this._subLayers={}),this._GAPIPromise.then(function(){var googleLayer=new google.maps[googleLayerName](options);return googleLayer.setMap(this._mutant),this._subLayers[googleLayerName]=googleLayer}.bind(this))},removeGoogleLayer:function(googleLayerName){var googleLayer=this._subLayers&&this._subLayers[googleLayerName];googleLayer&&(googleLayer.setMap(null),delete this._subLayers[googleLayerName])},_initMutantContainer:function(){this._mutantContainer||(this._mutantContainer=L.DomUtil.create("div","leaflet-google-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.zIndex="800",this._mutantContainer.style.pointerEvents="none",this._map.getContainer().appendChild(this._mutantContainer)),this.setOpacity(this.options.opacity),this.setElementSize(this._mutantContainer,this._map.getSize()),this._attachObserver(this._mutantContainer)},_initMutant:function(){if(this._ready&&this._mutantContainer){this._mutantCenter=new google.maps.LatLng(0,0);var map=new google.maps.Map(this._mutantContainer,{center:this._mutantCenter,zoom:0,tilt:0,mapTypeId:this.options.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.styles||{},backgroundColor:"transparent"});this._mutant=map,google.maps.event.addListenerOnce(map,"idle",function(){for(var nodes=this._mutantContainer.querySelectorAll("a"),i=0;i<nodes.length;i++)nodes[i].style.pointerEvents="auto"}.bind(this)),this.fire("spawned",{mapObject:map})}},_attachObserver:function(node){new MutationObserver(this._onMutations.bind(this)).observe(node,{childList:!0,subtree:!0})},_onMutations:function(mutations){for(var i=0;i<mutations.length;++i)for(var mutation=mutations[i],j=0;j<mutation.addedNodes.length;++j){var node=mutation.addedNodes[j];node instanceof HTMLImageElement?this._onMutatedImage(node):node instanceof HTMLElement&&Array.prototype.forEach.call(node.querySelectorAll("img"),this._onMutatedImage.bind(this))}},_roadRegexp:/!1i(\d+)!2i(\d+)!3i(\d+)!/,_satRegexp:/x=(\d+)&y=(\d+)&z=(\d+)/,_staticRegExp:/StaticMapService\.GetMapImage/,_onMutatedImage:function(imgNode){var coords,match=imgNode.src.match(this._roadRegexp),sublayer=0;if(match?(coords={z:match[1],x:match[2],y:match[3]},1<this._imagesPerTile&&(sublayer=imgNode.style.zIndex=1)):((match=imgNode.src.match(this._satRegexp))&&(coords={x:match[1],y:match[2],z:match[3]}),sublayer=0),coords){var tileKey=this._tileCoordsToKey(coords);imgNode.style.position="absolute",imgNode.style.visibility="hidden";var key=tileKey+"/"+sublayer;if(this._freshTiles[key]=imgNode,key in this._tileCallbacks&&this._tileCallbacks[key])this._tileCallbacks[key].pop()(imgNode),this._tileCallbacks[key].length||delete this._tileCallbacks[key];else if(this._tiles[tileKey]){var c=this._tiles[tileKey].el,oldImg=0===sublayer?c.firstChild:c.firstChild.nextSibling,cloneImgNode=this._clone(imgNode);c.replaceChild(cloneImgNode,oldImg)}}else imgNode.src.match(this._staticRegExp)&&(imgNode.style.visibility="hidden")},createTile:function(coords,done){var key=this._tileCoordsToKey(coords),tileContainer=L.DomUtil.create("div");tileContainer.dataset.pending=this._imagesPerTile,done=done.bind(this,null,tileContainer);for(var i=0;i<this._imagesPerTile;i++){var key2=key+"/"+i;if(key2 in this._freshTiles){var imgNode=this._freshTiles[key2];tileContainer.appendChild(this._clone(imgNode)),tileContainer.dataset.pending--}else this._tileCallbacks[key2]=this._tileCallbacks[key2]||[],this._tileCallbacks[key2].push(function(c){return function(imgNode){c.appendChild(this._clone(imgNode)),c.dataset.pending--,parseInt(c.dataset.pending)||done()}.bind(this)}.bind(this)(tileContainer))}return parseInt(tileContainer.dataset.pending)||L.Util.requestAnimFrame(done),tileContainer},_clone:function(imgNode){var clonedImgNode=imgNode.cloneNode(!0);return clonedImgNode.style.visibility="visible",clonedImgNode},_checkZoomLevels:function(){var zoomLevel=this._map.getZoom(),gMapZoomLevel=this._mutant.getZoom();zoomLevel&&gMapZoomLevel&&(gMapZoomLevel!==zoomLevel||gMapZoomLevel>this.options.maxNativeZoom)&&this._setMaxNativeZoom(gMapZoomLevel)},_setMaxNativeZoom:function(zoomLevel){zoomLevel!=this.options.maxNativeZoom&&(this.options.maxNativeZoom=zoomLevel,this._resetView())},_reset:function(){this._initContainer()},_update:function(){if(this._mutant){var center=this._map.getCenter(),_center=new google.maps.LatLng(center.lat,center.lng);this._mutant.setCenter(_center);var zoom=this._map.getZoom(),fractionalLevel=zoom!==Math.round(zoom),mutantZoom=this._mutant.getZoom();fractionalLevel||zoom==mutantZoom||(this._mutant.setZoom(zoom),this._mutantIsReady&&this._checkZoomLevels())}L.GridLayer.prototype._update.call(this)},_resize:function(){var size=this._map.getSize();this._mutantContainer.style.width===size.x&&this._mutantContainer.style.height===size.y||(this.setElementSize(this._mutantContainer,size),this._mutant&&google.maps.event.trigger(this._mutant,"resize"))},_handleZoomAnim:function(){if(this._mutant){var center=this._map.getCenter(),_center=new google.maps.LatLng(center.lat,center.lng);this._mutant.setCenter(_center),this._mutant.setZoom(Math.round(this._map.getZoom()))}},_removeTile:function(key){if(this._mutant)return setTimeout(this._pruneTile.bind(this,key),1e3),L.GridLayer.prototype._removeTile.call(this,key)},_pruneTile:function(key){for(var gZoom=this._mutant.getZoom(),tileZoom=key.split(":")[2],googleBounds=this._mutant.getBounds(),sw=googleBounds.getSouthWest(),ne=googleBounds.getNorthEast(),gMapBounds=L.latLngBounds([[sw.lat(),sw.lng()],[ne.lat(),ne.lng()]]),i=0;i<this._imagesPerTile;i++){var key2=key+"/"+i;if(key2 in this._freshTiles){var tileBounds=this._map&&this._keyToBounds(key);this._map&&tileBounds.overlaps(gMapBounds)&&tileZoom==gZoom||delete this._freshTiles[key2]}}}}),L.gridLayer.googleMutant=function(options){return new L.GridLayer.GoogleMutant(options)}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2),pluginName="textareaWidget";function TextareaWidget(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}((TextareaWidget.prototype=Object.create(Widget.prototype)).constructor=TextareaWidget).prototype._init=function(){this._setDelegatedHandlers()},TextareaWidget.prototype._setDelegatedHandlers=function(){var $form=$(this.element),textarea=$form[0].querySelector("textarea"),defaultHeight=textarea?textarea.clientHeight:20;$form.on("input","textarea",function(){this.scrollHeight>this.clientHeight&&this.scrollHeight>defaultHeight&&(this.style["min-height"]=this.scrollHeight+"px")})},$.fn[pluginName]=function(options,event){var $this=$(this),data=$this.data(pluginName);return options=options||{},data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,new TextareaWidget($this[0],options,event)),this},module.exports={name:pluginName,selector:"form"}},function(module,exports,__webpack_require__){"use strict";module.exports={name:"tablewidget"}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2);__webpack_require__(203);function Radiopicker(element,options){this.namespace="radiopicker",Widget.call(this,element,options),this._init()}((Radiopicker.prototype=Object.create(Widget.prototype)).constructor=Radiopicker).prototype._init=function(){this._setDelegatedHandlers()},Radiopicker.prototype._setDelegatedHandlers=function(){var $form=$(this.element);$form.on("click",'input[type="radio"]:not([readonly]):checked',function(){$(this).parent("label").siblings().removeAttr("data-checked").end().attr("data-checked","true")}).on("click",'input[type="checkbox"]:not([readonly])',function(){this.checked?this.parentNode.dataset.checked="true":delete this.parentNode.dataset.checked}).on("change","[data-checked] > input:not(:checked)",function(){delete this.parentNode.dataset.checked}).on("click",'input[type="checkbox"][readonly],input[type="radio"][readonly]',function(event){return event.stopImmediatePropagation(),!1}).on("change",'input[type="checkbox"][readonly],input[type="radio"][readonly]',function(event){var byProgram=void 0===event.originalEvent;return byProgram||(event.stopImmediatePropagation(),this.checked&&"true"!==this.parentNode.dataset.checked&&(this.checked=!1)),byProgram}).on("click",'[data-checked]>input[type="radio"]:not(.no-unselect)',function(){$(this).prop("checked",!1).trigger("change").parent().removeAttr("data-checked")}),$form.find('input[type="radio"]:checked, input[type="checkbox"]:checked').parent("label").attr("data-checked","true")},$.fn.radiopicker=function(options,event){var $this=$(this),data=$this.data("radiopicker");return options=options||{},data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data("radiopicker",new Radiopicker($this[0],options,event)),this},module.exports={name:"radiopicker",selector:"form"}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),support=__webpack_require__(34),$=__webpack_require__(2),types=__webpack_require__(132),utils=__webpack_require__(38);__webpack_require__(204),__webpack_require__(95);var pluginName="datepickerExtended";function DatepickerExtended(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}((DatepickerExtended.prototype=Object.create(Widget.prototype)).constructor=DatepickerExtended).prototype._init=function(){var $p=$(this.element).parent("label");this.settings=$p.hasClass("or-appearance-year")?{format:"yyyy",startView:"decade",minViewMode:"years"}:$p.hasClass("or-appearance-month-year")?{format:"yyyy-mm",startView:"year",minViewMode:"months"}:{format:"yyyy-mm-dd",startView:"month",minViewMode:"days"},this.$fakeDateI=this._createFakeDateInput(this.settings.format),this._setChangeHandler(this.$fakeDateI),this._setFocusHandler(this.$fakeDateI),this._setResetHandler(this.$fakeDateI),this.$fakeDateI.datepicker({format:this.settings.format,autoclose:!0,todayHighlight:!0,startView:this.settings.startView,minViewMode:this.settings.minViewMode,forceParse:!1})},DatepickerExtended.prototype._createFakeDateInput=function(format){var $dateI=$(this.element),$fakeDate=$('<div class="widget date"><input class="ignore input-small" type="text" value="'+$dateI.val()+'" placeholder="'+format+'" /><button class="btn-icon-only btn-reset" type="button" aria-label="comment"><i class="icon icon-refresh"> </i></button></div>'),$fakeDateI=$fakeDate.find("input");return $dateI.hide().after($fakeDate),$fakeDateI},DatepickerExtended.prototype._setChangeHandler=function($fakeDateI){var $dateI=$(this.element),settings=this.settings;$fakeDateI.on("change paste",function(e){var convertedValue="",value="paste"===e.type?utils.getPasteData(e):$fakeDateI.val(),showValue="";return 0<value.length&&(convertedValue=utils.isNumber(value)&&"yyyy"!==settings.format?"":(value="yyyy-mm"===settings.format?value+"-01":"yyyy"===settings.format?value+"-01-01":value,types.date.convert(value))),""!==convertedValue&&$dateI.val()===convertedValue||("paste"===e.type&&e.stopImmediatePropagation(),$dateI.val(convertedValue).trigger("change").blur()),showValue="yyyy-mm"===settings.format?convertedValue.substring(0,convertedValue.lastIndexOf("-")):"yyyy"===settings.format?convertedValue.substring(0,convertedValue.indexOf("-")):convertedValue,$fakeDateI.val(showValue).datepicker("update"),!1})},DatepickerExtended.prototype._setResetHandler=function($fakeDateI){var that=this;$fakeDateI.next(".btn-reset").on("click",function(){$(that.element).val()&&$fakeDateI.val("").datepicker("update")})},DatepickerExtended.prototype._setFocusHandler=function($fakeDateI){var that=this;$fakeDateI.on("focus",function(){$(that.element).trigger("fakefocus")}),$(this.element).on("applyfocus",function(){$fakeDateI.focus()})},DatepickerExtended.prototype.update=function(){this.$fakeDateI.val(this.element.value).datepicker("update")},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data(pluginName);data||"object"!=typeof options||support.touch&&support.inputTypes.date&&!/GT-P31[0-9]{2}.+AppleWebKit\/534\.30/.test(navigator.userAgent)?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,new DatepickerExtended(this,options,event))})},module.exports={name:pluginName,selector:'input[type="date"]:not([readonly])'}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2),pluginName="datepickerNative",support=__webpack_require__(34);function DatepickerNative(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}((DatepickerNative.prototype=Object.create(Widget.prototype)).constructor=DatepickerNative).prototype._init=function(){this.element.type="text",this.element.classList.add("mask-date")},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),dp=$this.data("datepickerExtended"),data=$this.data(pluginName);dp||"object"!=typeof options||data||support.touch||$this.data(pluginName,new DatepickerNative(this,options,event))})},module.exports={name:pluginName,selector:'input[type="date"]'}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2),pluginName="datepickerMobile",support=__webpack_require__(34);function DatePickerMobile(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}((DatePickerMobile.prototype=Object.create(Widget.prototype)).constructor=DatePickerMobile).prototype._init=function(){var $input=$(this.element),loadedValue=this.element.value;if(support.inputTypes.month){var $fakeInput=$('<input class="ignore widget datepicker-mobile" type="month"/>');$input.addClass("hide"),$fakeInput.val(loadedValue?loadedValue.substring(0,loadedValue.lastIndexOf("-")):"").insertAfter($input).on("change",function(){var correctedValue=this.value?this.value+"-01":"";$input.val(correctedValue).trigger("change")})}},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),dp=$this.data("datepickerExtended"),data=$this.data(pluginName);dp||"object"!=typeof options||data||!support.touch||$this.data(pluginName,new DatePickerMobile(this,options,event))})},module.exports={name:pluginName,selector:'.or-appearance-month-year input[type="date"]'}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),support=__webpack_require__(34),$=__webpack_require__(2);__webpack_require__(205),__webpack_require__(95);var pluginName="timepickerExtended";function TimepickerExtended(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}((TimepickerExtended.prototype=Object.create(Widget.prototype)).constructor=TimepickerExtended).prototype._init=function(){var $timeI=$(this.element),timeVal=$(this.element).val(),$fakeTime=$('<div class="widget timepicker"><input class="ignore timepicker-default" type="text" value="'+timeVal+'" placeholder="hh:mm" /><button class="btn-icon-only btn-reset" aria-label="reset" type="button"><i class="icon icon-refresh"> </i></button></div>'),$resetBtn=$fakeTime.find(".btn-reset"),$fakeTimeI=$fakeTime.find("input");$timeI.hide().after($fakeTime),$fakeTimeI.timepicker({defaultTime:0<timeVal.length&&timeVal,showMeridian:!1}).val(timeVal).closest(".widget").find("input").addClass("ignore"),$fakeTimeI.on("change",function(){return $timeI.val(this.value).trigger("change"),!1}),$resetBtn.on("click",function(){var event=$timeI.val()?"change":"";(event||$fakeTimeI.val())&&$fakeTimeI.val("").trigger(event)}),$fakeTimeI.on("focus",function(){$timeI.trigger("fakefocus")}),$(this.element).on("applyfocus",function(){$fakeTimeI.focus()})},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data(pluginName);data||"object"!=typeof options||support.touch&&support.inputTypes.time?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,new TimepickerExtended(this,options,event))})},module.exports={name:pluginName,selector:'input[type="time"]:not([readonly])'}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),support=__webpack_require__(34),$=__webpack_require__(2),types=__webpack_require__(132),pluginName="datetimepickerExtended";function DatetimepickerExtended(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}__webpack_require__(133),__webpack_require__(204),__webpack_require__(205),__webpack_require__(95),((DatetimepickerExtended.prototype=Object.create(Widget.prototype)).constructor=DatetimepickerExtended).prototype._init=function(){var that=this,$dateTimeI=$(this.element),vals=(0<$dateTimeI.val().length?new Date($dateTimeI.val()).toISOLocalString():"").split("T"),dateVal=vals[0],timeVal=vals[1]&&4<vals[1].length?vals[1].substring(0,5):"";function changeVal(){if(0<that.$fakeDateI.val().length&&3<that.$fakeTimeI.val().length){var d=that.$fakeDateI.val().split("-"),t=that.$fakeTimeI.val().split(":");$dateTimeI.val(new Date(d[0],d[1]-1,d[2],t[0],t[1]).toISOLocalString()).trigger("change")}else $dateTimeI.val("").trigger("change")}this.$fakeDateI=this._createFakeDateInput(dateVal),this.$fakeTimeI=this._createFakeTimeInput(timeVal),$dateTimeI.hide().after('<div class="datetimepicker widget" />'),$dateTimeI.siblings(".datetimepicker").append(this.$fakeDateI.closest(".date")).append(this.$fakeTimeI.closest(".timepicker")),this.$fakeDateI.datepicker({format:"yyyy-mm-dd",autoclose:!0,todayHighlight:!0,forceParse:!1}),this.$fakeTimeI.timepicker({defaultTime:0<timeVal.length&&"value",showMeridian:!1}).closest(".widget").find("input").addClass("ignore"),this._setFocusHandler(this.$fakeDateI.add(this.$fakeTimeI)),this.$fakeDateI.on("change changeDate",function(){return types.date.validate(this.value)||that.$fakeDateI.val("").datepicker("update"),changeVal(),!1}),this.$fakeTimeI.on("change",function(){return changeVal(),!1}),this.$fakeTimeI.next(".btn-reset").on("click",function(){var event=$dateTimeI.val()?"change":"";(event||that.$fakeDateI.val()||that.$fakeTimeI.val())&&(that.$fakeDateI.val("").trigger(event).datepicker("update"),that.$fakeTimeI.val("").trigger(event))})},DatetimepickerExtended.prototype._createFakeDateInput=function(dateVal){return $('<div class="date"><input class="ignore" type="text" value="'+dateVal+'" placeholder="yyyy-mm-dd"/></div>').find("input")},DatetimepickerExtended.prototype._createFakeTimeInput=function(timeVal){return $('<div class="timepicker"><input class="ignore timepicker-default" type="text" value="'+timeVal+'" placeholder="hh:mm"/><button class="btn-icon-only btn-reset" type="button" aria-label="reset"><i class="icon icon-refresh"> </i></button></div>').find("input")},DatetimepickerExtended.prototype.update=function(){var $dateTimeI=$(this.element),vals=(0<$dateTimeI.val().length?new Date($dateTimeI.val()).toISOLocalString():"").split("T"),dateVal=vals[0],timeVal=vals[1]&&4<vals[1].length?vals[1].substring(0,5):"";this.$fakeDateI.val(dateVal),this.$fakeTimeI.val(timeVal)},DatetimepickerExtended.prototype._setFocusHandler=function($els){var that=this;$els.on("focus",function(){$(that.element).trigger("fakefocus")}),$(this.element).on("applyfocus",function(){$els.eq(0).focus()})},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data(pluginName);data||"object"!=typeof options||support.touch&&support.inputTypes.datetime&&!/GT-P31[0-9]{2}.+AppleWebKit\/534\.30/.test(navigator.userAgent)?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,new DatetimepickerExtended(this,options,event))})},module.exports={name:pluginName,selector:'input[type="datetime"]:not([readonly])'}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),Widget=__webpack_require__(13);function CompactPicker(element,options){this.namespace="compactpicker",Widget.call(this,element,options),this._init()}((CompactPicker.prototype=Object.create(Widget.prototype)).constructor=CompactPicker).prototype._init=function(){$(this.element).find(".option-label").each(function(){var $optionLabel=$(this);0<$optionLabel.siblings("img, video, audio").length&&$optionLabel.css("display","none")})},$.fn.compactpicker=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data("compactpicker");data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data("compactpicker",new CompactPicker(this,options,event))})},module.exports={name:"compactpicker",selector:'.or-appearance-compact, .or-appearance-quickcompact, [class*="or-appearance-compact-"]'}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),Widget=__webpack_require__(13),fileManager=__webpack_require__(134),utils=__webpack_require__(38),t=__webpack_require__(46).t,TranslatedError=__webpack_require__(457),dialog=__webpack_require__(164);function Filepicker(element,options,e){e&&(e.stopPropagation(),e.preventDefault()),this.namespace="filepicker",Widget.call(this,element,options),this._init()}((Filepicker.prototype=Object.create(Widget.prototype)).constructor=Filepicker).prototype._init=function(){var $input=$(this.element),existingFileName=$input.attr("data-loaded-file-name"),that=this;this.props=this._getProps(),$input.prop("disabled",!0).addClass("hide").parent().addClass("with-media clearfix"),this.$widget=$('<div class="widget file-picker"><input class="ignore fake-file-input"/>'+(this.props.readonly?"":'<button class="btn-icon-only btn-reset" aria-label="reset" type="button"><i class="icon icon-refresh"> </i></button>')+'<a class="btn-icon-only btn-download" aria-label="download" download href=""><i class="icon icon-download"> </i></a><div class="file-feedback"></div><div class="file-preview"></div></div>').insertAfter($input),this.$feedback=this.$widget.find(".file-feedback"),this.$preview=this.$widget.find(".file-preview"),this.$fakeInput=this.$widget.find(".fake-file-input"),this.$downloadLink=this.$widget.find(".btn-download"),this.$widget.find(".btn-reset").on("click",function(){($input.val()||that.$fakeInput.val())&&dialog.confirm(t("filepicker.resetWarning",{item:t("filepicker.file")})).then(function(){$input.val("").trigger("change")})}).end(),that._focusListener(),this._showFileName(existingFileName),fileManager.isWaitingForPermissions()&&this._showFeedback(t("filepicker.waitingForPermissions"),"warning"),this._updatePlaceholder(),$input.closest("form.or").on("updateMaxSize",this._updatePlaceholder.bind(this)),fileManager.init().then(function(){that._showFeedback(),that._changeListener(),$input.prop("disabled",!1),existingFileName&&fileManager.getFileUrl(existingFileName).then(function(url){that._showPreview(url,that.props.mediaType),that._updateDownloadLink(url,existingFileName)}).catch(function(){that._showFeedback(t("filepicker.notFound",{existing:existingFileName}),"error")})}).catch(function(error){that._showFeedback(error,"error")})},Filepicker.prototype._getProps=function(){return{mediaType:this.element.getAttribute("accept"),readonly:this.element.readOnly}},Filepicker.prototype._updatePlaceholder=function(){this.$fakeInput.attr("placeholder",t("filepicker.placeholder",{maxSize:fileManager.getMaxSizeReadable()||"?MB"}))},Filepicker.prototype._changeListener=function(){var that=this;$(this.element).on("click",function(event){if(that.props.readonly||"propagate"!==event.namespace)return that.$fakeInput.focus(),event.stopImmediatePropagation(),!1}).on("change.propagate."+this.namespace,function(event){var file,fileName,postfix,$input=$(this),loadedFileName=$input.attr("data-loaded-file-name"),now=new Date;if("propagate"===event.namespace)return $input.trigger("change.file"),!1;event.stopImmediatePropagation(),file=this.files[0],postfix="-"+now.getHours()+"_"+now.getMinutes()+"_"+now.getSeconds(),this.dataset.filenamePostfix=postfix,fileName=utils.getFilename(file,postfix),fileManager.getFileUrl(file,fileName).then(function(url){that._showPreview(url,that.props.mediaType),that._showFeedback(),that._showFileName(fileName),loadedFileName&&loadedFileName!==fileName&&$input.removeAttr("data-loaded-file-name"),that._updateDownloadLink(url,fileName),$input.trigger("change.propagate")}).catch(function(error){$input.val("").trigger("change.propagate"),that._showFileName(""),that._showPreview(null),that._showFeedback(error,"error"),that._updateDownloadLink("","")})}),this.$fakeInput.on("click",function(event){if(that.props.readonly||that.element.value||that.$fakeInput[0].value)return $(this).focus(),event.stopImmediatePropagation(),!1;event.preventDefault(),$(that.element).trigger("click.propagate")}).on("change",function(){return!1})},Filepicker.prototype._focusListener=function(){var that=this;this.$fakeInput.on("focus",function(){$(that.element).trigger("fakefocus")}),$(this.element).on("applyfocus",function(){that.$fakeInput.focus()})},Filepicker.prototype._showFileName=function(fileName){this.$fakeInput.val(fileName).prop("readonly",!!fileName)},Filepicker.prototype._showFeedback=function(fb,status){var message=fb instanceof TranslatedError?t(fb.translationKey,fb.translationOptions):fb instanceof Error?fb.message:fb||"";status=status||"",this.$feedback.text(message).attr("class","file-feedback "+status)},Filepicker.prototype._showPreview=function(url,mediaType){var $el;switch(this.$widget.find(".file-preview").empty(),mediaType){case"image/*":$el=$("<img />");break;case"audio/*":$el=$('<audio controls="controls"/>');break;case"video/*":$el=$('<video controls="controls"/>');break;default:$el=$("")}url&&this.$preview.append($el.attr("src",url))},Filepicker.prototype._updateDownloadLink=function(url,fileName){this.$downloadLink.attr({href:url||"",download:fileName||""})},$.fn.filepicker=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data("filepicker");data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data("filepicker",new Filepicker(this,options,event))})},module.exports={name:"filepicker",selector:'.question:not(.or-appearance-draw):not(.or-appearance-signature):not(.or-appearance-annotate) input[type="file"]'}},function(module,exports,__webpack_require__){"use strict";function TranslatedError(message,translationKey,translationOptions){this.message=message,this.translationKey=translationKey,this.translationOptions=translationOptions}(TranslatedError.prototype=Object.create(Error.prototype)).name="TranslatedError",module.exports=TranslatedError},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2),support=__webpack_require__(34),fileManager=__webpack_require__(134),SignaturePad=__webpack_require__(459),t=__webpack_require__(46).t,dialog=__webpack_require__(164),utils=__webpack_require__(38),Promise=__webpack_require__(58);function DrawWidget(element,options){this.namespace="drawWidget",Widget.call(this,element,options),this._init()}SignaturePad.prototype.fromObjectURL=function(objectUrl,options){var image=new Image,deviceRatio=(options=options||{}).ratio||window.devicePixelRatio||1,width=options.width||this._canvas.width/deviceRatio,height=options.height||this._canvas.height/deviceRatio,that=this;return this._reset(),new Promise(function(resolve){image.src=objectUrl,image.onload=function(){var left,top,imgWidth=image.width,imgHeight=image.height,hRatio=width/imgWidth,vRatio=height/imgHeight;if(hRatio<1||vRatio<1){var ratio=Math.min(hRatio,vRatio);left=(width-imgWidth*ratio)/2,top=(height-imgHeight*ratio)/2,that._ctx.drawImage(image,0,0,imgWidth,imgHeight,left,top,imgWidth*ratio,imgHeight*ratio)}else left=(width-imgWidth)/2,top=(height-imgHeight)/2,that._ctx.drawImage(image,left,top,imgWidth,imgHeight);resolve(objectUrl)},that._isEmpty=!1})},SignaturePad.prototype.updateData=function(pointGroups){var that=this;this._fromData(pointGroups,function(curve,widths){that._drawCurve(curve,widths.start,widths.end)},function(rawPoint){that._drawDot(rawPoint)}),this._data=pointGroups},((DrawWidget.prototype=Object.create(Widget.prototype)).constructor=DrawWidget).prototype._init=function(){var canvas,that=this,existingFilename=this.element.dataset.loadedFileName;this.element.type="text",this.element.dataset.drawing=!0,this.props=this._getProps(this.element),this.$widget=this._getMarkup(),canvas=this.$widget[0].querySelector(".draw-widget__body__canvas"),$(this.element).after(this.$widget).closest(".question").addClass("or-"+this.props.type+"-initialized"),this._handleResize(canvas),this._resizeCanvas(canvas),this.props.load&&this._handleFiles(existingFilename),this.initialize=fileManager.init().then(function(){return that.pad=new SignaturePad(canvas,{onEnd:that._updateValue.bind(that),penColor:that.props.colors[0]||"black"}),that.pad.off(),!existingFilename||(that.element.value=existingFilename,that._loadFileIntoPad(existingFilename).then(that._updateDownloadLink.bind(that)))}),this.disable(),this.initialize.then(function(){that.$widget.find(".draw-widget__btn-reset").on("click",that._reset.bind(that)).end().find(".draw-widget__colorpicker").on("click",".current",function(){$(this).parent().toggleClass("reveal")}).on("click","[data-color]:not(.current)",function(){$(this).siblings().removeClass("current").end().addClass("current").parent().removeClass("reveal"),that.pad.penColor=this.dataset.color}).end().find(".draw-widget__undo").on("click",function(){var data=that.pad.toData();that.pad.clear();var fileInput=that.$widget[0].querySelector("input[type=file]"),fileToLoad=fileInput&&fileInput.files[0]?fileInput.files[0]:that.element.dataset.loadedFileName;that._loadFileIntoPad(fileToLoad).then(function(){that.pad.updateData(data.slice(0,-1)),that._updateValue(),that.pad.penColor=that.$widget.find(".draw-widget__colorpicker .current")[0].dataset.color})}).end().find(".show-canvas-btn").on("click",function(){return that.$widget.addClass("full-screen"),that._resizeCanvas(canvas),that.enable(),!1}).end().find(".hide-canvas-btn").on("click",function(){return that.$widget.removeClass("full-screen"),that.pad.off(),that._resizeCanvas(canvas),!1}).click(),$(canvas).on("canvasreload."+that.namespace,function(){that.cache&&that.pad.fromObjectURL(that.cache)}),that.enable()}).catch(function(error){that._showFeedback(error.message)}),$(this.element).on("applyfocus",function(){canvas.focus()}).closest('[role="page"]').on("pageflip.enketo",function(){that._resizeCanvas(canvas)})},DrawWidget.prototype._getProps=function(el){var $q=$(el).closest(".question"),type=$q.hasClass("or-appearance-draw")?"drawing":$q.hasClass("or-appearance-signature")?"signature":"annotation";return{readonly:el.readOnly,type:type,filename:type+".png",load:$q.hasClass("or-appearance-annotate"),colors:$q.hasClass("or-appearance-signature")?[]:["black","lightblue","blue","red","orange","cyan","yellow","lightgreen","green","pink","purple","lightgray","darkgray"],touch:support.touch,accept:el.getAttribute("accept"),capture:el.getAttribute("capture")}},DrawWidget.prototype._handleFiles=function(loadedFileName){this._updatePlaceholder(),this.$widget.closest("form.or").on("updateMaxSize",this._updatePlaceholder.bind(this));var that=this,$input=this.$widget.find("input[type=file]"),$fakeInput=this.$widget.find(".fake-file-input");this._showFileName(loadedFileName),$input.on("click."+this.namespace,function(event){if(that.props.readonly||"propagate"!==event.namespace)return that.$fakeInput.focus(),event.stopImmediatePropagation(),!1}).on("change."+this.namespace,function(){var file=this.files[0];file?fileManager.isTooLarge(file)?that._showFeedback(t("filepicker.toolargeerror",{maxSize:fileManager.getMaxSizeReadable()})):(that.pad.clear(),that._loadFileIntoPad(this.files[0]).then(function(){that._updateValue.call(that),that._showFileName(file.name),that.enable()})):that._showFileName(null)}),$fakeInput.on("click."+this.namespace,function(event){if(that.props.readonly||$input[0].value||$fakeInput[0].value)return $(this).focus(),event.stopImmediatePropagation(),!1;event.preventDefault(),$input.trigger("click.propagate")}).on("change."+this.namespace,function(){return!1})},DrawWidget.prototype._showFileName=function(fileName){this.$widget.find(".fake-file-input").val(fileName).prop("readonly",!!fileName)},DrawWidget.prototype._updatePlaceholder=function(){this.$widget.find(".fake-file-input").attr("placeholder",t("filepicker.placeholder",{maxSize:fileManager.getMaxSizeReadable()||"?MB"}))},DrawWidget.prototype._getMarkup=function(){var load=this.props.load?'<input type="file" class="ignore draw-widget__load"'+(null!==this.props.capture?' capture="'+this.props.capture+'"':"")+' accept="'+this.props.accept+'"/><div class="widget file-picker"><input class="ignore fake-file-input"/><div class="file-feedback"></div></div>':"",fullscreenBtns=this.props.touch?'<button type="button" class="show-canvas-btn btn btn-default">Draw/Sign</button><button type="button" class="hide-canvas-btn btn btn-default"><span class="icon icon-arrow-left"> </span></button>':"",$widget=$('<div class="widget draw-widget"><div class="draw-widget__body">'+fullscreenBtns+load+'<canvas class="draw-widget__body__canvas noSwipe disabled" tabindex="0"></canvas><div class="draw-widget__colorpicker"></div>'+("signature"===this.props.type?"":'<button class="btn-icon-only draw-widget__undo" aria-label="undo" type=button><i class="icon icon-undo"> </i></button>')+'</div><div class="draw-widget__footer"><button type="button" class="btn-icon-only draw-widget__btn-reset" aria-label="reset"><i class="icon icon-refresh"> </i></button><a class="btn-icon-only btn-download" aria-label="download" download href=""><i class="icon icon-download"> </i></a><div class="draw-widget__feedback"></div></div></div>'),$colorpicker=$widget.find(".draw-widget__colorpicker");return this.props.colors.forEach(function(color,index){var current=0===index?" current":"";$colorpicker.append('<div class="'+current+'"data-color="'+color+'" style="background: '+color+';" />')}),$widget},DrawWidget.prototype._updateValue=function(){var now=new Date,postfix="-"+now.getHours()+"_"+now.getMinutes()+"_"+now.getSeconds();this.cache=this.pad.toDataURL(),this.element.dataset.filenamePostfix=postfix,$(this.element).val(this.props.filename).trigger("change"),this._updateDownloadLink(this.cache)},DrawWidget.prototype._reset=function(){var that=this;if(this.element.value){var item="signature"===this.props.type?t("drawwidget.signature"):"drawing"===this.props.type?t("drawwidget.drawing"):t("drawwidget.annotation");dialog.confirm(t("filepicker.resetWarning",{item:item})).then(function(){that.pad.clear(),that.cache=null,delete that.element.dataset.loadedFileName,that.element.dataset.filenamePostfix="",$(that.element).val("").trigger("change"),that.$widget.find("input[type=file]").val("").trigger("change"),that._updateDownloadLink(""),that.disable(),that.enable()})}},DrawWidget.prototype._loadFileIntoPad=function(file){var that=this;return file?fileManager.getObjectUrl(file).then(that.pad.fromObjectURL.bind(that.pad)).then(function(objectUrl){return that.cache=objectUrl}).catch(function(){that._showFeedback("File could not be loaded (leave unchanged if already submitted and you want to preserve it).","error")}):Promise.resolve("")},DrawWidget.prototype._showFeedback=function(message){message=message||"",this.$widget.find(".draw-widget__feedback").text(message)},DrawWidget.prototype._updateDownloadLink=function(url){url&&0===url.indexOf("data:")&&(url=URL.createObjectURL(utils.dataUriToBlobSync(url))),this.$widget.find(".btn-download").attr({href:url||"",download:url?utils.getFilename({name:this.element.value},this.element.dataset.filenamePostfix):""})},DrawWidget.prototype._handleResize=function(canvas){var that=this;$(window).on("resize",function(){that._resizeCanvas(canvas)})},DrawWidget.prototype._resizeCanvas=function(canvas){var ratio=Math.max(window.devicePixelRatio||1,1);canvas.width=canvas.offsetWidth*ratio,canvas.height=canvas.offsetHeight*ratio,canvas.getContext("2d").scale(ratio,ratio),$(canvas).trigger("canvasreload."+this.namespace)},DrawWidget.prototype.disable=function(){var that=this,canvas=this.$widget.find(".draw-widget__body__canvas")[0];this.initialize.then(function(){that.pad.off(),canvas.classList.add("disabled"),that.$widget.find(".draw-widget__btn-reset").prop("disabled",!0)})},DrawWidget.prototype.enable=function(){var that=this,canvas=this.$widget.find(".draw-widget__body__canvas")[0],touchNotFull=this.props.touch&&!this.$widget.is(".full-screen"),needFile=this.props.load&&!this.element.value;this.initialize.then(function(){that.props.readonly||needFile||touchNotFull||(that.pad.on(),canvas.classList.remove("disabled"),that.$widget.find(".draw-widget__btn-reset").prop("disabled",!1)),that._resizeCanvas(canvas)})},DrawWidget.prototype.update=function(element){""===element.value&&this._reset()},$.fn.drawWidget=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data("drawWidget");data||"object"!=typeof options||$this.data("drawWidget",new DrawWidget(this,options,event)),data&&"string"==typeof options&&data[options](this)})},module.exports={name:"drawWidget",selector:'.or-appearance-draw input[data-type-xml="binary"][accept^="image"], .or-appearance-signature input[data-type-xml="binary"][accept^="image"], .or-appearance-annotate input[data-type-xml="binary"][accept^="image"]'}},function(module,exports,__webpack_require__){
/*!
 * Signature Pad v2.3.2
 * https://github.com/szimek/signature_pad
 *
 * Copyright 2017 Szymon Nowak
 * Released under the MIT license
 *
 * The main idea and some parts of the code (e.g. drawing variable width BÃ©zier curve) are taken from:
 * http://corner.squareup.com/2012/07/smoother-signatures.html
 *
 * Implementation of interpolation using cubic BÃ©zier curves is taken from:
 * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
 *
 * Algorithm for approximated length of a BÃ©zier curve is taken from:
 * http://www.lemoda.net/maths/bezier-length/index.html
 *
 */
module.exports=function(){"use strict";function Point(x,y,time){this.x=x,this.y=y,this.time=time||(new Date).getTime()}function Bezier(startPoint,control1,control2,endPoint){this.startPoint=startPoint,this.control1=control1,this.control2=control2,this.endPoint=endPoint}function SignaturePad(canvas,options){var self=this,opts=options||{};this.velocityFilterWeight=opts.velocityFilterWeight||.7,this.minWidth=opts.minWidth||.5,this.maxWidth=opts.maxWidth||2.5,this.throttle="throttle"in opts?opts.throttle:16,this.minDistance="minDistance"in opts?opts.minDistance:5,this.throttle?this._strokeMoveUpdate=function(func,wait,options){var context,args,result,timeout=null,previous=0;options=options||{};var later=function(){previous=!1===options.leading?0:Date.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=Date.now();previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||wait<remaining?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}}(SignaturePad.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=SignaturePad.prototype._strokeUpdate,this.dotSize=opts.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=opts.penColor||"black",this.backgroundColor=opts.backgroundColor||"rgba(0,0,0,0)",this.onBegin=opts.onBegin,this.onEnd=opts.onEnd,this._canvas=canvas,this._ctx=canvas.getContext("2d"),this.clear(),this._handleMouseDown=function(event){1===event.which&&(self._mouseButtonDown=!0,self._strokeBegin(event))},this._handleMouseMove=function(event){self._mouseButtonDown&&self._strokeMoveUpdate(event)},this._handleMouseUp=function(event){1===event.which&&self._mouseButtonDown&&(self._mouseButtonDown=!1,self._strokeEnd(event))},this._handleTouchStart=function(event){if(1===event.targetTouches.length){var touch=event.changedTouches[0];self._strokeBegin(touch)}},this._handleTouchMove=function(event){event.preventDefault();var touch=event.targetTouches[0];self._strokeMoveUpdate(touch)},this._handleTouchEnd=function(event){var wasCanvasTouched=event.target===self._canvas;wasCanvasTouched&&(event.preventDefault(),self._strokeEnd(event))},this.on()}return Point.prototype.velocityFrom=function(start){return this.time!==start.time?this.distanceTo(start)/(this.time-start.time):1},Point.prototype.distanceTo=function(start){return Math.sqrt(Math.pow(this.x-start.x,2)+Math.pow(this.y-start.y,2))},Point.prototype.equals=function(other){return this.x===other.x&&this.y===other.y&&this.time===other.time},Bezier.prototype.length=function(){for(var length=0,px=void 0,py=void 0,i=0;i<=10;i+=1){var t=i/10,cx=this._point(t,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),cy=this._point(t,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(0<i){var xdiff=cx-px,ydiff=cy-py;length+=Math.sqrt(xdiff*xdiff+ydiff*ydiff)}px=cx,py=cy}return length},Bezier.prototype._point=function(t,start,c1,c2,end){return start*(1-t)*(1-t)*(1-t)+3*c1*(1-t)*(1-t)*t+3*c2*(1-t)*t*t+end*t*t*t},SignaturePad.prototype.clear=function(){var ctx=this._ctx,canvas=this._canvas;ctx.fillStyle=this.backgroundColor,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillRect(0,0,canvas.width,canvas.height),this._data=[],this._reset(),this._isEmpty=!0},SignaturePad.prototype.fromDataURL=function(dataUrl){var _this=this,options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},image=new Image,ratio=options.ratio||window.devicePixelRatio||1,width=options.width||this._canvas.width/ratio,height=options.height||this._canvas.height/ratio;this._reset(),image.src=dataUrl,image.onload=function(){_this._ctx.drawImage(image,0,0,width,height)},this._isEmpty=!1},SignaturePad.prototype.toDataURL=function(type){var _canvas;switch(type){case"image/svg+xml":return this._toSVG();default:for(var _len=arguments.length,options=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)options[_key-1]=arguments[_key];return(_canvas=this._canvas).toDataURL.apply(_canvas,[type].concat(options))}},SignaturePad.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},SignaturePad.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},SignaturePad.prototype.isEmpty=function(){return this._isEmpty},SignaturePad.prototype._strokeBegin=function(event){this._data.push([]),this._reset(),this._strokeUpdate(event),"function"==typeof this.onBegin&&this.onBegin(event)},SignaturePad.prototype._strokeUpdate=function(event){var x=event.clientX,y=event.clientY,point=this._createPoint(x,y),lastPointGroup=this._data[this._data.length-1],lastPoint=lastPointGroup&&lastPointGroup[lastPointGroup.length-1],isLastPointTooClose=lastPoint&&point.distanceTo(lastPoint)<this.minDistance;if(!lastPoint||!isLastPointTooClose){var _addPoint=this._addPoint(point),curve=_addPoint.curve,widths=_addPoint.widths;curve&&widths&&this._drawCurve(curve,widths.start,widths.end),this._data[this._data.length-1].push({x:point.x,y:point.y,time:point.time,color:this.penColor})}},SignaturePad.prototype._strokeEnd=function(event){var canDrawCurve=2<this.points.length,point=this.points[0];if(!canDrawCurve&&point&&this._drawDot(point),point){var lastPointGroup=this._data[this._data.length-1],lastPoint=lastPointGroup[lastPointGroup.length-1];point.equals(lastPoint)||lastPointGroup.push({x:point.x,y:point.y,time:point.time,color:this.penColor})}"function"==typeof this.onEnd&&this.onEnd(event)},SignaturePad.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},SignaturePad.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},SignaturePad.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},SignaturePad.prototype._createPoint=function(x,y,time){var rect=this._canvas.getBoundingClientRect();return new Point(x-rect.left,y-rect.top,time||(new Date).getTime())},SignaturePad.prototype._addPoint=function(point){var points=this.points;if(points.push(point),2<points.length){3===points.length&&points.unshift(points[0]);var c2=this._calculateCurveControlPoints(points[0],points[1],points[2]).c2,c3=this._calculateCurveControlPoints(points[1],points[2],points[3]).c1,curve=new Bezier(points[1],c2,c3,points[2]),widths=this._calculateCurveWidths(curve);return points.shift(),{curve:curve,widths:widths}}return{}},SignaturePad.prototype._calculateCurveControlPoints=function(s1,s2,s3){var dx1=s1.x-s2.x,dy1=s1.y-s2.y,dx2=s2.x-s3.x,dy2=s2.y-s3.y,m1_x=(s1.x+s2.x)/2,m1_y=(s1.y+s2.y)/2,m2_x=(s2.x+s3.x)/2,m2_y=(s2.y+s3.y)/2,l1=Math.sqrt(dx1*dx1+dy1*dy1),l2=Math.sqrt(dx2*dx2+dy2*dy2),k=l2/(l1+l2),cm_x=m2_x+(m1_x-m2_x)*k,cm_y=m2_y+(m1_y-m2_y)*k,tx=s2.x-cm_x,ty=s2.y-cm_y;return{c1:new Point(m1_x+tx,m1_y+ty),c2:new Point(m2_x+tx,m2_y+ty)}},SignaturePad.prototype._calculateCurveWidths=function(curve){var startPoint=curve.startPoint,endPoint=curve.endPoint,widths={start:null,end:null},velocity=this.velocityFilterWeight*endPoint.velocityFrom(startPoint)+(1-this.velocityFilterWeight)*this._lastVelocity,newWidth=this._strokeWidth(velocity);return widths.start=this._lastWidth,widths.end=newWidth,this._lastVelocity=velocity,this._lastWidth=newWidth,widths},SignaturePad.prototype._strokeWidth=function(velocity){return Math.max(this.maxWidth/(velocity+1),this.minWidth)},SignaturePad.prototype._drawPoint=function(x,y,size){var ctx=this._ctx;ctx.moveTo(x,y),ctx.arc(x,y,size,0,2*Math.PI,!1),this._isEmpty=!1},SignaturePad.prototype._drawCurve=function(curve,startWidth,endWidth){var ctx=this._ctx,widthDelta=endWidth-startWidth,drawSteps=Math.floor(curve.length());ctx.beginPath();for(var i=0;i<drawSteps;i+=1){var t=i/drawSteps,tt=t*t,ttt=tt*t,u=1-t,uu=u*u,uuu=uu*u,x=uuu*curve.startPoint.x;x+=3*uu*t*curve.control1.x,x+=3*u*tt*curve.control2.x,x+=ttt*curve.endPoint.x;var y=uuu*curve.startPoint.y;y+=3*uu*t*curve.control1.y,y+=3*u*tt*curve.control2.y,y+=ttt*curve.endPoint.y;var width=startWidth+ttt*widthDelta;this._drawPoint(x,y,width)}ctx.closePath(),ctx.fill()},SignaturePad.prototype._drawDot=function(point){var ctx=this._ctx,width="function"==typeof this.dotSize?this.dotSize():this.dotSize;ctx.beginPath(),this._drawPoint(point.x,point.y,width),ctx.closePath(),ctx.fill()},SignaturePad.prototype._fromData=function(pointGroups,drawCurve,drawDot){for(var i=0;i<pointGroups.length;i+=1){var group=pointGroups[i];if(1<group.length)for(var j=0;j<group.length;j+=1){var rawPoint=group[j],point=new Point(rawPoint.x,rawPoint.y,rawPoint.time),color=rawPoint.color;if(0===j)this.penColor=color,this._reset(),this._addPoint(point);else if(j!==group.length-1){var _addPoint2=this._addPoint(point),curve=_addPoint2.curve,widths=_addPoint2.widths;curve&&widths&&drawCurve(curve,widths,color)}}else this._reset(),drawDot(group[0])}},SignaturePad.prototype._toSVG=function(){var _this2=this,pointGroups=this._data,canvas=this._canvas,ratio=Math.max(window.devicePixelRatio||1,1),maxX=canvas.width/ratio,maxY=canvas.height/ratio,svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttributeNS(null,"width",canvas.width),svg.setAttributeNS(null,"height",canvas.height),this._fromData(pointGroups,function(curve,widths,color){var path=document.createElement("path");if(!(isNaN(curve.control1.x)||isNaN(curve.control1.y)||isNaN(curve.control2.x)||isNaN(curve.control2.y))){var attr="M "+curve.startPoint.x.toFixed(3)+","+curve.startPoint.y.toFixed(3)+" C "+curve.control1.x.toFixed(3)+","+curve.control1.y.toFixed(3)+" "+curve.control2.x.toFixed(3)+","+curve.control2.y.toFixed(3)+" "+curve.endPoint.x.toFixed(3)+","+curve.endPoint.y.toFixed(3);path.setAttribute("d",attr),path.setAttribute("stroke-width",(2.25*widths.end).toFixed(3)),path.setAttribute("stroke",color),path.setAttribute("fill","none"),path.setAttribute("stroke-linecap","round"),svg.appendChild(path)}},function(rawPoint){var circle=document.createElement("circle"),dotSize="function"==typeof _this2.dotSize?_this2.dotSize():_this2.dotSize;circle.setAttribute("r",dotSize),circle.setAttribute("cx",rawPoint.x),circle.setAttribute("cy",rawPoint.y),circle.setAttribute("fill",rawPoint.color),svg.appendChild(circle)});var header='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+maxX+" "+maxY+'" width="'+maxX+'" height="'+maxY+'">',body=svg.innerHTML;if(void 0===body){var dummy=document.createElement("dummy"),nodes=svg.childNodes;dummy.innerHTML="";for(var i=0;i<nodes.length;i+=1)dummy.appendChild(nodes[i].cloneNode(!0));body=dummy.innerHTML}return"data:image/svg+xml;base64,"+btoa(header+body+"</svg>")},SignaturePad.prototype.fromData=function(pointGroups){var _this3=this;this.clear(),this._fromData(pointGroups,function(curve,widths){return _this3._drawCurve(curve,widths.start,widths.end)},function(rawPoint){return _this3._drawDot(rawPoint)}),this._data=pointGroups},SignaturePad.prototype.toData=function(){return this._data},SignaturePad}()},function(module,exports,__webpack_require__){"use strict";module.exports={name:"likertitem"}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2);__webpack_require__(206);var pluginName="distresspicker";function Distresspicker(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}((Distresspicker.prototype=Object.create(Widget.prototype)).constructor=Distresspicker).prototype._init=function(){var value=Number(this.element.value)||-1;this.props=this._getProps(),$(this.element).slider({reversed:!0,min:-1,max:10,orientation:"vertical",step:this.props.step,value:value,enabled:!this.props.readonly}).closest(".question").addClass("or-distress-initialized"),this.$widget=$(this.element).next(".widget"),this.$slider=this.$widget.find(".slider"),this._addBulb(),this._addScale(),this._setChangeListener()},Distresspicker.prototype._getProps=function(){var type=this.element.attributes["data-type-xml"].value;return{readonly:this.element.readOnly,step:"decimal"===type?.1:1}},Distresspicker.prototype._addBulb=function(){this.$slider.append('<div class="bulb"><div class="inner"></div></div>')},Distresspicker.prototype._addScale=function(){for(var $scale=$('<div class="scale"></div>'),i=10;-1<=i;i--)$scale.append('<div class="number"><div class="value">'+i+"</div></div>");this.$slider.prepend($scale)},Distresspicker.prototype._setChangeListener=function(){$(this.element).on("slideStop."+this.namespace,function(){-1===Number(this.value)&&(this.value=""),$(this).trigger("change")})},Distresspicker.prototype.disable=function(){var value=""!==this.element.value?Number(this.element.value):-1;$(this.element).slider("disable").slider("setValue",value,!1)},Distresspicker.prototype.enable=function(){$(this.element).slider("enable")},Distresspicker.prototype.update=function(){var value=""!==this.element.value?Number(this.element.value):-1;value!==$(this.element).slider("getValue")&&$(this.element).slider("setValue",value,!1)},$.fn[pluginName]=function(options,event){return this.each(function(){var $this=$(this),data=$(this).data(pluginName);options=options||{},data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,new Distresspicker(this,options,event))})},module.exports={name:pluginName,selector:'.or-appearance-distress input[type="number"]'}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),Widget=__webpack_require__(13),pluginName="horizontalChoices";function HorizontalChoices(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}((HorizontalChoices.prototype=Object.create(Widget.prototype)).constructor=HorizontalChoices).prototype._init=function(){$(this.element).find(".option-wrapper").each(function(){for(var $wrapper=$(this),fillers=3-$wrapper.find("label").length%3;fillers<3&&0<fillers;)$wrapper.append('<label class="filler"></label>'),fillers--;$(this).closest(".question").addClass("or-horizontal-initialized")})},$.fn[pluginName]=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data(pluginName);data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,new HorizontalChoices(this,options,event))})},module.exports={name:pluginName,selector:".or-appearance-horizontal"}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2),pluginName="analogscalepicker",support=__webpack_require__(34);function Analogscalepicker(element,options){this.namespace=pluginName,Widget.call(this,element,options),this._init()}__webpack_require__(206),((Analogscalepicker.prototype=Object.create(Widget.prototype)).constructor=Analogscalepicker).prototype._init=function(){var $question=$(this.element).closest(".question").addClass("or-analog-scale-initialized"),$input=$(this.element),value=Number(this.element.value)||-1;this.props=this._getProps($question),$input.slider({reversed:"vertical"===this.props.orientation,min:0,max:100,orientation:this.props.orientation,step:this.props.step,value:value,enabled:!this.props.readonly}),this.$widget=$input.next(".widget"),this.$slider=this.$widget.find(".slider"),this.$labelContent=$('<div class="label-content widget" />').prependTo($question),this.$originalLabels=$question.find(".question-label, .or-hint, .or-required-msg, .or-constraint-msg"),this.$labelContent.append(this.$originalLabels),this._renderResetButton(),this._renderLabels(),this._renderScale(),this._setChangeListener(),this._setResizeListener(),$input.trigger("programmaticChange"+this.namespace)},Analogscalepicker.prototype._getProps=function($question){var appearances=$question.attr("class").split(" ").map(function(appearance){return appearance.substring(14)}),type=this.element.attributes["data-type-xml"].value;return{touch:support.touch,readonly:this.element.readOnly,step:"decimal"===type?.1:1,orientation:-1!==appearances.indexOf("horizontal")?"horizontal":"vertical"}},Analogscalepicker.prototype._renderLabels=function(){var $labelEl=this.$labelContent.find(".question-label.active"),labels=$labelEl.html().split(/\|/).map(function(label){return label.trim()});this.$mainLabel=this.$mainLabel||$('<span class="question-label widget active" />').insertAfter($labelEl),this.$mainLabel.empty().append(labels[0]),this.$maxLabel=this.$maxLabel||$('<div class="max-label" />').prependTo(this.$widget),this.$maxLabel.empty().append(labels[1]),this.$minLabel=this.$minLabel||$('<div class="min-label" />').appendTo(this.$widget),this.$minLabel.empty().append(labels[2]),labels[3]?(this.$showValue=this.$showValue||$('<div class="widget show-value" />').appendTo(this.$labelContent),this.$showValue.empty().append('<div class="show-value__box">'+labels[3]+'<span class="show-value__value">'+this.element.value+"</span></div>")):this.$showValue&&(this.$showValue.remove(),this.$showValue=void 0)},Analogscalepicker.prototype._renderScale=function(){var i,$scale=$('<div class="scale"></div>');if("vertical"===this.props.orientation)for(i=100;0<=i;i-=10)$scale.append(this._getNumberHtml(i));else for(i=0;i<=100;i+=10)$scale.append(this._getNumberHtml(i));this.$slider.prepend($scale)},Analogscalepicker.prototype._getNumberHtml=function(num){return'<div class="scale__number"><div class="scale__ticks"></div><div class="scale__value">'+num+"</div></div>"},Analogscalepicker.prototype._renderResetButton=function(){var that=this;this.$resetBtn=$('<button class="btn-icon-only btn-reset" aria-label="reset"><i class="icon icon-refresh"></i></button>').appendTo(this.$widget).on("click",function(){return $(that.element).slider("setValue",0,!1),$(that.element).val("").trigger("programmaticChange"+that.namespace),!1}).prop("disabled",that.props.readonly)},Analogscalepicker.prototype._updateCurrentValueShown=function(){this.$showValue&&this.$showValue.find(".show-value__value").text(this.element.value)},Analogscalepicker.prototype._setChangeListener=function(){var that=this;$(this.element).on("slideStop."+this.namespace+" programmaticChange"+this.namespace,function(){var empty=""===this.value;$(this).trigger("change"),that.$resetBtn.prop("disabled",empty||that.props.readonly),that.$slider.toggleClass("slider--empty",empty),that._updateCurrentValueShown()})},Analogscalepicker.prototype._setResizeListener=function(){var $question=$(this.element).closest(".question");$question.hasClass("or-appearance-horizontal")||$question.on("pageflip.enketo",this._stretchHeight)},Analogscalepicker.prototype._stretchHeight=function(){var $question=$(this).closest(".question").css("min-height","auto"),height=$question.outerHeight(),$form=$question.closest(".or"),diff=$form.offset().top+$form.height()-($question.offset().top+height)-10;diff&&$question.css("min-height",height+diff+"px")},Analogscalepicker.prototype.disable=function(){var value=""!==this.element.value?Number(this.element.value):0;$(this.element).slider("disable").slider("setValue",value,!1)},Analogscalepicker.prototype.enable=function(){$(this.element).slider("enable")},Analogscalepicker.prototype.update=function(){var value=""!==this.element.value?Number(this.element.value):0;value!==$(this.element).slider("getValue")&&$(this.element).slider("setValue",value,!1).trigger("programmaticChange"+this.namespace),this._renderLabels()},$.fn[pluginName]=function(options,event){return this.each(function(){var $this=$(this),data=$(this).data(pluginName);options=options||{},data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data(pluginName,new Analogscalepicker(this,options,event))})},module.exports={name:pluginName,selector:'.or-appearance-analog-scale input[type="number"]'}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2);function ImageViewer(element,options){this.namespace="imageViewer",Widget.call(this,element,options),this._init()}((ImageViewer.prototype=Object.create(Widget.prototype)).constructor=ImageViewer).prototype._init=function(){$(this.element).on("click",function(){var $link=$(this),href=$link.attr("href"),$img=$link.find("img"),src=$img.attr("src");return $link.attr("href",src),$img.attr("src",href),$link.toggleClass("open"),!1})},$.fn.imageViewer=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data("imageViewer");data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data("imageViewer",new ImageViewer(this,options,event))})},module.exports={name:"imageViewer",selector:"a.or-big-image"}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2),t=__webpack_require__(46).t;function Comment(element,options){this.namespace="comment",Widget.call(this,element,options),this._init()}((Comment.prototype=Object.create(Widget.prototype)).constructor=Comment).prototype._init=function(){this.$linkedQuestion=this._getLinkedQuestion(this.element),this.$commentQuestion=$(this.element).closest(".question"),1===this.$linkedQuestion.length&&(this.$commentQuestion.addClass("hide").attr("role","comment"),this.$commentButton=$('<a class="btn-icon-only btn-comment aria-label="comment" type="button" href="#"><i class="icon"> </i></a>'),this._setCommentButtonState(this.element.value),this.$linkedQuestion.find(".question-label").last().after(this.$commentButton),this._setCommentButtonHandler(),this._setValidationHandler(),this._setFocusHandler())},Comment.prototype._getLinkedQuestion=function(element){var $input=$(element),contextPath=this.options.helpers.input.getName($input),targetPath=element.dataset.for.trim(),absoluteTargetPath=this.options.helpers.pathToAbsolute(targetPath,contextPath),$root=$(element).closest("form.or, .or-repeat");return this.options.helpers.input.getWrapNodes($root.find('[name="'+absoluteTargetPath+'"], [data-name="'+absoluteTargetPath+'"]')).eq(0)},Comment.prototype._commentHasError=function(){return this.$commentQuestion.hasClass("invalid-required")||this.$commentQuestion.hasClass("invalid-constraint")},Comment.prototype._setCommentButtonState=function(value,error){value="string"==typeof value?value.trim():value,this.$commentButton.toggleClass("empty",!value),this.$commentButton.toggleClass("invalid",!!error)},Comment.prototype._setCommentButtonHandler=function(){var that=this;this.$commentButton.click(function(){return that._isCommentModalShown(that.$linkedQuestion)?that._hideCommentModal(that.$linkedQuestion):that._showCommentModal(),!1})},Comment.prototype._setValidationHandler=function(){var that=this;$("form.or").on("validationcomplete.enketo",function(){var error=that._commentHasError(),value=that.element.value;that._setCommentButtonState(value,error)})},Comment.prototype._setFocusHandler=function(){var that=this;$(this.element).on("applyfocus",function(){that.$commentButton.is(":visible")?that.$commentButton.click():console.log("The linked question is not visible. Cannot apply focus to "+that.element.getAttribute("name"))})},Comment.prototype._isCommentModalShown=function($linkedQuestion){return 1===$linkedQuestion.find(".or-comment-widget").length},Comment.prototype._showCommentModal=function(){var $widget,$content,$input,$overlay,that=this,$comment=$(this.element).closest(".question").clone(!1),updateText=t("widget.comment.update")||"Update",$updateButton=$('<button class="btn btn-primary or-comment-widget__content__btn-update" type="button">'+updateText+"</button>"),$closeButton=$('<button class="btn-icon-only or-comment-widget__content__btn-close-x" type="button">&times;</button>');$input=$comment.removeClass("hide").find("input, textarea").addClass("ignore").removeAttr("name data-for data-type-xml").removeData(),$overlay=$('<div class="or-comment-widget__overlay"></div>'),$content=$('<div class="or-comment-widget__content"></div>').append($comment).append($closeButton).append($updateButton),$widget=$('<section class="widget or-comment-widget"></section>').append($overlay).append($content),this.$linkedQuestion.find(".or-comment-widget").remove().end().prepend($widget).before($overlay.clone(!1)),$input.focus(),$widget.get(0).scrollIntoView(!1),$updateButton.on("click",function(){var error,value=$input.val();return $(that.element).val(value).trigger("change"),error=that._commentHasError(),that._setCommentButtonState(value,error),that._hideCommentModal(that.$linkedQuestion),that.options.helpers.input.validate($(that.$linkedQuestion.get(0).querySelector("input, select, textarea"))),!1}),$closeButton.add($overlay).on("click",function(){return that._hideCommentModal(that.$linkedQuestion),!1})},Comment.prototype._hideCommentModal=function($linkedQuestion){$linkedQuestion.find(".or-comment-widget").remove().end().prev(".or-comment-widget__overlay").remove()},$.fn.comment=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data("comment");data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data("comment",new Comment(this,options,event))})},module.exports={name:"comment",selector:'.or-appearance-comment input[type="text"][data-for], .or-appearance-comment textarea[data-for]',helpersRequired:["input","pathToAbsolute"]}},function(module,exports,__webpack_require__){"use strict";var Widget=__webpack_require__(13),$=__webpack_require__(2),t=__webpack_require__(46).t;function ImageMap(element,options){this.namespace="imageMap",Widget.call(this,element,options),this.options=options,this._init()}((ImageMap.prototype=Object.create(Widget.prototype)).constructor=ImageMap).prototype._init=function(){var that=this,img=this.element.querySelector("img");if(this.$inputs=$(this.element).find("input"),this.props=this._getProps(),this.element.classList.add("or-image-map-initialized"),!img)return this._showSvgNotFoundError();img.getAttribute("src")?this._addMarkup(img).then(this._addFunctionality.bind(this)):$(img).on("load",function(){that._addMarkup(img).then(that._addFunctionality.bind(that))})},ImageMap.prototype._addFunctionality=function($widget){this.$svg=$widget.find("svg"),this.$tooltip=$widget.find(".image-map__ui__tooltip"),this.props.readonly&&this.disable(),this._setSvgClickHandler(),this._setChangeHandler(),this._setHoverHandler(),this._updateImage()},ImageMap.prototype._getProps=function(){return{readonly:this.$inputs[0].readOnly}},ImageMap.prototype._addMarkup=function(img){var that=this,src=img.getAttribute("src");return $.get(src).then(function(data){var $svg,$widget,width,height;if(that._isSvgDoc(data)){$svg=that._removeUnmatchedIds($(data.querySelector("svg"))),$widget=$('<div class="widget image-map"/>').append('<div class="image-map__ui"><span class="image-map__ui__tooltip"></span></div>').append($svg),$(that.element).find("img").remove(),$(that.element).find(".option-wrapper").before($widget);var bbox={};try{bbox=$svg[0].getBBox()}catch(e){console.error("Could not obtain Boundary Box of SVG element",e)}return width=bbox.width||$svg.attr("width"),height=bbox.height||$svg.attr("height"),$svg.attr("viewBox",[0,0,parseInt(width,10),parseInt(height,10)].join(" ")),$widget}throw"Image is not an SVG doc"}).catch(this._showSvgNotFoundError.bind(that))},ImageMap.prototype._showSvgNotFoundError=function(){$(this.element).find(".option-wrapper").before('<div class="widget image-map"><div class="image-map__error">'+t("imagemap.svgNotFound")+"</div></div>")},ImageMap.prototype._removeUnmatchedIds=function($svg){var that=this;return $svg.find("path[id], g[id]").each(function(){that._getInput(this.id)||this.removeAttribute("id")}),$svg},ImageMap.prototype._getInput=function(id){return this.element.querySelector('input[value="'+id+'"]')},ImageMap.prototype._setSvgClickHandler=function(){var that=this;this.$svg.not("[or-readonly]").on("click","path[id], g[id]",function(event){var id=event.target.id||$(event.target).closest("g[id]")[0].id,input=that._getInput(id);input&&$(input).prop("checked",!input.checked).trigger("change")})},ImageMap.prototype._setChangeHandler=function(){this.$inputs.on("change inputupdate.enketo",this._updateImage.bind(this))},ImageMap.prototype._setHoverHandler=function(){var that=this;this.$svg.on("mouseenter","path[id], g[id]",function(event){var id=event.target.id||$(event.target).closest("g[id]")[0].id,optionLabel=$(that._getInput(id)).siblings(".option-label.active").text();that.$tooltip.text(optionLabel)}).on("mouseleave","path[id], g[id]",function(){that.$tooltip.text("")})},ImageMap.prototype._isSvgDoc=function(data){return"object"==typeof data&&data.querySelector("svg")},ImageMap.prototype._updateImage=function(){var that=this,values=this.options.helpers.input.getVal(this.$inputs.eq(0));this.$svg.find("path[or-selected], g[or-selected]").removeAttr("or-selected"),"string"==typeof values&&(values=[values]),values.forEach(function(value){value&&that.$svg.find("path#"+value+",g#"+value).attr("or-selected","")})},ImageMap.prototype.disable=function(){this.$svg.attr("or-readonly","")},ImageMap.prototype.enable=function(){this.props.readonly||this.$svg.removeAttr("or-readonly")},$.fn.imageMap=function(options,event){return options=options||{},this.each(function(){var $this=$(this),data=$this.data("imageMap");data||"object"!=typeof options?data&&"string"==typeof options&&data[options](this):$this.data("imageMap",new ImageMap(this,options,event))})},module.exports={name:"imageMap",selector:".simple-select.or-appearance-image-map",helpersRequired:["input"]}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2);module.exports={init:function(){var currentDirectionality,that=this,$langSelector=$(".form-language-selector");if(!this.form)throw new Error("Language module not correctly instantiated with form property.");this.$formLanguages=this.form.view.$.find("#form-languages"),this.currentLang=this.$formLanguages.attr("data-default-lang")||this.$formLanguages.find("option").eq(0).attr("value"),currentDirectionality=this.$formLanguages.find('[value="'+this.currentLang+'"]').attr("data-dir")||"ltr",this.$formLanguages.detach().appendTo($langSelector).val(this.currentLang),this.form.view.$.attr("dir",currentDirectionality),this.$formLanguages.find("option").length<2||($langSelector.removeClass("hide"),this.$formLanguages.change(function(event){event.preventDefault(),that.currentLang=$(this).val(),that.setAll(that.currentLang)}))},getCurrentLang:function(){return this.currentLang},getCurrentLangDesc:function(){return this.$formLanguages.find('[value="'+this.currentLang+'"]').text()},setAll:function(lang){var that=this,dir=this.$formLanguages.find('[value="'+lang+'"]').attr("data-dir")||"ltr";this.form.view.$.attr("dir",dir).find("[lang]").removeClass("active").filter('[lang="'+lang+'"], [lang=""]').filter(function(){var $this=$(this);return!$this.hasClass("or-form-short")||$this.hasClass("or-form-short")&&0===$this.siblings(".or-form-long").length}).addClass("active"),window.enketoFormLocale=lang,this.form.view.$.find("select, datalist").each(function(){that.setSelect($(this))}),this.form.view.$.trigger("changelanguage")},setSelect:function($select){var value,curLabel,newLabel;$select.children("option").not('[value=""], [data-value=""]').each(function(){var $option=$(this);curLabel=$option.text(),value=$option.attr("value")||$option[0].dataset.value,newLabel=void 0!==(newLabel=$option.closest(".question").find(".or-option-translations").children('.active[data-option-value="'+value+'"]').text().trim())&&0<newLabel.length?newLabel:curLabel,$option.text(newLabel)})}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2);module.exports={init:function(){var item,param,curVal,newVal,dataNode,props,$preload,that=this;if(!this.form)throw new Error("Preload module not correctly instantiated with form property.");this.form.view.$.find("input[data-preload], select[data-preload], textarea[data-preload]").each(function(){$preload=$(this),props=that.form.input.getProps($preload),item=$preload.attr("data-preload").toLowerCase(),param=$preload.attr("data-preload-params").toLowerCase(),void 0!==that[item]?(dataNode=that.form.model.node(props.path,props.index)).get().length&&(curVal=dataNode.getVal()[0],newVal=that[item]({param:param,curVal:curVal,dataNode:dataNode}),dataNode.setVal(newVal,null,props.xmlType)):console.log('Preload "'+item+'" not supported. May or may not be a big deal.')})},timestamp:function(o){var value,that=this;return"start"===o.param?0<o.curVal.length?o.curVal:this.form.model.evaluate("now()","string"):"end"===o.param?(this.form.view.$.on("beforesave",function(){value=that.form.model.evaluate("now()","string"),o.dataNode.setVal(value,null,"datetime")}),this.form.model.evaluate("now()","string")):"error - unknown timestamp parameter"},date:function(o){var today;return 0===o.curVal.length?(today=new Date(this.form.model.evaluate("today()","string"))).getFullYear().toString().pad(4)+"-"+(today.getMonth()+1).toString().pad(2)+"-"+today.getDate().toString().pad(2):o.curVal},property:function(o){var node;return 0===o.curVal.length?(node=this.form.model.node('instance("__session")/session/context/'+o.param)).get().length?node.getVal()[0]:"no "+o.param+" property in enketo":o.curVal},context:function(o){return 0===o.curVal.length?"application"===o.param?"enketo":o.param+" not supported in enketo":o.curVal},patient:function(o){return 0===o.curVal.length?"patient preload item not supported in enketo":o.curVal},user:function(o){return 0===o.curVal.length?"user preload item not supported in enketo yet":o.curVal},uid:function(o){return 0===o.curVal.length?this.form.model.evaluate('concat("uuid:", uuid())',"string"):o.curVal}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2);module.exports={update:function(updated){var expr,clonedRepeatsPresent,insideRepeat,insideRepeatClone,$context,$output,context,index,$nodes,outputCache={},val="",that=this;if(!this.form)throw new Error("Output module not correctly instantiated with form property.");$nodes=this.form.getRelatedNodes("data-value",".or-output",updated),clonedRepeatsPresent=this.form.repeatsPresent&&0<this.form.view.$.find(".or-repeat.clone").length,$nodes.each(function(){($output=$(this)).closest(".or-branch").parent().closest(".disabled").length||(expr=$output.attr("data-value"),($context=$output.closest(".question, .note, .or-group")).is(".or-group")||($context=$context.find("[name]").eq(0)),context=that.form.input.getName($context),$context.children('.or-repeat-info[data-name="'+context+'"]').length&&!$context.children('.or-repeat[name="'+context+'"]').length&&(context=null),insideRepeat=clonedRepeatsPresent&&0<$output.parentsUntil(".or",".or-repeat").length,insideRepeatClone=insideRepeat&&0<$output.parentsUntil(".or",".or-repeat.clone").length,index=insideRepeatClone&&context?that.form.input.getIndex($context):0,void 0!==outputCache[expr]?val=outputCache[expr]:(val=that.form.model.evaluate(expr,"string",context,index,!0),insideRepeat||(outputCache[expr]=val)),$output.text()!==val&&$output.text(val))})}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2);module.exports={update:function(updated,filter){var that=this;if(filter=filter||"",!this.form)throw new Error("Calculation module not correctly instantiated with form property.");((updated=updated||{}).relevantPath?this.form.getRelatedNodes("data-calculate",'[name^="'+updated.relevantPath+'/"]'+filter).add(this.form.getRelatedNodes("data-calculate",'[name="'+updated.relevantPath+'"]'+filter)).add(this.form.getRelatedNodes("data-calculate",'[data-name="'+updated.relevantPath+'"]'+filter)):this.form.getRelatedNodes("data-calculate",filter,updated)).each(function(){var result,dataNodesObj,dataNodes,$dataNode,name,dataNodeName,expr,newExpr,dataType,constraintExpr,relevantExpr,relevant,$this;function updateCalc(index){var pathParts=name.split("/"),parentPath=pathParts.splice(0,pathParts.length-1).join("/"),$parentGroups=that.form.view.$.find('.or-group[name="'+parentPath+'"],.or-group-data[name="'+parentPath+'"]').eq(index).parents(".or-group, .or-group-data").addBack();relevant=$parentGroups.length?$parentGroups.filter("[data-relevant]").reverse().get().map(function(group){var $group=$(group),nm=that.form.input.getName($group);return{context:nm,index:that.form.view.$.find('.or-group[name="'+nm+'"], .or-group-data[name="'+nm+'"]').index($group),expr:that.form.input.getRelevant($group)}}).concat([{context:name,index:index,expr:relevantExpr}]).every(function(item){return!item.expr||that.form.model.evaluate(item.expr,"boolean",item.context,item.index)}):!relevantExpr||that.form.model.evaluate(relevantExpr,"boolean",name,index),newExpr=that.form.replaceChoiceNameFn(expr,"string",name,index),result=relevant&&newExpr?that.form.model.evaluate(newExpr,"string",name,index):"",dataNodesObj.setIndex(index),dataNodesObj.setVal(result,constraintExpr,dataType),that.form.input.setVal(name,index,dataNodesObj.getVal()[0])}$this=$(this),dataNodeName=-1!==(name=that.form.input.getName($this)).lastIndexOf("/")?name.substring(name.lastIndexOf("/")+1):name,expr=that.form.input.getCalculation($this),dataType=that.form.input.getXmlType($this),constraintExpr=that.form.input.getConstraint($this),relevantExpr=that.form.input.getRelevant($this),1<(dataNodes=(dataNodesObj=that.form.model.node(name)).get()).length&&updated.repeatPath&&-1!==name.indexOf(updated.repeatPath)?($dataNode=that.form.model.node(updated.repeatPath,updated.repeatIndex).get().find(dataNodeName),updateCalc($(dataNodes).index($dataNode))):1===dataNodes.length?updateCalc(0):dataNodes.each(function(index){updateCalc(index)})})}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(2),utils=__webpack_require__(38),KEYBOARD_CUT_PASTE="xvc";function _setNumberMask(selector,validRegex,allowedChars){$(selector).on("keydown",function(e){return!(!function(e){return 1<e.key.length&&"Spacebar"!==e.key}(e)&&!function(e){return-1!==KEYBOARD_CUT_PASTE.indexOf(e.key)&&(e.metaKey||e.ctrlKey)}(e)&&-1===allowedChars.indexOf(e.key))}).on("paste",function(e){var val=utils.getPasteData(e);return!(!val||!validRegex.test(val.trim()))||($(this).val("").trigger("change"),!1)}).on("blur",function(){void 0!==this.validity&&void 0!==this.validity.badInput&&this.validity.badInput?this.value="":void 0===this.validity.badInput&&this.value&&!validRegex.test(this.value.trim())&&(this.value="")})}module.exports={init:function(){_setNumberMask('[data-type-xml="int"]',/^(-?[0-9]+$)/,"-0123456789"),_setNumberMask('[data-type-xml="decimal"]',/^(-?[0-9]+[.,]?[0-9]*$)/,"-0123456789.,")}}},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(123),__webpack_require__(410),__webpack_require__(124),__webpack_require__(411);var toastr=__webpack_require__(35),toastr_default=__webpack_require__.n(toastr),angular=__webpack_require__(39),angular_default=__webpack_require__.n(angular),QueryParams=(__webpack_require__(412),__webpack_require__(1)),Server=(__webpack_require__(415),__webpack_require__(40)),Session=__webpack_require__(24);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(source,!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var emitter=__webpack_require__(45),Sms_Sms=function(){function Sms(session){_classCallCheck(this,Sms),this.session=session}var _submit;return _createClass(Sms,[{key:"transcode",value:function(xml){return new EnketoXmlParser(xml).parse()}},{key:"objectToText",value:function(object){return Object.keys(object).map(function(key){return"".concat(key,":").concat(object[key])}).join(";")}},{key:"submit",value:(_submit=function(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}(regeneratorRuntime.mark(function _callee(){var number,output,smsLink;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return number=QueryParams.a.get("sms"),output=_objectSpread({},"object"===_typeof(this.session.data.payload)?this.session.data.payload:{},{},this.transcode(this.session.data.xml)),smsLink=this._smsLink(number,this.objectToText(output)),window.clickSendSms=function(){emitter.emit("SMS.click")},emitter.emit("EnketoForm.submit.status",'<a href="'+smsLink+'" class="btn btn-primary" id="instantSubmit__sms-send" target="_blank" onclick="clickSendSms()">Click here to send SMS</a>'),_context.abrupt("return",new Promise(function(resolve){emitter.once("SMS.click",function(){setTimeout(resolve,200)})}));case 6:case"end":return _context.stop()}},_callee,this)})),function(){return _submit.apply(this,arguments)})},{key:"_smsLink",value:function(number,body){var sms="sms:"+encodeURIComponent(number);return this._isPlatformApple()?sms+"&body="+encodeURIComponent(body):sms+"?body="+encodeURIComponent(body)}},{key:"_isPlatformApple",value:function(){var userAgent=window.navigator.userAgent.toLowerCase();return/iphone|ipod|ipad|os\sx/.test(userAgent)}}]),Sms}(),IGNORED_TAGS=["meta","start","end","today","username","simserial","subscriberid","deviceid","phonenumber"],EnketoXmlParser=function(){function EnketoXmlParser(xml){_classCallCheck(this,EnketoXmlParser),this.$xml=$($.parseXML(xml)),this.output={}}return _createClass(EnketoXmlParser,[{key:"parse",value:function(){return this._appendMeta(),this._appendFromNodes(this.$xml.find("data").children()),this.output}},{key:"_appendMeta",value:function(){var meta=this.$xml.find("meta");this._appendFromNodes(meta.children())}},{key:"_appendFromNodes",value:function($children){var _this=this;$children.each(function(){if($(this).children().length)return _this._appendFromNodes($(this).children());var node=$(this)[0];IGNORED_TAGS.includes(node.nodeName)||"file"!==node.getAttribute("type")&&node.textContent&&(_this.output[node.nodeName]=node.textContent)})}}]),EnketoXmlParser}();function Http_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Http_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Http_Http=function(){function Http(session){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Http),this.session=session}var _submit;return function(Constructor,protoProps,staticProps){protoProps&&Http_defineProperties(Constructor.prototype,protoProps),staticProps&&Http_defineProperties(Constructor,staticProps)}(Http,[{key:"submit",value:(_submit=function(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Http_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Http_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Server.a.create().postForm(this.session);case 2:return _context.abrupt("return",_context.sent);case 3:case"end":return _context.stop()}},_callee,this)})),function(){return _submit.apply(this,arguments)})}]),Http}();function Submit_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Submit_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Submit_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Submit_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Submit_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Submit(session){return new Submit_Submission(session).send()}var Submit_emitter=__webpack_require__(45),Submit_Submission=function(){function Submission(session){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Submission),this.session=session}var _send,_chooseDriver;return function(Constructor,protoProps,staticProps){protoProps&&Submit_defineProperties(Constructor.prototype,protoProps),staticProps&&Submit_defineProperties(Constructor,staticProps)}(Submission,[{key:"getDriver",value:function(){return QueryParams.a.has("sms")?new Sms_Sms(this.session):new Http_Http(this.session)}},{key:"chooseDriver",value:(_chooseDriver=Submit_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _this=this;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return window.chooseMethod=function(method){Submit_emitter.emit("Submit.method.choose",method)},Submit_emitter.emit("EnketoForm.submit.status",'<div style="text-align:center">Please choose submission method <br><a href="#" id="instantSubmit__sms" role="button" style="margin:16px" onclick="chooseMethod(\'sms\')" class="btn btn-primary">SMS</a><a href="#" id="instantSubmit__http" role="button" style="margin:16px" onclick="chooseMethod(\'http\')" class="btn btn-primary">Internet</a></div>'),_context.abrupt("return",new Promise(function(resolve){Submit_emitter.once("Submit.method.choose",function(method){return Submit_emitter.emit("EnketoForm.submit.status","Please wait..."),resolve("sms"===method?new Sms_Sms(_this.session):new Http_Http(_this.session))})}));case 3:case"end":return _context.stop()}},_callee)})),function(){return _chooseDriver.apply(this,arguments)})},{key:"send",value:(_send=Submit_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var driver;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(Submit_emitter.emit("EnketoForm.submitting"),QueryParams.a.get("instant_submit"))return _context2.next=4,this.chooseDriver();_context2.next=7;break;case 4:driver=_context2.sent,_context2.next=8;break;case 7:driver=this.getDriver();case 8:return _context2.next=10,driver.submit();case 10:case"end":return _context2.stop()}},_callee2,this)})),function(){return _send.apply(this,arguments)})},{key:"_updateStatus",value:function(text){Submit_emitter.emit("EnketoForm.submit.status",text)}}]),Submission}();function Online_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Online_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Online_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Online_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Online_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Online_Online=function(){function Online(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Online)}var _loadSessionFromUrl2,_attachmentUrl,_finalize;return function(Constructor,protoProps,staticProps){protoProps&&Online_defineProperties(Constructor.prototype,protoProps),staticProps&&Online_defineProperties(Constructor,staticProps)}(Online,[{key:"start",value:function(){return QueryParams.a.has("edit")?this._loadSessionFromUrl(QueryParams.a.getPath("edit")):Promise.resolve(new Session.a({online:!0,draft:!1}))}},{key:"canSave",value:function(){return!1}},{key:"finalize",value:(_finalize=Online_asyncToGenerator(regeneratorRuntime.mark(function _callee(session){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,Submit(session);case 2:case"end":return _context.stop()}},_callee)})),function(_x){return _finalize.apply(this,arguments)})},{key:"attachmentUrl",value:(_attachmentUrl=Online_asyncToGenerator(regeneratorRuntime.mark(function _callee2(session,fileName){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",QueryParams.a.getUrl("submissions/"+session.data.instance_id+"/photo/"+fileName));case 1:case"end":return _context2.stop()}},_callee2)})),function(_x2,_x3){return _attachmentUrl.apply(this,arguments)})},{key:"_loadSessionFromUrl",value:(_loadSessionFromUrl2=Online_asyncToGenerator(regeneratorRuntime.mark(function _callee3(url){var data;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,Server.a.create().json(url);case 2:return data=_context3.sent,_context3.abrupt("return",new Session.a({submitted:!0,xml:data.instance,instance_id:data.instance_id,deprecated_id:data.deprecated_id}));case 4:case"end":return _context3.stop()}},_callee3)})),function(_x4){return _loadSessionFromUrl2.apply(this,arguments)})}]),Online}(),Optimizer=__webpack_require__(207),Optimizer_default=__webpack_require__.n(Optimizer),SessionRepository=__webpack_require__(14);function Offline_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Offline_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Offline_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Offline_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Offline_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Offline_emitter=__webpack_require__(45),AVAILABLE_DRIVERS={online:Online_Online,offline:function(){function Offline(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Offline)}var _createDistinctFromName2,_createFromName2,_create2,_startFromName2,_sessionFromUi2,_chooseSession2,_loadSessions2,_attachmentUrl,_finalize,_save,_start;return function(Constructor,protoProps,staticProps){protoProps&&Offline_defineProperties(Constructor.prototype,protoProps),staticProps&&Offline_defineProperties(Constructor,staticProps)}(Offline,[{key:"start",value:(_start=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this._loadSessions();case 2:return _context.abrupt("return",this._chooseSession());case 3:case"end":return _context.stop()}},_callee,this)})),function(){return _start.apply(this,arguments)})},{key:"canSave",value:function(){return!0}},{key:"save",value:(_save=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee2(session){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Optimizer_default()(session,function(progress){Offline_emitter.emit("EnketoForm.savingProgress",progress)});case 2:return session=_context2.sent,_context2.t0=Session.a,_context2.next=6,SessionRepository.default.update(session.data);case 6:return _context2.t1=_context2.sent,_context2.abrupt("return",new _context2.t0(_context2.t1));case 8:case"end":return _context2.stop()}},_callee2)})),function(_x){return _save.apply(this,arguments)})},{key:"finalize",value:(_finalize=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee3(session){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(QueryParams.a.has("instant_submit"))return _context3.next=3,Submit(session);_context3.next=4;break;case 3:return _context3.abrupt("return",_context3.sent);case 4:return _context3.next=6,this.save(session.setData({draft:!1}));case 6:return _context3.abrupt("return",_context3.sent);case 7:case"end":return _context3.stop()}},_callee3,this)})),function(_x2){return _finalize.apply(this,arguments)})},{key:"attachmentUrl",value:(_attachmentUrl=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee4(session,fileName){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",SessionRepository.default.getAttachment(session.data._id,fileName).then(function(f){return URL.createObjectURL(f)}));case 1:case"end":return _context4.stop()}},_callee4)})),function(_x3,_x4){return _attachmentUrl.apply(this,arguments)})},{key:"_loadSessions",value:(_loadSessions2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var listedSessions;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,SessionRepository.default.all();case 2:this.sessions=_context5.sent,listedSessions=this.sessions.filter(function(s){return s.draft}).reverse(),Offline_emitter.emit("SessionModal.updateSessions",listedSessions);case 5:case"end":return _context5.stop()}},_callee5,this)})),function(){return _loadSessions2.apply(this,arguments)})},{key:"_chooseSession",value:(_chooseSession2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(QueryParams.a.has("session"))return _context6.abrupt("return",this._startFromName(QueryParams.a.get("session")));_context6.next=2;break;case 2:return _context6.abrupt("return",this._sessionFromUi());case 3:case"end":return _context6.stop()}},_callee6,this)})),function(){return _chooseSession2.apply(this,arguments)})},{key:"_sessionFromUi",value:(_sessionFromUi2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee8(){var _this=this;return regeneratorRuntime.wrap(function(_context8){for(;;)switch(_context8.prev=_context8.next){case 0:return Offline_emitter.emit("SessionModal.activate"),_context8.abrupt("return",new Promise(function(resolve){Offline_emitter.once("Session.create",function(name){resolve(_this._createDistinctFromName(name))}),Offline_emitter.on("Session.delete",function(){var _ref=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee7(session){return regeneratorRuntime.wrap(function(_context7){for(;;)switch(_context7.prev=_context7.next){case 0:return _context7.next=2,SessionRepository.default.remove(session);case 2:return _context7.next=4,_this._loadSessions();case 4:case"end":return _context7.stop()}},_callee7)}));return function(_x5){return _ref.apply(this,arguments)}}()),Offline_emitter.on("Session.select",function(session){resolve(new Session.a(session))})}));case 2:case"end":return _context8.stop()}},_callee8)})),function(){return _sessionFromUi2.apply(this,arguments)})},{key:"_startFromName",value:(_startFromName2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee9(name){var existingSession;return regeneratorRuntime.wrap(function(_context9){for(;;)switch(_context9.prev=_context9.next){case 0:if(existingSession=this.sessions.find(function(s){return s.name==name}))return _context9.abrupt("return",new Session.a(existingSession));_context9.next=3;break;case 3:return _context9.abrupt("return",this._createFromName(name));case 4:case"end":return _context9.stop()}},_callee9,this)})),function(_x6){return _startFromName2.apply(this,arguments)})},{key:"_create",value:(_create2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee10(data){var session,savedSessionData;return regeneratorRuntime.wrap(function(_context10){for(;;)switch(_context10.prev=_context10.next){case 0:return session=new Session.a(data),_context10.next=3,SessionRepository.default.create(session.data);case 3:return savedSessionData=_context10.sent,_context10.abrupt("return",new Session.a(savedSessionData));case 5:case"end":return _context10.stop()}},_callee10)})),function(_x7){return _create2.apply(this,arguments)})},{key:"_createFromName",value:(_createFromName2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee11(name){var payload,_args11=arguments;return regeneratorRuntime.wrap(function(_context11){for(;;)switch(_context11.prev=_context11.next){case 0:return payload=1<_args11.length&&void 0!==_args11[1]?_args11[1]:{},QueryParams.a.has("session_extra")&&(payload=JSON.parse(QueryParams.a.get("session_extra"))),_context11.abrupt("return",this._create({name:name,payload:payload}));case 3:case"end":return _context11.stop()}},_callee11,this)})),function(_x8){return _createFromName2.apply(this,arguments)})},{key:"_createDistinctFromName",value:(_createDistinctFromName2=Offline_asyncToGenerator(regeneratorRuntime.mark(function _callee12(name){var date;return regeneratorRuntime.wrap(function(_context12){for(;;)switch(_context12.prev=_context12.next){case 0:return this.sessions.find(function(s){return s.name==name})&&(date=new Date,name="".concat(name," ").concat(date.getHours(),":").concat(date.getMinutes())),_context12.abrupt("return",this._createFromName(name));case 2:case"end":return _context12.stop()}},_callee12,this)})),function(_x9){return _createDistinctFromName2.apply(this,arguments)})}]),Offline}()},SessionDrivers_getDriver=function(){var mode=QueryParams.a.get("mode");return new AVAILABLE_DRIVERS[mode||"offline"]};function SessionManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function SessionManager_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){SessionManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){SessionManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function SessionManager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var sessions_SessionManager=new(function(){function SessionManager(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SessionManager),this.driver=SessionDrivers_getDriver()}var _save,_finalize,_attachmentUrl,_start;return function(Constructor,protoProps,staticProps){protoProps&&SessionManager_defineProperties(Constructor.prototype,protoProps),staticProps&&SessionManager_defineProperties(Constructor,staticProps)}(SessionManager,[{key:"start",value:(_start=SessionManager_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this.driver.start();case 2:this.session=_context.sent;case 3:case"end":return _context.stop()}},_callee,this)})),function(){return _start.apply(this,arguments)})},{key:"attachmentUrl",value:(_attachmentUrl=SessionManager_asyncToGenerator(regeneratorRuntime.mark(function _callee2(fileName){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,this.driver.attachmentUrl(this.session,fileName);case 2:return _context2.abrupt("return",_context2.sent);case 3:case"end":return _context2.stop()}},_callee2,this)})),function(_x){return _attachmentUrl.apply(this,arguments)})},{key:"finalize",value:(_finalize=SessionManager_asyncToGenerator(regeneratorRuntime.mark(function _callee3(form){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,this.save(form);case 2:return _context3.next=4,this.driver.finalize(this.session);case 4:case"end":return _context3.stop()}},_callee3,this)})),function(_x2){return _finalize.apply(this,arguments)})},{key:"save",value:(_save=SessionManager_asyncToGenerator(regeneratorRuntime.mark(function _callee4(form){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(this.session.putEnketoForm(form),this.driver.canSave()){_context4.next=3;break}return _context4.abrupt("return",Promise.resolve(!0));case 3:return _context4.next=5,this.driver.save(this.session);case 5:this.session=_context4.sent;case 6:case"end":return _context4.stop()}},_callee4,this)})),function(_x3){return _save.apply(this,arguments)})}]),SessionManager}()),fileManager=__webpack_require__(134),originalGetFileUrl=fileManager.getFileUrl;fileManager.getFileUrl=function(subject){return subject&&"string"==typeof subject?sessions_SessionManager.attachmentUrl(subject):originalGetFileUrl(subject)};var file_manager=fileManager;function SurveyManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function SurveyManager_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){SurveyManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){SurveyManager_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function SurveyManager_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var survey_SurveyManager=new(function(){function SurveyManager(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,SurveyManager)}var _load2,_loadAndAttach;return function(Constructor,protoProps,staticProps){protoProps&&SurveyManager_defineProperties(Constructor.prototype,protoProps),staticProps&&SurveyManager_defineProperties(Constructor,staticProps)}(SurveyManager,[{key:"loadAndAttach",value:(_loadAndAttach=SurveyManager_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,this._load();case 2:this._preprocessFormHtml(),this._attachSurveyFormToDom();case 4:case"end":return _context.stop()}},_callee,this)})),function(){return _loadAndAttach.apply(this,arguments)})},{key:"_load",value:(_load2=SurveyManager_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var $form;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.next=2,Server.a.create().json(QueryParams.a.getPath("survey"));case 2:this.survey=_context2.sent,QueryParams.a.has("readonly")&&($form=$(this.survey.form),$("input,select",$form).attr("readonly","true()"),this.survey.form=$form.prop("outerHTML"));case 4:case"end":return _context2.stop()}},_callee2,this)})),function(){return _load2.apply(this,arguments)})},{key:"_preprocessFormHtml",value:function(){this.survey.form=this.survey.form.replace(/jr:\/\/images\//g,QueryParams.a.getPath("assets")+"/")}},{key:"_attachSurveyFormToDom",value:function(){document.querySelector(".form-header").insertAdjacentHTML("afterend",this.survey.form),this._hideSurveyTitle()}},{key:"_hideSurveyTitle",value:function(){"off"===QueryParams.a.get("title")&&document.getElementById("form-title").remove()}}]),SurveyManager}());function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function EnketoForm_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function EnketoForm_defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function EnketoForm_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function EnketoForm_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){EnketoForm_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){EnketoForm_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function EnketoForm_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Form=__webpack_require__(426),EnketoForm_emitter=__webpack_require__(45),makeEmitter=function(silent){return silent?function(e){}:function(e){return EnketoForm_emitter.emit(e)}},survey_EnketoForm=new(function(){function EnketoForm(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,EnketoForm)}var _finishAndSubmit,_validate,_form2,_saveSession2,_save,_init;return function(Constructor,protoProps,staticProps){protoProps&&EnketoForm_defineProperties(Constructor.prototype,protoProps),staticProps&&EnketoForm_defineProperties(Constructor,staticProps)}(EnketoForm,[{key:"init",value:(_init=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return this.saving=!1,this.validating=!1,_context.next=4,survey_SurveyManager.loadAndAttach();case 4:return _context.next=6,sessions_SessionManager.start();case 6:this._newFormInstance(),this._initFormInstance(),this._localizeForm(),EnketoForm_emitter.emit("EnketoForm.initialized");case 10:case"end":return _context.stop()}},_callee,this)})),function(){return _init.apply(this,arguments)})},{key:"_newFormInstance",value:function(){this.form=new Form("form.or:eq(0)",function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?EnketoForm_ownKeys(source,!0).forEach(function(key){EnketoForm_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):EnketoForm_ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}({modelStr:survey_SurveyManager.survey.model},sessions_SessionManager.session.toFormInstance()))}},{key:"_initFormInstance",value:function(){var loadErrors=this.form.init();if(loadErrors.length)throw console.error(loadErrors),new Error("The form could not be initialized");setTimeout(this._restoreLastPage.bind(this),50)}},{key:"_localizeForm",value:function(){QueryParams.a.has("lang")&&i18n.set(QueryParams.a.get("lang"));var lang=i18n.get();this.form.langs.setAll(lang)}},{key:"save",value:(_save=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(this.saving)return _context2.abrupt("return",null);_context2.next=2;break;case 2:return this.saving=!0,EnketoForm_emitter.emit("EnketoForm.saving"),_context2.prev=4,_context2.next=7,this._saveSession();case 7:_context2.next=14;break;case 9:throw _context2.prev=9,_context2.t0=_context2.catch(4),this.saving=!1,EnketoForm_emitter.emit("EnketoForm.saveFailed"),_context2.t0;case 14:this.saving=!1,EnketoForm_emitter.emit("EnketoForm.saveSucceded");case 16:case"end":return _context2.stop()}},_callee2,this,[[4,9]])})),function(){return _save.apply(this,arguments)})},{key:"_saveSession",value:(_saveSession2=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.t0=sessions_SessionManager,_context3.next=3,this._form();case 3:return _context3.t1=_context3.sent,_context3.next=6,_context3.t0.save.call(_context3.t0,_context3.t1);case 6:case"end":return _context3.stop()}},_callee3,this)})),function(){return _saveSession2.apply(this,arguments)})},{key:"_form",value:(_form2=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.t0=this.form.getDataStr(),_context4.next=3,this._formFiles();case 3:return _context4.t1=_context4.sent,_context4.t2=this._getCurrentPage(),_context4.t3=this.form.instanceID,_context4.t4=this.form.deprecatedID,_context4.abrupt("return",{xml:_context4.t0,files:_context4.t1,current_page:_context4.t2,instance_id:_context4.t3,deprecated_id:_context4.t4});case 8:case"end":return _context4.stop()}},_callee4,this)})),function(){return _form2.apply(this,arguments)})},{key:"_getCurrentPage",value:function(){return _toConsumableArray(this.form.pages.$activePages).indexOf(this.form.pages.$current[0])}},{key:"_restoreLastPage",value:function(){if(sessions_SessionManager.session.data.current_page&&!(sessions_SessionManager.session.data.current_page<=0)){var page=sessions_SessionManager.session.data.current_page,pagesArr=_toConsumableArray(this.form.pages.$activePages);pagesArr[page]&&this.form.pages.flipTo(pagesArr[page])}}},{key:"_formFiles",value:function(){var files=file_manager.getCurrentFiles();return $('form.or input[type="file"][data-loaded-file-name]').each(function(){files.push($(this).data("loaded-file-name"))}),files}},{key:"_validateForm",value:function(){return QueryParams.a.has("novalidate")?Promise.resolve(!0):this.form.validate()}},{key:"validate",value:(_validate=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var silent,emitEvent,outcome,_args5=arguments;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(silent=0<_args5.length&&void 0!==_args5[0]&&_args5[0],this.validating)return _context5.abrupt("return");_context5.next=3;break;case 3:return emitEvent=makeEmitter(silent),this.validating=!0,emitEvent("EnketoForm.validating"),_context5.next=8,this._validateForm();case 8:return outcome=_context5.sent,emitEvent(outcome?"EnketoForm.validationSucceeded":"EnketoForm.validationFailed"),this.validating=!1,_context5.abrupt("return",outcome);case 12:case"end":return _context5.stop()}},_callee5,this)})),function(){return _validate.apply(this,arguments)})},{key:"finishAndSubmit",value:(_finishAndSubmit=EnketoForm_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return!0,_context6.next=3,this.validate(!0);case 3:if(_context6.sent){_context6.next=5;break}throw new Error("Form cannot be submitted. Check validation errors!");case 5:return _context6.prev=5,_context6.t0=sessions_SessionManager,_context6.next=9,this._form();case 9:return _context6.t1=_context6.sent,_context6.next=12,_context6.t0.finalize.call(_context6.t0,_context6.t1);case 12:_context6.next=18;break;case 14:throw _context6.prev=14,_context6.t2=_context6.catch(5),EnketoForm_emitter.emit("EnketoForm.submitFailed",_context6.t2),_context6.t2;case 18:if(sessions_SessionManager.driver.canSave()&&!QueryParams.a.get("instant_submit"))return _context6.abrupt("return","Survey finished. It's ready to upload!");_context6.next=20;break;case 20:return _context6.abrupt("return","Submission completed. Thank you!");case 21:case"end":return _context6.stop()}},_callee6,this,[[5,14]])})),function(){return _finishAndSubmit.apply(this,arguments)})}]),EnketoForm}()),JumpTo_emitter=__webpack_require__(45);function Kernel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function Kernel_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){Kernel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){Kernel_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function Kernel_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}!function(){if($("#jump-to-block").hide(),"off"!==QueryParams.a.get("jumpto")){var app=angular_default.a.module("jumpTo",["vAccordion"]),_=__webpack_require__(94);app.controller("jumpCtrl",["$scope",function($scope){var rawPages=[];$scope.pages={},$scope.search={label:""},JumpTo_emitter.on("EnketoForm.initialized",function(){return $scope.$apply(function(){$('[role="page"]').each(function(){var page=$(this);$(".question-label.active",page).each(function(){var label=$(this).text();if(!(label.length<2||"."!=label[1])){var firstSpace=label.indexOf(" "),notations=label.substr(0,firstSpace).split(".").filter(function(str){return""!=str});rawPages.push({el:page.children().first(),notations:notations,label:label})}})}),rawPages.forEach(function(page){if(_.set($scope.pages,page.notations.join(".items."),page),1<page.notations.length){page.notations.pop();var parentPage=page.notations.join(".items.");null==_.get($scope.pages,parentPage+".label",null)&&(_.set($scope.pages,parentPage+".label",page.label),_.set($scope.pages,parentPage+".el",page.el))}})})}),$scope.jump=function(page){$scope.accordion.collapseAll(),survey_EnketoForm.form.pages.flipToPageContaining(page.el),setTimeout(function(){$("#jump-to-block").overlay("hide")})},$("#jump-to-close").click(function(){$scope.accordion.collapseAll(),$("#jump-to-block").overlay("hide")})}]),$("#jump-to").click(function(){$("#jump-to-block").overlay("show")}),angular_default.a.bootstrap(document.getElementById("jump-to-block"),["jumpTo"])}else $("#jump-to").remove()}();__webpack_require__(45);var survey_Kernel=new(function(){function Kernel(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Kernel),this.saving=!1,this.validating=!1}var _saveAndExit,_exit,_save2,_submit,_boot;return function(Constructor,protoProps,staticProps){protoProps&&Kernel_defineProperties(Constructor.prototype,protoProps),staticProps&&Kernel_defineProperties(Constructor,staticProps)}(Kernel,[{key:"boot",value:(_boot=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:survey_EnketoForm.init();case 1:case"end":return _context.stop()}},_callee)})),function(){return _boot.apply(this,arguments)})},{key:"submit",value:(_submit=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this=this;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",survey_EnketoForm.finishAndSubmit().then(function(message){return _this.exit({message:message,message_type:"success"})}));case 1:case"end":return _context2.stop()}},_callee2)})),function(){return _submit.apply(this,arguments)})},{key:"_save",value:(_save2=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,survey_EnketoForm.save();case 2:case"end":return _context3.stop()}},_callee3)})),function(){return _save2.apply(this,arguments)})},{key:"exit",value:(_exit=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var message,_args4=arguments;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(message=0<_args4.length&&void 0!==_args4[0]?_args4[0]:null,QueryParams.a.has("return"))return _context4.abrupt("return",window.location=QueryParams.a.getPath("return"));_context4.next=3;break;case 3:window.location="index.html?"+(message?$.param(message):"");case 4:case"end":return _context4.stop()}},_callee4)})),function(){return _exit.apply(this,arguments)})},{key:"saveAndExit",value:(_saveAndExit=Kernel_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:return _context5.next=2,this._save();case 2:return _context5.next=4,this.exit();case 4:case"end":return _context5.stop()}},_callee5,this)})),function(){return _saveAndExit.apply(this,arguments)})}]),Kernel}());$(document).ready(function(){$(".save-progress").click(function(){survey_EnketoForm.save()}),$("#close-button").click(function(){survey_Kernel.saveAndExit()}),$(".validate-form").on("click",function(){survey_EnketoForm.validate()}),$(".first-page-alias").click(function(){$(".first-page").click()}),$(".last-page-alias").click(function(){$(".last-page").click()}),$(".submit-form").on("click",function(){var $self=$(this);return $self.attr("disabled","disabled"),survey_Kernel.submit().catch(function(e){console.error(e),$self.removeAttr("disabled")}),!1})});var Overlays_emitter=__webpack_require__(45);$(document).ready(function(){return Overlays_setBackgroundImage()}),Overlays_emitter.once("EnketoForm.initialized",function(){return Overlays_showSurvey()}),Overlays_emitter.on("EnketoForm.saving",function(){return saving()}),Overlays_emitter.on("EnketoForm.savingProgress",function(total,completed){return savingProgress(total,completed)}),Overlays_emitter.on("EnketoForm.saveFailed",function(){return saveFailed()}),Overlays_emitter.on("EnketoForm.saveSucceded",function(){return saveSucceded()}),Overlays_emitter.on("EnketoForm.validating",function(){return validating()}),Overlays_emitter.on("EnketoForm.validationFailed",function(){return validationFailed()}),Overlays_emitter.on("EnketoForm.validationSucceeded",function(){return validationSucceeded()}),Overlays_emitter.on("EnketoForm.submitting",function(){return submitting()}),Overlays_emitter.on("EnketoForm.submitFailed",function(e){return Overlays_submitFailed(e)}),Overlays_emitter.on("EnketoForm.submitSucceeded",function(){return submitSucceeded()}),Overlays_emitter.on("EnketoForm.submit.status",function(status){return submitStatus(status)});function Overlays_finishSaving(outcome,message){$("#submit-progress").overlay("hide");var $saveProgress=$(".save-progress");$saveProgress.html('<i class="fa fa-save"></i>'),$saveProgress.removeAttr("disabled","disabled"),message&&toastr_default.a[outcome](message)}function Overlays_finishValidating(outcome,message){$(".submit-form").removeAttr("disabled").text($(".submit-form").data("original-content")),toastr_default.a[outcome](message)}var Overlays_setBackgroundImage=function(){if(QueryParams.a.has("bg")){var style="content: ' ';display: block;position: absolute;top: 0;left: 0;width: 100%;height: 100%;opacity: 0.2;z-index: -1;background-image: url('"+QueryParams.a.get("bg")+"');background-size: cover;background-position: center;background-repeat: no-repeat;";$("<style>#loading-block:after { "+style+"}Â </style>").appendTo("head")}},Overlays_showSurvey=function(){sessions_SessionManager.driver.canSave()||document.querySelector(".save-progress").remove(),QueryParams.a.has("readonly")&&(document.querySelector(".save-progress").remove(),document.querySelector(".submit-form").remove(),document.querySelector(".validate-form").remove()),document.querySelector(".form-header").style.display="block",document.querySelector("#submit-progress").style.display="none",document.querySelector("#loading-block").remove(),window.scrollTo(0,0)},saving=function(){var $saveProgress=$(".save-progress");$saveProgress.html('<i class="fa fa-spinner fa-spin"></i>'),$saveProgress.attr("disabled","disabled")},savingProgress=function(_ref){var total=_ref.total,done=_ref.done;1===total&&1===done||($("#submit-progress").overlay("show"),submitStatus("Optimizing attachments... ".concat(done," out of ").concat(total)))},saveFailed=function(){Overlays_finishSaving("error","An error occured while saving this sesssion...")},saveSucceded=function(){Overlays_finishSaving("success",i18n._("survey.saved"))},validating=function(){$(".submit-form").data("original-content",$(".submit-form").text()).attr("disabled","disabled").text("Validating...")},validationFailed=function(){Overlays_finishValidating("error","The form contains validation errors.")},validationSucceeded=function(){Overlays_finishValidating("success","The data looks valid!"),$(".last-page").click()},submitting=function(){$("#submit-progress").overlay("show")},Overlays_submitFailed=function(e){$("#submit-progress").overlay("hide"),toastr_default.a.error("Submission failed","string"==typeof e?e:e.toString())},submitStatus=function(_submitStatus){$("#submit-progress-text").html(_submitStatus)};$(document).ready(function(){if(QueryParams.a.has("css")){var css=QueryParams.a.get("css");0<=css.indexOf(".css")?injectLinkTag(css):injectCss(css)}});var injectLinkTag=function(path){var link=document.createElement("link");link.id="ssas_enketo_custom_css_link",link.rel="stylesheet",link.href=path,document.head.appendChild(link)},injectCss=function(css){var style=document.createElement("style");style.id="ssas_enketo_custom_css_stlye",style.innerHTML=css,document.head.appendChild(style)},SessionModal_emitter=__webpack_require__(45),SessionModal_app=angular_default.a.module("sessionModal",[]);SessionModal_app.filter("timeAgo",function(){return function(value){return new Date(value).toLocaleString()}}),SessionModal_app.controller("Controller",function($scope){$scope.form={name:""},$scope.show=!1,$scope.sessions=[],$scope.disableCreateButton=!1,SessionModal_emitter.on("SessionModal.activate",function(){return $scope.$apply(function(){$scope.show=!0})}),SessionModal_emitter.on("SessionModal.updateSessions",function(sessions){return $scope.$apply(function(){$scope.sessions=sessions})}),$scope.createSession=function(){var name=$scope.form.name.trim();if(!name)return $scope.name="",alert("Please enter a session name");$scope.show=!1,$scope.disableCreateButton=!0,SessionModal_emitter.emit("Session.create",name)},$scope.delete=function(session){confirm("Do you really want to delete this session? DATA WILL BE LOST!")&&SessionModal_emitter.emit("Session.delete",session)},$scope.select=function(session){$scope.show=!1,SessionModal_emitter.emit("Session.select",session)}}),angular_default.a.bootstrap(document.getElementById("sessionModal"),["sessionModal"]),toastr_default.a.options={positionClass:"toast-top-left"},survey_Kernel.boot()}],installedModules={},__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=473);function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}var modules,installedModules});